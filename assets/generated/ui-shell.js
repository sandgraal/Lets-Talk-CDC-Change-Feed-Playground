import{r as c,j as n,T as On,S as Ir,R as Or}from"./event-log-widget.js";class Nr{constructor(){this.topics=new Map}publish(t,r){if(r.length===0)return[];const o=this.ensure(t);return r.map(i=>{const u=++o.offset,f={...i,offset:u};return o.queue.push(f),f})}consume(t,r=1){const o=this.ensure(t);return r<=0?[]:o.queue.splice(0,r)}size(t){return this.ensure(t).queue.length}reset(t){if(t){this.topics.delete(t);return}this.topics.clear()}ensure(t){let r=this.topics.get(t);return r||(r={offset:-1,queue:[]},this.topics.set(t,r)),r}}class Dr{constructor(){this.produced=0,this.consumed=0,this.backlog=0,this.lagSamples=[],this.missedDeletes=0,this.writeAmplification=0,this.snapshotRows=0,this.errors=0,this.lagAggregators=new Set}onProduced(t){this.produced+=t.length,this.backlog+=t.length}onConsumed(t){this.consumed+=t.length,this.backlog=Math.max(this.backlog-t.length,0);const r=Date.now();t.forEach(o=>{const i=typeof o.commitTs=="number"?o.commitTs:typeof o.ts_ms=="number"?o.ts_ms:r,u=Math.max(r-i,0);this.lagSamples.push(u)}),this.lagSamples.length>2e3&&this.lagSamples.splice(0,this.lagSamples.length-2e3),this.notifyLagAggregators()}registerLagAggregator(t){return this.lagAggregators.add(t),this.safeInvokeAggregator(t),()=>{this.lagAggregators.delete(t)}}recordMissedDelete(t=1){this.missedDeletes+=t}recordWriteAmplification(t=1){this.writeAmplification+=t}recordSnapshotRows(t){this.snapshotRows=t}recordError(){this.errors+=1}reset(){this.produced=0,this.consumed=0,this.backlog=0,this.lagSamples=[],this.missedDeletes=0,this.writeAmplification=0,this.snapshotRows=0,this.errors=0,this.notifyLagAggregators()}snapshot(){const t=[...this.lagSamples].sort((i,u)=>i-u),r=this.percentile(t,.5),o=this.percentile(t,.95);return{produced:this.produced,consumed:this.consumed,backlog:this.backlog,lagMsP50:r,lagMsP95:o,missedDeletes:this.missedDeletes,writeAmplification:this.writeAmplification,snapshotRows:this.snapshotRows,errors:this.errors}}safeInvokeAggregator(t,r){try{const o=r?[...r]:[...this.lagSamples];t(o)}catch{}}notifyLagAggregators(){if(this.lagAggregators.size===0)return;const t=[...this.lagSamples];this.lagAggregators.forEach(r=>{this.safeInvokeAggregator(r,t)})}percentile(t,r){if(!t.length)return 0;const o=Math.max(t.length-1,0)*r,i=Math.floor(o),u=Math.min(i+1,t.length-1);if(i===u)return t[i];const f=o-i;return t[i]+(t[u]-t[i])*f}}class Rr{constructor(){this.tasks=new Map,this.nextId=1}every(t,r){const o=this.nextId++,i={id:o,interval:t,handler:r};this.tasks.set(o,i);const u=setInterval(()=>r(),t);return i.timerId=u,o}clear(t){if(t!=null){const r=this.tasks.get(t);r&&r.timerId&&clearInterval(r.timerId),this.tasks.delete(t);return}this.tasks.forEach(r=>{const o=r.timerId;o&&clearInterval(o)}),this.tasks.clear()}}class $r{constructor(t,r,o,i,u,f={}){this.mode=t,this.bus=r,this.scheduler=o,this.metrics=i,this.handlers=f,this.state="IDLE",this.topic=u??`cdc.${t.toLowerCase()}`}get currentState(){return this.state}get topicName(){return this.topic}startSnapshot(t){this.state==="IDLE"&&(this.state="SNAPSHOTTING",this.handlers.startSnapshot?.(t,r=>this.emit(r)))}startTailing(){this.state!=="TAILING"&&(this.state="TAILING",this.handlers.startTailing?.(t=>this.emit(t)))}pause(){this.state==="TAILING"&&(this.state="PAUSED")}resume(){this.state==="PAUSED"&&(this.state="TAILING")}stop(){this.state="IDLE",this.scheduler.clear(),this.handlers.stop?.(),this.bus.reset(this.topic),this.metrics.reset()}emit(t){if(t.length===0)return[];const r=this.bus.publish(this.topic,t);return this.metrics.onProduced(r),r}}let Pr=0;const _s=()=>`evt-${Date.now()}-${++Pr}`,Ft=e=>e?JSON.parse(JSON.stringify(e)):null,sn=(e,t)=>`${e}::${t}`,nn=(e,t)=>({id:e.name,type:e.type,nullable:e.nullable??!1,__ts:t}),rn=(e,t,r=`tx-${t}`)=>{const o=e?.id??r,i=typeof e?.index=="number",u=i?e.index:void 0,f=typeof e?.total=="number"?e.total:void 0;let x;return typeof e?.last=="boolean"?x=e.last:i&&typeof f=="number"?x=u>=f-1:x=!e,{id:o,index:u,total:f,last:x}};function Fr(){let e=null,t=null,r=100,o=0;const i=new Map,u=[];let f=0;const x=new Map,j=b=>{const S=x.get(b);return typeof S=="number"&&S>=1?S:(x.set(b,1),1)},w=b=>{const S=j(b),l=S+1;return x.set(b,l),{previous:S,next:l}},k=(b,S,l,h,p)=>{const y=rn(b.txn,p);return{id:_s(),kind:S,table:b.table,before:l?{id:b.pk.id,...l,__ts:p}:void 0,after:h?{id:b.pk.id,...h,__ts:p}:void 0,txnId:y.id,txnIndex:y.index,txnTotal:y.total,txnLast:y.last,commitTs:p,schemaVersion:j(b.table),topic:e?.topic??`cdc.${b.table}`,partition:0}},v=(b,S,l,h)=>{if(!t||!e)return;const{previous:p,next:y}=w(b),T=rn(void 0,h,`schema-${h}`),M={id:_s(),kind:S==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:b,before:S==="DROP_COLUMN"?nn(l,h):void 0,after:S==="ADD_COLUMN"?nn(l,h):void 0,txnId:T.id,txnIndex:T.index,txnTotal:T.total,txnLast:T.last,commitTs:h,schemaVersion:y,topic:e.topic??`cdc.${b}`,partition:0,schemaChange:{action:S,column:l,previousVersion:p,nextVersion:y}};t([M])};return{id:"LOG_BASED",initialise(b){e=b},configure(b){const S=Number(b.fetch_interval_ms??b.fetchIntervalMs);Number.isFinite(S)&&S>0&&(r=S)},startSnapshot(b=[],S){if(t=S,!b.length||(b.forEach(h=>{const p=h.schema?.version??1;x.set(h.name,p),h.rows.forEach(y=>{const T=sn(h.name,y.id);i.set(T,{id:y.id,table:h.name,data:{...y},version:1,updatedAt:y.__ts??0,deleted:!1})})}),e?.metrics.recordSnapshotRows(i.size),!i.size))return;const l=[];i.forEach(h=>{l.push({id:_s(),kind:"INSERT",table:h.table,before:void 0,after:{id:h.id,...h.data,__ts:h.updatedAt},txnId:`snapshot-${h.updatedAt}`,txnIndex:0,txnTotal:1,txnLast:!0,commitTs:h.updatedAt,schemaVersion:j(h.table),topic:e?.topic??`cdc.${h.table}`,partition:0})}),t(l),f=u.length},startTailing(b){t=b},applySource(b){if(!e)return;const S=b.t,l=sn(b.table,b.pk.id);if(j(b.table),b.op==="insert")i.set(l,{id:b.pk.id,table:b.table,data:{...b.after},version:1,updatedAt:S,deleted:!1}),u.push(k(b,"INSERT",null,Ft(b.after),S));else if(b.op==="update"){const h=i.get(l),p=h?Ft(h.data):null,y=h?{...h.data,...b.after}:{...b.after};i.set(l,{id:b.pk.id,table:b.table,data:y,version:(h?.version??0)+1,updatedAt:S,deleted:!1}),u.push(k(b,"UPDATE",p,Ft(y),S))}else if(b.op==="delete"){const h=i.get(l);i.set(l,{id:b.pk.id,table:b.table,data:h?{...h.data}:{},version:(h?.version??0)+1,updatedAt:S,deleted:!0}),u.push(k(b,"DELETE",h?Ft(h.data):null,null,S))}},applySchemaChange(b,S,l,h){e&&(j(b),S==="ADD_COLUMN"?i.forEach((p,y)=>{p.table===b&&(l.name in p.data||(p.data[l.name]=null,i.set(y,{...p,data:{...p.data}})))}):S==="DROP_COLUMN"&&i.forEach((p,y)=>{if(p.table===b&&l.name in p.data){const T={...p.data};delete T[l.name],i.set(y,{...p,data:T})}}),v(b,S,l,h))},tick(b){if(!t||b-o<r)return;const S=u.slice(f);S.length&&(t(S),f=u.length),o=b},pause(){},resume(){},stop(){i.clear(),u.length=0,f=0,t=null,e=null,x.clear(),o=0}}}let Ur=0;const ws=()=>`evt-${Date.now()}-${++Ur}`,on=e=>e?JSON.parse(JSON.stringify(e)):null,an=(e,t)=>`${e}::${t}`,ln=(e,t)=>({id:e.name,type:e.type,nullable:e.nullable??!1,__ts:t}),cn=(e,t,r=`tx-${t}`)=>{const o=e?.id??r,u=!1?e.index:void 0,f=void 0;let x;return x=!0,{id:o,index:u,total:f,last:x}};function Br(){let e=null,t=null,r=1e3,o=!1,i=0;const u=new Map,f=new Map,x=new Map,j=[],w=l=>{const h=x.get(l);return typeof h=="number"&&h>=1?h:(x.set(l,1),1)},k=l=>{const h=w(l),p=h+1;return x.set(l,p),{previous:h,next:p}},v=(l,h,p,y,T,M,N,H)=>{const U=cn(H,M,N);return{id:ws(),kind:p,table:l,before:y?{id:h,...y,__ts:M}:void 0,after:T?{id:h,...T,__ts:M}:void 0,txnId:U.id,txnIndex:U.index,txnTotal:U.total,txnLast:U.last,commitTs:M,schemaVersion:w(l),topic:e?.topic??`cdc.${l}`,partition:0}},b=(l,h,p,y)=>{const{previous:T,next:M}=k(l),N=cn(void 0,y,`schema-${y}`);j.push({id:ws(),kind:h==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:l,before:h==="DROP_COLUMN"?ln(p,y):void 0,after:h==="ADD_COLUMN"?ln(p,y):void 0,txnId:N.id,txnIndex:N.index,txnTotal:N.total,txnLast:N.last,commitTs:y,schemaVersion:M,topic:e?.topic??`cdc.${l}`,partition:0,schemaChange:{action:h,column:p,previousVersion:T,nextVersion:M}})},S=l=>{!l.length||!t||t(l)};return{id:"QUERY_BASED",initialise(l){e=l},configure(l){const h=Number(l.poll_interval_ms??l.pollIntervalMs);Number.isFinite(h)&&h>0&&(r=h),l.include_soft_deletes!=null&&(o=!!l.include_soft_deletes),l.includeSoftDeletes!=null&&(o=!!l.includeSoftDeletes)},startSnapshot(l=[],h){t=h;const p=[];l.forEach(y=>{const T=y.schema?.version??1;x.set(y.name,T),y.rows.forEach(M=>{const N=an(y.name,M.id);u.set(N,{id:M.id,table:y.name,data:{...M},version:1,updatedAt:M.__ts??0,deleted:!1}),f.set(N,1);const{id:H,__ts:U,...we}=M;p.push({id:ws(),kind:"INSERT",table:y.name,before:void 0,after:{id:H,...we,__ts:U??0},txnId:`snapshot-${M.__ts??0}`,txnIndex:0,txnTotal:1,txnLast:!0,commitTs:M.__ts??0,schemaVersion:w(y.name),topic:e?.topic??`cdc.${y.name}`,partition:0})})}),e?.metrics.recordSnapshotRows(p.length),S(p)},startTailing(l){t=l},applySource(l){const h=an(l.table,l.pk.id),p=l.t;if(w(l.table),l.op==="insert")u.set(h,{id:l.pk.id,table:l.table,data:{...l.after},version:1,updatedAt:p,deleted:!1});else if(l.op==="update"){const y=u.get(h),T=y?{...y.data,...l.after}:{...l.after};u.set(h,{id:l.pk.id,table:l.table,data:T,version:(y?.version??0)+1,updatedAt:p,deleted:!1})}else if(l.op==="delete"){const y=u.get(h);u.set(h,{id:l.pk.id,table:l.table,data:y?{...y.data}:{},version:(y?.version??0)+1,updatedAt:p,deleted:!0})}},applySchemaChange(l,h,p,y){w(l),h==="ADD_COLUMN"?u.forEach((T,M)=>{if(T.table!==l||Object.prototype.hasOwnProperty.call(T.data,p.name))return;const N={...T.data,[p.name]:null};u.set(M,{...T,data:N})}):h==="DROP_COLUMN"&&u.forEach((T,M)=>{if(T.table===l&&p.name in T.data){const N={...T.data};delete N[p.name],u.set(M,{...T,data:N})}}),b(l,h,p,y)},tick(l){if(!t||l-i<r)return;const h=[];j.length&&h.push(...j.splice(0,j.length)),u.forEach((p,y)=>{if(p.updatedAt<=i)return;const T=f.get(y)??0;if(p.deleted){o?(h.push(v(p.table,p.id,"DELETE",on(p.data),null,p.updatedAt,`tx-${p.updatedAt}`)),f.set(y,p.version)):(e?.metrics.recordMissedDelete(),f.set(y,p.version));return}if(p.version<=T)return;const M=T===0?"INSERT":"UPDATE";h.push(v(p.table,p.id,M,null,on(p.data),p.updatedAt,`tx-${p.updatedAt}`)),f.set(y,p.version)}),S(h),i=l},stop(){u.clear(),f.clear(),x.clear(),j.length=0,t=null,e=null,i=0}}}let qr=0;const dn=()=>`evt-${Date.now()}-${++qr}`,Ut=e=>e?JSON.parse(JSON.stringify(e)):null,Vr=(e,t)=>`${e}::${t}`,un=(e,t)=>({id:e.name,type:e.type,nullable:e.nullable??!1,__ts:t}),hn=(e,t,r=`tx-${t}`)=>{const o=e?.id??r,i=typeof e?.index=="number",u=i?e.index:void 0,f=typeof e?.total=="number"?e.total:void 0;let x;return typeof e?.last=="boolean"?x=e.last:i&&typeof f=="number"?x=u>=f-1:x=!e,{id:o,index:u,total:f,last:x}};function Gr(){let e=null,t=null,r=250,o=8,i=0,u=0;const f=new Map,x=[],j=new Map,w=l=>{const h=j.get(l);return typeof h=="number"&&h>=1?h:(j.set(l,1),1)},k=l=>{const h=w(l),p=h+1;return j.set(l,p),{previous:h,next:p}},v=(l,h,p,y,T)=>{const M=hn(l.txn,T);return{id:dn(),kind:h,table:l.table,before:p?{id:l.pk.id,...p,__ts:T}:void 0,after:y?{id:l.pk.id,...y,__ts:T}:void 0,txnId:M.id,txnIndex:M.index,txnTotal:M.total,txnLast:M.last,commitTs:T,schemaVersion:w(l.table),topic:e?.topic??`cdc.${l.table}`,partition:0}},b=(l,h,p,y)=>{const{previous:T,next:M}=k(l),N=hn(void 0,y,`schema-${y}`),H={id:dn(),kind:h==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:l,before:h==="DROP_COLUMN"?un(p,y):void 0,after:h==="ADD_COLUMN"?un(p,y):void 0,txnId:N.id,txnIndex:N.index,txnTotal:N.total,txnLast:N.last,commitTs:y,schemaVersion:M,topic:e?.topic??`cdc.${l}`,partition:0,schemaChange:{action:h,column:p,previousVersion:T,nextVersion:M}};x.push({event:H})},S=l=>{!l.length||!t||t(l)};return{id:"TRIGGER_BASED",initialise(l){e=l},configure(l){const h=Number(l.extract_interval_ms??l.extractIntervalMs);Number.isFinite(h)&&h>0&&(r=h);const p=Number(l.trigger_overhead_ms??l.triggerOverheadMs);Number.isFinite(p)&&p>=0&&(o=p)},startSnapshot(l=[],h){t=h,e?.metrics.recordSnapshotRows(0)},startTailing(l){t=l},applySource(l){if(!e)return;const h=Vr(l.table,l.pk.id),p=l.t+o;let y=null,T=null,M;if(w(l.table),l.op==="insert")M="INSERT",T=Ut(l.after),f.set(h,{id:l.pk.id,table:l.table,data:{...l.after},version:1,updatedAt:p,deleted:!1});else if(l.op==="update"){const N=f.get(h);y=N?Ut(N.data):null;const H=N?{...N.data,...l.after}:{...l.after};T=Ut(H),M="UPDATE",f.set(h,{id:l.pk.id,table:l.table,data:H,version:(N?.version??0)+1,updatedAt:p,deleted:!1})}else if(l.op==="delete"){const N=f.get(h);y=N?Ut(N.data):null,T=null,M="DELETE",f.set(h,{id:l.pk.id,table:l.table,data:N?{...N.data}:{},version:(N?.version??0)+1,updatedAt:p,deleted:!0})}else return;x.push({event:v(l,M,y,T,p)}),e.metrics.recordWriteAmplification(1)},applySchemaChange(l,h,p,y){if(!e)return;const T=y+o;w(l),h==="ADD_COLUMN"?f.forEach((M,N)=>{if(M.table===l&&!(p.name in M.data)){const H={...M.data,[p.name]:null};f.set(N,{...M,data:H,version:M.version+1,updatedAt:T})}}):h==="DROP_COLUMN"&&f.forEach((M,N)=>{if(M.table===l&&p.name in M.data){const H={...M.data};delete H[p.name],f.set(N,{...M,data:H,version:M.version+1,updatedAt:T})}}),b(l,h,p,T)},tick(l){if(!t||l-i<r)return;const h=x.slice(u).map(p=>p.event);S(h),u=x.length,i=l},stop(){x.length=0,f.clear(),t=null,e=null,u=0,i=0,j.clear()}}}const Ht={MYSQL_DEBEZIUM:{id:"MYSQL_DEBEZIUM",label:"MySQL · Debezium · Kafka",description:"Debezium tails the MySQL binlog and pushes commits to Kafka for downstream consumers.",docsHint:"https://debezium.io/documentation/reference/stable/connectors/mysql.html",sourceLabel:"MySQL primary",sourceTooltip:"InnoDB workload emitting row-level changes for capture.",logLabel:"MySQL binlog (Debezium)",logTooltip:"Debezium connector streams row-format binlog entries in commit order.",busLabel:"Kafka topic",busTooltip:"Kafka transports Debezium change events (e.g. db.orders) to consumers.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Analytics warehouse, service, or cache subscribing to the Kafka topic.",topicFormat:e=>`db.${e}`,methodCopyOverrides:{polling:{label:"Polling (scheduled SQL)",laneDescription:"Batch jobs diff the MySQL table on an interval to detect divergence.",callout:"Misses hard deletes and rapid updates without custom tracking tables.",whenToUse:"Fallback when binlog access is blocked. Accepts lag and data loss for small tables only.",tooltip:"ETL-style SELECT polling against the MySQL primary."},trigger:{label:"Triggers (audit table)",laneDescription:"AFTER triggers write every mutation into an audit table for downstream extract.",callout:"Adds synchronous latency on the write path and increases operational overhead.",whenToUse:"When connectors are unavailable but you still need complete change history.",tooltip:"MySQL triggers populate audit tables that an extractor drains."},log:{label:"Debezium binlog tail",laneDescription:"Debezium streams row-based binlog events into Kafka with schema evolution support.",callout:"Preferred default: low-impact, ordered, near real-time change capture.",whenToUse:"Standard choice for production MySQL workloads when Kafka + Debezium are available.",tooltip:"Debezium connector tailing the MySQL binlog."}}},POSTGRES_LOGICAL:{id:"POSTGRES_LOGICAL",label:"Postgres · Logical decoding · Kafka",description:"Logical decoding streams Postgres WAL changes (pgoutput/wal2json) into Kafka.",docsHint:"https://www.postgresql.org/docs/current/logicaldecoding.html",sourceLabel:"Postgres primary",sourceTooltip:"OLTP Postgres emitting WAL entries for publications.",logLabel:"Logical replication slot",logTooltip:"Logical decoding slot materialises committed WAL changes via pgoutput or wal2json.",busLabel:"Kafka topic",busTooltip:"Kafka topics per publication (e.g. public.orders) fan out change events.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Consumers applying logical changes into warehouses or services.",topicFormat:e=>`public.${e}`,methodCopyOverrides:{polling:{label:"Polling (snapshot queries)",laneDescription:"Incremental SELECT queries compare current rows to previous snapshots.",callout:"Can't observe deletes or mid-transaction updates without tombstone columns.",whenToUse:"Stopgap for small tables when logical replication isn't permitted.",tooltip:"Periodic comparison queries against Postgres source tables."},trigger:{label:"Triggers (audit schema)",laneDescription:"Triggers populate audit tables that an extractor tails outside the WAL.",callout:"Higher write amplification and maintenance across replicas.",whenToUse:"When WAL access is off-limits yet complete history is required.",tooltip:"AFTER triggers write into audit tables for downstream capture."},log:{label:"Logical decoding stream",laneDescription:"Slot-based logical decoding streams ordered WAL changes through Kafka.",callout:"Best balance: ordered, low-impact capture with schema evolution support.",whenToUse:"Primary choice when you can run wal2json/pgoutput connectors.",tooltip:"Logical replication slot feeding Kafka via connectors."}}},SQLSERVER_CDC:{id:"SQLSERVER_CDC",label:"SQL Server · CDC tables · ETL",description:"SQL Server CDC populates change tables that ETL tools ship downstream.",docsHint:"https://learn.microsoft.com/sql/relational-databases/track-changes/about-change-data-capture-sql-server",sourceLabel:"SQL Server OLTP",sourceTooltip:"Source database with CDC enabled on tracked tables.",logLabel:"CDC change tables",logTooltip:"Log reader agent populates [cdc].[schema_table_CT] from the transaction log.",busLabel:"ETL pipeline",busTooltip:"ADF/SSIS or similar ETL pipelines move captured rows to consumers.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Lakehouse, staging DB, or microservice applying captured rows.",topicFormat:e=>`cdc.${e}_ct`,methodCopyOverrides:{polling:{label:"Polling (T-SQL jobs)",laneDescription:"Scheduled queries compare source tables against a shadow copy.",callout:"Hard deletes vanish and rapid updates collapse to last-write wins.",whenToUse:"Only when CDC can't be enabled. Expect drift and operational overhead.",tooltip:"Agent jobs issuing SELECT deltas against the primary."},trigger:{label:"DB triggers (audit tables)",laneDescription:"DDL-driven triggers write into audit tables that ETL picks up.",callout:"Adds synchronous writes and complicates deployments.",whenToUse:"Fallback for editions without CDC but needing full fidelity.",tooltip:"FOR INSERT/UPDATE/DELETE triggers persisting rows into audit tables."},log:{label:"CDC change table stream",laneDescription:"Native CDC surfaces ordered change rows ready for downstream ETL.",callout:"Balanced approach: leverages log reader agent with minimal code.",whenToUse:"Default when SQL Server Enterprise/Standard CDC is available.",tooltip:"Change Data Capture tables populated by the log reader agent."}}},ORACLE_GG:{id:"ORACLE_GG",label:"Oracle · GoldenGate",description:"GoldenGate extracts Oracle redo into trails that replicat apply downstream.",docsHint:"https://docs.oracle.com/en/middleware/goldengate/",sourceLabel:"Oracle primary",sourceTooltip:"Oracle Database generating redo entries for tracked schemas.",logLabel:"Redo / GoldenGate trail",logTooltip:"Extract captures redo logs into GoldenGate trail files.",busLabel:"GoldenGate distribution",busTooltip:"GoldenGate distribution path replicates changes to targets or Kafka.",destinationLabel:"Replica / downstream sink",destinationTooltip:"Target database, cache, or Kafka topic consuming GoldenGate trails.",topicFormat:e=>`ogg.${e}`,methodCopyOverrides:{polling:{label:"Polling (custom jobs)",laneDescription:"Scripts query Oracle tables for deltas outside of GoldenGate.",callout:"Expensive and incomplete without change tracking columns.",whenToUse:"Rare stopgap for small tables when GoldenGate access is unavailable.",tooltip:"Ad-hoc jobs diffing source tables over DB links or snapshots."},trigger:{label:"Triggers (shadow tables)",laneDescription:"Row-level triggers populate shadow tables for downstream capture.",callout:"Adds redo volume and requires meticulous deployment management.",whenToUse:"Fallback when GoldenGate licensing or access is restricted.",tooltip:"Oracle triggers mirroring mutations into custom staging tables."},log:{label:"GoldenGate redo tail",laneDescription:"GoldenGate Extract/Replicat stream redo into ordered trail files.",callout:"Enterprise-grade: minimal source impact with robust replication semantics.",whenToUse:"Primary approach for Oracle sources requiring guaranteed replication.",tooltip:"GoldenGate Extract reading redo logs into trail files."}}},MONGODB_STREAMS:{id:"MONGODB_STREAMS",label:"MongoDB · Change Streams",description:"Change Streams tail the MongoDB oplog and push updates to subscribers.",docsHint:"https://www.mongodb.com/docs/manual/changeStreams/",sourceLabel:"MongoDB replica set",sourceTooltip:"Replica set primary emitting operations into the oplog.",logLabel:"Change stream (oplog)",logTooltip:"Change Stream cursor streams oplog events filtered per namespace.",busLabel:"Driver subscriber",busTooltip:"Driver / connector pushes stream events to downstream sinks (Kafka/Atlas).",destinationLabel:"Streaming sink",destinationTooltip:"Analytical store or service consuming the stream.",topicFormat:e=>`mongo.${e}`,methodCopyOverrides:{polling:{label:"Polling (find queries)",laneDescription:"Scheduled queries diff collections by last-updated timestamps.",callout:"No delete visibility and heavy load for high-churn collections.",whenToUse:"Only for prototypes without Change Stream or oplog access.",tooltip:"find() queries scanning for updated documents on an interval."},trigger:{label:"Hooks (side-write)",laneDescription:"Application-layer hooks write audit documents alongside originals.",callout:"Requires app changes and doubles write throughput.",whenToUse:"When database triggers/log access is unavailable and app control exists.",tooltip:"Custom middleware duplicating writes into audit collections."},log:{label:"Change Stream tail",laneDescription:"Native Change Stream cursor fans out oplog events in order.",callout:"Recommended: low-latency stream with resume tokens and schema support.",whenToUse:"Default for MongoDB replicas when you can open a Change Stream cursor.",tooltip:"MongoDB Change Stream subscription on the oplog."}}}},zt="cdc_playground_template_filter_v1",Qt="cdc_playground_template_filter_tags_v1",Yt={query:"",tags:[]},Wr=e=>typeof e=="string"?e:"",Nn=e=>{if(!Array.isArray(e))return[];const t=new Set,r=[];return e.forEach(o=>{if(o==null)return;const i=String(o).trim();!i||t.has(i)||(t.add(i),r.push(i))}),r},Ts=e=>{if(!e||typeof e!="object")return{...Yt};const t=Wr(typeof e.query=="string"?e.query:""),r=e.tags;if(Array.isArray(r))return{query:t,tags:Nn(r)};if(typeof r=="string"){const o=r.trim();return{query:t,tags:o?[o]:[]}}return{query:t,tags:[]}},Hr=(e,t)=>{if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(e[r]!==t[r])return!1;return!0},zr=e=>typeof e!="string"?"":e,Qr=e=>{if(typeof e!="string"||e.trim().length===0)return[];try{const t=JSON.parse(e);if(Array.isArray(t))return Nn(t)}catch{}return[]},Kr=e=>{if(!e)return{...Yt};try{const t=zr(e.getItem(zt)),r=Qr(e.getItem(Qt));return{query:t,tags:r}}catch{return{...Yt}}},Jr=(e,t)=>{if(!t)return;const r=Ts(e);try{r.query?t.setItem(zt,r.query):typeof t.removeItem=="function"?t.removeItem(zt):t.setItem(zt,"")}catch{}try{r.tags.length>0?t.setItem(Qt,JSON.stringify(r.tags)):typeof t.removeItem=="function"?t.removeItem(Qt):t.setItem(Qt,"")}catch{}},Yr=e=>typeof e=="string"?e.trim().toLowerCase():"",pn=e=>Array.isArray(e)?e.map(t=>typeof t=="string"?t.trim():"").filter(t=>t.length>0):[],Xr=e=>{const t=[];return e.label&&t.push(e.label),e.description&&t.push(e.description),e.highlight&&t.push(e.highlight),e.name&&t.push(e.name),Array.isArray(e.tags)&&e.tags.length>0&&t.push(e.tags.join(" ")),t.join(" ").toLowerCase()};function Zr(e,t={}){const r=Array.from(e),{liveScenario:o,liveScenarioName:i,tags:u,query:f}=t;if(o){const k=r.findIndex(v=>v.name===o.name);k>=0?r.splice(k,1,o):r.unshift(o)}const x=pn(u),w=Yr(f).split(/\s+/).map(k=>k.trim()).filter(k=>k.length>0);return r.filter(k=>{if(i&&k.name===i)return!0;if(x.length>0){const b=pn(k.tags??[]);if(!x.every(l=>b.includes(l)))return!1}if(w.length===0)return!0;const v=Xr(k);return v?w.every(b=>v.includes(b)):!1})}const Ss=(e,t)=>{Array.isArray(t)&&t.forEach(r=>{if(typeof r!="string")return;const o=r.trim();o.length>0&&e.add(o)})};function eo(e,t={}){const r=new Set;return e.forEach(o=>Ss(r,o.tags)),t.liveScenario&&Ss(r,t.liveScenario.tags),t.additionalTags?.forEach(o=>Ss(r,o)),Array.from(r).sort((o,i)=>o.localeCompare(i))}const Ms=e=>{if(Array.isArray(e))return e.map(t=>Ms(t));if(e&&typeof e=="object"){const t={};return Object.entries(e).forEach(([r,o])=>{t[r]=Ms(o)}),t}return e},Kt=e=>Ms(e),Dn=e=>({...e}),mn=e=>({name:e.name,version:e.version,columns:e.columns.map(Dn)}),to=(e,t)=>typeof t=="boolean"?"bool":typeof t=="number"?/_ts$|timestamp$/i.test(e)?"timestamp":"number":t instanceof Date?"timestamp":"string",so=(e,t=1)=>({name:e,version:t,columns:[{name:"id",type:"string",nullable:!1}]}),fn=e=>{e.columns.some(r=>r.name==="id")||e.columns.unshift({name:"id",type:"string",nullable:!1})},gn=e=>{const t=Kt(e);return t.id=String(t.id),t};class Es{constructor(t=[]){this.tables=new Map,t.forEach(r=>this.upsertTable(r))}upsertTable(t){const r=mn(t.schema);fn(r);const o=new Map;t.rows.forEach(i=>{const u=gn(Kt(i));o.set(u.id,u)}),this.tables.set(t.name,{schema:r,rows:o})}replaceAll(t){this.tables.clear(),t.forEach(r=>this.upsertTable(r))}getTable(t){const r=this.tables.get(t);if(r)return{name:t,schema:mn(r.schema),rows:Array.from(r.rows.values()).map(o=>Kt(o))}}listTables(){return Array.from(this.tables.keys()).map(t=>this.getTable(t)).filter(t=>!!t)}clear(){this.tables.clear()}applyEvents(t){t.forEach(r=>this.applyEvent(r))}applyEvent(t){if(!t?.table)return;if(t.kind==="SCHEMA_ADD_COL"||t.kind==="SCHEMA_DROP_COL"){this.applySchemaChange(t);return}const r=this.ensureTableState(t.table,t.schemaVersion);if(t.schemaVersion&&t.schemaVersion>r.schema.version&&(r.schema.version=t.schemaVersion),t.kind==="DELETE"){const j=t.before?.id??t.after?.id;j!=null&&r.rows.delete(String(j));return}const o=t.after??void 0;if(!o)return;const i=gn(o),u=r.rows.get(i.id),f=u?{...u,...i}:i,x=Kt(f);this.syncSchemaColumns(r,x),r.rows.set(x.id,x)}snapshot(){return this.listTables()}ensureTableState(t,r){let o=this.tables.get(t);return o||(o={schema:so(t,r??1),rows:new Map},this.tables.set(t,o)),r&&r>o.schema.version&&(o.schema.version=r),fn(o.schema),o}applySchemaChange(t){const r=t.schemaChange;if(!r)return;const o=this.ensureTableState(t.table,r.nextVersion??t.schemaVersion);o.schema.version=Math.max(o.schema.version,r.nextVersion??t.schemaVersion??o.schema.version),t.kind==="SCHEMA_ADD_COL"?this.addColumn(o,r.column):t.kind==="SCHEMA_DROP_COL"&&this.dropColumn(o,r.column.name)}addColumn(t,r){const o=t.schema.columns.find(i=>i.name===r.name);o?(o.type=r.type,r.nullable&&(o.nullable=!0)):t.schema.columns.push(Dn(r)),t.rows.forEach(i=>{r.name in i||(i[r.name]=null)})}dropColumn(t,r){r!=="id"&&(t.schema.columns=t.schema.columns.filter(o=>o.name!==r),t.rows.forEach(o=>{r in o&&delete o[r]}))}syncSchemaColumns(t,r){const o=t.schema.columns;Object.entries(r).forEach(([i,u])=>{if(i==="id"||i.startsWith("__"))return;let f=o.find(x=>x.name===i);f||(f={name:i,type:to(i,u)},o.push(f)),u==null&&(f.nullable=!0)})}}const no=2e3,Bt={methods:[],ops:[],tables:[],txns:[]},bn={empty:"No events yet.",noMatch:"No events match the current filters."},xn=e=>{if(!e)return"";try{const t=JSON.stringify(e);return t?t.length>160?`${t.slice(0,160)}…`:t:""}catch{return""}},Rn=e=>{if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const r=t.toLowerCase();return["c","create","insert","i"].includes(r)?"insert":["u","update"].includes(r)?"update":["d","delete"].includes(r)?"delete":r},ro=e=>{const t=Rn(e);if(t==="insert"||t==="update"||t==="delete")return t.toUpperCase();if(typeof e!="string")return"—";const r=e.trim();return r?r.toUpperCase():"—"},oo=({events:e,stats:t,totalCount:r,filters:o={},filterOptions:i,onFiltersChange:u,onDownload:f,onClear:x,onCopyEvent:j,onReplayEvent:w,maxVisibleEvents:k=no,emptyMessage:v,noMatchMessage:b,className:S})=>{const l={methods:i?.methods??Bt.methods,ops:i?.ops??Bt.ops,tables:i?.tables??Bt.tables,txns:i?.txns??Bt.txns},h=c.useMemo(()=>typeof k!="number"||k<=0?e.length:Math.min(k,e.length),[e.length,k]),[p,y]=c.useState(h);c.useEffect(()=>{y(A=>A<h?h:A>e.length?e.length:A)},[h,e.length]);const T=c.useMemo(()=>{const A=Math.max(p,0),z=Math.max(e.length-A,0);return e.slice(z)},[e,p]),M=T.length<e.length,N=p>h,H=()=>{if(!M)return;const A=h>0?h:e.length;y(z=>Math.min(z+A,e.length))},U=()=>{y(h)},we=typeof r=="number"?r:e.length,I=!!o.methodId||!!o.op||!!o.table||!!o.txnId,Ie={empty:v??bn.empty,noMatch:b??bn.noMatch},fe=A=>{if(!u)return;const z={methodId:A.methodId===void 0?o.methodId:A.methodId,op:A.op===void 0?o.op:A.op,table:A.table===void 0?o.table:A.table,txnId:A.txnId===void 0?o.txnId:A.txnId},Z={methodId:z.methodId||void 0,op:z.op||void 0,table:z.table||void 0,txnId:z.txnId||void 0};u(Z)},ze=A=>{const z=xn(A.before),Z=xn(A.after);return!z&&!Z?null:n.jsxs("details",{className:"cdc-event-log__details",children:[n.jsx("summary",{children:"Row image"}),z&&n.jsxs("div",{className:"cdc-event-log__details-row",children:[n.jsx("span",{children:"before"}),n.jsx("code",{children:z})]}),Z&&n.jsxs("div",{className:"cdc-event-log__details-row",children:[n.jsx("span",{children:"after"}),n.jsx("code",{children:Z})]})]})};return n.jsxs("section",{className:`cdc-event-log${S?` ${S}`:""}`,"aria-label":"Event log",role:"region",children:[n.jsxs("header",{className:"cdc-event-log__header",children:[n.jsxs("div",{className:"cdc-event-log__headline",children:[n.jsx("h3",{children:"Event Log"}),t&&n.jsxs("p",{className:"cdc-event-log__stats",children:[n.jsxs("span",{children:["Produced ",t.produced]})," · ",n.jsxs("span",{children:["Consumed ",t.consumed]})," · ",n.jsxs("span",{children:["Backlog ",t.backlog]}),typeof t.snapshotRows=="number"&&n.jsxs(n.Fragment,{children:[" · ",n.jsxs("span",{children:["Snapshot rows ",t.snapshotRows]})]})]})]}),n.jsxs("div",{className:"cdc-event-log__actions",children:[n.jsxs("span",{children:[e.length," events"]}),n.jsx("button",{type:"button",onClick:f,disabled:!f||e.length===0,children:"Download NDJSON"}),n.jsx("button",{type:"button",onClick:x,disabled:!x||we===0,children:"Clear"})]})]}),n.jsxs("div",{className:"cdc-event-log__filters",role:"group","aria-label":"Event log filters",children:[n.jsxs("label",{children:[n.jsx("span",{children:"Method"}),n.jsxs("select",{value:o.methodId??"",onChange:A=>fe({methodId:A.target.value||void 0}),disabled:!u||l.methods.length===0,children:[n.jsx("option",{value:"",children:"All methods"}),l.methods.map(A=>n.jsx("option",{value:A.id,children:A.label},A.id))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Operation"}),n.jsxs("select",{value:o.op??"",onChange:A=>fe({op:A.target.value||void 0}),disabled:!u||l.ops.length===0,children:[n.jsx("option",{value:"",children:"All ops"}),l.ops.map(A=>n.jsx("option",{value:A,children:A.toUpperCase()},A))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Table"}),n.jsxs("select",{value:o.table??"",onChange:A=>fe({table:A.target.value||void 0}),disabled:!u||l.tables.length===0,children:[n.jsx("option",{value:"",children:"All tables"}),l.tables.map(A=>n.jsx("option",{value:A,children:A},A))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Txn"}),n.jsxs("select",{value:o.txnId??"",onChange:A=>fe({txnId:A.target.value||void 0}),disabled:!u||l.txns.length===0,children:[n.jsx("option",{value:"",children:"All txns"}),l.txns.map(A=>n.jsx("option",{value:A,children:A},A))]})]})]}),e.length===0?n.jsx("p",{className:"cdc-event-log__empty",children:we>0||I?Ie.noMatch:Ie.empty}):n.jsxs("ul",{className:"cdc-event-log__list",children:[e.length>T.length&&n.jsxs("li",{className:"cdc-event-log__notice",children:[n.jsxs("span",{children:["Showing latest ",T.length," of ",e.length," events."]}),n.jsxs("div",{className:"cdc-event-log__notice-actions",children:[n.jsx("button",{type:"button",onClick:H,disabled:!M,children:"Load more"}),N&&n.jsx("button",{type:"button",onClick:U,children:"Show latest"})]})]}),T.map(A=>{const z=ro(A.op),Z=Rn(A.op),Zt=typeof A.offset=="number"?A.offset:A.offset==null?"—":A.offset,Se=A.topic??"—",lt=A.table??"—",re=A.pk??"—",Qe=A.txnId??"",Oe=typeof A.tsMs=="number"?A.tsMs:"—",Ne=Z==="insert"||Z==="update"||Z==="delete";return n.jsxs("li",{className:"cdc-event-log__item",children:[n.jsx("span",{className:"cdc-event-log__method",children:A.methodLabel??A.methodId??"—"}),n.jsx("span",{className:"cdc-event-log__op","data-op":z,children:z}),n.jsxs("span",{className:"cdc-event-log__offset",children:["offset ",Zt]}),n.jsx("span",{className:"cdc-event-log__topic",children:Se}),n.jsxs("span",{className:"cdc-event-log__table",children:["table ",lt]}),n.jsxs("span",{className:"cdc-event-log__meta",children:["ts=",Oe,"ms · pk=",re,Qe?` · txn=${Qe}`:""]}),A.meta?n.jsx("span",{className:"cdc-event-log__extra",children:A.meta}):null,w?n.jsx("button",{type:"button",className:"cdc-event-log__replay",onClick:()=>w?.(A),disabled:!Ne,children:"Replay"}):null,n.jsx("button",{type:"button",className:"cdc-event-log__copy",onClick:()=>j?.(A),disabled:!j,children:"Copy"}),ze(A)]},A.id)})]})]})};function ao(e){const t=e.op?.toUpperCase?.()??"?",r=e.pk??"∅",o=e.expectedIndex!=null?`#${e.expectedIndex}`:void 0,i=e.actualIndex!=null?`#${e.actualIndex}`:void 0;return e.type==="missing"?`Missing ${t} for pk=${r} (${o??"expected"} @ ${e.expectedTime??"?"}ms)`:e.type==="extra"?`Unexpected ${t} for pk=${r} (${i??"emitted"} @ ${e.actualTime??"?"}ms)`:`Out-of-order ${t} pk=${r} (expected ${o??"?"} before actual ${i??"?"})`}const io=({diff:e,scenarioName:t,laneId:r,schemaStatus:o,onDiffDetailsOpened:i})=>{if(!e)return null;const{totals:u,issues:f,lag:x}=e,j=u.missing>0||u.extra>0||u.ordering>0,w=f.slice(0,6);let k=null;return o&&(o.hasColumn?o.version<o.expectedVersion&&(k=`Schema behind: v${o.version} (expected v${o.expectedVersion})`):k=`${o.columnName} column missing in destination`),!j&&x.max<=0&&!k?null:n.jsxs("div",{className:"sim-shell__lane-diff","data-has-issues":j?"true":"false",role:"note",children:[n.jsxs("div",{className:"sim-shell__lane-diff-summary",children:[j?n.jsxs(n.Fragment,{children:[u.missing>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--missing",children:[u.missing," missing"]}),u.extra>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--extra",children:[u.extra," extra"]}),u.ordering>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--ordering",children:[u.ordering," ordering"]})]}):n.jsx("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--ok",children:"Operations aligned"}),x.max>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--lag",children:["Max lag ",Math.round(x.max),"ms"]})]}),k&&n.jsx("p",{className:"sim-shell__lane-diff-schema",children:k}),(w.length>0||x.samples.length>0)&&n.jsxs("details",{id:r?`lane-diff-${r}`:void 0,className:"sim-shell__lane-diff-details",onToggle:v=>{v.target.open&&i?.({method:e.method,issueCount:e.issues.length,maxLag:e.lag.max,scenario:t})},children:[n.jsx("summary",{children:"Diff details"}),w.length>0&&n.jsx("ul",{className:"sim-shell__lane-diff-list",children:w.map((v,b)=>n.jsx("li",{children:ao(v)},`${v.type}-${v.op}-${v.pk??"∅"}-${b}`))}),f.length>w.length&&n.jsxs("p",{className:"sim-shell__lane-diff-more",children:["+",f.length-w.length," additional difference(s)"]}),x.samples.length>0&&n.jsxs("div",{className:"sim-shell__lane-diff-lag",children:[n.jsx("h4",{children:"Lag hotspots"}),n.jsx("ul",{children:x.samples.map(v=>n.jsxs("li",{children:[Math.round(v.lagMs),"ms on ",v.op.toUpperCase()," pk=",v.pk??"∅"]},`${v.op}-${v.pk??"∅"}-${v.actualTime??"?"}`))})]})]})]})},ot=On,de=e=>Number.isFinite(e)?e.toLocaleString():"—",yn=e=>Number.isFinite(e)?`${Math.round(e)}ms`:"—",lo=({lanes:e,renderSchemaWalkthrough:t})=>{const r=e.reduce((o,i)=>(o.produced+=i.produced,o.consumed+=i.consumed,o.backlog+=i.backlog,o),{produced:0,consumed:0,backlog:0});return n.jsxs("section",{className:"sim-shell__metrics-dashboard","aria-label":"Runtime metrics",children:[n.jsx("header",{className:"sim-shell__metrics-dashboard-header",children:n.jsxs("div",{children:[n.jsx("h3",{children:"Runtime metrics"}),n.jsxs("p",{children:["Produced ",de(r.produced)," · Consumed ",de(r.consumed)," · Backlog ",de(r.backlog)]})]})}),n.jsx("div",{className:"sim-shell__metrics-dashboard-grid",children:e.map(o=>n.jsxs("article",{className:"sim-shell__metrics-dashboard-card",children:[n.jsx("header",{children:n.jsx("h4",{"data-tooltip":o.tooltip||void 0,children:o.label})}),t&&n.jsx("div",{className:"sim-shell__schema-demo-inline",children:t(o.id)}),n.jsxs("dl",{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Produced"}),n.jsx("dd",{children:de(o.produced)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Consumed"}),n.jsx("dd",{children:de(o.consumed)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Backlog"}),n.jsx("dd",{"data-tooltip":ot.backlog,children:de(o.backlog)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Lag p50"}),n.jsx("dd",{"data-tooltip":ot.lagPercentile,children:yn(o.lagP50)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Lag p95"}),n.jsx("dd",{"data-tooltip":ot.lagPercentile,children:yn(o.lagP95)})]}),typeof o.snapshotRows=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Snapshot rows"}),n.jsx("dd",{"data-tooltip":ot.snapshot,children:de(o.snapshotRows)})]}),(typeof o.inserts=="number"||typeof o.updates=="number"||typeof o.deletes=="number")&&n.jsxs("div",{children:[n.jsx("dt",{children:"Change mix"}),n.jsxs("dd",{children:["C ",de(o.inserts??0)," · U ",de(o.updates??0)," · D ",de(o.deletes??0),typeof o.schemaChanges=="number"&&o.schemaChanges>0?` · Schema ${de(o.schemaChanges)}`:""]})]}),typeof o.missedDeletes=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Missed deletes"}),n.jsx("dd",{"data-tooltip":ot.deleteCapture,children:de(o.missedDeletes)})]}),typeof o.writeAmplification=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Write amplification"}),n.jsxs("dd",{"data-tooltip":ot.triggerWriteAmplification,children:[o.writeAmplification.toFixed(1),"x"]})]})]})]},o.id))})]})},co=({lagMs:e,throughput:t,deletesPct:r,orderingOk:o,consistent:i,writeAmplification:u,insertCount:f,updateCount:x,deleteCount:j,schemaChangeCount:w})=>n.jsxs("div",{role:"status","aria-live":"polite",children:[n.jsxs("span",{children:["Lag: ",e,"ms"]})," ·",n.jsxs("span",{children:["TPS: ",t.toFixed(1)]})," ·",n.jsxs("span",{children:["Deletes: ",Math.round(r),"%"]})," ·",n.jsxs("span",{children:["Ordering: ",o?"OK":"KO"]})," ·",n.jsxs("span",{children:["Consistency: ",i?"OK":"Drift"]})," ","·",n.jsxs("span",{children:["Ops C/U/D: ",f,"/",x,"/",j]}),w>0&&n.jsxs(n.Fragment,{children:[" ","·",n.jsxs("span",{children:["Schema: ",w]})]}),typeof u=="number"&&n.jsxs(n.Fragment,{children:[" ","·",n.jsxs("span",{children:["Trigger WA: ",u.toFixed(1),"x"]})]})]}),uo=({onAdd:e,onDrop:t,columnName:r,disabled:o,disableAdd:i,disableDrop:u,status:f})=>n.jsxs("section",{className:"sim-shell__schema-demo","aria-label":"Schema walkthrough",children:[n.jsxs("header",{children:[n.jsx("h4",{children:"Schema walkthrough"}),n.jsxs("p",{children:["Add or drop ",n.jsx("code",{children:r})," while events stream to compare capture behaviour."]})]}),f?n.jsx("p",{className:"sim-shell__schema-demo-status",children:f}):null,n.jsxs("div",{className:"sim-shell__schema-demo-buttons",children:[n.jsxs("button",{type:"button",onClick:e,disabled:o||i,"data-tour-target":"schema-add",children:["Add ",r]}),n.jsxs("button",{type:"button",onClick:t,disabled:o||u,"data-tour-target":"schema-drop",children:["Drop ",r]})]})]}),vt=e=>{if(Array.isArray(e))return e.map(t=>vt(t));if(e&&typeof e=="object"){const t={};return Object.entries(e).forEach(([r,o])=>{t[r]=vt(o)}),t}return e},qe=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"&&e.trim().length>0){const t=Number(e);return Number.isFinite(t)?t:null}return null},ho=e=>{if(typeof e=="boolean")return e;if(typeof e=="string"){const t=e.trim().toLowerCase();if(t==="true")return!0;if(t==="false")return!1}return null},We=e=>{if(e==null)return null;if(typeof e=="string"){const t=e.trim();return t.length>0?t:null}return typeof e=="number"&&Number.isFinite(e)?String(e):typeof e=="boolean"?e?"true":"false":null},po=e=>{if(!e)return null;if(typeof e=="object"){const r=e;if(r&&Object.prototype.hasOwnProperty.call(r,"id")){const o=We(r.id);return o?{id:o}:null}}const t=We(e);return t?{id:t}:null},mo=e=>{const t=e.event??{},r=We(e.method),o=qe(t.offset),i=qe(t.seq),u=qe(t.ts_ms)??qe(t.tsMs)??qe(t.ts),f=We(t.op),x=We(t.table),j=po(t.pk),w=t.before==null?null:vt(t.before),k=t.after==null?null:vt(t.after),v=We(t.topic),b=t.tx??null,S=We(b?.id??t.txnId),l=qe(b?.index??t.txnIndex),h=qe(b?.total??t.txnTotal),p=ho(b?.last??t.txnLast),y=t.schemaChange==null?null:vt(t.schemaChange);return{method:r??null,offset:o,seq:i,ts_ms:u,op:f,table:x,pk:j,before:w,after:k,topic:v,txn_id:S,txn_index:l,txn_total:h,txn_last:p,schema_change:y}},fo=(e,t={})=>{const r=t.newline??`
`,o=[];for(const i of e){if(!i||typeof i!="object")continue;const u=mo(i);o.push(JSON.stringify(u))}return o.join(r)},go="cdc_telemetry_buffer_v1",bo=200,$n={activation:{key:"activation",label:"Activation",description:"Do new users reach their first comparator insight?"},funnel_drop:{key:"funnel_drop",label:"Funnel drop",description:"Where do users abandon the guided comparator walkthrough?"},adoption:{key:"adoption",label:"Adoption",description:"Which comparator features become part of regular usage?"},quality_gate:{key:"quality_gate",label:"Quality gate",description:"Do reliability issues or errors block comparator adoption?"},scenario_completeness:{key:"scenario_completeness",label:"Scenario completeness",description:"Which templates lead to full replay, export, and comparator review?"},collaboration:{key:"collaboration",label:"Collaboration",description:"How often do teams share scenarios or comparator snapshots?"}},vn={"comparator.scenario.select":"activation","comparator.scenario.preview":"activation","comparator.preset.select":"activation","comparator.scenario.filter":"activation","comparator.scenario.tag_toggle":"funnel_drop","comparator.scenario.tag_clear":"funnel_drop","comparator.summary.copied":"activation","comparator.diff.opened":"funnel_drop","comparator.overlay.inspect":"activation","comparator.schema.change":"activation","comparator.clock.control":"funnel_drop","comparator.consumer.toggle":"funnel_drop","comparator.consumer.rate_toggle":"funnel_drop","comparator.consumer.rate_adjust":"activation","comparator.consumer.rate_reset":"activation","comparator.event.search":"activation","comparator.event.filter":"activation","comparator.panel.layout":"adoption","comparator.event.download":"adoption","comparator.event.clear":"adoption","comparator.event.copy":"activation","comparator.event.copy.error":"quality_gate","comparator.event.replay":"activation","comparator.destination.download":"adoption","comparator.generator.toggle":"adoption","comparator.generator.rate_adjust":"adoption","comparator.generator.burst":"activation","tour.started":"funnel_drop","tour.completed":"activation","tour.dismissed":"funnel_drop","workspace.share.generated":"collaboration","workspace.scenario.imported":"scenario_completeness","workspace.scenario.template_loaded":"activation","workspace.scenario.exported":"scenario_completeness","telemetry.flush":"activation"},Pn=e=>!!e&&typeof e=="object"&&!Array.isArray(e),Xt=e=>{if(!Pn(e))return{};const t={};return Object.keys(e).forEach(r=>{t[r]=e[r]}),t},xo=()=>({getItem:()=>null,setItem:()=>{}}),yo=e=>{try{return e.toISOString()}catch{return new Date().toISOString()}},vo=e=>{if(!Pn(e))return null;const t=typeof e.event=="string"?e.event:null;if(!t)return null;const r=Xt(e.payload),o=Xt(e.context),i=typeof e.recordedAt=="string"?e.recordedAt:typeof e.recorded_at=="string"?e.recorded_at:null,u=i&&!Number.isNaN(Date.parse(i))?i:new Date().toISOString(),f=e.question,x=typeof f=="string"&&f in $n?f:null;return{event:t,payload:r,context:o,question:x,recordedAt:u}},_o=e=>({event:e.event,payload:e.payload,context:e.context,question:e.question,recordedAt:e.recordedAt}),wo=(e={})=>{const t=e.storage??(typeof window<"u"&&window.localStorage?window.localStorage:xo()),r=e.storageKey??go,o=Math.max(1,e.maxEntries??bo),i=e.now??(()=>new Date),u=e.console??(typeof console<"u"?{warn:console.warn.bind(console),debug:console.debug.bind(console)}:{warn:()=>{},debug:()=>{}}),x=(()=>{try{const S=t.getItem(r);if(!S)return[];const l=JSON.parse(S);return Array.isArray(l)?l.map(vo).filter(p=>!!p).slice(-o):[]}catch(S){return u.warn("Telemetry buffer load failed",S),[]}})(),j=()=>{try{const S=x.slice(-o).map(_o);t.setItem(r,JSON.stringify(S))}catch(S){u.warn("Telemetry buffer save failed",S)}};return{buffer:x,track:(S,l={},h={})=>{if(typeof S!="string"||!S.trim())return;const p=S.trim(),y={event:p,payload:Xt(l),context:Xt(h),question:vn[p]??null,recordedAt:yo(i())};x.push(y),x.length>o&&x.splice(0,x.length-o),j(),y.context.debug&&u.debug("[telemetry]",y)},flush:()=>{if(x.length===0)return[];const S=x.slice();return x.length=0,j(),S},questions:()=>Object.values($n).map(S=>({...S})),taxonomy:()=>({...vn})}},So=e=>{const t=new Map,r=i=>{if(!e)return t.get(i)??null;try{const u=e.getItem(i);return typeof u=="string"?u:u??null}catch{return t.get(i)??null}},o=i=>{if(!e)return!1;try{return typeof e.removeItem=="function"?e.removeItem(i):e.setItem(i,""),!0}catch{return!1}};return{getItem(i){return t.has(i)?t.get(i)??null:r(i)},setItem(i,u){if(e)try{e.setItem(i,u),t.delete(i);return}catch{}t.set(i,u)},removeItem(i){t.delete(i),o(i)||t.set(i,null)}}},_n=e=>{const t=e.trim();if(!t.startsWith("|")||t==="|")return[];const r=t.split("|");return r.shift(),r.length>0&&r[r.length-1].trim()===""&&r.pop(),r.map(o=>o.trim())},Fn=e=>{let t=e.trim(),r=!1;const o=["*","_"];let i=!0;for(;i&&t.length>=2;)i=!1,o.forEach(u=>{if(t.startsWith(u)&&t.endsWith(u)){const f=t.slice(u.length,t.length-u.length).trim();f.length>=0&&(t=f,r=!0,i=!0)}});return{text:t,emphasis:r}},Eo=e=>{const t=e.match(/^\[([^\]]+)\]\(([^)]+)\)$/);if(!t)return{text:e};const[,r,o]=t;return{text:r.trim(),href:o.trim()}},Un=e=>e.replace(/&nbsp;/gi," ").replace(/&#160;/g," "),Co=e=>{if(!e)return{text:""};const t=Un(e),{text:r,emphasis:o}=Fn(t),i=Eo(r);return{text:i.text.trim(),href:i.href,emphasis:o}},jo=e=>e.length>0&&e.every(t=>/^:?[-=]+:?$/u.test(t.replace(/\s+/g,""))),Lo=e=>{if(!e.length)return!1;const t=e[0].text.trim().toLowerCase();return t.length>0&&t.includes("no runs")&&t.includes("captured")},ko=e=>{const t=e.split(/\r?\n/).map(x=>x.trim()).filter(x=>x.startsWith("|"));if(t.length<2)return null;const r=_n(t[0]);if(!r.length)return null;const o=r.map(x=>Fn(Un(x)).text),i=t.slice(1),u=[];let f=null;return i.forEach(x=>{const j=_n(x);if(!j.length||jo(j))return;const w=j.map(Co);if(Lo(w)){f=w[0].text.trim();return}w.every(k=>k.text==="")||u.push(w)}),{headers:o,rows:u,placeholder:f}};function To(e,t){const r=structuredClone(e??{}),o=(i,u,f)=>{if(!i)return;const x=i[u],j=typeof x=="string"?x:f,w=j?t[j]:void 0;x!=null&&typeof x=="object"&&"label"in x||(i[u]={label:w?.label??String(j??x??""),tooltip:w?.tooltip,value:typeof x=="number"?x:x?.value??x})};return o(r,"bestLag",r?.bestLagId),o(r,"triggerWriteAmplification",r?.triggerWriteAmplificationId),Array.isArray(r.lanes)&&(r.lanes=r.lanes.map(i=>{const u=typeof i?.method=="string"?i.method:void 0,f=u?t[u]:void 0;return{...i,id:u,label:f?.label??u,tooltip:f?.tooltip}}).filter(Boolean)),r}class Mo{constructor(){this.scenario=null,this.engines=[],this.idx=0,this.now=0,this.playing=!1}attach(t){this.engines=t}load(t){this.scenario=t,this.idx=0,this.now=0,this.playing=!1}reset(t){this.engines.forEach(r=>r.reset(t)),this.idx=0,this.now=0}onTick(t){this.onTickCb=t}start(){this.playing=!0}pause(){this.playing=!1}tick(t){if(!this.playing||!this.scenario)return;this.now+=t;const{ops:r}=this.scenario;for(;this.idx<r.length&&r[this.idx].t<=this.now;){const o=r[this.idx++];this.engines.forEach(i=>i.applySourceOp(o))}this.engines.forEach(o=>o.tick(this.now)),this.onTickCb?.(this.now)}}const Ao=new Set(["c","u","d"]);function Io(e){switch(e.op){case"insert":return"c";case"update":return"u";case"delete":return"d";default:return null}}function Oo(e){return e.map((t,r)=>{const o=Io(t);if(!o)return null;const i=t.pk?.id!=null?String(t.pk.id):"";return{key:`${o}::${i}`,op:o,pk:i,index:r,time:t.t}}).filter(t=>!!t)}function No(e){return e.map((t,r)=>{if(!Ao.has(t.op))return null;const o=t.pk?.id!=null?String(t.pk.id):"",i=t.op;return{key:`${i}::${o}`,op:i,pk:o,index:r,time:t.ts_ms}}).filter(t=>!!t)}function wn(e){const t=new Map;for(const r of e){const o=t.get(r.key);o?o.push(r):t.set(r.key,[r])}return t}function Do(e,t){const r=[],o=[],i=[],u=wn(e),f=wn(t),x=new Set([...u.keys(),...f.keys()]);for(const j of x){const w=u.get(j)??[],k=f.get(j)??[],v=Math.min(w.length,k.length);for(let b=0;b<v;b++){const S=w[b],l=k[b];r.push({expected:S,actual:l,lagMs:Math.max(0,l.time-S.time)})}for(let b=v;b<w.length;b++)o.push(w[b]);for(let b=v;b<k.length;b++)i.push(k[b])}return{matched:r,missing:o,extra:i}}function Ro(e){const t=[],r=[...e].sort((i,u)=>i.actual.index-u.actual.index);let o=-1/0;for(const i of r)i.expected.index<o?t.push({type:"ordering",op:i.expected.op,pk:i.expected.pk,expectedIndex:i.expected.index,actualIndex:i.actual.index,expectedTime:i.expected.time,actualTime:i.actual.time}):o=i.expected.index;return t}function $o(e){return e.filter(t=>t.lagMs>0).sort((t,r)=>r.lagMs-t.lagMs).slice(0,5).map(t=>({op:t.expected.op,pk:t.expected.pk,expectedTime:t.expected.time,actualTime:t.actual.time,lagMs:t.lagMs}))}function Po(e,t,r){const o=Oo(t),i=No(r),{matched:u,missing:f,extra:x}=Do(o,i),j=[];for(const v of f)j.push({type:"missing",op:v.op,pk:v.pk,expectedIndex:v.index,expectedTime:v.time});for(const v of x)j.push({type:"extra",op:v.op,pk:v.pk,actualIndex:v.index,actualTime:v.time});j.push(...Ro(u));const w=$o(u),k=w.reduce((v,b)=>Math.max(v,b.lagMs),0);return{method:e,totals:{missing:j.filter(v=>v.type==="missing").length,extra:j.filter(v=>v.type==="extra").length,ordering:j.filter(v=>v.type==="ordering").length},issues:j,lag:{max:k,samples:w}}}const Fo=`# Harness Nightly History

Run \`GITHUB_TOKEN=... npm run harness:history\` to refresh this summary. The script aggregates the latest Harness Nightly artifacts and records table-level parity results here so the app can surface them inline.

| Run | Date | Conclusion | Events | Missing | Extra | Max Lag (ms) | Tables | Mismatches |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| _No runs captured yet._ |   |   |   |   |   |   |   |   |

`,Uo="workspace",Bo=e=>({...e}),qo=e=>!Array.isArray(e)||e.length===0?[{name:"id",type:"string",pk:!0}]:e.filter(t=>t&&typeof t.name=="string").map(t=>{const r={name:t.name,type:"string",pk:!!t.pk},o=t.type;if(typeof o=="string"){const i=o.toLowerCase();i==="number"||i==="bool"||i==="timestamp"?r.type=i:i==="string"&&(r.type="string")}return typeof t.nullable=="boolean"&&(r.nullable=t.nullable),r}),Vo=e=>e.type?String(e.type).toLowerCase():"string",Go=e=>{const t=e.find(r=>r.pk);return t?.name?t.name:"id"},Sn=(e,t,r)=>Array.isArray(r)&&r.length>0?r.reduce((o,i)=>(i===t||Object.prototype.hasOwnProperty.call(e,i)&&(o[i]=e[i]),o),{}):Object.entries(e).reduce((o,[i,u])=>(i===t||(o[i]=u),o),{}),En=(e,t,r,o)=>{const i=Vo(e);if(i==="number"){const f=t.seq*10+r;return typeof o=="number"?o+1:f}if(i==="bool"||i==="boolean")return typeof o=="boolean"?!o:r%2===0;if(i==="timestamp")return t.logicalTime+r+1;const u=`${t.seq}_${r}_${t.opCounter}`;return`${e.name}_${u}`},Wo=(e,t={})=>{const r=qo(e.schema),o=Go(r),i=new Map;(Array.isArray(e.rows)?e.rows:[]).forEach(j=>{if(!j||typeof j!="object")return;const w=j,k=w[o]??w.id;if(k==null)return;const v=String(k),b={};Object.entries(w).forEach(([S,l])=>{if(S===o){b[S]=String(l);return}S==="id"&&o!=="id"||(b[S]=l)}),Object.prototype.hasOwnProperty.call(b,o)||(b[o]=v),i.set(v,b)});const f=Array.isArray(e.ops)?e.ops.reduce((j,w)=>Math.max(j,w?.t??0),0):0;return{table:typeof e.table=="string"&&e.table.trim().length?e.table:t.fallbackTable??Uo,columns:r,pkField:o,rows:i,logicalTime:f,seq:i.size+1,opCounter:0}},Ho=(e,t,r)=>{const o=Math.max(1,Math.floor(t)||1),i=Array.from(e.rows.keys()),u=e.columns.filter(k=>k.name!==e.pkField);let f="insert";if(i.length>0&&u.length>0){const k=e.opCounter%6;(k===0||k===4)&&i.length>1?f="delete":k===1||k===2||k===3?f="update":f="insert"}else i.length>1&&u.length===0&&(f=e.opCounter%3===0?"delete":"insert");const x=e.opCounter;e.opCounter+=1;const j=Math.max(e.logicalTime,r);e.logicalTime=j+o;const w=e.logicalTime;if(f==="insert"){const k=`gen-${e.seq++}`,v={[e.pkField]:k};u.forEach((l,h)=>{v[l.name]=En(l,e,h)}),e.rows.set(k,v);const b=Sn(v,e.pkField);return{op:{t:w,op:"insert",table:e.table,pk:{id:k},after:b},kind:f}}if(f==="update"&&i.length>0&&u.length>0){const k=x%i.length,v=i[k],b=e.rows.get(v);if(!b)return null;const S=u[x%u.length],l=En(S,e,x,b[S.name]),h=Bo(b);h[S.name]=l,e.rows.set(v,h);const p=Sn(h,e.pkField,[S.name]);return{op:{t:w,op:"update",table:e.table,pk:{id:v},after:p},kind:f}}if(f==="delete"&&i.length>0){const k=x%i.length,v=i[k];return e.rows.delete(v),{op:{t:w,op:"delete",table:e.table,pk:{id:v}},kind:f}}return null};function V(e,t={},r={}){if(typeof window>"u")return;const o=window.telemetry;!o||typeof o.track!="function"||o.track(e,t,r)}function yt(e,t={}){V("comparator.clock.control",{action:e,...t})}function zo({onDiffDetailsOpened:e,...t}){const r=o=>{e?.(o),V("comparator.diff.opened",{method:o.method,issues:o.issueCount,maxLag:o.maxLag,scenario:o.scenario})};return n.jsx(io,{...t,onDiffDetailsOpened:r})}function Qo(e){const t={...e};return e.pk&&(t.pk={...e.pk}),e.after&&(t.after={...e.after}),e.txn&&(t.txn={...e.txn}),t}function Ko(e){if(e==null)return e;try{return JSON.parse(JSON.stringify(e))}catch{return e}}function Jo(e){return{id:e.id,name:e.id||e.name,label:e.label,description:e.description,highlight:e.highlight,stats:{rows:e.rows.length,ops:e.ops.length},table:e.table,tags:[...e.tags],schema:e.schema.length?e.schema.map(t=>({...t})):void 0,rows:e.rows.length?e.rows.map(t=>({...t})):void 0,events:e.events.length?e.events.map(t=>({...t})):void 0,schemaVersion:e.schemaVersion,seed:e.seed,ops:e.ops.map(Qo),comparator:e.comparator?Ko(e.comparator):null}}const Bn=Ir;Bn.length===0&&typeof console<"u"&&console.warn("No scenario templates were loaded from assets/shared-scenarios.js; the comparator scenario gallery will be empty.");const qt=Bn.map(Jo),qn={polling:{label:"Polling (Query)",laneDescription:"Simple, but lossy. Periodic scans read current state only; hard deletes and mid-poll updates can disappear.",callout:"Polling reads current state only. Hard deletes and intermediate updates are not captured.",whenToUse:"Simple, but lossy. Periodic scans read current state only. Hard deletes and intermediate updates between polls are not observable. Good for small, non-critical syncs where some lag and loss is acceptable."},trigger:{label:"Trigger (Audit)",laneDescription:"Complete, but intrusive. Database triggers write to an audit table and add synchronous source overhead.",callout:"Triggers add write overhead to source transactions.",whenToUse:"Complete, but intrusive. Triggers capture every change into an audit table, but add write latency and operational overhead on the source. Use when log access isn’t available."},log:{label:"Log (WAL)",laneDescription:"Default choice. Streams the transaction log post-commit for ordered, low-latency change events.",callout:"Log-based CDC is the preferred default when available.",whenToUse:"Default choice. Reads the database’s transaction log post-commit. Lowest source impact, complete and ordered changes, near-real-time. Requires connector setup and ops discipline."}};typeof window<"u"&&(window.CDC_METHOD_COPY=qn);const Ve="workspace-live",Vn="cdc_comparator_prefs_v1",Ge={name:"priority_flag",type:"bool"},Yo=()=>{if(typeof window>"u")return null;try{return window.localStorage}catch{return null}},Os=(()=>{let e=null,t=null;return()=>{const r=Yo();return(!e||r!==t)&&(e=So(r),t=r),e}})();function Xo(e,t,r,o){if(r.length===0)return 0;const i=e[t]?.metrics.writeAmplification;if(typeof i=="number"&&i>=0)return i;const u=o.ops.filter(f=>f.table===r[0]?.table);return u.length?r.length/u.length:r.length}const it=["polling","trigger","log"],Gn=2,Ae=100,Wn=10,Hn=300,As=120,Zo=10,zn=10,Qn=600,Kn=120,Is=10,Cs=40,ea=5,He=["c","u","d","s"],Cn="MYSQL_DEBEZIUM";function Jt(e){return typeof e=="string"&&Object.prototype.hasOwnProperty.call(Ht,e)}const ue=e=>{if(e==null)return e;try{return JSON.parse(JSON.stringify(e))}catch{return null}},ta=e=>{if(!e)return null;const t=e.methodCopyOverrides?ue(e.methodCopyOverrides)??void 0:void 0;return{id:e.id,label:e.label,description:e.description,docsHint:e.docsHint,sourceLabel:e.sourceLabel,sourceTooltip:e.sourceTooltip,logLabel:e.logLabel,logTooltip:e.logTooltip,busLabel:e.busLabel,busTooltip:e.busTooltip,destinationLabel:e.destinationLabel,destinationTooltip:e.destinationTooltip,methodCopyOverrides:t}};function sa(e,t,r,o,i,u,f,x){const j=ue(e),w=t?ue(t):null,k=ue(r)??[],v=f?ue(f):null,b=Array.from(o.values()).map(l=>ue(l)).filter(l=>!!l),S=x.map(l=>{const h=ue(l.metrics);return h?{method:l.method,eventCount:l.events.length,metrics:h}:null}).filter(l=>!!l);return{preferences:j,summary:w,analytics:k,diffs:b,tags:[...i],preset:ta(u),overlay:v,lanes:S}}function jn(e){return e?!!(e.preferences&&Object.keys(e.preferences).length>0)||!!e.summary||(e.analytics?.length??0)>0||(e.diffs?.length??0)>0||(e.tags?.length??0)>0||!!e.preset||(e.overlay?.length??0)>0||(e.lanes?.length??0)>0:!1}const na=qn,Y=On,js=200,ra=2e3,oa=6;function aa(){if(typeof window>"u")return new Set;const t=window.cdcFeatureFlags?.all?.();if(Array.isArray(t)&&t.length)return new Set(t.map(String));const r=window.APPWRITE_CFG?.featureFlags;return Array.isArray(r)&&r.length?new Set(r.map(String)):new Set}const ia={polling:{pollIntervalMs:500,includeSoftDeletes:!1},trigger:{extractIntervalMs:250,triggerOverheadMs:8},log:{fetchIntervalMs:50}},la={polling:"QUERY_BASED",trigger:"TRIGGER_BASED",log:"LOG_BASED"},ca={polling:"polling",trigger:"trigger",log:"log"},Ln=e=>{switch(e){case"polling":return Br();case"trigger":return Gr();case"log":default:return Fr()}},kn=e=>{if(!e)return null;const t={...e};return delete t.__ts,t},da=e=>{if(e==null)return"—";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="number")return Number.isFinite(e)?e.toString():"—";if(e instanceof Date)return e.toISOString();if(typeof e=="object")try{return JSON.stringify(e)}catch{return"[object]"}return String(e)},Jn=(e,t,r)=>{const o=t.kind==="INSERT"?"c":t.kind==="UPDATE"?"u":t.kind==="DELETE"?"d":"s",i=t.schemaChange?{action:t.schemaChange.action,column:{name:t.schemaChange.column.name,type:t.schemaChange.column.type,nullable:t.schemaChange.column.nullable},previousVersion:t.schemaChange.previousVersion,nextVersion:t.schemaChange.nextVersion}:null,u=t.after?.id??t.before?.id??i?.column?.name??null,f=u!=null?String(u):"";return{source:"demo-db",table:t.table,op:o,pk:{id:f},before:kn(t.before),after:kn(t.after),ts_ms:t.commitTs,tx:{id:t.txnId??`tx-${t.commitTs}`,lsn:typeof t.offset=="number"?t.offset:null,index:typeof t.txnIndex=="number"?t.txnIndex:void 0,total:typeof t.txnTotal=="number"?t.txnTotal:void 0,last:typeof t.txnLast=="boolean"?t.txnLast:typeof t.txnTotal=="number"&&typeof t.txnIndex=="number"?t.txnIndex>=t.txnTotal-1:!0},seq:r,meta:{method:ca[e]},schemaChange:i}};function ua(e,t){const r=new Nr,o=new Dr,i=new Rr,u=`cdc.${e}`;let f=Ln(e),x,j={bus:r,metrics:o,scheduler:i,topic:u},w={},k=0;const v=new Set,b=p=>{const y=p.__seq,T=typeof y=="number"&&y>0?y:++k;return p.__seq=T,{...Jn(e,p,T),offset:p.offset,topic:p.topic??u}},S=p=>y=>{const T=p(y);if(T.length){const M=T.map(N=>b(N));t(M),M.forEach(N=>v.forEach(H=>H(N)))}return T},l=()=>{f.initialise?.(j),f.configure?.(w),x=new $r(la[e],r,i,o,u,{startSnapshot:(p,y)=>f.startSnapshot?.(p,T=>S(y)(T)),startTailing:p=>f.startTailing?.(y=>S(p)(y)),stop:()=>f.stop?.()}),x.startSnapshot([]),x.startTailing()};return l(),{name:e,configure(p){w={...p},f.configure?.(p)},reset(p){x.stop(),i.clear(),o.reset(),r.reset(u),k=0,f=Ln(e),j={bus:r,metrics:o,scheduler:i,topic:u},l()},applySourceOp(p){f.applySource?.(p)},applySchemaChange(p,y,T,M){const N=y==="add"?"ADD_COLUMN":"DROP_COLUMN";f.applySchemaChange?.(p,N,T,M)},tick(p){f.tick?.(p)},onEvent(p){return v.add(p),()=>v.delete(p)},bus:r,metrics:o,topic:u}}function ha(e,t){return ua(e,t)}function at(e){return e.reduce((t,r)=>(t[r]=[],t),{})}function pa(e){return{polling:{...e.polling},trigger:{...e.trigger},log:{...e.log}}}function Vt(e,t,r){let o=typeof e=="number"?e:Number(e);return Number.isFinite(o)?(typeof r=="number"&&(o=Math.max(r,o)),o):t}function Gt(e,t=As){if(typeof e!="number"||!Number.isFinite(e))return t;const r=Math.round(e);return Number.isFinite(r)?Math.min(Hn,Math.max(Wn,r)):t}function Ls(e,t=Kn){if(typeof e!="number"||!Number.isFinite(e))return t;const r=Math.round(e/Is)*Is;return Number.isFinite(r)?Math.min(Qn,Math.max(zn,r)):t}function ks(e,t=it){const r=[...t];if(!Array.isArray(e))return r;const o=[];t.forEach(u=>{e.includes(u)&&!o.includes(u)&&o.push(u)});const i=Math.min(Gn,t.length);return o.length>=i?o:r}function Tn(e){const t=Array.from(He);if(!Array.isArray(e)||e.length===0)return new Set(t);const r=[];return e.forEach(o=>{if(He.includes(o)){const i=o;r.includes(i)||r.push(i)}}),r.length?new Set(r):new Set(t)}function Wt(e,t=it){return typeof e=="string"&&t.includes(e)}function Mn(e){const t=pa(ia);return e&&(e.polling&&(e.polling.pollIntervalMs!=null&&(t.polling.pollIntervalMs=Vt(e.polling.pollIntervalMs,t.polling.pollIntervalMs,50)),e.polling.includeSoftDeletes!=null&&(t.polling.includeSoftDeletes=!!e.polling.includeSoftDeletes)),e.trigger&&(e.trigger.extractIntervalMs!=null&&(t.trigger.extractIntervalMs=Vt(e.trigger.extractIntervalMs,t.trigger.extractIntervalMs,50)),e.trigger.triggerOverheadMs!=null&&(t.trigger.triggerOverheadMs=Vt(e.trigger.triggerOverheadMs,t.trigger.triggerOverheadMs,0))),e.log&&e.log.fetchIntervalMs!=null&&(t.log.fetchIntervalMs=Vt(e.log.fetchIntervalMs,t.log.fetchIntervalMs,10))),t}function ma(){if(typeof window>"u")return null;try{const t=Os().getItem(Vn);if(!t)return null;const r=JSON.parse(t);return{scenarioId:typeof r.scenarioId=="string"?r.scenarioId:void 0,presetId:Jt(r.presetId)?r.presetId:void 0,activeMethods:Array.isArray(r.activeMethods)?r.activeMethods:void 0,methodConfig:r.methodConfig??void 0,userPinnedScenario:typeof r.userPinnedScenario=="boolean"?r.userPinnedScenario:void 0,showEventList:typeof r.showEventList=="boolean"?r.showEventList:void 0,eventOps:Array.isArray(r.eventOps)?r.eventOps:void 0,eventSearch:typeof r.eventSearch=="string"?r.eventSearch:void 0,eventLogTable:typeof r.eventLogTable=="string"?r.eventLogTable:void 0,eventLogTxn:typeof r.eventLogTxn=="string"?r.eventLogTxn:void 0,eventLogMethod:typeof r.eventLogMethod=="string"?r.eventLogMethod:void 0,eventLogOp:typeof r.eventLogOp=="string"?r.eventLogOp:void 0,applyOnCommit:typeof r.applyOnCommit=="boolean"?r.applyOnCommit:void 0,consumerRateEnabled:typeof r.consumerRateEnabled=="boolean"?r.consumerRateEnabled:void 0,consumerRateLimit:typeof r.consumerRateLimit=="number"?r.consumerRateLimit:void 0,generatorEnabled:typeof r.generatorEnabled=="boolean"?r.generatorEnabled:void 0,generatorRate:typeof r.generatorRate=="number"?r.generatorRate:void 0}}catch(e){return console.warn("Comparator prefs load failed",e),null}}function fa(e){if(!(typeof window>"u"))try{Os().setItem(Vn,JSON.stringify(e))}catch(t){console.warn("Comparator prefs save failed",t)}}function ga(e,t,r,o,i,u){const f=e.length?e[e.length-1]:null,x=f?Math.max(t-f.ts_ms,0):t,j=t>0?e.length/(t/1e3):0;let w=0,k=0,v=0,b=0;e.forEach(M=>{M.op==="c"?w+=1:M.op==="u"?k+=1:M.op==="d"&&(v+=1),M.schemaChange&&(b+=1)});const S=r.ops.filter(M=>M.op==="delete").length,l=u?.deletes??0,h=S+l,p=h===0?100:v/h*100,y=e.every((M,N)=>{if(N===0)return!0;const H=e[N-1];return M.ts_ms>=H.ts_ms});return{lagMs:x,throughput:j,deletesPct:p,orderingOk:y,consistent:y&&(o==="polling"?v===h:!0),writeAmplification:o==="trigger"?Xo(i,o,e,r)??0:void 0,insertCount:w,updateCount:k,deleteCount:v,schemaChangeCount:b}}function ba(e){if(e.length===0)return null;const t=[...e].sort((v,b)=>v.metrics.lagMs-b.metrics.lagMs),r=t[0],o=t[t.length-1],i=o.metrics.lagMs-r.metrics.lagMs,u=[...e].sort((v,b)=>v.metrics.deletesPct-b.metrics.deletesPct),f=u[0],x=u[u.length-1],j=e.filter(v=>!v.metrics.orderingOk).map(v=>v.method),w=e.filter(v=>v.method==="trigger"&&typeof v.metrics.writeAmplification=="number"),k=w.length?w.reduce((v,b)=>v.metrics.writeAmplification?b.metrics.writeAmplification&&b.metrics.writeAmplification>v.metrics.writeAmplification?b:v:b):null;return{bestLag:r,worstLag:o,lagSpread:i,lowestDeletes:f,highestDeletes:x,orderingIssues:j,triggerWriteAmplification:k}}function xa(){const e=c.useRef(null);e.current===null&&(e.current=ma());const t=e.current||void 0,r=c.useMemo(()=>Os(),[]),o=c.useMemo(()=>aa(),[]),i=o.size===0||o.has("ff_trigger_mode"),u=o.size===0||o.has("ff_schema_demo"),f=o.size===0||o.has("ff_multitable"),x=o.size===0||o.has("ff_metrics"),j=o.size===0||o.has("ff_walkthrough"),w=c.useMemo(()=>i?[...it]:it.filter(s=>s!=="trigger"),[i]),k=c.useMemo(()=>ks(t?.activeMethods,w),[w,t?.activeMethods]),v=Mn(t?.methodConfig),b=t?.presetId&&Jt(t.presetId)?t.presetId:Cn,S=Wt(t?.eventLogMethod,w)?t?.eventLogMethod:null,l=typeof t?.eventLogOp=="string"&&t.eventLogOp.trim()?t.eventLogOp.trim().toLowerCase():null,h=c.useMemo(()=>typeof window>"u"?{...Yt}:Kr(r),[r]),[p,y]=c.useState(null),[T,M]=c.useState(()=>t?.scenarioId??qt[0].name),[N,H]=c.useState(()=>h.query),[U,we]=c.useState(()=>h.tags),[I,Ie]=c.useState(()=>k),[fe,ze]=c.useState(()=>at(k)),[A,z]=c.useState(()=>at(k)),[Z,Zt]=c.useState(()=>({})),[Se,lt]=c.useState(b),[re,Qe]=c.useState(0),[Oe,Ne]=c.useState(!1),[ge,Yn]=c.useState(!1),[ee,es]=c.useState(()=>v),[ct,_t]=c.useState(!1),[be,dt]=c.useState(()=>t?.eventSearch??""),[Ns,ts]=c.useState(()=>Tn(t?.eventOps)),[Ee,ss]=c.useState(t?.showEventList??!0),[oe,De]=c.useState(t?.eventLogTable??null),[se,Re]=c.useState(t?.eventLogTxn??""),[ae,Ce]=c.useState(S),[ie,je]=c.useState(l),[he,wt]=c.useState(t?.applyOnCommit??!1),[le,ns]=c.useState(t?.consumerRateEnabled??!1),[pe,rs]=c.useState(()=>Gt(t?.consumerRateLimit,As)),[ce,os]=c.useState(t?.generatorEnabled??!1),[ne,as]=c.useState(()=>Ls(t?.generatorRate,Kn)),Le=c.useRef({}),xe=c.useRef({}),Ke=c.useRef({}),Ds=c.useRef(t?.consumerRateEnabled??!1?Gt(t?.consumerRateLimit,As):null),ut=c.useRef(0),is=c.useRef(null),ht=c.useRef(0),Rs=c.useRef(ne),$s=c.useRef(ce),pt=c.useRef({inserts:0,updates:0,deletes:0}),ls=c.useRef({}),Ps=c.useRef(I),Fs=c.useRef(re),B=Ht[Se]??Ht[Cn],Xn=c.useMemo(()=>Object.values(Ht).map(s=>({id:s.id,label:s.label})),[]),$=c.useMemo(()=>{const s=B.methodCopyOverrides??{};return it.reduce((a,d)=>{const m=na[d],C=s[d];return a[d]={label:C?.label??m.label,laneDescription:C?.laneDescription??m.laneDescription,callout:C?.callout??m.callout,whenToUse:C?.whenToUse??m.whenToUse,tooltip:C?.tooltip??m.tooltip},a},{})},[B]),Us=c.useMemo(()=>it.reduce((s,a)=>{const d=$[a];return s[a]={label:d.label,tooltip:d.tooltip},s},{}),[$]),Bs=c.useMemo(()=>new Set(U),[U]),qs=c.useMemo(()=>eo(qt,{liveScenario:p??void 0,additionalTags:[U]}),[p,U]);c.useEffect(()=>{typeof window>"u"||Jr({query:N,tags:U},r)},[N,U,r]);const ke=c.useCallback((s,a)=>{if(typeof window>"u")return;const d=Ts({query:s,tags:a});window.dispatchEvent(new CustomEvent("cdc:scenario-filter",{detail:d}))},[]),St=c.useCallback(s=>{if(!s){Pe.current=!1;return}if("userPinnedScenario"in s&&(Pe.current=!!s.userPinnedScenario),s.activeMethods&&Ie(ks(s.activeMethods,w)),s.methodConfig&&es(Mn(s.methodConfig)),s.scenarioId&&M(s.scenarioId),s.presetId&&Jt(s.presetId)&&lt(s.presetId),"showEventList"in s&&typeof s.showEventList=="boolean"&&ss(s.showEventList),"eventOps"in s&&ts(Tn(s.eventOps)),"eventSearch"in s&&typeof s.eventSearch=="string"&&dt(s.eventSearch),"eventLogTable"in s){const a=typeof s.eventLogTable=="string"&&s.eventLogTable.trim().length>0?s.eventLogTable:null;De(a)}if("eventLogTxn"in s&&Re(typeof s.eventLogTxn=="string"?s.eventLogTxn:""),"eventLogMethod"in s){const a=Wt(s.eventLogMethod,w)?s.eventLogMethod:null;Ce(a)}if("eventLogOp"in s)if(typeof s.eventLogOp=="string"){const a=s.eventLogOp.trim().toLowerCase();je(a||null)}else je(null);"applyOnCommit"in s&&typeof s.applyOnCommit=="boolean"&&wt(s.applyOnCommit),"consumerRateEnabled"in s&&typeof s.consumerRateEnabled=="boolean"&&ns(s.consumerRateEnabled),"consumerRateLimit"in s&&typeof s.consumerRateLimit=="number"&&rs(Gt(s.consumerRateLimit)),"generatorEnabled"in s&&typeof s.generatorEnabled=="boolean"&&os(s.generatorEnabled),"generatorRate"in s&&typeof s.generatorRate=="number"&&as(Ls(s.generatorRate))},[w,Ie,es,M,lt,ss,ts,dt,De,Re,Ce,je,wt,ns,rs,os,as]);c.useEffect(()=>{if(typeof window>"u")return;const s=()=>{ke(N,U)};return window.addEventListener("cdc:scenario-filter-request",s),()=>{window.removeEventListener("cdc:scenario-filter-request",s)}},[ke,N,U]);const $e=c.useMemo(()=>ko(Fo),[]),Et=c.useCallback(s=>{let a=Ke.current[s];return a||(a=new Es,Ke.current[s]=a),a},[]),Je=c.useCallback(s=>{is.current=Wo(s),ht.current=0,pt.current={inserts:0,updates:0,deletes:0}},[]),Ct=c.useCallback((s,a)=>{const d=is.current;if(!d||s<=0)return;const m=Ps.current;if(!m.length)return;const C=ls.current;for(let L=0;L<s;L+=1){const E=Ho(d,a,Fs.current);E&&(m.forEach(_=>{C[_]?.applySourceOp(E.op)}),E.kind==="insert"?pt.current.inserts+=1:E.kind==="update"?pt.current.updates+=1:E.kind==="delete"&&(pt.current.deletes+=1))}},[]),jt=c.useCallback(s=>{if(!$s.current||!is.current)return;const a=Rs.current;if(!Number.isFinite(a)||a<=0)return;ht.current+=a*s/1e3;const d=Math.floor(ht.current);if(d<=0)return;ht.current-=d;const m=d>0?s/d:s;Ct(d,m)},[Ct]),ye=c.useCallback((s,a)=>{const d=Le.current[s];if(!d)return;const m=d.metrics.snapshot(),C=d.bus.size(d.topic);Zt(L=>({...L,[s]:{metrics:m,backlog:C,lastOffset:a?.lastOffset??L[s]?.lastOffset??-1}}))},[]),Vs=c.useCallback((s,a)=>{a.length&&(z(d=>{const m={...d},C=m[s]??[];return m[s]=[...C,...a],m}),ye(s,{lastOffset:a[a.length-1]?.offset??-1}))},[ye]);c.useEffect(()=>{if(typeof window>"u")return;const s=a=>{if(!(a instanceof CustomEvent))return;const d=a.detail,m=Array.isArray(d)?d:[];setFeatureFlags(new Set(m.map(String)))};return window.addEventListener("cdc:feature-flags",s),()=>{window.removeEventListener("cdc:feature-flags",s)}},[]);const Lt=c.useCallback(s=>o.size===0?!0:o.has(s),[o]),kt=Lt("ff_event_bus"),cs=Lt("ff_pause_resume"),Zn=Lt("ff_query_slider"),er=Lt("ff_event_log");c.useEffect(()=>{Ie(s=>{const a=ks(s,w);return a.length===s.length&&a.every((d,m)=>d===s[m])?s:a})},[w]),c.useEffect(()=>{!f&&he&&wt(!1)},[he,f]);const Te=c.useMemo(()=>Array.from(Ns).sort(),[Ns]),Gs=c.useMemo(()=>new Set(Te),[Te]),Ye=c.useMemo(()=>be.trim().toLowerCase().split(/\s+/).filter(Boolean),[be]),Ws=c.useMemo(()=>Ye.join("|"),[Ye]),Hs=c.useRef(new WeakMap),Tt=c.useCallback(s=>{const a=new Set(Te),d=a.size<He.length,m=Ye.length>0,C=Hs.current,L=new Map,E=_=>{const O=C.get(_);if(O)return O;const D=[String(_.seq??""),_.op,_.pk?.id??"",_.table??""];_.after&&D.push(...Object.values(_.after).map(P=>String(P??""))),_.before&&D.push(...Object.values(_.before).map(P=>String(P??"")));const F=D.join(" ").toLowerCase();return C.set(_,F),F};return I.forEach(_=>{const O=s[_]??[];if(!d&&!m){L.set(_,O);return}const D=O.filter(F=>{if(!a.has(F.op))return!1;if(!m)return!0;const P=E(F);return Ye.every(q=>P.includes(q))});L.set(_,D)}),L},[I,Te,Ye]),tr=c.useMemo(()=>Tt(fe),[Tt,fe,Ws]),zs=c.useMemo(()=>Tt(A),[Tt,A,Ws]),mt=c.useMemo(()=>{const s=[],a=new Set,d=new Set,m=new Set;return I.forEach(C=>{(zs.get(C)??[]).forEach(E=>{const _=E.table??"";_&&a.add(_);const O=E.tx?.id??null;O&&d.add(O);const D=typeof E.op=="string"?E.op.trim().toLowerCase():"";D&&m.add(D),s.push({method:C,event:E})})}),s.sort((C,L)=>{const E=C.event.offset??C.event.seq??0,_=L.event.offset??L.event.seq??0;return E!==_?E-_:(C.event.ts_ms??0)-(L.event.ts_ms??0)}),{events:s,tables:Array.from(a).sort(),txns:Array.from(d).sort(),ops:Array.from(m)}},[I,zs]),ds=mt.events,Mt=mt.tables,At=mt.txns,us=c.useMemo(()=>{const s=new Set(mt.ops),a=He.filter(m=>s.has(m)),d=Array.from(s).filter(m=>!He.includes(m));return d.sort(),[...a,...d]},[mt.ops]),Xe=c.useMemo(()=>ds.filter(({method:s,event:a})=>{if(ae&&s!==ae||oe&&(a.table??"")!==oe||se&&(a.tx?.id??"")!==se)return!1;const d=typeof a.op=="string"?a.op.trim().toLowerCase():"";return!(ie&&d!==ie)}),[ds,ae,ie,oe,se]),sr=c.useMemo(()=>Xe.map(({method:s,event:a},d)=>{const m=typeof a.offset=="number"?a.offset:null,C=typeof a.seq=="number"?a.seq:null,L=typeof a.ts_ms=="number"?a.ts_ms:null,E=[s,m!=null?`offset-${m}`:null,C!=null?`seq-${C}`:null,L!=null?`ts-${L}`:null,d].filter(Boolean),_=a.pk?.id!=null?String(a.pk.id):null,O=a.schemaChange?n.jsxs("span",{className:"sim-shell__event-log-schema",children:[a.schemaChange.action==="ADD_COLUMN"?"Added":"Dropped"," column ",a.schemaChange.column.name,` · v${a.schemaChange.previousVersion}→v${a.schemaChange.nextVersion}`]}):void 0;return{id:E.length?E.join("|"):`${s}-${d}`,methodId:s,methodLabel:$[s].label,op:a.op??"",offset:m,topic:a.topic??null,table:a.table??null,tsMs:L,pk:_,txnId:a.tx?.id??null,before:a.before??null,after:a.after??null,meta:O}}),[Xe,$]),nr=c.useMemo(()=>({methodId:ae??void 0,op:ie??void 0,table:oe??void 0,txnId:se||void 0}),[ae,ie,oe,se]),rr=c.useMemo(()=>({methods:w.map(s=>({id:s,label:$[s].label})),ops:us,tables:Mt,txns:At}),[Mt,At,w,$]),ft=c.useMemo(()=>{const s=new Map;return I.forEach(a=>{const m=Et(a).snapshot(),C=["table","id"],L=new Set(C);let E=1;m.forEach(D=>{E=Math.max(E,D.schema?.version??1),D.schema?.columns.forEach(F=>{if(!F)return;const P=F.name;!P||P==="id"||P.startsWith("__")||L.has(P)||(L.add(P),C.push(P))})}),m.forEach(D=>{D.rows.forEach(F=>{Object.keys(F).forEach(P=>{P==="id"||P.startsWith("__")||L.has(P)||(L.add(P),C.push(P))})})});const _=m.flatMap(D=>D.rows.map(F=>{const P=String(F.id),q={};return C.forEach(G=>{if(G==="table"||G==="id"||G.startsWith("__"))return;const Q=F[G];q[G]=Q??null}),{id:`${D.name}::${P}`,displayId:P,table:D.name,values:q}})).sort((D,F)=>D.id.localeCompare(F.id,void 0,{numeric:!0,sensitivity:"base"})),O=L.has(Ge.name);s.set(a,{columns:C,rows:_,schemaVersion:E,hasSchemaColumn:O})}),s},[I,Et,fe]),Qs=c.useRef(Oe),It=c.useRef(0);c.useEffect(()=>{ae&&!I.includes(ae)&&Ce(null)},[I,ae]),c.useEffect(()=>{oe&&!Mt.includes(oe)&&De(null)},[Mt,oe]),c.useEffect(()=>{ie&&!us.includes(ie)&&je(null)},[us,ie]),c.useEffect(()=>{se&&!At.includes(se)&&Re("")},[At,se]),c.useEffect(()=>{Ps.current=I},[I]),c.useEffect(()=>{Fs.current=re},[re]),c.useEffect(()=>{$s.current=ce,ce||(ht.current=0)},[ce]),c.useEffect(()=>{Rs.current=ne},[ne]);const Pe=c.useRef(t?.userPinnedScenario??!1),hs=c.useRef(null),ve=c.useMemo(()=>Zr(qt,{liveScenario:p??void 0,liveScenarioName:Ve,query:N,tags:U}),[p,N,U]),g=c.useMemo(()=>ve.length?ve.find(s=>s.name===T)??ve[0]:qt[0],[T,ve]);c.useEffect(()=>{Je(g)},[g,Je]),c.useEffect(()=>{const s=g.comparator?.preferences;if(!s||typeof s!="object"){hs.current=null;return}hs.current!==g.name&&(St(s),hs.current=g.name)},[St,g]);const Ot=c.useMemo(()=>{const s=new Map;return I.forEach(a=>{const d=ft.get(a);s.set(a,{present:d?.hasSchemaColumn??!1,version:d?.schemaVersion??1})}),s},[I,ft]),gt=c.useMemo(()=>I.length>0?I.every(s=>Ot.get(s)?.present??!1):!1,[I,Ot]),Fe=c.useMemo(()=>{let s=1;return I.forEach(a=>{const d=Ot.get(a);d&&d.version>s&&(s=d.version)}),s},[I,Ot]),Ze=c.useMemo(()=>!!g.tags?.includes("schema"),[g.tags]),Ks=c.useMemo(()=>{if(!Ze)return null;const s=`v${Fe}`;return gt?`${s} · column present`:`${s} · column absent`},[gt,Fe,Ze]);c.useEffect(()=>{It.current=0},[g.name]);const ps=c.useMemo(()=>g.table?g.table:g.ops.find(a=>a.table)?.table??"table",[g.ops,g.table]);c.useEffect(()=>{if(!ct)return;const s=window.setTimeout(()=>_t(!1),2e3);return()=>window.clearTimeout(s)},[ct]),c.useEffect(()=>{if(typeof window>"u")return;const s=window.setTimeout(()=>{V("comparator.event.search",{scenario:g.name,query:be,hasQuery:!!be.trim()})},400);return()=>window.clearTimeout(s)},[be,g.name]),c.useEffect(()=>{Qs.current=Oe},[Oe]),c.useEffect(()=>{ve.length&&(ve.some(s=>s.name===T)||(Pe.current=!1,M(ve[0].name)))},[T,ve]),c.useEffect(()=>{if(!ct)return;const s=window.setTimeout(()=>_t(!1),2e3);return()=>window.clearTimeout(s)},[ct]),c.useEffect(()=>{if(typeof window>"u")return;const s=a=>{if(!(a instanceof CustomEvent))return;const d=Ts(a.detail);H(m=>m===d.query?m:d.query),we(m=>Hr(m,d.tags)?m:d.tags)};return window.addEventListener("cdc:scenario-filter",s),window.dispatchEvent(new CustomEvent("cdc:scenario-filter-request")),()=>{window.removeEventListener("cdc:scenario-filter",s)}},[]),c.useEffect(()=>{if(typeof window>"u")return;const s=a=>{if(!(a instanceof CustomEvent))return;const d=a.detail;if(!d||!d.scenario){y(null);return}const m=Array.isArray(d.scenario.ops)?d.scenario.ops:[],C=d.scenario.label??"Workspace (live)",L=d.scenario.description??`${m.length} operations`,E=d.scenario.seed??1;y({name:Ve,label:C,description:L,seed:E,ops:m})};return window.addEventListener("cdc:workspace-update",s),window.dispatchEvent(new CustomEvent("cdc:workspace-request")),()=>{window.removeEventListener("cdc:workspace-update",s)}},[]),c.useEffect(()=>{p&&p.ops.length&&(Pe.current||M(Ve))},[p]),c.useEffect(()=>{if(typeof window>"u")return;const s=a=>{if(!(a instanceof CustomEvent))return;const d=a.detail;St(d)};return window.addEventListener("cdc:comparator-preferences-set",s),()=>{window.removeEventListener("cdc:comparator-preferences-set",s)}},[St]),c.useEffect(()=>{fa({scenarioId:T,presetId:Se,activeMethods:I,methodConfig:ee,userPinnedScenario:Pe.current,showEventList:Ee,eventOps:Te,eventSearch:be,eventLogTable:oe,eventLogTxn:se,eventLogMethod:ae,eventLogOp:ie,applyOnCommit:he,consumerRateEnabled:le,consumerRateLimit:pe,generatorEnabled:ce,generatorRate:ne})},[T,Se,I,ee,Ee,Te,be,oe,se,ae,ie,he,le,pe,ce,ne]);const Ue=c.useRef(null),Nt=c.useRef(null),me=c.useCallback(()=>{Nt.current!=null&&(window.clearInterval(Nt.current),Nt.current=null)},[]),et=c.useCallback(()=>{if(ge)return;const s={},a=Ds.current;if(a!=null){const E=a*Ae/1e3,_=ut.current+E;ut.current=Math.min(_,a*5)}let d=a==null?Number.POSITIVE_INFINITY:ut.current;const m=E=>E.txnId??`tx-${E.commitTs}`,C=E=>{if(!E.length)return!1;const _=E[E.length-1];return typeof _.txnLast=="boolean"?_.txnLast:typeof _.txnIndex=="number"&&typeof _.txnTotal=="number"?_.txnIndex>=_.txnTotal-1:!0},L=(E,_)=>{const O=xe.current[E]??[];let D=O.length?[...O]:[];if(D.length&&(xe.current[E]=[]),!D.length){const P=_.bus.consume(_.topic,1);if(!P.length)return[];D=P}const F=m(D[0]);for(;!C(D);){const P=_.bus.consume(_.topic,1);if(!P.length)return xe.current[E]=D,[];const q=P[0];if(m(q)!==F){const Q=xe.current[E]??[];xe.current[E]=[q,...Q];break}D.push(q)}return D};for(const E of I){const _=Le.current[E];if(!_)continue;let O=[],D=0;if(he){const q=L(E,_);if(!q.length)continue;if(a!=null&&q.length>d){xe.current[E]=q;continue}O=q,D=q.length}else{const q=xe.current[E]??[];if(q.length){if(a!=null&&q.length>d){xe.current[E]=q;continue}O=[...q],D+=q.length,xe.current[E]=[]}const G=a==null?Number.POSITIVE_INFINITY:d-D;if(a==null?!0:G>=1){const K=a==null?50:Math.min(Math.floor(G),50),J=a==null?50:Math.max(K,0);if(J>0){const te=_.bus.consume(_.topic,J);te.length&&(O=O.length?O.concat(te):te,D+=te.length)}}if(!O.length)continue}a!=null&&(d=Math.max(d-D,0)),Et(E).applyEvents(O),_.metrics.onConsumed(O);const P=O.map(q=>{const G=q.__seq??0;return Jn(E,q,G)});ye(E),s[E]=P}a!=null&&(ut.current=d),Object.keys(s).length!==0&&ze(E=>{const _={...E};for(const[O,D]of Object.entries(s)){const F=_[O]??[];_[O]=[...F,...D]}return _})},[I,he,Et,ge,ye]),Js=c.useCallback(()=>{me(),Nt.current=window.setInterval(()=>{Ue.current?.tick(Ae),jt(Ae),et()},Ae)},[me,et,jt]);c.useEffect(()=>{const s=le?pe:null;Ds.current=s,s==null&&(ut.current=0)},[le,pe]),c.useEffect(()=>{ge||et()},[ge,et]),c.useEffect(()=>{ze(at(I)),z(at(I)),Le.current={},xe.current={},Ke.current={},I.forEach(L=>{Ke.current[L]=new Es}),Qe(0),Ne(!1),me(),Je(g);const s=new Mo,a=[],d={},m={},C=I.map(L=>{const E=ha(L,D=>Vs(L,D));if(m[L]=E,L==="polling"){const D=ee.polling;E.configure({poll_interval_ms:D.pollIntervalMs,include_soft_deletes:D.includeSoftDeletes})}else if(L==="trigger"){const D=ee.trigger;E.configure({extract_interval_ms:D.extractIntervalMs,trigger_overhead_ms:D.triggerOverheadMs})}else{const D=ee.log;E.configure({fetch_interval_ms:D.fetchIntervalMs})}const _={bus:E.bus,metrics:E.metrics,topic:E.topic,applySchemaChange:E.applySchemaChange};d[L]=_;const O=E.onEvent(D=>{ze(F=>{const P={...F},q=P[L]??[];return P[L]=[...q,D],P})});return a.push(O),E});return Le.current=d,ls.current=m,I.forEach(L=>ye(L,{lastOffset:-1})),s.attach(C),s.load(g),s.reset(g.seed),s.onTick(L=>Qe(L)),Ue.current=s,()=>{s.pause(),me(),a.forEach(L=>L()),ls.current={}}},[I,g,me,ee,ye,Vs,Je]);const or=c.useCallback(s=>{Ie(a=>{if(!w.includes(s))return a;const d=Math.min(Gn,w.length);if(a.includes(s))return a.length<=d?a:a.filter(C=>C!==s);const m=[...a,s];return w.filter(C=>m.includes(C))})},[w]),ar=c.useCallback(s=>{ts(a=>{const d=new Set(a);let m=!1;return d.has(s)?d.size>1&&(d.delete(s),m=!0):(d.add(s),m=!0),m&&V("comparator.event.filter",{scenario:g.name,op:s,active:d.has(s)}),m?d:a})},[g.name]),ir=c.useCallback(s=>{dt(s)},[]),lr=c.useCallback(()=>{ss(s=>{const a=!s;return V("comparator.panel.layout",{scenario:g.name,showEvents:a}),a})},[g.name]),cr=c.useCallback(()=>{ns(s=>{const a=!s;return V("comparator.consumer.rate_toggle",{scenario:g.name,enabled:a}),a}),le&&V("comparator.consumer.rate_reset",{scenario:g.name})},[le,g.name]),dr=c.useCallback(s=>{const a=Gt(s,pe);a!==pe&&(rs(a),V("comparator.consumer.rate_adjust",{scenario:g.name,rate:a}))},[pe,g.name]),ur=c.useCallback(()=>{os(s=>{const a=!s;return V("comparator.generator.toggle",{scenario:g.name,enabled:a}),a})},[g.name]),hr=c.useCallback(s=>{const a=Ls(s,ne);a!==ne&&(as(a),V("comparator.generator.rate_adjust",{scenario:g.name,rate:a}))},[ne,g.name]),pr=c.useCallback(()=>{Ct(Cs,ea),V("comparator.generator.burst",{scenario:g.name,count:Cs})},[Ct,g.name]),mr=c.useCallback(s=>{s.methodId&&Wt(s.methodId)?Ce(s.methodId):Ce(null),De(s.table??null),Re(s.txnId??""),je(s.op?s.op.toLowerCase():null)},[Ce,je,De,Re]),fr=c.useCallback(()=>{if(Xe.length===0)return;const s=fo(Xe);if(!s)return;const a=new Blob([s],{type:"application/x-ndjson"}),d=URL.createObjectURL(a),m=document.createElement("a");m.href=d,m.download=`${g.name}-event-log.ndjson`,m.click(),URL.revokeObjectURL(d),V("comparator.event.download",{scenario:g.name,events:Xe.length})},[Xe,g.name]),gr=c.useCallback(s=>{const a=Ke.current[s];if(!a)return;const d=a.snapshot(),m=(g.name||"scenario").replace(/[^a-z0-9-_]+/gi,"-"),C={scenario:g.name,method:s,tables:d},L=new Blob([JSON.stringify(C,null,2)],{type:"application/json"}),E=URL.createObjectURL(L),_=document.createElement("a");_.href=E,_.download=`${m}-${s}-destination.json`,_.click(),URL.revokeObjectURL(E);const O=d.reduce((D,F)=>D+(F.rows?.length??0),0);V("comparator.destination.download",{scenario:g.name,method:s,tables:d.length,rows:O})},[g.name]),br=c.useCallback(()=>{z(s=>{const a={...s};return I.forEach(d=>{a[d]=[]}),a}),Hs.current=new WeakMap,V("comparator.event.clear",{scenario:g.name})},[I,g.name]),xr=c.useCallback(s=>{const a=JSON.stringify({method:s.methodId??null,methodLabel:s.methodLabel??null,op:s.op,offset:s.offset??null,topic:s.topic??null,table:s.table??null,ts_ms:s.tsMs??null,pk:s.pk??null,txnId:s.txnId??null,before:s.before??null,after:s.after??null},null,2);navigator.clipboard.writeText(a).then(()=>V("comparator.event.copy",{scenario:g.name,method:s.methodId??null,op:s.op,offset:s.offset??null})).catch(()=>{V("comparator.event.copy.error",{scenario:g.name,method:s.methodId??null})})},[g.name]),yr=c.useCallback(s=>{if(typeof window>"u")return;const a=typeof s.op=="string"?s.op.trim().toLowerCase():"";if(a!=="c"&&a!=="u"&&a!=="d")return;const d={op:a,before:s.before??null,after:s.after??null,ts_ms:typeof s.tsMs=="number"?s.tsMs:void 0,table:s.table??void 0,key:s.pk?{id:s.pk}:void 0};window.dispatchEvent(new CustomEvent("cdc:workspace-replay-event",{detail:d})),V("comparator.event.replay",{scenario:g.name,method:s.methodId??null,table:s.table??null,op:a})},[g.name]),vr=c.useCallback(s=>{Jt(s)&&(lt(s),V("comparator.preset.select",{presetId:s}))},[]),_r=c.useCallback(s=>{H(s),ke(s,U),V("comparator.scenario.filter",{query:s})},[ke,U]),wr=c.useCallback(s=>{const a=U.includes(s),d=a?U.filter(m=>m!==s):[...U,s];we(d),ke(N,d),V("comparator.scenario.tag_toggle",{tag:s,active:!a})},[ke,N,U]),Sr=c.useCallback(()=>{U.length&&(we([]),ke(N,[]),V("comparator.scenario.tag_clear"))},[ke,N,U]),Er=c.useCallback(s=>{Pe.current=!0,M(s),V("comparator.scenario.select",{scenario:s})},[]),Cr=c.useCallback(s=>{V("comparator.scenario.preview",{scenario:s.name,tags:s.tags??[]}),window.dispatchEvent(new CustomEvent("cdc:preview-scenario",{detail:s}))},[]),X=c.useMemo(()=>I.map(s=>{const a=fe[s]??[];return{method:s,events:a,metrics:ga(a,re,g,s,Z,pt.current)}}),[I,re,fe,g,Z]),Dt=c.useMemo(()=>X.some(s=>s.events.length>0),[X]),bt=c.useMemo(()=>{const s=g.comparator;if(!s||!s.summary)return null;const a=s.summary?ue(s.summary)??s.summary:null;if(!a)return null;const d=To(a,Us),m=ue(s.analytics)??[],C=ue(s.diffs)??[],L=ue(s.overlay)??[],E=s.preset?ue(s.preset)??s.preset:null,_=s.tags.length?[...s.tags]:Array.isArray(g.tags)?[...g.tags]:[],O=m.reduce((G,Q)=>{const K=Number(Q.total);return Number.isFinite(K)?G+K:G},0),D=Array.isArray(s.lanes)?s.lanes.reduce((G,Q)=>{const K=Number(Q.eventCount);return Number.isFinite(K)?G+K:G},0):0,F=typeof g.stats?.ops=="number"&&Number.isFinite(g.stats.ops)?g.stats.ops:g.ops.length,P=O||D||F;if(!(P>0))return null;const q=Array.isArray(s.lanes)?s.lanes.map(G=>{const Q=typeof G.method=="string"?G.method:void 0;if(!Q||!Wt(Q))return null;const K=G.metrics&&typeof G.metrics=="object"&&!Array.isArray(G.metrics)?G.metrics:{},J=(...Pt)=>{for(const vs of Pt){const rt=K[vs];if(typeof rt=="number"&&Number.isFinite(rt))return rt}},te=$[Q];return{id:Q,label:te?.label??Q,tooltip:te?.tooltip,produced:J("produced")??0,consumed:J("consumed")??0,backlog:J("backlog")??0,lagP50:J("lagMsP50","lagP50")??0,lagP95:J("lagMsP95","lagP95")??0,missedDeletes:J("missedDeletes"),writeAmplification:J("writeAmplification"),snapshotRows:J("snapshotRows"),inserts:J("insertCount","inserts")??0,updates:J("updateCount","updates")??0,deletes:J("deleteCount","deletes")??0,schemaChanges:J("schemaChangeCount","schemaChanges")??0}}).filter(G=>!!G):[];return{scenarioName:g.name,scenarioLabel:g.label,scenarioDescription:g.description,isLive:g.name===Ve,totalEvents:P,summary:d,lanes:q,analytics:m,tags:_,preset:E,diffs:C,overlay:L}},[$,Us,g]),_e=c.useMemo(()=>I.reduce((s,a)=>{const d=Z[a],m=d?.metrics,C={backlog:d?.backlog??0,lastOffset:d?.lastOffset??-1,produced:m?.produced??0,consumed:m?.consumed??0,lagMsP50:m?.lagMsP50??0,lagMsP95:m?.lagMsP95??0,missedDeletes:m?.missedDeletes??0,writeAmplification:m?.writeAmplification??0,snapshotRows:m?.snapshotRows??0,errors:m?.errors??0};return s.set(a,C),s},new Map),[I,Z]);c.useEffect(()=>{typeof window>"u"||bt&&(Dt||window.dispatchEvent(new CustomEvent("cdc:comparator-summary",{detail:bt})))},[Dt,bt]);const ms=c.useMemo(()=>I.reduce((s,a)=>s+(_e.get(a)?.backlog??0),0),[I,_e]),jr=c.useMemo(()=>kt?I.reduce((s,a)=>{const d=_e.get(a);return d&&(s.produced+=d.produced,s.consumed+=d.consumed,s.backlog+=d.backlog,s.snapshotRows+=d.snapshotRows),s},{produced:0,consumed:0,backlog:0,snapshotRows:0}):{produced:0,consumed:0,backlog:0,snapshotRows:0},[I,_e,kt]),R=ba(X),Ys=c.useMemo(()=>X.reduce((s,a)=>s+a.events.length,0),[X]),tt=c.useMemo(()=>X.map(({method:s,events:a,metrics:d})=>({method:s,label:$[s].label,total:a.length,inserts:d.insertCount,updates:d.updateCount,deletes:d.deleteCount,schemaChanges:d.schemaChangeCount})),[X,$]),Xs=c.useMemo(()=>tt.reduce((s,a)=>s.set(a.method,a),new Map),[tt]),Me=c.useMemo(()=>{const s=new Map;return X.forEach(({method:a,events:d})=>{s.set(a,Po(a,g.ops,d))}),s},[X,g.ops]),Zs=c.useMemo(()=>x?I.map(s=>{const a=_e.get(s),d=Xs.get(s);return{id:s,label:$[s].label,tooltip:$[s].tooltip,produced:a?.produced??0,consumed:a?.consumed??0,backlog:a?.backlog??0,lagP50:a?.lagMsP50??0,lagP95:a?.lagMsP95??0,missedDeletes:a?.missedDeletes,writeAmplification:a?.writeAmplification,snapshotRows:a?.snapshotRows,inserts:d?.inserts??0,updates:d?.updates??0,deletes:d?.deletes??0,schemaChanges:d?.schemaChanges??0}}):[],[I,Xs,_e,x,$]),xt=c.useMemo(()=>I.map(s=>{const a=_e.get(s),d=$[s].label,m=a?.snapshotRows??0;return`${d} ${m}`}).join(", "),[I,_e,$]),Rt=c.useMemo(()=>I.map(s=>{const a=Me.get(s),d=$[s].label,m=a?.totals??{missing:0,extra:0,ordering:0},C=a?.lag?.max??0,L=[];if(m.missing>0&&L.push({key:"missing",text:`${m.missing} missing`,tone:"missing"}),m.extra>0&&L.push({key:"extra",text:`${m.extra} extra`,tone:"extra"}),m.ordering>0&&L.push({key:"ordering",text:`${m.ordering} ordering`,tone:"ordering"}),C>0&&L.push({key:"lag",text:`${Math.round(C)}ms lag`,tone:"lag"}),Ze){const _=ft.get(s),O=_?.schemaVersion??1;_&&!_.hasSchemaColumn?L.push({key:"schema-missing",text:`${Ge.name} missing`,tone:"schema"}):O<Fe&&L.push({key:"schema-behind",text:`Schema v${O}/${Fe}`,tone:"schema"})}L.length===0&&L.push({key:"ok",text:"Aligned",tone:"ok"});const E=!!a?.issues.length||(a?.lag?.samples?.length??0)>0||(a?.lag?.max??0)>0;return{method:s,label:d,chips:L,hasDetails:E}}),[I,ft,Me,$,Fe,Ze]),en=Pe.current,$t=c.useMemo(()=>{const s={scenarioId:T,presetId:Se,activeMethods:[...I],methodConfig:ee,userPinnedScenario:en,showEventList:Ee,eventOps:Te,eventSearch:be,eventLogTable:oe,eventLogTxn:se,eventLogMethod:ae,eventLogOp:ie,applyOnCommit:he,consumerRateEnabled:le,consumerRateLimit:pe,generatorEnabled:ce,generatorRate:ne};return sa(s,R??null,tt,Me,Array.isArray(g.tags)?g.tags:[],B,Rt,X)},[I,tt,he,le,pe,ae,ie,oe,se,Te,be,ce,ne,Me,X,Rt,ee,B,Se,g,T,Ee,R,en]),Lr=c.useCallback(s=>{const a=new Date().toISOString(),d=jn($t)?$t:s.comparator??$t,m={id:s.id,name:s.name,label:s.label,description:s.description,highlight:s.highlight,tags:s.tags,table:s.table,schemaVersion:s.schemaVersion,seed:s.seed,schema:s.schema??[],rows:s.rows??[],events:s.events??[],ops:s.ops,version:2,exportedAt:a,comparator:d},C=new Blob([JSON.stringify(m,null,2)],{type:"application/json"}),L=document.createElement("a");L.href=URL.createObjectURL(C),L.download=`${s.name}.json`,L.click(),URL.revokeObjectURL(L.href);const E=Array.isArray(s.rows)?s.rows.length:0,_=Array.isArray(s.events)?s.events.length:0;V("workspace.scenario.exported",{scenario:s.name,rows:E,events:_,hasComparator:jn(d),methods:I})},[I,$t,V]);c.useEffect(()=>{typeof window>"u"||window.dispatchEvent(new CustomEvent("cdc:consumer-paused",{detail:{paused:ge,backlog:ms}}))},[ge,ms]);const kr=c.useCallback(()=>{if(!R)return;const s=[];s.push(`${g.label}: ${g.description}`),s.push(`Methods: ${I.map(a=>$[a].label).join(", ")}`),R.bestLag&&s.push(`Fastest ${$[R.bestLag.method].label} at ${Math.round(R.bestLag.metrics.lagMs)}ms`),R.lagSpread>0&&s.push(`${$[R.worstLag.method].label} trails by ${Math.round(R.lagSpread)}ms`),s.push(`Lowest delete capture: ${$[R.lowestDeletes.method].label} (${Math.round(R.lowestDeletes.metrics.deletesPct)}%)`),R.triggerWriteAmplification&&s.push(`Trigger write amplification: ${$[R.triggerWriteAmplification.method].label} ${(R.triggerWriteAmplification.metrics.writeAmplification??0).toFixed(1)}x`),xt&&s.push(`Snapshot rows: ${xt}`),s.push(`Ordering: ${R.orderingIssues.length?R.orderingIssues.map(a=>$[a].label).join(", "):"All lanes aligned"}`),g.tags?.length&&s.push(`Tags: ${g.tags.join(", ")}`),navigator.clipboard.writeText(s.join(`
`)).then(()=>_t(!0)).catch(()=>_t(!1)),V("comparator.summary.copied",{scenario:g.name,tags:g.tags??[],methods:I})},[R,g,I,$,xt]),Tr=c.useCallback(s=>{V("comparator.overlay.inspect",{method:s,scenario:g.name});const a=document.getElementById(`lane-diff-${s}`);a instanceof HTMLDetailsElement?(a.open=!0,a.scrollIntoView({behavior:"smooth",block:"center"})):a&&a.scrollIntoView({behavior:"smooth",block:"center"})},[g.name]),fs=c.useCallback(s=>{if(!u||!g.tags?.includes("schema"))return;const a=Math.max(re,It.current+Ae);It.current=a,I.forEach(d=>{Le.current[d]?.applySchemaChange?.(ps,s,Ge,a),ye(d)}),V("comparator.schema.change",{action:s,table:ps,scenario:g.name,commitTs:a,methods:I})},[I,re,Le,u,ps,g.name,g.tags,ye]),Mr=c.useMemo(()=>{if(!u||!g.tags?.includes("schema"))return;const s=I[0];if(s)return a=>a!==s?null:n.jsx(uo,{columnName:Ge.name,onAdd:()=>fs("add"),onDrop:()=>fs("drop"),disableAdd:gt,disableDrop:!gt,status:Ks})},[I,fs,gt,u,Ks,g.tags]),st=c.useCallback((s,a,d)=>{es(m=>({...m,[s]:{...m[s],[a]:d}}))},[]),nt=c.useCallback(s=>{const a=Ue.current;if(a){Je(g),a.reset(g.seed),ze(at(I)),z(at(I));for(const d of I){Ke.current[d]=new Es;const m=Le.current[d];m&&(m.bus.reset(m.topic),m.metrics.reset(),ye(d,{lastOffset:-1}))}Qe(0),It.current=0,s?.keepLoop||(a.pause(),Ne(!1),me())}},[I,Je,g,g.seed,me,ye]),gs=c.useCallback(()=>{const s=Ue.current;s&&(nt({keepLoop:!0}),s.start(),Ne(!0),Js(),yt("play",{scenario:g.name}))},[nt,Js,g.name]),bs=c.useCallback(()=>{Ue.current?.pause(),Ne(!1),me(),yt("pause",{scenario:g.name})},[me,g.name]),Ar=c.useCallback(()=>{cs&&Yn(s=>{const a=!s;return V("comparator.consumer.toggle",{scenario:g.name,paused:a}),a||et(),a})},[et,cs,g.name]),xs=c.useCallback((s=Ae)=>{const a=Ue.current;if(!a)return;const d=Qs.current;d||a.start(),a.tick(s),jt(s),d||a.pause(),yt("step",{deltaMs:s,scenario:g.name})},[jt,g.name]),tn=c.useCallback((s,a)=>{const d=Ue.current;if(!d)return;const m=Math.max(10,a??Ae);nt({keepLoop:!1});const C=Math.max(s,0);d.start();let L=0,E=0;for(;L<C&&E<1e4;){const _=Math.min(m,C-L);d.tick(_),L+=_,E+=1}d.pause(),Ne(!1),yt("seek",{targetMs:s,stepMs:a,scenario:g.name})},[nt,g.name]),ys=c.useCallback(()=>{dt(""),Ce(null),De(null),je(null),Re(""),nt(),yt("reset",{scenario:g.name})},[nt,g.name,Ce,je,De,Re,dt]);return c.useEffect(()=>{if(typeof window>"u")return;const s={play:()=>gs(),pause:()=>bs(),step:d=>xs(d),seek:(d,m)=>tn(d,m),reset:()=>ys()};window.cdcComparatorClock=s;const a=d=>{if(!(d instanceof CustomEvent))return;const m=d.detail;if(m)switch(m.type){case"play":s.play();break;case"pause":s.pause();break;case"step":s.step(m.deltaMs);break;case"seek":s.seek(m.timeMs,m.stepMs);break;case"reset":s.reset();break}};return window.addEventListener("cdc:comparator-clock",a),()=>{window.removeEventListener("cdc:comparator-clock",a),window.cdcComparatorClock===s&&delete window.cdcComparatorClock}},[bs,ys,tn,gs,xs]),c.useEffect(()=>{typeof window>"u"||window.dispatchEvent(new CustomEvent("cdc:comparator-clock-tick",{detail:{clock:re}}))},[re]),c.useEffect(()=>()=>me(),[me]),c.useEffect(()=>{if(typeof window>"u"||!Dt&&bt)return;const s=R?{lagSpread:R.lagSpread,bestLag:{method:R.bestLag.method,label:$[R.bestLag.method].label,metrics:R.bestLag.metrics},worstLag:{method:R.worstLag.method,label:$[R.worstLag.method].label,metrics:R.worstLag.metrics},lowestDeletes:{method:R.lowestDeletes.method,label:$[R.lowestDeletes.method].label,metrics:R.lowestDeletes.metrics},highestDeletes:{method:R.highestDeletes.method,label:$[R.highestDeletes.method].label,metrics:R.highestDeletes.metrics},orderingIssues:R.orderingIssues.map(_=>({method:_,label:$[_].label})),triggerWriteAmplification:R.triggerWriteAmplification?{method:R.triggerWriteAmplification.method,label:$[R.triggerWriteAmplification.method].label,value:R.triggerWriteAmplification.metrics.writeAmplification??0}:null}:null,a=X.map(({method:_,metrics:O})=>({method:_,label:$[_].label,tooltip:$[_].tooltip,metrics:O})),d=g.table??g.ops.find(_=>_.table)?.table??"table";let m=d;try{m=B.topicFormat(d)}catch{m=d}const C={id:B.id,label:B.label,description:B.description,docsHint:B.docsHint,source:{label:B.sourceLabel,tooltip:B.sourceTooltip},log:{label:B.logLabel,tooltip:B.logTooltip},bus:{label:B.busLabel,tooltip:B.busTooltip,exampleTopic:m},destination:{label:B.destinationLabel,tooltip:B.destinationTooltip},methods:w.map(_=>({id:_,label:$[_].label,tooltip:$[_].tooltip??null}))},L=X.map(({method:_})=>{const O=Me.get(_);return O?{method:_,totals:O.totals,issues:O.issues.slice(0,25),lag:O.lag}:{method:_,totals:{missing:0,extra:0,ordering:0},issues:[],lag:{max:0,samples:[]}}}),E=I.map(_=>{const O=Me.get(_);return O?{method:_,label:$[_].label,totals:O.totals,issues:O.issues.slice(0,10),lag:{max:O.lag.max,samples:O.lag.samples.slice(0,10)}}:{method:_,label:$[_].label,totals:{missing:0,extra:0,ordering:0},issues:[],lag:{max:0,samples:[]}}});window.dispatchEvent(new CustomEvent("cdc:comparator-summary",{detail:{scenarioName:g.name,scenarioLabel:g.label,scenarioDescription:g.description,isLive:g.name===Ve,totalEvents:Ys,summary:s,lanes:a,analytics:tt,tags:U,preset:C,diffs:L,overlay:E}}))},[I,tt,Dt,Me,X,$,B,g,bt,U,R,Ys]),n.jsxs("section",{className:"sim-shell","aria-label":"Simulator preview",children:[n.jsxs("header",{className:"sim-shell__header",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"sim-shell__title",children:"CDC Method Comparator"}),n.jsx("p",{className:"sim-shell__description",children:B.description}),n.jsxs("div",{className:"sim-shell__preset-row",role:"list","aria-label":"Selected vendor pipeline",children:[n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":B.sourceTooltip,role:"listitem",children:["Source · ",B.sourceLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":B.logTooltip,role:"listitem",children:["Capture · ",B.logLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":B.busTooltip,role:"listitem",children:["Transport · ",B.busLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":B.destinationTooltip,role:"listitem",children:["Sink · ",B.destinationLabel]})]}),n.jsxs("p",{className:"sim-shell__description sim-shell__description--meta",children:[B.label,B.docsHint?n.jsxs(n.Fragment,{children:[" · ",n.jsx("a",{href:B.docsHint,target:"_blank",rel:"noopener noreferrer",children:"Reference"})]}):null]})]}),n.jsxs("div",{className:"sim-shell__scenario-filter-row",role:"group","aria-label":"Filter scenarios",children:[n.jsxs("label",{className:"sim-shell__scenario-search",children:[n.jsx("span",{children:"Search scenarios"}),n.jsx("input",{type:"search",value:N,onChange:s=>_r(s.target.value),placeholder:"Find by label, description, or tag"})]}),qs.length>0?n.jsxs("div",{className:"sim-shell__scenario-tags",role:"group","aria-label":"Scenario tags",children:[qs.map(s=>n.jsxs("button",{type:"button",className:"sim-shell__scenario-tag","data-active":Bs.has(s)?"true":"false","aria-pressed":Bs.has(s),onClick:()=>wr(s),children:["#",s]},s)),U.length?n.jsx("button",{type:"button",className:"sim-shell__scenario-tag sim-shell__scenario-tag--clear",onClick:Sr,children:"Clear"}):null]}):null]}),n.jsxs("div",{className:"sim-shell__actions sim-shell__actions--scenario",role:"group","aria-label":"Scenario controls",children:[n.jsx("select",{"aria-label":"Vendor preset",value:Se,onChange:s=>vr(s.target.value),children:Xn.map(s=>n.jsx("option",{value:s.id,children:s.label},s.id))}),n.jsx("select",{"aria-label":"Scenario",value:T,onChange:s=>Er(s.target.value),children:ve.map(s=>n.jsx("option",{value:s.name,children:s.label},s.name))}),n.jsxs("div",{className:"sim-shell__scenario-actions",children:[n.jsx("button",{type:"button",className:"sim-shell__scenario-sync",onClick:()=>{g.name!==Ve&&window.dispatchEvent(new CustomEvent("cdc:apply-scenario-template",{detail:{id:g.name}}))},disabled:g.name===Ve,children:"Load in workspace"}),n.jsx("button",{type:"button",className:"sim-shell__scenario-download",onClick:()=>Lr(g),children:"Download JSON"}),n.jsx("button",{type:"button",className:"sim-shell__scenario-preview",onClick:()=>Cr(g),children:"Preview"})]}),n.jsx("div",{className:"sim-shell__method-toggle",role:"group","aria-label":"Methods to display",children:w.map(s=>n.jsx("button",{type:"button",className:"sim-shell__method-chip","aria-pressed":I.includes(s),onClick:()=>or(s),"data-tooltip":$[s].tooltip||void 0,children:$[s].label},s))})]})]}),n.jsxs("p",{className:"sim-shell__description","aria-live":"polite",children:[n.jsxs("strong",{children:[g.label,":"]})," ",g.description]}),g.highlight&&n.jsx("p",{className:"sim-shell__description sim-shell__description--highlight","aria-live":"polite",children:g.highlight}),g.tags?.length?n.jsx("div",{className:"sim-shell__tag-row","aria-label":"Scenario tags",children:g.tags.map(s=>n.jsxs("span",{className:"sim-shell__tag-chip",children:["#",s]},s))}):null,g.stats&&n.jsxs("p",{className:"sim-shell__description sim-shell__description--meta","aria-live":"polite",children:[g.stats.rows," rows · ",g.stats.ops," ops"]}),n.jsxs("div",{className:"sim-shell__event-filters",role:"group","aria-label":"Event filters",children:[ge&&n.jsx("div",{className:"sim-shell__pause-banner",role:"status","aria-live":"polite",children:"Apply paused. Resume to drain the event bus."}),n.jsxs("label",{className:"sim-shell__event-search",children:[n.jsx("span",{children:"Search events"}),n.jsx("input",{type:"search",value:be,onChange:s=>ir(s.target.value),placeholder:"Filter by pk, seq, or payload"})]}),n.jsx("div",{className:"sim-shell__event-ops",role:"group","aria-label":"Change operations",children:He.map(s=>n.jsx("button",{type:"button",className:"sim-shell__event-op","data-active":Gs.has(s)?"true":"false",onClick:()=>ar(s),children:s.toUpperCase()},s))}),n.jsx("button",{type:"button",className:"sim-shell__event-toggle",onClick:lr,children:Ee?"Hide timeline":"Show timeline"})]}),er&&n.jsx(oo,{className:"sim-shell__event-log",events:sr,stats:jr,totalCount:ds.length,filters:nr,filterOptions:rr,onFiltersChange:mr,onDownload:fr,onClear:br,onCopyEvent:xr,onReplayEvent:yr,maxVisibleEvents:ra}),$e&&($e.rows.length>0||$e.placeholder)&&n.jsx("section",{className:"sim-shell__harness-history","aria-label":"Harness nightly history",children:n.jsxs("details",{children:[n.jsx("summary",{children:"Harness nightly history"}),$e.rows.length>0?n.jsx("div",{className:"sim-shell__harness-history-table-wrapper",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsx("tr",{children:$e.headers.map(s=>n.jsx("th",{children:s},s))})}),n.jsx("tbody",{children:$e.rows.map((s,a)=>n.jsx("tr",{children:s.map((d,m)=>{const C=d.text||"—",L=d.href?n.jsx("a",{href:d.href,target:"_blank",rel:"noreferrer noopener",children:C}):C,E=d.emphasis?n.jsx("em",{children:L}):L;return n.jsx("td",{children:E},`harness-cell-${a}-${m}`)})},`harness-row-${a}`))})]})}):n.jsx("p",{className:"sim-shell__harness-history-empty",children:$e.placeholder??"No harness runs captured yet."})]})}),n.jsxs("div",{className:"sim-shell__actions",role:"group","aria-label":"Playback controls","data-tour-target":j?"comparator-actions":void 0,children:[n.jsx("button",{type:"button",onClick:gs,disabled:Oe,children:"Start"}),n.jsx("button",{type:"button",onClick:bs,disabled:!Oe,children:"Pause"}),n.jsxs("button",{type:"button",onClick:()=>xs(),children:["Step +",Ae,"ms"]}),n.jsx("button",{type:"button",onClick:ys,children:"Reset"}),cs&&n.jsxs("button",{type:"button",onClick:Ar,className:"sim-shell__consumer-toggle","data-tooltip":Y.backlog,children:[ge?"Resume apply":"Pause apply",kt?` (${ms} queued)`:""]}),f&&n.jsxs("label",{className:"sim-shell__apply-toggle","data-tooltip":Y.txnAtomic||void 0,children:[n.jsx("input",{type:"checkbox",checked:he,onChange:s=>wt(s.target.checked)}),n.jsx("span",{children:"Apply on commit"})]}),n.jsxs("div",{className:"sim-shell__consumer-rate",role:"group","aria-label":"Apply rate limit","data-enabled":le?"true":"false",children:[n.jsx("button",{type:"button",onClick:cr,children:le?"Disable throttle":"Throttle apply"}),n.jsxs("label",{children:[n.jsx("span",{children:le?`${pe} events/s`:"Unlimited"}),n.jsx("input",{type:"range",min:Wn,max:Hn,step:Zo,value:pe,onChange:s=>dr(Number(s.target.value)),disabled:!le})]})]}),n.jsxs("div",{className:"sim-shell__generator",role:"group","aria-label":"Event generator","data-enabled":ce?"true":"false",children:[n.jsx("button",{type:"button",onClick:ur,children:ce?"Stop generator":"Start generator"}),n.jsxs("label",{children:[n.jsx("span",{children:ce?`${ne} events/s`:`Set ${ne} events/s`}),n.jsx("input",{type:"range",min:zn,max:Qn,step:Is,value:ne,onChange:s=>hr(Number(s.target.value)),disabled:!ce})]}),n.jsxs("button",{type:"button",onClick:pr,children:["Burst +",Cs]})]})]}),n.jsx("div",{className:"sim-shell__controls","aria-label":"Method tuning controls",children:w.map(s=>{const a=I.includes(s);if(s==="polling"){const m=ee.polling;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":a?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:$[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Adjust poll cadence and whether soft deletes are surfaced."}),Zn?n.jsxs(n.Fragment,{children:[n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsxs("span",{children:["Poll interval (",(m.pollIntervalMs/1e3).toFixed(1),"s)"]}),n.jsx("input",{type:"range",min:500,max:1e4,step:100,value:m.pollIntervalMs,onChange:C=>st("polling","pollIntervalMs",Math.min(1e4,Math.max(500,Number(C.target.value)||500)))})]}),n.jsxs("p",{className:"sim-shell__control-hint",children:["⏱️ Polling every ",(m.pollIntervalMs/1e3).toFixed(1),"s"]})]}):n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Poll interval (ms)"}),n.jsx("input",{type:"number",min:100,step:100,value:m.pollIntervalMs,onChange:C=>st("polling","pollIntervalMs",Math.min(1e4,Math.max(100,Number(C.target.value)||500)))})]}),n.jsxs("label",{className:"sim-shell__control-checkbox",children:[n.jsx("input",{type:"checkbox",checked:m.includeSoftDeletes,onChange:C=>st("polling","includeSoftDeletes",C.target.checked)}),n.jsx("span",{children:"Include soft delete marker column"})]})]},s)}if(s==="trigger"){const m=ee.trigger;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":a?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:$[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Tune audit extractor cadence and per-write trigger overhead."}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Extractor interval (ms)"}),n.jsx("input",{type:"number",min:100,step:50,value:m.extractIntervalMs,onChange:C=>st("trigger","extractIntervalMs",Math.max(50,Number(C.target.value)||0))})]}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Trigger overhead (ms)"}),n.jsx("input",{type:"number",min:0,step:1,value:m.triggerOverheadMs,onChange:C=>st("trigger","triggerOverheadMs",Math.max(0,Number(C.target.value)||0))})]})]},s)}const d=ee.log;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":a?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:$[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Control how frequently the WAL/Binlog fetcher polls for new records."}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Fetch interval (ms)"}),n.jsx("input",{type:"number",min:10,step:10,value:d.fetchIntervalMs,onChange:m=>st("log","fetchIntervalMs",Math.max(10,Number(m.target.value)||0))})]})]},s)})}),x&&R&&n.jsxs("div",{className:"sim-shell__summary","aria-live":"polite",children:[n.jsxs("ul",{children:[n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":Y.lagSpread,children:"Lag spread:"})," ",$[R.bestLag.method].label," is leading at",` ${R.bestLag.metrics.lagMs.toFixed(0)}ms`,R.lagSpread>0?` — ${$[R.worstLag.method].label} trails by ${R.lagSpread.toFixed(0)}ms`:" (no spread)"]}),n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":Y.deleteCapture,children:"Delete capture:"})," ",$[R.lowestDeletes.method].label," is lowest at",` ${R.lowestDeletes.metrics.deletesPct.toFixed(0)}%`," · best is ",$[R.highestDeletes.method].label,` (${R.highestDeletes.metrics.deletesPct.toFixed(0)}%)`]}),xt&&n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":Y.snapshot,children:"Snapshot rows:"})," ",xt]}),R.triggerWriteAmplification&&n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":Y.triggerOverhead,children:"Trigger overhead:"})," ",$[R.triggerWriteAmplification.method].label," is at"," ",`${(R.triggerWriteAmplification.metrics.writeAmplification??0).toFixed(1)}x`," write amplification"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Ordering:"}),R.orderingIssues.length===0?" All methods preserved ordering":` Issues: ${R.orderingIssues.map(s=>$[s].label).join(", ")}`]})]}),n.jsx("button",{type:"button",className:"sim-shell__summary-copy",onClick:kr,children:ct?"Copied":"Copy summary"})]}),Rt.length>0&&n.jsxs("section",{className:"sim-shell__overlay-summary","aria-label":"Lane checks",children:[n.jsxs("header",{children:[n.jsx("h3",{children:"Lane checks"}),n.jsx("p",{children:"Quick glance at diff findings and lag hotspots across active capture methods."})]}),n.jsx("ul",{children:Rt.map(s=>n.jsxs("li",{className:"sim-shell__overlay-row",children:[n.jsx("div",{className:"sim-shell__overlay-label",children:s.label}),n.jsx("div",{className:"sim-shell__overlay-chips",children:s.chips.map(a=>n.jsx("span",{className:`sim-shell__overlay-chip sim-shell__overlay-chip--${a.tone}`,children:a.text},`${s.method}-${a.key}`))}),s.hasDetails&&n.jsx("button",{type:"button",className:"sim-shell__overlay-action",onClick:()=>Tr(s.method),children:"Inspect"})]},s.method))})]}),Zs.length>0&&n.jsx(lo,{lanes:Zs,renderSchemaWalkthrough:Mr}),n.jsx("div",{className:"sim-shell__lane-grid","data-tour-target":j?"comparator-lanes":void 0,children:X.map(({method:s,metrics:a,events:d},m)=>{const C=$[s],L=C.laneDescription,E=Me.get(s)??null,_=m===0,O=_e.get(s),D=Le.current[s],F=ft.get(s),P=F?.rows.slice(0,oa)??[],q=(F?.rows.length??0)>P.length,G=u&&Ze&&F?{version:F.schemaVersion,expectedVersion:Fe,hasColumn:F.hasSchemaColumn,columnName:Ge.name}:u&&Ze?{version:0,expectedVersion:Fe,hasColumn:!1,columnName:Ge.name}:void 0,Q=s==="trigger"?O?.writeAmplification??a.writeAmplification??0:void 0,K=[],J=s==="polling"?"warning":"info";C.callout&&(s==="polling"&&a.deletesPct<100?K.push({text:`${C.callout} (${a.deletesPct.toFixed(0)}% of deletes captured in this scenario)`,tone:J}):K.push({text:C.callout,tone:J})),u&&g.tags?.includes("schema")&&(s==="trigger"&&typeof Q=="number"&&Q>0&&K.push({text:`Write amplification ${Q.toFixed(1)}x (extra audit writes per change)`,tone:"info"}),s==="log"&&K.push({text:"Log capture streams schema changes in-order, keeping downstream versions aligned.",tone:"info"}),s==="polling"&&K.push({text:"Polling picks up new columns once refreshed rows include them; expect interim nulls.",tone:"warning"})),g.tags?.includes("transactions")&&K.push({text:he?"Apply-on-commit groups transaction events before updating destinations so tables stay in sync.":"Apply-on-commit is off: events apply individually, so pausing mid-transaction shows partial state.",tone:he?"info":"warning"});const te=tr.get(s)??d,Pt=te.length!==d.length||Ye.length>0||Gs.size<He.length,vs=Ee&&te.length>js,rt=Ee?te.slice(Math.max(te.length-js,0)):[];return n.jsxs("article",{className:"sim-shell__lane-card",children:[n.jsxs("header",{className:"sim-shell__lane-header","data-tour-target":j&&_&&m===0?"comparator-callouts":void 0,children:[n.jsxs("div",{children:[n.jsx("h3",{className:"sim-shell__lane-title","data-tooltip":C.tooltip||void 0,children:C.label}),n.jsx("p",{className:"sim-shell__lane-copy",children:L})]}),n.jsxs("span",{className:"sim-shell__lane-count",children:[te.length,Pt?` / ${d.length}`:""," events"]})]}),x&&n.jsx("div",{className:"sim-shell__metrics","data-tour-target":j&&_?"comparator-metrics":void 0,children:n.jsx(co,{...a})}),n.jsx(zo,{diff:E,scenarioName:g.name,laneId:s,schemaStatus:G}),kt&&n.jsxs("section",{className:"sim-shell__lane-bus","aria-label":`${C.label} event bus`,"data-paused":ge?"true":"false",children:[n.jsxs("header",{children:[n.jsx("h4",{children:"Event Bus"}),n.jsx("span",{children:D?.topic??`cdc.${s}`})]}),n.jsxs("p",{children:[n.jsxs("span",{"data-tooltip":Y.backlog,children:["Backlog ",n.jsx("strong",{children:O?.backlog??0}),ge?" (apply paused)":""]})," · ",n.jsxs("span",{"data-tooltip":Y.offset,children:["Last offset ",O?.lastOffset??-1]})]}),n.jsxs("p",{children:["Produced ",O?.produced??0," · Consumed ",O?.consumed??0]}),n.jsxs("p",{"data-tooltip":Y.snapshot,children:["Snapshot rows ",O?.snapshotRows??0]}),n.jsxs("p",{"data-tooltip":Y.lagPercentile,children:["Lag p50 ",Math.round(O?.lagMsP50??0),"ms · p95 ",Math.round(O?.lagMsP95??0),"ms"]}),s==="trigger"&&n.jsxs("p",{"data-tooltip":Y.triggerWriteAmplification,children:["Write amplification: ",Q?.toFixed(1)??"0.0","x"]}),s==="polling"&&n.jsxs("p",{className:"sim-shell__lane-bus-warning","data-tooltip":Y.deleteCapture,children:["Missed deletes: ",O?.missedDeletes??0]}),O&&O.errors>0&&n.jsxs("p",{className:"sim-shell__lane-bus-warning",children:["Errors: ",O.errors]})]}),F&&n.jsxs("section",{className:"sim-shell__destination","aria-label":`${C.label} destination snapshot`,children:[n.jsxs("header",{children:[n.jsxs("div",{className:"sim-shell__destination-title",children:[n.jsx("h4",{children:"Destination snapshot"}),n.jsxs("span",{children:["schema v",F.schemaVersion]})]}),n.jsx("div",{className:"sim-shell__destination-actions",children:n.jsx("button",{type:"button",className:"sim-shell__destination-download",onClick:()=>gr(s),disabled:F.rows.length===0,children:"Download JSON"})})]}),P.length>0?n.jsx("div",{className:"sim-shell__destination-table",role:"table",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsx("tr",{children:F.columns.map(W=>n.jsx("th",{"data-highlight":W===Ge.name?"true":void 0,children:W},W))})}),n.jsx("tbody",{children:P.map(W=>n.jsx("tr",{children:F.columns.map(Be=>n.jsx("td",{children:da(Be==="id"?W.displayId:Be==="table"?W.table:W.values[Be])},`${W.id}-${Be}`))},W.id))})]})}):n.jsx("p",{className:"sim-shell__destination-empty",children:"No rows applied yet."}),q&&n.jsxs("p",{className:"sim-shell__destination-note",children:["Showing ",P.length," of ",F.rows.length," rows."]})]}),n.jsxs("dl",{className:"sim-shell__lane-config",children:[s==="polling"&&(()=>{const W=ee.polling;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Poll interval"}),n.jsxs("dd",{"data-tooltip":Y.pollingInterval,children:[W.pollIntervalMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Soft deletes"}),n.jsx("dd",{"data-tooltip":Y.pollingSoftDeletes,children:W.includeSoftDeletes?"included":"ignored"})]})]})})(),s==="trigger"&&(()=>{const W=ee.trigger;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Extractor interval"}),n.jsxs("dd",{"data-tooltip":Y.triggerExtractorInterval,children:[W.extractIntervalMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Trigger overhead"}),n.jsxs("dd",{"data-tooltip":Y.triggerOverhead,children:[W.triggerOverheadMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Write amplification"}),n.jsxs("dd",{"data-tooltip":Y.triggerWriteAmplification,children:[Q?.toFixed(1)??"0.0","x"]})]})]})})(),s==="log"&&(()=>{const W=ee.log;return n.jsxs("div",{children:[n.jsx("dt",{children:"Fetch interval"}),n.jsxs("dd",{"data-tooltip":Y.logFetchInterval,children:[W.fetchIntervalMs," ms"]})]})})()]}),K.length>0&&n.jsx("div",{className:"sim-shell__callouts",children:K.map((W,Be)=>n.jsx("p",{className:`sim-shell__callout${W.tone==="warning"?" sim-shell__callout--warning":""}`,"data-tour-target":j&&_&&Be===0?"comparator-callouts":void 0,children:W.text},`${s}-callout-${Be}`))}),n.jsxs("section",{className:"sim-shell__lane-why","aria-label":`When to use ${C.label}`,children:[n.jsx("h4",{children:"When to use"}),n.jsx("p",{children:C.whenToUse})]}),Ee?n.jsxs("ul",{className:"sim-shell__event-list","aria-live":"polite",children:[vs&&n.jsx("li",{className:"sim-shell__event sim-shell__event--notice",children:n.jsxs("span",{children:["Showing latest ",js," of ",te.length," matching events."]})}),rt.length===0?n.jsx("li",{className:"sim-shell__empty",children:Pt?"No events match the current filters.":"No events yet."}):rt.map(W=>n.jsxs("li",{className:`sim-shell__event${W.op==="d"?" sim-shell__event--delete":""}`,children:[n.jsx("span",{className:"sim-shell__event-op","data-op":W.op,children:W.op}),n.jsxs("span",{children:["#",W.seq," · pk=",W.pk.id]}),n.jsxs("span",{className:"sim-shell__event-target",children:["ts=",W.ts_ms,"ms"]})]},`${s}-${W.seq}`))]}):n.jsx("p",{className:"sim-shell__lane-hidden",children:"Timeline hidden. Use “Show timeline” to view recent events."})]},s)})}),n.jsxs("footer",{className:"sim-shell__footer",children:["Scenario clock: ",re,"ms · ",X.reduce((s,a)=>s+a.events.length,0)," total events emitted"]})]})}function An(){if(typeof window>"u")return;const e=window.telemetry;if(e&&typeof e.track=="function"&&typeof e.flush=="function")return e;let t;try{t=window.localStorage}catch{t=void 0}const r=wo({storage:t,console:typeof console<"u"?{warn:console.warn.bind(console),debug:console.debug.bind(console)}:void 0});return window.telemetry=r,r}function In(){const e=document.getElementById("simShellRoot");if(!e){console.warn("Simulator UI shell mount point not found (simShellRoot).");return}Or.createRoot(e).render(n.jsx(xa,{}))}document.readyState==="loading"?(An(),document.addEventListener("DOMContentLoaded",In,{once:!0})):(An(),In());
