import{r as c,j as n,T as kn,S as Lr,R as kr}from"./event-log-widget.js";class Tr{constructor(){this.topics=new Map}publish(t,r){if(r.length===0)return[];const o=this.ensure(t);return r.map(i=>{const p=++o.offset,g={...i,offset:p};return o.queue.push(g),g})}consume(t,r=1){const o=this.ensure(t);return r<=0?[]:o.queue.splice(0,r)}size(t){return this.ensure(t).queue.length}reset(t){if(t){this.topics.delete(t);return}this.topics.clear()}ensure(t){let r=this.topics.get(t);return r||(r={offset:-1,queue:[]},this.topics.set(t,r)),r}}class Mr{constructor(){this.produced=0,this.consumed=0,this.backlog=0,this.lagSamples=[],this.missedDeletes=0,this.writeAmplification=0,this.snapshotRows=0,this.errors=0,this.lagAggregators=new Set}onProduced(t){this.produced+=t.length,this.backlog+=t.length}onConsumed(t){this.consumed+=t.length,this.backlog=Math.max(this.backlog-t.length,0);const r=Date.now();t.forEach(o=>{const i=typeof o.commitTs=="number"?o.commitTs:typeof o.ts_ms=="number"?o.ts_ms:r,p=Math.max(r-i,0);this.lagSamples.push(p)}),this.lagSamples.length>2e3&&this.lagSamples.splice(0,this.lagSamples.length-2e3),this.notifyLagAggregators()}registerLagAggregator(t){return this.lagAggregators.add(t),this.safeInvokeAggregator(t),()=>{this.lagAggregators.delete(t)}}recordMissedDelete(t=1){this.missedDeletes+=t}recordWriteAmplification(t=1){this.writeAmplification+=t}recordSnapshotRows(t){this.snapshotRows=t}recordError(){this.errors+=1}reset(){this.produced=0,this.consumed=0,this.backlog=0,this.lagSamples=[],this.missedDeletes=0,this.writeAmplification=0,this.snapshotRows=0,this.errors=0,this.notifyLagAggregators()}snapshot(){const t=[...this.lagSamples].sort((i,p)=>i-p),r=this.percentile(t,.5),o=this.percentile(t,.95);return{produced:this.produced,consumed:this.consumed,backlog:this.backlog,lagMsP50:r,lagMsP95:o,missedDeletes:this.missedDeletes,writeAmplification:this.writeAmplification,snapshotRows:this.snapshotRows,errors:this.errors}}safeInvokeAggregator(t,r){try{const o=r?[...r]:[...this.lagSamples];t(o)}catch{}}notifyLagAggregators(){if(this.lagAggregators.size===0)return;const t=[...this.lagSamples];this.lagAggregators.forEach(r=>{this.safeInvokeAggregator(r,t)})}percentile(t,r){if(!t.length)return 0;const o=Math.max(t.length-1,0)*r,i=Math.floor(o),p=Math.min(i+1,t.length-1);if(i===p)return t[i];const g=o-i;return t[i]+(t[p]-t[i])*g}}class Ar{constructor(){this.tasks=new Map,this.nextId=1}every(t,r){const o=this.nextId++,i={id:o,interval:t,handler:r};this.tasks.set(o,i);const p=setInterval(()=>r(),t);return i.timerId=p,o}clear(t){if(t!=null){const r=this.tasks.get(t);r&&r.timerId&&clearInterval(r.timerId),this.tasks.delete(t);return}this.tasks.forEach(r=>{const o=r.timerId;o&&clearInterval(o)}),this.tasks.clear()}}class Ir{constructor(t,r,o,i,p,g={}){this.mode=t,this.bus=r,this.scheduler=o,this.metrics=i,this.handlers=g,this.state="IDLE",this.topic=p??`cdc.${t.toLowerCase()}`}get currentState(){return this.state}get topicName(){return this.topic}startSnapshot(t){this.state==="IDLE"&&(this.state="SNAPSHOTTING",this.handlers.startSnapshot?.(t,r=>this.emit(r)))}startTailing(){this.state!=="TAILING"&&(this.state="TAILING",this.handlers.startTailing?.(t=>this.emit(t)))}pause(){this.state==="TAILING"&&(this.state="PAUSED")}resume(){this.state==="PAUSED"&&(this.state="TAILING")}stop(){this.state="IDLE",this.scheduler.clear(),this.handlers.stop?.(),this.bus.reset(this.topic),this.metrics.reset()}emit(t){if(t.length===0)return[];const r=this.bus.publish(this.topic,t);return this.metrics.onProduced(r),r}}let Or=0;const gs=()=>`evt-${Date.now()}-${++Or}`,It=e=>e?JSON.parse(JSON.stringify(e)):null,Js=(e,t)=>`${e}::${t}`,Ys=(e,t)=>({id:e.name,type:e.type,nullable:e.nullable??!1,__ts:t}),Xs=(e,t,r=`tx-${t}`)=>{const o=e?.id??r,i=typeof e?.index=="number",p=i?e.index:void 0,g=typeof e?.total=="number"?e.total:void 0;let y;return typeof e?.last=="boolean"?y=e.last:i&&typeof g=="number"?y=p>=g-1:y=!e,{id:o,index:p,total:g,last:y}};function Nr(){let e=null,t=null,r=100,o=0;const i=new Map,p=[];let g=0;const y=new Map,L=b=>{const _=y.get(b);return typeof _=="number"&&_>=1?_:(y.set(b,1),1)},C=b=>{const _=L(b),l=_+1;return y.set(b,l),{previous:_,next:l}},k=(b,_,l,h,m)=>{const u=Xs(b.txn,m);return{id:gs(),kind:_,table:b.table,before:l?{id:b.pk.id,...l,__ts:m}:void 0,after:h?{id:b.pk.id,...h,__ts:m}:void 0,txnId:u.id,txnIndex:u.index,txnTotal:u.total,txnLast:u.last,commitTs:m,schemaVersion:L(b.table),topic:e?.topic??`cdc.${b.table}`,partition:0}},v=(b,_,l,h)=>{if(!t||!e)return;const{previous:m,next:u}=C(b),M=Xs(void 0,h,`schema-${h}`),T={id:gs(),kind:_==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:b,before:_==="DROP_COLUMN"?Ys(l,h):void 0,after:_==="ADD_COLUMN"?Ys(l,h):void 0,txnId:M.id,txnIndex:M.index,txnTotal:M.total,txnLast:M.last,commitTs:h,schemaVersion:u,topic:e.topic??`cdc.${b}`,partition:0,schemaChange:{action:_,column:l,previousVersion:m,nextVersion:u}};t([T])};return{id:"LOG_BASED",initialise(b){e=b},configure(b){const _=Number(b.fetch_interval_ms??b.fetchIntervalMs);Number.isFinite(_)&&_>0&&(r=_)},startSnapshot(b=[],_){if(t=_,!b.length||(b.forEach(h=>{const m=h.schema?.version??1;y.set(h.name,m),h.rows.forEach(u=>{const M=Js(h.name,u.id);i.set(M,{id:u.id,table:h.name,data:{...u},version:1,updatedAt:u.__ts??0,deleted:!1})})}),e?.metrics.recordSnapshotRows(i.size),!i.size))return;const l=[];i.forEach(h=>{l.push({id:gs(),kind:"INSERT",table:h.table,before:void 0,after:{id:h.id,...h.data,__ts:h.updatedAt},txnId:`snapshot-${h.updatedAt}`,txnIndex:0,txnTotal:1,txnLast:!0,commitTs:h.updatedAt,schemaVersion:L(h.table),topic:e?.topic??`cdc.${h.table}`,partition:0})}),t(l),g=p.length},startTailing(b){t=b},applySource(b){if(!e)return;const _=b.t,l=Js(b.table,b.pk.id);if(L(b.table),b.op==="insert")i.set(l,{id:b.pk.id,table:b.table,data:{...b.after},version:1,updatedAt:_,deleted:!1}),p.push(k(b,"INSERT",null,It(b.after),_));else if(b.op==="update"){const h=i.get(l),m=h?It(h.data):null,u=h?{...h.data,...b.after}:{...b.after};i.set(l,{id:b.pk.id,table:b.table,data:u,version:(h?.version??0)+1,updatedAt:_,deleted:!1}),p.push(k(b,"UPDATE",m,It(u),_))}else if(b.op==="delete"){const h=i.get(l);i.set(l,{id:b.pk.id,table:b.table,data:h?{...h.data}:{},version:(h?.version??0)+1,updatedAt:_,deleted:!0}),p.push(k(b,"DELETE",h?It(h.data):null,null,_))}},applySchemaChange(b,_,l,h){e&&(L(b),_==="ADD_COLUMN"?i.forEach((m,u)=>{m.table===b&&(l.name in m.data||(m.data[l.name]=null,i.set(u,{...m,data:{...m.data}})))}):_==="DROP_COLUMN"&&i.forEach((m,u)=>{if(m.table===b&&l.name in m.data){const M={...m.data};delete M[l.name],i.set(u,{...m,data:M})}}),v(b,_,l,h))},tick(b){if(!t||b-o<r)return;const _=p.slice(g);_.length&&(t(_),g=p.length),o=b},pause(){},resume(){},stop(){i.clear(),p.length=0,g=0,t=null,e=null,y.clear(),o=0}}}let Dr=0;const bs=()=>`evt-${Date.now()}-${++Dr}`,Zs=e=>e?JSON.parse(JSON.stringify(e)):null,en=(e,t)=>`${e}::${t}`,tn=(e,t)=>({id:e.name,type:e.type,nullable:e.nullable??!1,__ts:t}),sn=(e,t,r=`tx-${t}`)=>{const o=e?.id??r,p=!1?e.index:void 0,g=void 0;let y;return y=!0,{id:o,index:p,total:g,last:y}};function Rr(){let e=null,t=null,r=1e3,o=!1,i=0;const p=new Map,g=new Map,y=new Map,L=[],C=l=>{const h=y.get(l);return typeof h=="number"&&h>=1?h:(y.set(l,1),1)},k=l=>{const h=C(l),m=h+1;return y.set(l,m),{previous:h,next:m}},v=(l,h,m,u,M,T,D,G)=>{const ee=sn(G,T,D);return{id:bs(),kind:m,table:l,before:u?{id:h,...u,__ts:T}:void 0,after:M?{id:h,...M,__ts:T}:void 0,txnId:ee.id,txnIndex:ee.index,txnTotal:ee.total,txnLast:ee.last,commitTs:T,schemaVersion:C(l),topic:e?.topic??`cdc.${l}`,partition:0}},b=(l,h,m,u)=>{const{previous:M,next:T}=k(l),D=sn(void 0,u,`schema-${u}`);L.push({id:bs(),kind:h==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:l,before:h==="DROP_COLUMN"?tn(m,u):void 0,after:h==="ADD_COLUMN"?tn(m,u):void 0,txnId:D.id,txnIndex:D.index,txnTotal:D.total,txnLast:D.last,commitTs:u,schemaVersion:T,topic:e?.topic??`cdc.${l}`,partition:0,schemaChange:{action:h,column:m,previousVersion:M,nextVersion:T}})},_=l=>{!l.length||!t||t(l)};return{id:"QUERY_BASED",initialise(l){e=l},configure(l){const h=Number(l.poll_interval_ms??l.pollIntervalMs);Number.isFinite(h)&&h>0&&(r=h),l.include_soft_deletes!=null&&(o=!!l.include_soft_deletes),l.includeSoftDeletes!=null&&(o=!!l.includeSoftDeletes)},startSnapshot(l=[],h){t=h;const m=[];l.forEach(u=>{const M=u.schema?.version??1;y.set(u.name,M),u.rows.forEach(T=>{const D=en(u.name,T.id);p.set(D,{id:T.id,table:u.name,data:{...T},version:1,updatedAt:T.__ts??0,deleted:!1}),g.set(D,1);const{id:G,__ts:ee,...xe}=T;m.push({id:bs(),kind:"INSERT",table:u.name,before:void 0,after:{id:G,...xe,__ts:ee??0},txnId:`snapshot-${T.__ts??0}`,txnIndex:0,txnTotal:1,txnLast:!0,commitTs:T.__ts??0,schemaVersion:C(u.name),topic:e?.topic??`cdc.${u.name}`,partition:0})})}),e?.metrics.recordSnapshotRows(m.length),_(m)},startTailing(l){t=l},applySource(l){const h=en(l.table,l.pk.id),m=l.t;if(C(l.table),l.op==="insert")p.set(h,{id:l.pk.id,table:l.table,data:{...l.after},version:1,updatedAt:m,deleted:!1});else if(l.op==="update"){const u=p.get(h),M=u?{...u.data,...l.after}:{...l.after};p.set(h,{id:l.pk.id,table:l.table,data:M,version:(u?.version??0)+1,updatedAt:m,deleted:!1})}else if(l.op==="delete"){const u=p.get(h);p.set(h,{id:l.pk.id,table:l.table,data:u?{...u.data}:{},version:(u?.version??0)+1,updatedAt:m,deleted:!0})}},applySchemaChange(l,h,m,u){C(l),h==="ADD_COLUMN"?p.forEach((M,T)=>{if(M.table!==l||Object.prototype.hasOwnProperty.call(M.data,m.name))return;const D={...M.data,[m.name]:null};p.set(T,{...M,data:D})}):h==="DROP_COLUMN"&&p.forEach((M,T)=>{if(M.table===l&&m.name in M.data){const D={...M.data};delete D[m.name],p.set(T,{...M,data:D})}}),b(l,h,m,u)},tick(l){if(!t||l-i<r)return;const h=[];L.length&&h.push(...L.splice(0,L.length)),p.forEach((m,u)=>{if(m.updatedAt<=i)return;const M=g.get(u)??0;if(m.deleted){o?(h.push(v(m.table,m.id,"DELETE",Zs(m.data),null,m.updatedAt,`tx-${m.updatedAt}`)),g.set(u,m.version)):(e?.metrics.recordMissedDelete(),g.set(u,m.version));return}if(m.version<=M)return;const T=M===0?"INSERT":"UPDATE";h.push(v(m.table,m.id,T,null,Zs(m.data),m.updatedAt,`tx-${m.updatedAt}`)),g.set(u,m.version)}),_(h),i=l},stop(){p.clear(),g.clear(),y.clear(),L.length=0,t=null,e=null,i=0}}}let $r=0;const nn=()=>`evt-${Date.now()}-${++$r}`,Ot=e=>e?JSON.parse(JSON.stringify(e)):null,Pr=(e,t)=>`${e}::${t}`,rn=(e,t)=>({id:e.name,type:e.type,nullable:e.nullable??!1,__ts:t}),on=(e,t,r=`tx-${t}`)=>{const o=e?.id??r,i=typeof e?.index=="number",p=i?e.index:void 0,g=typeof e?.total=="number"?e.total:void 0;let y;return typeof e?.last=="boolean"?y=e.last:i&&typeof g=="number"?y=p>=g-1:y=!e,{id:o,index:p,total:g,last:y}};function Fr(){let e=null,t=null,r=250,o=8,i=0,p=0;const g=new Map,y=[],L=new Map,C=l=>{const h=L.get(l);return typeof h=="number"&&h>=1?h:(L.set(l,1),1)},k=l=>{const h=C(l),m=h+1;return L.set(l,m),{previous:h,next:m}},v=(l,h,m,u,M)=>{const T=on(l.txn,M);return{id:nn(),kind:h,table:l.table,before:m?{id:l.pk.id,...m,__ts:M}:void 0,after:u?{id:l.pk.id,...u,__ts:M}:void 0,txnId:T.id,txnIndex:T.index,txnTotal:T.total,txnLast:T.last,commitTs:M,schemaVersion:C(l.table),topic:e?.topic??`cdc.${l.table}`,partition:0}},b=(l,h,m,u)=>{const{previous:M,next:T}=k(l),D=on(void 0,u,`schema-${u}`),G={id:nn(),kind:h==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:l,before:h==="DROP_COLUMN"?rn(m,u):void 0,after:h==="ADD_COLUMN"?rn(m,u):void 0,txnId:D.id,txnIndex:D.index,txnTotal:D.total,txnLast:D.last,commitTs:u,schemaVersion:T,topic:e?.topic??`cdc.${l}`,partition:0,schemaChange:{action:h,column:m,previousVersion:M,nextVersion:T}};y.push({event:G})},_=l=>{!l.length||!t||t(l)};return{id:"TRIGGER_BASED",initialise(l){e=l},configure(l){const h=Number(l.extract_interval_ms??l.extractIntervalMs);Number.isFinite(h)&&h>0&&(r=h);const m=Number(l.trigger_overhead_ms??l.triggerOverheadMs);Number.isFinite(m)&&m>=0&&(o=m)},startSnapshot(l=[],h){t=h,e?.metrics.recordSnapshotRows(0)},startTailing(l){t=l},applySource(l){if(!e)return;const h=Pr(l.table,l.pk.id),m=l.t+o;let u=null,M=null,T;if(C(l.table),l.op==="insert")T="INSERT",M=Ot(l.after),g.set(h,{id:l.pk.id,table:l.table,data:{...l.after},version:1,updatedAt:m,deleted:!1});else if(l.op==="update"){const D=g.get(h);u=D?Ot(D.data):null;const G=D?{...D.data,...l.after}:{...l.after};M=Ot(G),T="UPDATE",g.set(h,{id:l.pk.id,table:l.table,data:G,version:(D?.version??0)+1,updatedAt:m,deleted:!1})}else if(l.op==="delete"){const D=g.get(h);u=D?Ot(D.data):null,M=null,T="DELETE",g.set(h,{id:l.pk.id,table:l.table,data:D?{...D.data}:{},version:(D?.version??0)+1,updatedAt:m,deleted:!0})}else return;y.push({event:v(l,T,u,M,m)}),e.metrics.recordWriteAmplification(1)},applySchemaChange(l,h,m,u){if(!e)return;const M=u+o;C(l),h==="ADD_COLUMN"?g.forEach((T,D)=>{if(T.table===l&&!(m.name in T.data)){const G={...T.data,[m.name]:null};g.set(D,{...T,data:G,version:T.version+1,updatedAt:M})}}):h==="DROP_COLUMN"&&g.forEach((T,D)=>{if(T.table===l&&m.name in T.data){const G={...T.data};delete G[m.name],g.set(D,{...T,data:G,version:T.version+1,updatedAt:M})}}),b(l,h,m,M)},tick(l){if(!t||l-i<r)return;const h=y.slice(p).map(m=>m.event);_(h),p=y.length,i=l},stop(){y.length=0,g.clear(),t=null,e=null,p=0,i=0,L.clear()}}}const Ft={MYSQL_DEBEZIUM:{id:"MYSQL_DEBEZIUM",label:"MySQL · Debezium · Kafka",description:"Debezium tails the MySQL binlog and pushes commits to Kafka for downstream consumers.",docsHint:"https://debezium.io/documentation/reference/stable/connectors/mysql.html",sourceLabel:"MySQL primary",sourceTooltip:"InnoDB workload emitting row-level changes for capture.",logLabel:"MySQL binlog (Debezium)",logTooltip:"Debezium connector streams row-format binlog entries in commit order.",busLabel:"Kafka topic",busTooltip:"Kafka transports Debezium change events (e.g. db.orders) to consumers.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Analytics warehouse, service, or cache subscribing to the Kafka topic.",topicFormat:e=>`db.${e}`,methodCopyOverrides:{polling:{label:"Polling (scheduled SQL)",laneDescription:"Batch jobs diff the MySQL table on an interval to detect divergence.",callout:"Misses hard deletes and rapid updates without custom tracking tables.",whenToUse:"Fallback when binlog access is blocked. Accepts lag and data loss for small tables only.",tooltip:"ETL-style SELECT polling against the MySQL primary."},trigger:{label:"Triggers (audit table)",laneDescription:"AFTER triggers write every mutation into an audit table for downstream extract.",callout:"Adds synchronous latency on the write path and increases operational overhead.",whenToUse:"When connectors are unavailable but you still need complete change history.",tooltip:"MySQL triggers populate audit tables that an extractor drains."},log:{label:"Debezium binlog tail",laneDescription:"Debezium streams row-based binlog events into Kafka with schema evolution support.",callout:"Preferred default: low-impact, ordered, near real-time change capture.",whenToUse:"Standard choice for production MySQL workloads when Kafka + Debezium are available.",tooltip:"Debezium connector tailing the MySQL binlog."}}},POSTGRES_LOGICAL:{id:"POSTGRES_LOGICAL",label:"Postgres · Logical decoding · Kafka",description:"Logical decoding streams Postgres WAL changes (pgoutput/wal2json) into Kafka.",docsHint:"https://www.postgresql.org/docs/current/logicaldecoding.html",sourceLabel:"Postgres primary",sourceTooltip:"OLTP Postgres emitting WAL entries for publications.",logLabel:"Logical replication slot",logTooltip:"Logical decoding slot materialises committed WAL changes via pgoutput or wal2json.",busLabel:"Kafka topic",busTooltip:"Kafka topics per publication (e.g. public.orders) fan out change events.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Consumers applying logical changes into warehouses or services.",topicFormat:e=>`public.${e}`,methodCopyOverrides:{polling:{label:"Polling (snapshot queries)",laneDescription:"Incremental SELECT queries compare current rows to previous snapshots.",callout:"Can't observe deletes or mid-transaction updates without tombstone columns.",whenToUse:"Stopgap for small tables when logical replication isn't permitted.",tooltip:"Periodic comparison queries against Postgres source tables."},trigger:{label:"Triggers (audit schema)",laneDescription:"Triggers populate audit tables that an extractor tails outside the WAL.",callout:"Higher write amplification and maintenance across replicas.",whenToUse:"When WAL access is off-limits yet complete history is required.",tooltip:"AFTER triggers write into audit tables for downstream capture."},log:{label:"Logical decoding stream",laneDescription:"Slot-based logical decoding streams ordered WAL changes through Kafka.",callout:"Best balance: ordered, low-impact capture with schema evolution support.",whenToUse:"Primary choice when you can run wal2json/pgoutput connectors.",tooltip:"Logical replication slot feeding Kafka via connectors."}}},SQLSERVER_CDC:{id:"SQLSERVER_CDC",label:"SQL Server · CDC tables · ETL",description:"SQL Server CDC populates change tables that ETL tools ship downstream.",docsHint:"https://learn.microsoft.com/sql/relational-databases/track-changes/about-change-data-capture-sql-server",sourceLabel:"SQL Server OLTP",sourceTooltip:"Source database with CDC enabled on tracked tables.",logLabel:"CDC change tables",logTooltip:"Log reader agent populates [cdc].[schema_table_CT] from the transaction log.",busLabel:"ETL pipeline",busTooltip:"ADF/SSIS or similar ETL pipelines move captured rows to consumers.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Lakehouse, staging DB, or microservice applying captured rows.",topicFormat:e=>`cdc.${e}_ct`,methodCopyOverrides:{polling:{label:"Polling (T-SQL jobs)",laneDescription:"Scheduled queries compare source tables against a shadow copy.",callout:"Hard deletes vanish and rapid updates collapse to last-write wins.",whenToUse:"Only when CDC can't be enabled. Expect drift and operational overhead.",tooltip:"Agent jobs issuing SELECT deltas against the primary."},trigger:{label:"DB triggers (audit tables)",laneDescription:"DDL-driven triggers write into audit tables that ETL picks up.",callout:"Adds synchronous writes and complicates deployments.",whenToUse:"Fallback for editions without CDC but needing full fidelity.",tooltip:"FOR INSERT/UPDATE/DELETE triggers persisting rows into audit tables."},log:{label:"CDC change table stream",laneDescription:"Native CDC surfaces ordered change rows ready for downstream ETL.",callout:"Balanced approach: leverages log reader agent with minimal code.",whenToUse:"Default when SQL Server Enterprise/Standard CDC is available.",tooltip:"Change Data Capture tables populated by the log reader agent."}}},ORACLE_GG:{id:"ORACLE_GG",label:"Oracle · GoldenGate",description:"GoldenGate extracts Oracle redo into trails that replicat apply downstream.",docsHint:"https://docs.oracle.com/en/middleware/goldengate/",sourceLabel:"Oracle primary",sourceTooltip:"Oracle Database generating redo entries for tracked schemas.",logLabel:"Redo / GoldenGate trail",logTooltip:"Extract captures redo logs into GoldenGate trail files.",busLabel:"GoldenGate distribution",busTooltip:"GoldenGate distribution path replicates changes to targets or Kafka.",destinationLabel:"Replica / downstream sink",destinationTooltip:"Target database, cache, or Kafka topic consuming GoldenGate trails.",topicFormat:e=>`ogg.${e}`,methodCopyOverrides:{polling:{label:"Polling (custom jobs)",laneDescription:"Scripts query Oracle tables for deltas outside of GoldenGate.",callout:"Expensive and incomplete without change tracking columns.",whenToUse:"Rare stopgap for small tables when GoldenGate access is unavailable.",tooltip:"Ad-hoc jobs diffing source tables over DB links or snapshots."},trigger:{label:"Triggers (shadow tables)",laneDescription:"Row-level triggers populate shadow tables for downstream capture.",callout:"Adds redo volume and requires meticulous deployment management.",whenToUse:"Fallback when GoldenGate licensing or access is restricted.",tooltip:"Oracle triggers mirroring mutations into custom staging tables."},log:{label:"GoldenGate redo tail",laneDescription:"GoldenGate Extract/Replicat stream redo into ordered trail files.",callout:"Enterprise-grade: minimal source impact with robust replication semantics.",whenToUse:"Primary approach for Oracle sources requiring guaranteed replication.",tooltip:"GoldenGate Extract reading redo logs into trail files."}}},MONGODB_STREAMS:{id:"MONGODB_STREAMS",label:"MongoDB · Change Streams",description:"Change Streams tail the MongoDB oplog and push updates to subscribers.",docsHint:"https://www.mongodb.com/docs/manual/changeStreams/",sourceLabel:"MongoDB replica set",sourceTooltip:"Replica set primary emitting operations into the oplog.",logLabel:"Change stream (oplog)",logTooltip:"Change Stream cursor streams oplog events filtered per namespace.",busLabel:"Driver subscriber",busTooltip:"Driver / connector pushes stream events to downstream sinks (Kafka/Atlas).",destinationLabel:"Streaming sink",destinationTooltip:"Analytical store or service consuming the stream.",topicFormat:e=>`mongo.${e}`,methodCopyOverrides:{polling:{label:"Polling (find queries)",laneDescription:"Scheduled queries diff collections by last-updated timestamps.",callout:"No delete visibility and heavy load for high-churn collections.",whenToUse:"Only for prototypes without Change Stream or oplog access.",tooltip:"find() queries scanning for updated documents on an interval."},trigger:{label:"Hooks (side-write)",laneDescription:"Application-layer hooks write audit documents alongside originals.",callout:"Requires app changes and doubles write throughput.",whenToUse:"When database triggers/log access is unavailable and app control exists.",tooltip:"Custom middleware duplicating writes into audit collections."},log:{label:"Change Stream tail",laneDescription:"Native Change Stream cursor fans out oplog events in order.",callout:"Recommended: low-latency stream with resume tokens and schema support.",whenToUse:"Default for MongoDB replicas when you can open a Change Stream cursor.",tooltip:"MongoDB Change Stream subscription on the oplog."}}}},Ut="cdc_playground_template_filter_v1",Bt="cdc_playground_template_filter_tags_v1",Gt={query:"",tags:[]},Ur=e=>typeof e=="string"?e:"",Tn=e=>{if(!Array.isArray(e))return[];const t=new Set,r=[];return e.forEach(o=>{if(o==null)return;const i=String(o).trim();!i||t.has(i)||(t.add(i),r.push(i))}),r},Ss=e=>{if(!e||typeof e!="object")return{...Gt};const t=Ur(typeof e.query=="string"?e.query:""),r=e.tags;if(Array.isArray(r))return{query:t,tags:Tn(r)};if(typeof r=="string"){const o=r.trim();return{query:t,tags:o?[o]:[]}}return{query:t,tags:[]}},Br=(e,t)=>{if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(e[r]!==t[r])return!1;return!0},qr=e=>typeof e!="string"?"":e,Vr=e=>{if(typeof e!="string"||e.trim().length===0)return[];try{const t=JSON.parse(e);if(Array.isArray(t))return Tn(t)}catch{}return[]},Gr=e=>{if(!e)return{...Gt};try{const t=qr(e.getItem(Ut)),r=Vr(e.getItem(Bt));return{query:t,tags:r}}catch{return{...Gt}}},Wr=(e,t)=>{if(!t)return;const r=Ss(e);try{r.query?t.setItem(Ut,r.query):typeof t.removeItem=="function"?t.removeItem(Ut):t.setItem(Ut,"")}catch{}try{r.tags.length>0?t.setItem(Bt,JSON.stringify(r.tags)):typeof t.removeItem=="function"?t.removeItem(Bt):t.setItem(Bt,"")}catch{}},Hr=e=>typeof e=="string"?e.trim().toLowerCase():"",an=e=>Array.isArray(e)?e.map(t=>typeof t=="string"?t.trim():"").filter(t=>t.length>0):[],zr=e=>{const t=[];return e.label&&t.push(e.label),e.description&&t.push(e.description),e.highlight&&t.push(e.highlight),e.name&&t.push(e.name),Array.isArray(e.tags)&&e.tags.length>0&&t.push(e.tags.join(" ")),t.join(" ").toLowerCase()};function Qr(e,t={}){const r=Array.from(e),{liveScenario:o,liveScenarioName:i,tags:p,query:g}=t;if(o){const k=r.findIndex(v=>v.name===o.name);k>=0?r.splice(k,1,o):r.unshift(o)}const y=an(p),C=Hr(g).split(/\s+/).map(k=>k.trim()).filter(k=>k.length>0);return r.filter(k=>{if(i&&k.name===i)return!0;if(y.length>0){const b=an(k.tags??[]);if(!y.every(l=>b.includes(l)))return!1}if(C.length===0)return!0;const v=zr(k);return v?C.every(b=>v.includes(b)):!1})}const xs=(e,t)=>{Array.isArray(t)&&t.forEach(r=>{if(typeof r!="string")return;const o=r.trim();o.length>0&&e.add(o)})};function Kr(e,t={}){const r=new Set;return e.forEach(o=>xs(r,o.tags)),t.liveScenario&&xs(r,t.liveScenario.tags),t.additionalTags?.forEach(o=>xs(r,o)),Array.from(r).sort((o,i)=>o.localeCompare(i))}const Es=e=>{if(Array.isArray(e))return e.map(t=>Es(t));if(e&&typeof e=="object"){const t={};return Object.entries(e).forEach(([r,o])=>{t[r]=Es(o)}),t}return e},qt=e=>Es(e),Mn=e=>({...e}),ln=e=>({name:e.name,version:e.version,columns:e.columns.map(Mn)}),Jr=(e,t)=>typeof t=="boolean"?"bool":typeof t=="number"?/_ts$|timestamp$/i.test(e)?"timestamp":"number":t instanceof Date?"timestamp":"string",Yr=(e,t=1)=>({name:e,version:t,columns:[{name:"id",type:"string",nullable:!1}]}),cn=e=>{e.columns.some(r=>r.name==="id")||e.columns.unshift({name:"id",type:"string",nullable:!1})},dn=e=>{const t=qt(e);return t.id=String(t.id),t};class ys{constructor(t=[]){this.tables=new Map,t.forEach(r=>this.upsertTable(r))}upsertTable(t){const r=ln(t.schema);cn(r);const o=new Map;t.rows.forEach(i=>{const p=dn(qt(i));o.set(p.id,p)}),this.tables.set(t.name,{schema:r,rows:o})}replaceAll(t){this.tables.clear(),t.forEach(r=>this.upsertTable(r))}getTable(t){const r=this.tables.get(t);if(r)return{name:t,schema:ln(r.schema),rows:Array.from(r.rows.values()).map(o=>qt(o))}}listTables(){return Array.from(this.tables.keys()).map(t=>this.getTable(t)).filter(t=>!!t)}clear(){this.tables.clear()}applyEvents(t){t.forEach(r=>this.applyEvent(r))}applyEvent(t){if(!t?.table)return;if(t.kind==="SCHEMA_ADD_COL"||t.kind==="SCHEMA_DROP_COL"){this.applySchemaChange(t);return}const r=this.ensureTableState(t.table,t.schemaVersion);if(t.schemaVersion&&t.schemaVersion>r.schema.version&&(r.schema.version=t.schemaVersion),t.kind==="DELETE"){const L=t.before?.id??t.after?.id;L!=null&&r.rows.delete(String(L));return}const o=t.after??void 0;if(!o)return;const i=dn(o),p=r.rows.get(i.id),g=p?{...p,...i}:i,y=qt(g);this.syncSchemaColumns(r,y),r.rows.set(y.id,y)}snapshot(){return this.listTables()}ensureTableState(t,r){let o=this.tables.get(t);return o||(o={schema:Yr(t,r??1),rows:new Map},this.tables.set(t,o)),r&&r>o.schema.version&&(o.schema.version=r),cn(o.schema),o}applySchemaChange(t){const r=t.schemaChange;if(!r)return;const o=this.ensureTableState(t.table,r.nextVersion??t.schemaVersion);o.schema.version=Math.max(o.schema.version,r.nextVersion??t.schemaVersion??o.schema.version),t.kind==="SCHEMA_ADD_COL"?this.addColumn(o,r.column):t.kind==="SCHEMA_DROP_COL"&&this.dropColumn(o,r.column.name)}addColumn(t,r){const o=t.schema.columns.find(i=>i.name===r.name);o?(o.type=r.type,r.nullable&&(o.nullable=!0)):t.schema.columns.push(Mn(r)),t.rows.forEach(i=>{r.name in i||(i[r.name]=null)})}dropColumn(t,r){r!=="id"&&(t.schema.columns=t.schema.columns.filter(o=>o.name!==r),t.rows.forEach(o=>{r in o&&delete o[r]}))}syncSchemaColumns(t,r){const o=t.schema.columns;Object.entries(r).forEach(([i,p])=>{if(i==="id"||i.startsWith("__"))return;let g=o.find(y=>y.name===i);g||(g={name:i,type:Jr(i,p)},o.push(g)),p==null&&(g.nullable=!0)})}}const Xr=2e3,Nt={methods:[],ops:[],tables:[],txns:[]},un={empty:"No events yet.",noMatch:"No events match the current filters."},hn=e=>{if(!e)return"";try{const t=JSON.stringify(e);return t?t.length>160?`${t.slice(0,160)}…`:t:""}catch{return""}},An=e=>{if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const r=t.toLowerCase();return["c","create","insert","i"].includes(r)?"insert":["u","update"].includes(r)?"update":["d","delete"].includes(r)?"delete":r},Zr=e=>{const t=An(e);if(t==="insert"||t==="update"||t==="delete")return t.toUpperCase();if(typeof e!="string")return"—";const r=e.trim();return r?r.toUpperCase():"—"},eo=({events:e,stats:t,totalCount:r,filters:o={},filterOptions:i,onFiltersChange:p,onDownload:g,onClear:y,onCopyEvent:L,onReplayEvent:C,maxVisibleEvents:k=Xr,emptyMessage:v,noMatchMessage:b,className:_})=>{const l={methods:i?.methods??Nt.methods,ops:i?.ops??Nt.ops,tables:i?.tables??Nt.tables,txns:i?.txns??Nt.txns},h=c.useMemo(()=>typeof k!="number"||k<=0?e.length:Math.min(k,e.length),[e.length,k]),[m,u]=c.useState(h);c.useEffect(()=>{u(A=>A<h?h:A>e.length?e.length:A)},[h,e.length]);const M=c.useMemo(()=>{const A=Math.max(m,0),W=Math.max(e.length-A,0);return e.slice(W)},[e,m]),T=M.length<e.length,D=m>h,G=()=>{if(!T)return;const A=h>0?h:e.length;u(W=>Math.min(W+A,e.length))},ee=()=>{u(h)},xe=typeof r=="number"?r:e.length,Ht=!!o.methodId||!!o.op||!!o.table||!!o.txnId,ye={empty:v??un.empty,noMatch:b??un.noMatch},Se=A=>{if(!p)return;const W={methodId:A.methodId===void 0?o.methodId:A.methodId,op:A.op===void 0?o.op:A.op,table:A.table===void 0?o.table:A.table,txnId:A.txnId===void 0?o.txnId:A.txnId},X={methodId:W.methodId||void 0,op:W.op||void 0,table:W.table||void 0,txnId:W.txnId||void 0};p(X)},ne=A=>{const W=hn(A.before),X=hn(A.after);return!W&&!X?null:n.jsxs("details",{className:"cdc-event-log__details",children:[n.jsx("summary",{children:"Row image"}),W&&n.jsxs("div",{className:"cdc-event-log__details-row",children:[n.jsx("span",{children:"before"}),n.jsx("code",{children:W})]}),X&&n.jsxs("div",{className:"cdc-event-log__details-row",children:[n.jsx("span",{children:"after"}),n.jsx("code",{children:X})]})]})};return n.jsxs("section",{className:`cdc-event-log${_?` ${_}`:""}`,"aria-label":"Event log",role:"region",children:[n.jsxs("header",{className:"cdc-event-log__header",children:[n.jsxs("div",{className:"cdc-event-log__headline",children:[n.jsx("h3",{children:"Event Log"}),t&&n.jsxs("p",{className:"cdc-event-log__stats",children:[n.jsxs("span",{children:["Produced ",t.produced]})," · ",n.jsxs("span",{children:["Consumed ",t.consumed]})," · ",n.jsxs("span",{children:["Backlog ",t.backlog]}),typeof t.snapshotRows=="number"&&n.jsxs(n.Fragment,{children:[" · ",n.jsxs("span",{children:["Snapshot rows ",t.snapshotRows]})]})]})]}),n.jsxs("div",{className:"cdc-event-log__actions",children:[n.jsxs("span",{children:[e.length," events"]}),n.jsx("button",{type:"button",onClick:g,disabled:!g||e.length===0,children:"Download NDJSON"}),n.jsx("button",{type:"button",onClick:y,disabled:!y||xe===0,children:"Clear"})]})]}),n.jsxs("div",{className:"cdc-event-log__filters",role:"group","aria-label":"Event log filters",children:[n.jsxs("label",{children:[n.jsx("span",{children:"Method"}),n.jsxs("select",{value:o.methodId??"",onChange:A=>Se({methodId:A.target.value||void 0}),disabled:!p||l.methods.length===0,children:[n.jsx("option",{value:"",children:"All methods"}),l.methods.map(A=>n.jsx("option",{value:A.id,children:A.label},A.id))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Operation"}),n.jsxs("select",{value:o.op??"",onChange:A=>Se({op:A.target.value||void 0}),disabled:!p||l.ops.length===0,children:[n.jsx("option",{value:"",children:"All ops"}),l.ops.map(A=>n.jsx("option",{value:A,children:A.toUpperCase()},A))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Table"}),n.jsxs("select",{value:o.table??"",onChange:A=>Se({table:A.target.value||void 0}),disabled:!p||l.tables.length===0,children:[n.jsx("option",{value:"",children:"All tables"}),l.tables.map(A=>n.jsx("option",{value:A,children:A},A))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Txn"}),n.jsxs("select",{value:o.txnId??"",onChange:A=>Se({txnId:A.target.value||void 0}),disabled:!p||l.txns.length===0,children:[n.jsx("option",{value:"",children:"All txns"}),l.txns.map(A=>n.jsx("option",{value:A,children:A},A))]})]})]}),e.length===0?n.jsx("p",{className:"cdc-event-log__empty",children:xe>0||Ht?ye.noMatch:ye.empty}):n.jsxs("ul",{className:"cdc-event-log__list",children:[e.length>M.length&&n.jsxs("li",{className:"cdc-event-log__notice",children:[n.jsxs("span",{children:["Showing latest ",M.length," of ",e.length," events."]}),n.jsxs("div",{className:"cdc-event-log__notice-actions",children:[n.jsx("button",{type:"button",onClick:G,disabled:!T,children:"Load more"}),D&&n.jsx("button",{type:"button",onClick:ee,children:"Show latest"})]})]}),M.map(A=>{const W=Zr(A.op),X=An(A.op),re=typeof A.offset=="number"?A.offset:A.offset==null?"—":A.offset,zt=A.topic??"—",J=A.table??"—",rt=A.pk??"—",Ee=A.txnId??"",We=typeof A.tsMs=="number"?A.tsMs:"—",oe=X==="insert"||X==="update"||X==="delete";return n.jsxs("li",{className:"cdc-event-log__item",children:[n.jsx("span",{className:"cdc-event-log__method",children:A.methodLabel??A.methodId??"—"}),n.jsx("span",{className:"cdc-event-log__op","data-op":W,children:W}),n.jsxs("span",{className:"cdc-event-log__offset",children:["offset ",re]}),n.jsx("span",{className:"cdc-event-log__topic",children:zt}),n.jsxs("span",{className:"cdc-event-log__table",children:["table ",J]}),n.jsxs("span",{className:"cdc-event-log__meta",children:["ts=",We,"ms · pk=",rt,Ee?` · txn=${Ee}`:""]}),A.meta?n.jsx("span",{className:"cdc-event-log__extra",children:A.meta}):null,C?n.jsx("button",{type:"button",className:"cdc-event-log__replay",onClick:()=>C?.(A),disabled:!oe,children:"Replay"}):null,n.jsx("button",{type:"button",className:"cdc-event-log__copy",onClick:()=>L?.(A),disabled:!L,children:"Copy"}),ne(A)]},A.id)})]})]})};function to(e){const t=e.op?.toUpperCase?.()??"?",r=e.pk??"∅",o=e.expectedIndex!=null?`#${e.expectedIndex}`:void 0,i=e.actualIndex!=null?`#${e.actualIndex}`:void 0;return e.type==="missing"?`Missing ${t} for pk=${r} (${o??"expected"} @ ${e.expectedTime??"?"}ms)`:e.type==="extra"?`Unexpected ${t} for pk=${r} (${i??"emitted"} @ ${e.actualTime??"?"}ms)`:`Out-of-order ${t} pk=${r} (expected ${o??"?"} before actual ${i??"?"})`}const so=({diff:e,scenarioName:t,laneId:r,schemaStatus:o,onDiffDetailsOpened:i})=>{if(!e)return null;const{totals:p,issues:g,lag:y}=e,L=p.missing>0||p.extra>0||p.ordering>0,C=g.slice(0,6);let k=null;return o&&(o.hasColumn?o.version<o.expectedVersion&&(k=`Schema behind: v${o.version} (expected v${o.expectedVersion})`):k=`${o.columnName} column missing in destination`),!L&&y.max<=0&&!k?null:n.jsxs("div",{className:"sim-shell__lane-diff","data-has-issues":L?"true":"false",role:"note",children:[n.jsxs("div",{className:"sim-shell__lane-diff-summary",children:[L?n.jsxs(n.Fragment,{children:[p.missing>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--missing",children:[p.missing," missing"]}),p.extra>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--extra",children:[p.extra," extra"]}),p.ordering>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--ordering",children:[p.ordering," ordering"]})]}):n.jsx("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--ok",children:"Operations aligned"}),y.max>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--lag",children:["Max lag ",Math.round(y.max),"ms"]})]}),k&&n.jsx("p",{className:"sim-shell__lane-diff-schema",children:k}),(C.length>0||y.samples.length>0)&&n.jsxs("details",{id:r?`lane-diff-${r}`:void 0,className:"sim-shell__lane-diff-details",onToggle:v=>{v.target.open&&i?.({method:e.method,issueCount:e.issues.length,maxLag:e.lag.max,scenario:t})},children:[n.jsx("summary",{children:"Diff details"}),C.length>0&&n.jsx("ul",{className:"sim-shell__lane-diff-list",children:C.map((v,b)=>n.jsx("li",{children:to(v)},`${v.type}-${v.op}-${v.pk??"∅"}-${b}`))}),g.length>C.length&&n.jsxs("p",{className:"sim-shell__lane-diff-more",children:["+",g.length-C.length," additional difference(s)"]}),y.samples.length>0&&n.jsxs("div",{className:"sim-shell__lane-diff-lag",children:[n.jsx("h4",{children:"Lag hotspots"}),n.jsx("ul",{children:y.samples.map(v=>n.jsxs("li",{children:[Math.round(v.lagMs),"ms on ",v.op.toUpperCase()," pk=",v.pk??"∅"]},`${v.op}-${v.pk??"∅"}-${v.actualTime??"?"}`))})]})]})]})},st=kn,ue=e=>Number.isFinite(e)?e.toLocaleString():"—",pn=e=>Number.isFinite(e)?`${Math.round(e)}ms`:"—",no=({lanes:e,renderSchemaWalkthrough:t})=>{const r=e.reduce((o,i)=>(o.produced+=i.produced,o.consumed+=i.consumed,o.backlog+=i.backlog,o),{produced:0,consumed:0,backlog:0});return n.jsxs("section",{className:"sim-shell__metrics-dashboard","aria-label":"Runtime metrics",children:[n.jsx("header",{className:"sim-shell__metrics-dashboard-header",children:n.jsxs("div",{children:[n.jsx("h3",{children:"Runtime metrics"}),n.jsxs("p",{children:["Produced ",ue(r.produced)," · Consumed ",ue(r.consumed)," · Backlog ",ue(r.backlog)]})]})}),n.jsx("div",{className:"sim-shell__metrics-dashboard-grid",children:e.map(o=>n.jsxs("article",{className:"sim-shell__metrics-dashboard-card",children:[n.jsx("header",{children:n.jsx("h4",{"data-tooltip":o.tooltip||void 0,children:o.label})}),t&&n.jsx("div",{className:"sim-shell__schema-demo-inline",children:t(o.id)}),n.jsxs("dl",{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Produced"}),n.jsx("dd",{children:ue(o.produced)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Consumed"}),n.jsx("dd",{children:ue(o.consumed)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Backlog"}),n.jsx("dd",{"data-tooltip":st.backlog,children:ue(o.backlog)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Lag p50"}),n.jsx("dd",{"data-tooltip":st.lagPercentile,children:pn(o.lagP50)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Lag p95"}),n.jsx("dd",{"data-tooltip":st.lagPercentile,children:pn(o.lagP95)})]}),typeof o.snapshotRows=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Snapshot rows"}),n.jsx("dd",{"data-tooltip":st.snapshot,children:ue(o.snapshotRows)})]}),(typeof o.inserts=="number"||typeof o.updates=="number"||typeof o.deletes=="number")&&n.jsxs("div",{children:[n.jsx("dt",{children:"Change mix"}),n.jsxs("dd",{children:["C ",ue(o.inserts??0)," · U ",ue(o.updates??0)," · D ",ue(o.deletes??0),typeof o.schemaChanges=="number"&&o.schemaChanges>0?` · Schema ${ue(o.schemaChanges)}`:""]})]}),typeof o.missedDeletes=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Missed deletes"}),n.jsx("dd",{"data-tooltip":st.deleteCapture,children:ue(o.missedDeletes)})]}),typeof o.writeAmplification=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Write amplification"}),n.jsxs("dd",{"data-tooltip":st.triggerWriteAmplification,children:[o.writeAmplification.toFixed(1),"x"]})]})]})]},o.id))})]})},ro=({lagMs:e,throughput:t,deletesPct:r,orderingOk:o,consistent:i,writeAmplification:p,insertCount:g,updateCount:y,deleteCount:L,schemaChangeCount:C})=>n.jsxs("div",{role:"status","aria-live":"polite",children:[n.jsxs("span",{children:["Lag: ",e,"ms"]})," ·",n.jsxs("span",{children:["TPS: ",t.toFixed(1)]})," ·",n.jsxs("span",{children:["Deletes: ",Math.round(r),"%"]})," ·",n.jsxs("span",{children:["Ordering: ",o?"OK":"KO"]})," ·",n.jsxs("span",{children:["Consistency: ",i?"OK":"Drift"]})," ","·",n.jsxs("span",{children:["Ops C/U/D: ",g,"/",y,"/",L]}),C>0&&n.jsxs(n.Fragment,{children:[" ","·",n.jsxs("span",{children:["Schema: ",C]})]}),typeof p=="number"&&n.jsxs(n.Fragment,{children:[" ","·",n.jsxs("span",{children:["Trigger WA: ",p.toFixed(1),"x"]})]})]}),oo=({onAdd:e,onDrop:t,columnName:r,disabled:o,disableAdd:i,disableDrop:p,status:g})=>n.jsxs("section",{className:"sim-shell__schema-demo","aria-label":"Schema walkthrough",children:[n.jsxs("header",{children:[n.jsx("h4",{children:"Schema walkthrough"}),n.jsxs("p",{children:["Add or drop ",n.jsx("code",{children:r})," while events stream to compare capture behaviour."]})]}),g?n.jsx("p",{className:"sim-shell__schema-demo-status",children:g}):null,n.jsxs("div",{className:"sim-shell__schema-demo-buttons",children:[n.jsxs("button",{type:"button",onClick:e,disabled:o||i,"data-tour-target":"schema-add",children:["Add ",r]}),n.jsxs("button",{type:"button",onClick:t,disabled:o||p,"data-tour-target":"schema-drop",children:["Drop ",r]})]})]}),ft=e=>{if(Array.isArray(e))return e.map(t=>ft(t));if(e&&typeof e=="object"){const t={};return Object.entries(e).forEach(([r,o])=>{t[r]=ft(o)}),t}return e},Ue=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"&&e.trim().length>0){const t=Number(e);return Number.isFinite(t)?t:null}return null},ao=e=>{if(typeof e=="boolean")return e;if(typeof e=="string"){const t=e.trim().toLowerCase();if(t==="true")return!0;if(t==="false")return!1}return null},Ve=e=>{if(e==null)return null;if(typeof e=="string"){const t=e.trim();return t.length>0?t:null}return typeof e=="number"&&Number.isFinite(e)?String(e):typeof e=="boolean"?e?"true":"false":null},io=e=>{if(!e)return null;if(typeof e=="object"){const r=e;if(r&&Object.prototype.hasOwnProperty.call(r,"id")){const o=Ve(r.id);return o?{id:o}:null}}const t=Ve(e);return t?{id:t}:null},lo=e=>{const t=e.event??{},r=Ve(e.method),o=Ue(t.offset),i=Ue(t.seq),p=Ue(t.ts_ms)??Ue(t.tsMs)??Ue(t.ts),g=Ve(t.op),y=Ve(t.table),L=io(t.pk),C=t.before==null?null:ft(t.before),k=t.after==null?null:ft(t.after),v=Ve(t.topic),b=t.tx??null,_=Ve(b?.id??t.txnId),l=Ue(b?.index??t.txnIndex),h=Ue(b?.total??t.txnTotal),m=ao(b?.last??t.txnLast),u=t.schemaChange==null?null:ft(t.schemaChange);return{method:r??null,offset:o,seq:i,ts_ms:p,op:g,table:y,pk:L,before:C,after:k,topic:v,txn_id:_,txn_index:l,txn_total:h,txn_last:m,schema_change:u}},co=(e,t={})=>{const r=t.newline??`
`,o=[];for(const i of e){if(!i||typeof i!="object")continue;const p=lo(i);o.push(JSON.stringify(p))}return o.join(r)},uo="cdc_telemetry_buffer_v1",ho=200,In={activation:{key:"activation",label:"Activation",description:"Do new users reach their first comparator insight?"},funnel_drop:{key:"funnel_drop",label:"Funnel drop",description:"Where do users abandon the guided comparator walkthrough?"},adoption:{key:"adoption",label:"Adoption",description:"Which comparator features become part of regular usage?"},quality_gate:{key:"quality_gate",label:"Quality gate",description:"Do reliability issues or errors block comparator adoption?"},scenario_completeness:{key:"scenario_completeness",label:"Scenario completeness",description:"Which templates lead to full replay, export, and comparator review?"},collaboration:{key:"collaboration",label:"Collaboration",description:"How often do teams share scenarios or comparator snapshots?"}},mn={"comparator.scenario.select":"activation","comparator.scenario.preview":"activation","comparator.preset.select":"activation","comparator.scenario.filter":"activation","comparator.scenario.tag_toggle":"funnel_drop","comparator.scenario.tag_clear":"funnel_drop","comparator.summary.copied":"activation","comparator.diff.opened":"funnel_drop","comparator.overlay.inspect":"activation","comparator.schema.change":"activation","comparator.clock.control":"funnel_drop","comparator.consumer.toggle":"funnel_drop","comparator.consumer.rate_toggle":"funnel_drop","comparator.consumer.rate_adjust":"activation","comparator.consumer.rate_reset":"activation","comparator.event.search":"activation","comparator.event.filter":"activation","comparator.panel.layout":"adoption","comparator.event.download":"adoption","comparator.event.clear":"adoption","comparator.event.copy":"activation","comparator.event.copy.error":"quality_gate","comparator.event.replay":"activation","comparator.destination.download":"adoption","comparator.generator.toggle":"adoption","comparator.generator.rate_adjust":"adoption","comparator.generator.burst":"activation","tour.started":"funnel_drop","tour.completed":"activation","tour.dismissed":"funnel_drop","workspace.share.generated":"collaboration","workspace.scenario.imported":"scenario_completeness","workspace.scenario.template_loaded":"activation","workspace.scenario.exported":"scenario_completeness","telemetry.flush":"activation"},On=e=>!!e&&typeof e=="object"&&!Array.isArray(e),Wt=e=>{if(!On(e))return{};const t={};return Object.keys(e).forEach(r=>{t[r]=e[r]}),t},po=()=>({getItem:()=>null,setItem:()=>{}}),mo=e=>{try{return e.toISOString()}catch{return new Date().toISOString()}},fo=e=>{if(!On(e))return null;const t=typeof e.event=="string"?e.event:null;if(!t)return null;const r=Wt(e.payload),o=Wt(e.context),i=typeof e.recordedAt=="string"?e.recordedAt:typeof e.recorded_at=="string"?e.recorded_at:null,p=i&&!Number.isNaN(Date.parse(i))?i:new Date().toISOString(),g=e.question,y=typeof g=="string"&&g in In?g:null;return{event:t,payload:r,context:o,question:y,recordedAt:p}},go=e=>({event:e.event,payload:e.payload,context:e.context,question:e.question,recordedAt:e.recordedAt}),bo=(e={})=>{const t=e.storage??(typeof window<"u"&&window.localStorage?window.localStorage:po()),r=e.storageKey??uo,o=Math.max(1,e.maxEntries??ho),i=e.now??(()=>new Date),p=e.console??(typeof console<"u"?{warn:console.warn.bind(console),debug:console.debug.bind(console)}:{warn:()=>{},debug:()=>{}}),y=(()=>{try{const _=t.getItem(r);if(!_)return[];const l=JSON.parse(_);return Array.isArray(l)?l.map(fo).filter(m=>!!m).slice(-o):[]}catch(_){return p.warn("Telemetry buffer load failed",_),[]}})(),L=()=>{try{const _=y.slice(-o).map(go);t.setItem(r,JSON.stringify(_))}catch(_){p.warn("Telemetry buffer save failed",_)}};return{buffer:y,track:(_,l={},h={})=>{if(typeof _!="string"||!_.trim())return;const m=_.trim(),u={event:m,payload:Wt(l),context:Wt(h),question:mn[m]??null,recordedAt:mo(i())};y.push(u),y.length>o&&y.splice(0,y.length-o),L(),u.context.debug&&p.debug("[telemetry]",u)},flush:()=>{if(y.length===0)return[];const _=y.slice();return y.length=0,L(),_},questions:()=>Object.values(In).map(_=>({..._})),taxonomy:()=>({...mn})}},xo=e=>{const t=new Map,r=i=>{if(!e)return t.get(i)??null;try{const p=e.getItem(i);return typeof p=="string"?p:p??null}catch{return t.get(i)??null}},o=i=>{if(!e)return!1;try{return typeof e.removeItem=="function"?e.removeItem(i):e.setItem(i,""),!0}catch{return!1}};return{getItem(i){return t.has(i)?t.get(i)??null:r(i)},setItem(i,p){if(e)try{e.setItem(i,p),t.delete(i);return}catch{}t.set(i,p)},removeItem(i){t.delete(i),o(i)||t.set(i,null)}}},fn=e=>{const t=e.trim();if(!t.startsWith("|")||t==="|")return[];const r=t.split("|");return r.shift(),r.length>0&&r[r.length-1].trim()===""&&r.pop(),r.map(o=>o.trim())},Nn=e=>{let t=e.trim(),r=!1;const o=["*","_"];let i=!0;for(;i&&t.length>=2;)i=!1,o.forEach(p=>{if(t.startsWith(p)&&t.endsWith(p)){const g=t.slice(p.length,t.length-p.length).trim();g.length>=0&&(t=g,r=!0,i=!0)}});return{text:t,emphasis:r}},yo=e=>{const t=e.match(/^\[([^\]]+)\]\(([^)]+)\)$/);if(!t)return{text:e};const[,r,o]=t;return{text:r.trim(),href:o.trim()}},Dn=e=>e.replace(/&nbsp;/gi," ").replace(/&#160;/g," "),vo=e=>{if(!e)return{text:""};const t=Dn(e),{text:r,emphasis:o}=Nn(t),i=yo(r);return{text:i.text.trim(),href:i.href,emphasis:o}},_o=e=>e.length>0&&e.every(t=>/^:?[-=]+:?$/u.test(t.replace(/\s+/g,""))),wo=e=>{if(!e.length)return!1;const t=e[0].text.trim().toLowerCase();return t.length>0&&t.includes("no runs")&&t.includes("captured")},So=e=>{const t=e.split(/\r?\n/).map(y=>y.trim()).filter(y=>y.startsWith("|"));if(t.length<2)return null;const r=fn(t[0]);if(!r.length)return null;const o=r.map(y=>Nn(Dn(y)).text),i=t.slice(1),p=[];let g=null;return i.forEach(y=>{const L=fn(y);if(!L.length||_o(L))return;const C=L.map(vo);if(wo(C)){g=C[0].text.trim();return}C.every(k=>k.text==="")||p.push(C)}),{headers:o,rows:p,placeholder:g}};function Eo(e,t){const r=structuredClone(e??{}),o=(i,p,g)=>{if(!i)return;const y=i[p],L=typeof y=="string"?y:g,C=L?t[L]:void 0;y!=null&&typeof y=="object"&&"label"in y||(i[p]={label:C?.label??String(L??y??""),tooltip:C?.tooltip,value:typeof y=="number"?y:y?.value??y})};return o(r,"bestLag",r?.bestLagId),o(r,"triggerWriteAmplification",r?.triggerWriteAmplificationId),Array.isArray(r.lanes)&&(r.lanes=r.lanes.map(i=>{const p=typeof i?.method=="string"?i.method:void 0,g=p?t[p]:void 0;return{...i,id:p,label:g?.label??p,tooltip:g?.tooltip}}).filter(Boolean)),r}class Co{constructor(){this.scenario=null,this.engines=[],this.idx=0,this.now=0,this.playing=!1}attach(t){this.engines=t}load(t){this.scenario=t,this.idx=0,this.now=0,this.playing=!1}reset(t){this.engines.forEach(r=>r.reset(t)),this.idx=0,this.now=0}onTick(t){this.onTickCb=t}start(){this.playing=!0}pause(){this.playing=!1}tick(t){if(!this.playing||!this.scenario)return;this.now+=t;const{ops:r}=this.scenario;for(;this.idx<r.length&&r[this.idx].t<=this.now;){const o=r[this.idx++];this.engines.forEach(i=>i.applySourceOp(o))}this.engines.forEach(o=>o.tick(this.now)),this.onTickCb?.(this.now)}}const jo=new Set(["c","u","d"]);function Lo(e){switch(e.op){case"insert":return"c";case"update":return"u";case"delete":return"d";default:return null}}function ko(e){return e.map((t,r)=>{const o=Lo(t);if(!o)return null;const i=t.pk?.id!=null?String(t.pk.id):"";return{key:`${o}::${i}`,op:o,pk:i,index:r,time:t.t}}).filter(t=>!!t)}function To(e){return e.map((t,r)=>{if(!jo.has(t.op))return null;const o=t.pk?.id!=null?String(t.pk.id):"",i=t.op;return{key:`${i}::${o}`,op:i,pk:o,index:r,time:t.ts_ms}}).filter(t=>!!t)}function gn(e){const t=new Map;for(const r of e){const o=t.get(r.key);o?o.push(r):t.set(r.key,[r])}return t}function Mo(e,t){const r=[],o=[],i=[],p=gn(e),g=gn(t),y=new Set([...p.keys(),...g.keys()]);for(const L of y){const C=p.get(L)??[],k=g.get(L)??[],v=Math.min(C.length,k.length);for(let b=0;b<v;b++){const _=C[b],l=k[b];r.push({expected:_,actual:l,lagMs:Math.max(0,l.time-_.time)})}for(let b=v;b<C.length;b++)o.push(C[b]);for(let b=v;b<k.length;b++)i.push(k[b])}return{matched:r,missing:o,extra:i}}function Ao(e){const t=[],r=[...e].sort((i,p)=>i.actual.index-p.actual.index);let o=-1/0;for(const i of r)i.expected.index<o?t.push({type:"ordering",op:i.expected.op,pk:i.expected.pk,expectedIndex:i.expected.index,actualIndex:i.actual.index,expectedTime:i.expected.time,actualTime:i.actual.time}):o=i.expected.index;return t}function Io(e){return e.filter(t=>t.lagMs>0).sort((t,r)=>r.lagMs-t.lagMs).slice(0,5).map(t=>({op:t.expected.op,pk:t.expected.pk,expectedTime:t.expected.time,actualTime:t.actual.time,lagMs:t.lagMs}))}function Oo(e,t,r){const o=ko(t),i=To(r),{matched:p,missing:g,extra:y}=Mo(o,i),L=[];for(const v of g)L.push({type:"missing",op:v.op,pk:v.pk,expectedIndex:v.index,expectedTime:v.time});for(const v of y)L.push({type:"extra",op:v.op,pk:v.pk,actualIndex:v.index,actualTime:v.time});L.push(...Ao(p));const C=Io(p),k=C.reduce((v,b)=>Math.max(v,b.lagMs),0);return{method:e,totals:{missing:L.filter(v=>v.type==="missing").length,extra:L.filter(v=>v.type==="extra").length,ordering:L.filter(v=>v.type==="ordering").length},issues:L,lag:{max:k,samples:C}}}const No=`# Harness Nightly History

Run \`GITHUB_TOKEN=... npm run harness:history\` to refresh this summary. The script aggregates the latest Harness Nightly artifacts and records table-level parity results here so the app can surface them inline.

| Run | Date | Conclusion | Events | Missing | Extra | Max Lag (ms) | Tables | Mismatches |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| _No runs captured yet._ |   |   |   |   |   |   |   |   |

`,Do="workspace",Ro=e=>({...e}),$o=e=>!Array.isArray(e)||e.length===0?[{name:"id",type:"string",pk:!0}]:e.filter(t=>t&&typeof t.name=="string").map(t=>{const r={name:t.name,type:"string",pk:!!t.pk},o=t.type;if(typeof o=="string"){const i=o.toLowerCase();i==="number"||i==="bool"||i==="timestamp"?r.type=i:i==="string"&&(r.type="string")}return typeof t.nullable=="boolean"&&(r.nullable=t.nullable),r}),Po=e=>e.type?String(e.type).toLowerCase():"string",Fo=e=>{const t=e.find(r=>r.pk);return t?.name?t.name:"id"},bn=(e,t,r)=>Array.isArray(r)&&r.length>0?r.reduce((o,i)=>(i===t||Object.prototype.hasOwnProperty.call(e,i)&&(o[i]=e[i]),o),{}):Object.entries(e).reduce((o,[i,p])=>(i===t||(o[i]=p),o),{}),xn=(e,t,r,o)=>{const i=Po(e);if(i==="number"){const g=t.seq*10+r;return typeof o=="number"?o+1:g}if(i==="bool"||i==="boolean")return typeof o=="boolean"?!o:r%2===0;if(i==="timestamp")return t.logicalTime+r+1;const p=`${t.seq}_${r}_${t.opCounter}`;return`${e.name}_${p}`},Uo=(e,t={})=>{const r=$o(e.schema),o=Fo(r),i=new Map;(Array.isArray(e.rows)?e.rows:[]).forEach(L=>{if(!L||typeof L!="object")return;const C=L,k=C[o]??C.id;if(k==null)return;const v=String(k),b={};Object.entries(C).forEach(([_,l])=>{if(_===o){b[_]=String(l);return}_==="id"&&o!=="id"||(b[_]=l)}),Object.prototype.hasOwnProperty.call(b,o)||(b[o]=v),i.set(v,b)});const g=Array.isArray(e.ops)?e.ops.reduce((L,C)=>Math.max(L,C?.t??0),0):0;return{table:typeof e.table=="string"&&e.table.trim().length?e.table:t.fallbackTable??Do,columns:r,pkField:o,rows:i,logicalTime:g,seq:i.size+1,opCounter:0}},Bo=(e,t,r)=>{const o=Math.max(1,Math.floor(t)||1),i=Array.from(e.rows.keys()),p=e.columns.filter(k=>k.name!==e.pkField);let g="insert";if(i.length>0&&p.length>0){const k=e.opCounter%6;(k===0||k===4)&&i.length>1?g="delete":k===1||k===2||k===3?g="update":g="insert"}else i.length>1&&p.length===0&&(g=e.opCounter%3===0?"delete":"insert");const y=e.opCounter;e.opCounter+=1;const L=Math.max(e.logicalTime,r);e.logicalTime=L+o;const C=e.logicalTime;if(g==="insert"){const k=`gen-${e.seq++}`,v={[e.pkField]:k};p.forEach((l,h)=>{v[l.name]=xn(l,e,h)}),e.rows.set(k,v);const b=bn(v,e.pkField);return{op:{t:C,op:"insert",table:e.table,pk:{id:k},after:b},kind:g}}if(g==="update"&&i.length>0&&p.length>0){const k=y%i.length,v=i[k],b=e.rows.get(v);if(!b)return null;const _=p[y%p.length],l=xn(_,e,y,b[_.name]),h=Ro(b);h[_.name]=l,e.rows.set(v,h);const m=bn(h,e.pkField,[_.name]);return{op:{t:C,op:"update",table:e.table,pk:{id:v},after:m},kind:g}}if(g==="delete"&&i.length>0){const k=y%i.length,v=i[k];return e.rows.delete(v),{op:{t:C,op:"delete",table:e.table,pk:{id:v}},kind:g}}return null};function B(e,t={},r={}){if(typeof window>"u")return;const o=window.telemetry;!o||typeof o.track!="function"||o.track(e,t,r)}function mt(e,t={}){B("comparator.clock.control",{action:e,...t})}function qo({onDiffDetailsOpened:e,...t}){const r=o=>{e?.(o),B("comparator.diff.opened",{method:o.method,issues:o.issueCount,maxLag:o.maxLag,scenario:o.scenario})};return n.jsx(so,{...t,onDiffDetailsOpened:r})}function Vo(e){const t={...e};return e.pk&&(t.pk={...e.pk}),e.after&&(t.after={...e.after}),e.txn&&(t.txn={...e.txn}),t}function Go(e){if(e==null)return e;try{return JSON.parse(JSON.stringify(e))}catch{return e}}function Wo(e){return{id:e.id,name:e.id||e.name,label:e.label,description:e.description,highlight:e.highlight,stats:{rows:e.rows.length,ops:e.ops.length},table:e.table,tags:[...e.tags],schema:e.schema.length?e.schema.map(t=>({...t})):void 0,rows:e.rows.length?e.rows.map(t=>({...t})):void 0,events:e.events.length?e.events.map(t=>({...t})):void 0,schemaVersion:e.schemaVersion,seed:e.seed,ops:e.ops.map(Vo),comparator:e.comparator?Go(e.comparator):null}}const Rn=Lr;Rn.length===0&&typeof console<"u"&&console.warn("No scenario templates were loaded from assets/shared-scenarios.js; the comparator scenario gallery will be empty.");const Dt=Rn.map(Wo),$n={polling:{label:"Polling (Query)",laneDescription:"Simple, but lossy. Periodic scans read current state only; hard deletes and mid-poll updates can disappear.",callout:"Polling reads current state only. Hard deletes and intermediate updates are not captured.",whenToUse:"Simple, but lossy. Periodic scans read current state only. Hard deletes and intermediate updates between polls are not observable. Good for small, non-critical syncs where some lag and loss is acceptable."},trigger:{label:"Trigger (Audit)",laneDescription:"Complete, but intrusive. Database triggers write to an audit table and add synchronous source overhead.",callout:"Triggers add write overhead to source transactions.",whenToUse:"Complete, but intrusive. Triggers capture every change into an audit table, but add write latency and operational overhead on the source. Use when log access isn’t available."},log:{label:"Log (WAL)",laneDescription:"Default choice. Streams the transaction log post-commit for ordered, low-latency change events.",callout:"Log-based CDC is the preferred default when available.",whenToUse:"Default choice. Reads the database’s transaction log post-commit. Lowest source impact, complete and ordered changes, near-real-time. Requires connector setup and ops discipline."}};typeof window<"u"&&(window.CDC_METHOD_COPY=$n);const Be="workspace-live",Pn="cdc_comparator_prefs_v1",qe={name:"priority_flag",type:"bool"},Ho=()=>{if(typeof window>"u")return null;try{return window.localStorage}catch{return null}},Ls=(()=>{let e=null,t=null;return()=>{const r=Ho();return(!e||r!==t)&&(e=xo(r),t=r),e}})();function zo(e,t,r,o){if(r.length===0)return 0;const i=e[t]?.metrics.writeAmplification;if(typeof i=="number"&&i>=0)return i;const p=o.ops.filter(g=>g.table===r[0]?.table);return p.length?r.length/p.length:r.length}const fe=["polling","trigger","log"],Fn=2,Ie=100,Un=10,Bn=300,Cs=120,Qo=10,qn=10,Vn=600,Gn=120,js=10,vs=40,Ko=5,Ge=["c","u","d","s"],yn="MYSQL_DEBEZIUM";function Vt(e){return typeof e=="string"&&Object.prototype.hasOwnProperty.call(Ft,e)}const he=e=>{if(e==null)return e;try{return JSON.parse(JSON.stringify(e))}catch{return null}},Jo=e=>{if(!e)return null;const t=e.methodCopyOverrides?he(e.methodCopyOverrides)??void 0:void 0;return{id:e.id,label:e.label,description:e.description,docsHint:e.docsHint,sourceLabel:e.sourceLabel,sourceTooltip:e.sourceTooltip,logLabel:e.logLabel,logTooltip:e.logTooltip,busLabel:e.busLabel,busTooltip:e.busTooltip,destinationLabel:e.destinationLabel,destinationTooltip:e.destinationTooltip,methodCopyOverrides:t}};function Yo(e,t,r,o,i,p,g,y){const L=he(e),C=t?he(t):null,k=he(r)??[],v=g?he(g):null,b=Array.from(o.values()).map(l=>he(l)).filter(l=>!!l),_=y.map(l=>{const h=he(l.metrics);return h?{method:l.method,eventCount:l.events.length,metrics:h}:null}).filter(l=>!!l);return{preferences:L,summary:C,analytics:k,diffs:b,tags:[...i],preset:Jo(p),overlay:v,lanes:_}}function vn(e){return e?!!(e.preferences&&Object.keys(e.preferences).length>0)||!!e.summary||(e.analytics?.length??0)>0||(e.diffs?.length??0)>0||(e.tags?.length??0)>0||!!e.preset||(e.overlay?.length??0)>0||(e.lanes?.length??0)>0:!1}const Xo=$n,K=kn,_s=200,Zo=2e3,ea=6;function ta(){if(typeof window>"u")return new Set;const t=window.cdcFeatureFlags?.all?.();if(Array.isArray(t)&&t.length)return new Set(t.map(String));const r=window.APPWRITE_CFG?.featureFlags;return Array.isArray(r)&&r.length?new Set(r.map(String)):new Set}const sa={polling:{pollIntervalMs:500,includeSoftDeletes:!1},trigger:{extractIntervalMs:250,triggerOverheadMs:8},log:{fetchIntervalMs:50}},na={polling:"QUERY_BASED",trigger:"TRIGGER_BASED",log:"LOG_BASED"},ra={polling:"polling",trigger:"trigger",log:"log"},_n=e=>{switch(e){case"polling":return Rr();case"trigger":return Fr();case"log":default:return Nr()}},wn=e=>{if(!e)return null;const t={...e};return delete t.__ts,t},oa=e=>{if(e==null)return"—";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="number")return Number.isFinite(e)?e.toString():"—";if(e instanceof Date)return e.toISOString();if(typeof e=="object")try{return JSON.stringify(e)}catch{return"[object]"}return String(e)},Wn=(e,t,r)=>{const o=t.kind==="INSERT"?"c":t.kind==="UPDATE"?"u":t.kind==="DELETE"?"d":"s",i=t.schemaChange?{action:t.schemaChange.action,column:{name:t.schemaChange.column.name,type:t.schemaChange.column.type,nullable:t.schemaChange.column.nullable},previousVersion:t.schemaChange.previousVersion,nextVersion:t.schemaChange.nextVersion}:null,p=t.after?.id??t.before?.id??i?.column?.name??null,g=p!=null?String(p):"";return{source:"demo-db",table:t.table,op:o,pk:{id:g},before:wn(t.before),after:wn(t.after),ts_ms:t.commitTs,tx:{id:t.txnId??`tx-${t.commitTs}`,lsn:typeof t.offset=="number"?t.offset:null,index:typeof t.txnIndex=="number"?t.txnIndex:void 0,total:typeof t.txnTotal=="number"?t.txnTotal:void 0,last:typeof t.txnLast=="boolean"?t.txnLast:typeof t.txnTotal=="number"&&typeof t.txnIndex=="number"?t.txnIndex>=t.txnTotal-1:!0},seq:r,meta:{method:ra[e]},schemaChange:i}};function aa(e,t){const r=new Tr,o=new Mr,i=new Ar,p=`cdc.${e}`;let g=_n(e),y,L={bus:r,metrics:o,scheduler:i,topic:p},C={},k=0;const v=new Set,b=m=>{const u=m.__seq,M=typeof u=="number"&&u>0?u:++k;return m.__seq=M,{...Wn(e,m,M),offset:m.offset,topic:m.topic??p}},_=m=>u=>{const M=m(u);if(M.length){const T=M.map(D=>b(D));t(T),T.forEach(D=>v.forEach(G=>G(D)))}return M},l=()=>{g.initialise?.(L),g.configure?.(C),y=new Ir(na[e],r,i,o,p,{startSnapshot:(m,u)=>g.startSnapshot?.(m,M=>_(u)(M)),startTailing:m=>g.startTailing?.(u=>_(m)(u)),stop:()=>g.stop?.()}),y.startSnapshot([]),y.startTailing()};return l(),{name:e,configure(m){C={...m},g.configure?.(m)},reset(m){y.stop(),i.clear(),o.reset(),r.reset(p),k=0,g=_n(e),L={bus:r,metrics:o,scheduler:i,topic:p},l()},applySourceOp(m){g.applySource?.(m)},applySchemaChange(m,u,M,T){const D=u==="add"?"ADD_COLUMN":"DROP_COLUMN";g.applySchemaChange?.(m,D,M,T)},tick(m){g.tick?.(m)},onEvent(m){return v.add(m),()=>v.delete(m)},bus:r,metrics:o,topic:p}}function ia(e,t){return aa(e,t)}function nt(e){return e.reduce((t,r)=>(t[r]=[],t),{})}function la(e){return{polling:{...e.polling},trigger:{...e.trigger},log:{...e.log}}}function Rt(e,t,r){let o=typeof e=="number"?e:Number(e);return Number.isFinite(o)?(typeof r=="number"&&(o=Math.max(r,o)),o):t}function $t(e,t=Cs){if(typeof e!="number"||!Number.isFinite(e))return t;const r=Math.round(e);return Number.isFinite(r)?Math.min(Bn,Math.max(Un,r)):t}function ws(e,t=Gn){if(typeof e!="number"||!Number.isFinite(e))return t;const r=Math.round(e/js)*js;return Number.isFinite(r)?Math.min(Vn,Math.max(qn,r)):t}function Sn(e){if(!Array.isArray(e))return[...fe];const t=[];return fe.forEach(r=>{e.includes(r)&&!t.includes(r)&&t.push(r)}),t.length>=Fn?t:[...fe]}function En(e){const t=Array.from(Ge);if(!Array.isArray(e)||e.length===0)return new Set(t);const r=[];return e.forEach(o=>{if(Ge.includes(o)){const i=o;r.includes(i)||r.push(i)}}),r.length?new Set(r):new Set(t)}function Pt(e){return typeof e=="string"&&fe.includes(e)}function Cn(e){const t=la(sa);return e&&(e.polling&&(e.polling.pollIntervalMs!=null&&(t.polling.pollIntervalMs=Rt(e.polling.pollIntervalMs,t.polling.pollIntervalMs,50)),e.polling.includeSoftDeletes!=null&&(t.polling.includeSoftDeletes=!!e.polling.includeSoftDeletes)),e.trigger&&(e.trigger.extractIntervalMs!=null&&(t.trigger.extractIntervalMs=Rt(e.trigger.extractIntervalMs,t.trigger.extractIntervalMs,50)),e.trigger.triggerOverheadMs!=null&&(t.trigger.triggerOverheadMs=Rt(e.trigger.triggerOverheadMs,t.trigger.triggerOverheadMs,0))),e.log&&e.log.fetchIntervalMs!=null&&(t.log.fetchIntervalMs=Rt(e.log.fetchIntervalMs,t.log.fetchIntervalMs,10))),t}function ca(){if(typeof window>"u")return null;try{const t=Ls().getItem(Pn);if(!t)return null;const r=JSON.parse(t);return{scenarioId:typeof r.scenarioId=="string"?r.scenarioId:void 0,presetId:Vt(r.presetId)?r.presetId:void 0,activeMethods:Array.isArray(r.activeMethods)?r.activeMethods:void 0,methodConfig:r.methodConfig??void 0,userPinnedScenario:typeof r.userPinnedScenario=="boolean"?r.userPinnedScenario:void 0,showEventList:typeof r.showEventList=="boolean"?r.showEventList:void 0,eventOps:Array.isArray(r.eventOps)?r.eventOps:void 0,eventSearch:typeof r.eventSearch=="string"?r.eventSearch:void 0,eventLogTable:typeof r.eventLogTable=="string"?r.eventLogTable:void 0,eventLogTxn:typeof r.eventLogTxn=="string"?r.eventLogTxn:void 0,eventLogMethod:typeof r.eventLogMethod=="string"?r.eventLogMethod:void 0,eventLogOp:typeof r.eventLogOp=="string"?r.eventLogOp:void 0,applyOnCommit:typeof r.applyOnCommit=="boolean"?r.applyOnCommit:void 0,consumerRateEnabled:typeof r.consumerRateEnabled=="boolean"?r.consumerRateEnabled:void 0,consumerRateLimit:typeof r.consumerRateLimit=="number"?r.consumerRateLimit:void 0,generatorEnabled:typeof r.generatorEnabled=="boolean"?r.generatorEnabled:void 0,generatorRate:typeof r.generatorRate=="number"?r.generatorRate:void 0}}catch(e){return console.warn("Comparator prefs load failed",e),null}}function da(e){if(!(typeof window>"u"))try{Ls().setItem(Pn,JSON.stringify(e))}catch(t){console.warn("Comparator prefs save failed",t)}}function ua(e,t,r,o,i,p){const g=e.length?e[e.length-1]:null,y=g?Math.max(t-g.ts_ms,0):t,L=t>0?e.length/(t/1e3):0;let C=0,k=0,v=0,b=0;e.forEach(T=>{T.op==="c"?C+=1:T.op==="u"?k+=1:T.op==="d"&&(v+=1),T.schemaChange&&(b+=1)});const _=r.ops.filter(T=>T.op==="delete").length,l=p?.deletes??0,h=_+l,m=h===0?100:v/h*100,u=e.every((T,D)=>{if(D===0)return!0;const G=e[D-1];return T.ts_ms>=G.ts_ms});return{lagMs:y,throughput:L,deletesPct:m,orderingOk:u,consistent:u&&(o==="polling"?v===h:!0),writeAmplification:o==="trigger"?zo(i,o,e,r)??0:void 0,insertCount:C,updateCount:k,deleteCount:v,schemaChangeCount:b}}function ha(e){if(e.length===0)return null;const t=[...e].sort((v,b)=>v.metrics.lagMs-b.metrics.lagMs),r=t[0],o=t[t.length-1],i=o.metrics.lagMs-r.metrics.lagMs,p=[...e].sort((v,b)=>v.metrics.deletesPct-b.metrics.deletesPct),g=p[0],y=p[p.length-1],L=e.filter(v=>!v.metrics.orderingOk).map(v=>v.method),C=e.filter(v=>v.method==="trigger"&&typeof v.metrics.writeAmplification=="number"),k=C.length?C.reduce((v,b)=>v.metrics.writeAmplification?b.metrics.writeAmplification&&b.metrics.writeAmplification>v.metrics.writeAmplification?b:v:b):null;return{bestLag:r,worstLag:o,lagSpread:i,lowestDeletes:g,highestDeletes:y,orderingIssues:L,triggerWriteAmplification:k}}function pa(){const e=c.useRef(null);e.current===null&&(e.current=ca());const t=e.current||void 0,r=c.useMemo(()=>Ls(),[]),o=Sn(t?.activeMethods),i=Cn(t?.methodConfig),p=t?.presetId&&Vt(t.presetId)?t.presetId:yn,g=Pt(t?.eventLogMethod)?t?.eventLogMethod:null,y=typeof t?.eventLogOp=="string"&&t.eventLogOp.trim()?t.eventLogOp.trim().toLowerCase():null,L=c.useMemo(()=>typeof window>"u"?{...Gt}:Gr(r),[r]),[C,k]=c.useState(null),[v,b]=c.useState(()=>t?.scenarioId??Dt[0].name),[_,l]=c.useState(()=>L.query),[h,m]=c.useState(()=>L.tags),[u,M]=c.useState(()=>o),[T,D]=c.useState(()=>nt(o)),[G,ee]=c.useState(()=>nt(o)),[xe,Ht]=c.useState(()=>({})),[ye,Se]=c.useState(p),[ne,A]=c.useState(0),[W,X]=c.useState(!1),[re,zt]=c.useState(!1),[J,rt]=c.useState(()=>i),[Ee,We]=c.useState(!1),[oe,ot]=c.useState(()=>t?.eventSearch??""),[ks,Qt]=c.useState(()=>En(t?.eventOps)),[Ce,Kt]=c.useState(t?.showEventList??!0),[ae,Oe]=c.useState(t?.eventLogTable??null),[te,Ne]=c.useState(t?.eventLogTxn??""),[ie,je]=c.useState(g),[le,Le]=c.useState(y),[ve,Jt]=c.useState(t?.applyOnCommit??!1),[ce,Yt]=c.useState(t?.consumerRateEnabled??!1),[pe,Xt]=c.useState(()=>$t(t?.consumerRateLimit,Cs)),[de,Zt]=c.useState(t?.generatorEnabled??!1),[se,es]=c.useState(()=>ws(t?.generatorRate,Gn)),[ts,Hn]=c.useState(()=>ta()),ke=c.useRef({}),ge=c.useRef({}),He=c.useRef({}),Ts=c.useRef(t?.consumerRateEnabled??!1?$t(t?.consumerRateLimit,Cs):null),at=c.useRef(0),ss=c.useRef(null),it=c.useRef(0),Ms=c.useRef(se),As=c.useRef(de),lt=c.useRef({inserts:0,updates:0,deletes:0}),ns=c.useRef({}),Is=c.useRef(u),Os=c.useRef(ne),F=Ft[ye]??Ft[yn],zn=c.useMemo(()=>Object.values(Ft).map(s=>({id:s.id,label:s.label})),[]),R=c.useMemo(()=>{const s=F.methodCopyOverrides??{};return fe.reduce((a,d)=>{const f=Xo[d],E=s[d];return a[d]={label:E?.label??f.label,laneDescription:E?.laneDescription??f.laneDescription,callout:E?.callout??f.callout,whenToUse:E?.whenToUse??f.whenToUse,tooltip:E?.tooltip??f.tooltip},a},{})},[F]),Ns=c.useMemo(()=>fe.reduce((s,a)=>{const d=R[a];return s[a]={label:d.label,tooltip:d.tooltip},s},{}),[R]),Ds=c.useMemo(()=>new Set(h),[h]),Rs=c.useMemo(()=>Kr(Dt,{liveScenario:C??void 0,additionalTags:[h]}),[C,h]);c.useEffect(()=>{typeof window>"u"||Wr({query:_,tags:h},r)},[_,h,r]);const Te=c.useCallback((s,a)=>{if(typeof window>"u")return;const d=Ss({query:s,tags:a});window.dispatchEvent(new CustomEvent("cdc:scenario-filter",{detail:d}))},[]),gt=c.useCallback(s=>{if(!s){Re.current=!1;return}if("userPinnedScenario"in s&&(Re.current=!!s.userPinnedScenario),s.activeMethods&&M(Sn(s.activeMethods)),s.methodConfig&&rt(Cn(s.methodConfig)),s.scenarioId&&b(s.scenarioId),s.presetId&&Vt(s.presetId)&&Se(s.presetId),"showEventList"in s&&typeof s.showEventList=="boolean"&&Kt(s.showEventList),"eventOps"in s&&Qt(En(s.eventOps)),"eventSearch"in s&&typeof s.eventSearch=="string"&&ot(s.eventSearch),"eventLogTable"in s){const a=typeof s.eventLogTable=="string"&&s.eventLogTable.trim().length>0?s.eventLogTable:null;Oe(a)}if("eventLogTxn"in s&&Ne(typeof s.eventLogTxn=="string"?s.eventLogTxn:""),"eventLogMethod"in s){const a=Pt(s.eventLogMethod)?s.eventLogMethod:null;je(a)}if("eventLogOp"in s)if(typeof s.eventLogOp=="string"){const a=s.eventLogOp.trim().toLowerCase();Le(a||null)}else Le(null);"applyOnCommit"in s&&typeof s.applyOnCommit=="boolean"&&Jt(s.applyOnCommit),"consumerRateEnabled"in s&&typeof s.consumerRateEnabled=="boolean"&&Yt(s.consumerRateEnabled),"consumerRateLimit"in s&&typeof s.consumerRateLimit=="number"&&Xt($t(s.consumerRateLimit)),"generatorEnabled"in s&&typeof s.generatorEnabled=="boolean"&&Zt(s.generatorEnabled),"generatorRate"in s&&typeof s.generatorRate=="number"&&es(ws(s.generatorRate))},[M,rt,b,Se,Kt,Qt,ot,Oe,Ne,je,Le,Jt,Yt,Xt,Zt,es]);c.useEffect(()=>{if(typeof window>"u")return;const s=()=>{Te(_,h)};return window.addEventListener("cdc:scenario-filter-request",s),()=>{window.removeEventListener("cdc:scenario-filter-request",s)}},[Te,_,h]);const De=c.useMemo(()=>So(No),[]),bt=c.useCallback(s=>{let a=He.current[s];return a||(a=new ys,He.current[s]=a),a},[]),ze=c.useCallback(s=>{ss.current=Uo(s),it.current=0,lt.current={inserts:0,updates:0,deletes:0}},[]),xt=c.useCallback((s,a)=>{const d=ss.current;if(!d||s<=0)return;const f=Is.current;if(!f.length)return;const E=ns.current;for(let j=0;j<s;j+=1){const S=Bo(d,a,Os.current);S&&(f.forEach(w=>{E[w]?.applySourceOp(S.op)}),S.kind==="insert"?lt.current.inserts+=1:S.kind==="update"?lt.current.updates+=1:S.kind==="delete"&&(lt.current.deletes+=1))}},[]),yt=c.useCallback(s=>{if(!As.current||!ss.current)return;const a=Ms.current;if(!Number.isFinite(a)||a<=0)return;it.current+=a*s/1e3;const d=Math.floor(it.current);if(d<=0)return;it.current-=d;const f=d>0?s/d:s;xt(d,f)},[xt]),be=c.useCallback((s,a)=>{const d=ke.current[s];if(!d)return;const f=d.metrics.snapshot(),E=d.bus.size(d.topic);Ht(j=>({...j,[s]:{metrics:f,backlog:E,lastOffset:a?.lastOffset??j[s]?.lastOffset??-1}}))},[]),$s=c.useCallback((s,a)=>{a.length&&(ee(d=>{const f={...d},E=f[s]??[];return f[s]=[...E,...a],f}),be(s,{lastOffset:a[a.length-1]?.offset??-1}))},[be]);c.useEffect(()=>{if(typeof window>"u")return;const s=a=>{if(!(a instanceof CustomEvent))return;const d=a.detail,f=Array.isArray(d)?d:[];Hn(new Set(f.map(String)))};return window.addEventListener("cdc:feature-flags",s),()=>{window.removeEventListener("cdc:feature-flags",s)}},[]);const vt=c.useCallback(s=>ts.size===0?!0:ts.has(s),[ts]),_t=vt("ff_event_bus"),rs=vt("ff_pause_resume"),Qn=vt("ff_query_slider"),Kn=vt("ff_event_log"),Me=c.useMemo(()=>Array.from(ks).sort(),[ks]),Ps=c.useMemo(()=>new Set(Me),[Me]),Qe=c.useMemo(()=>oe.trim().toLowerCase().split(/\s+/).filter(Boolean),[oe]),Fs=c.useMemo(()=>Qe.join("|"),[Qe]),Us=c.useRef(new WeakMap),wt=c.useCallback(s=>{const a=new Set(Me),d=a.size<Ge.length,f=Qe.length>0,E=Us.current,j=new Map,S=w=>{const I=E.get(w);if(I)return I;const O=[String(w.seq??""),w.op,w.pk?.id??"",w.table??""];w.after&&O.push(...Object.values(w.after).map($=>String($??""))),w.before&&O.push(...Object.values(w.before).map($=>String($??"")));const P=O.join(" ").toLowerCase();return E.set(w,P),P};return u.forEach(w=>{const I=s[w]??[];if(!d&&!f){j.set(w,I);return}const O=I.filter(P=>{if(!a.has(P.op))return!1;if(!f)return!0;const $=S(P);return Qe.every(U=>$.includes(U))});j.set(w,O)}),j},[u,Me,Qe]),Jn=c.useMemo(()=>wt(T),[wt,T,Fs]),Bs=c.useMemo(()=>wt(G),[wt,G,Fs]),ct=c.useMemo(()=>{const s=[],a=new Set,d=new Set,f=new Set;return u.forEach(E=>{(Bs.get(E)??[]).forEach(S=>{const w=S.table??"";w&&a.add(w);const I=S.tx?.id??null;I&&d.add(I);const O=typeof S.op=="string"?S.op.trim().toLowerCase():"";O&&f.add(O),s.push({method:E,event:S})})}),s.sort((E,j)=>{const S=E.event.offset??E.event.seq??0,w=j.event.offset??j.event.seq??0;return S!==w?S-w:(E.event.ts_ms??0)-(j.event.ts_ms??0)}),{events:s,tables:Array.from(a).sort(),txns:Array.from(d).sort(),ops:Array.from(f)}},[u,Bs]),os=ct.events,St=ct.tables,Et=ct.txns,as=c.useMemo(()=>{const s=new Set(ct.ops),a=Ge.filter(f=>s.has(f)),d=Array.from(s).filter(f=>!Ge.includes(f));return d.sort(),[...a,...d]},[ct.ops]),Ke=c.useMemo(()=>os.filter(({method:s,event:a})=>{if(ie&&s!==ie||ae&&(a.table??"")!==ae||te&&(a.tx?.id??"")!==te)return!1;const d=typeof a.op=="string"?a.op.trim().toLowerCase():"";return!(le&&d!==le)}),[os,ie,le,ae,te]),Yn=c.useMemo(()=>Ke.map(({method:s,event:a},d)=>{const f=typeof a.offset=="number"?a.offset:null,E=typeof a.seq=="number"?a.seq:null,j=typeof a.ts_ms=="number"?a.ts_ms:null,S=[s,f!=null?`offset-${f}`:null,E!=null?`seq-${E}`:null,j!=null?`ts-${j}`:null,d].filter(Boolean),w=a.pk?.id!=null?String(a.pk.id):null,I=a.schemaChange?n.jsxs("span",{className:"sim-shell__event-log-schema",children:[a.schemaChange.action==="ADD_COLUMN"?"Added":"Dropped"," column ",a.schemaChange.column.name,` · v${a.schemaChange.previousVersion}→v${a.schemaChange.nextVersion}`]}):void 0;return{id:S.length?S.join("|"):`${s}-${d}`,methodId:s,methodLabel:R[s].label,op:a.op??"",offset:f,topic:a.topic??null,table:a.table??null,tsMs:j,pk:w,txnId:a.tx?.id??null,before:a.before??null,after:a.after??null,meta:I}}),[Ke,R]),Xn=c.useMemo(()=>({methodId:ie??void 0,op:le??void 0,table:ae??void 0,txnId:te||void 0}),[ie,le,ae,te]),Zn=c.useMemo(()=>({methods:fe.map(s=>({id:s,label:R[s].label})),ops:as,tables:St,txns:Et}),[St,Et,R]),dt=c.useMemo(()=>{const s=new Map;return u.forEach(a=>{const f=bt(a).snapshot(),E=["table","id"],j=new Set(E);let S=1;f.forEach(O=>{S=Math.max(S,O.schema?.version??1),O.schema?.columns.forEach(P=>{if(!P)return;const $=P.name;!$||$==="id"||$.startsWith("__")||j.has($)||(j.add($),E.push($))})}),f.forEach(O=>{O.rows.forEach(P=>{Object.keys(P).forEach($=>{$==="id"||$.startsWith("__")||j.has($)||(j.add($),E.push($))})})});const w=f.flatMap(O=>O.rows.map(P=>{const $=String(P.id),U={};return E.forEach(q=>{if(q==="table"||q==="id"||q.startsWith("__"))return;const H=P[q];U[q]=H??null}),{id:`${O.name}::${$}`,displayId:$,table:O.name,values:U}})).sort((O,P)=>O.id.localeCompare(P.id,void 0,{numeric:!0,sensitivity:"base"})),I=j.has(qe.name);s.set(a,{columns:E,rows:w,schemaVersion:S,hasSchemaColumn:I})}),s},[u,bt,T]),qs=c.useRef(W),Ct=c.useRef(0);c.useEffect(()=>{ie&&!u.includes(ie)&&je(null)},[u,ie]),c.useEffect(()=>{ae&&!St.includes(ae)&&Oe(null)},[St,ae]),c.useEffect(()=>{le&&!as.includes(le)&&Le(null)},[as,le]),c.useEffect(()=>{te&&!Et.includes(te)&&Ne("")},[Et,te]),c.useEffect(()=>{Is.current=u},[u]),c.useEffect(()=>{Os.current=ne},[ne]),c.useEffect(()=>{As.current=de,de||(it.current=0)},[de]),c.useEffect(()=>{Ms.current=se},[se]);const Re=c.useRef(t?.userPinnedScenario??!1),is=c.useRef(null),_e=c.useMemo(()=>Qr(Dt,{liveScenario:C??void 0,liveScenarioName:Be,query:_,tags:h}),[C,_,h]),x=c.useMemo(()=>_e.length?_e.find(s=>s.name===v)??_e[0]:Dt[0],[v,_e]);c.useEffect(()=>{ze(x)},[x,ze]),c.useEffect(()=>{const s=x.comparator?.preferences;if(!s||typeof s!="object"){is.current=null;return}is.current!==x.name&&(gt(s),is.current=x.name)},[gt,x]);const jt=c.useMemo(()=>{const s=new Map;return u.forEach(a=>{const d=dt.get(a);s.set(a,{present:d?.hasSchemaColumn??!1,version:d?.schemaVersion??1})}),s},[u,dt]),ut=c.useMemo(()=>u.length>0?u.every(s=>jt.get(s)?.present??!1):!1,[u,jt]),$e=c.useMemo(()=>{let s=1;return u.forEach(a=>{const d=jt.get(a);d&&d.version>s&&(s=d.version)}),s},[u,jt]),Je=c.useMemo(()=>!!x.tags?.includes("schema"),[x.tags]),Vs=c.useMemo(()=>{if(!Je)return null;const s=`v${$e}`;return ut?`${s} · column present`:`${s} · column absent`},[ut,$e,Je]);c.useEffect(()=>{Ct.current=0},[x.name]);const ls=c.useMemo(()=>x.table?x.table:x.ops.find(a=>a.table)?.table??"table",[x.ops,x.table]);c.useEffect(()=>{if(!Ee)return;const s=window.setTimeout(()=>We(!1),2e3);return()=>window.clearTimeout(s)},[Ee]),c.useEffect(()=>{if(typeof window>"u")return;const s=window.setTimeout(()=>{B("comparator.event.search",{scenario:x.name,query:oe,hasQuery:!!oe.trim()})},400);return()=>window.clearTimeout(s)},[oe,x.name]),c.useEffect(()=>{qs.current=W},[W]),c.useEffect(()=>{_e.length&&(_e.some(s=>s.name===v)||(Re.current=!1,b(_e[0].name)))},[v,_e]),c.useEffect(()=>{if(!Ee)return;const s=window.setTimeout(()=>We(!1),2e3);return()=>window.clearTimeout(s)},[Ee]),c.useEffect(()=>{if(typeof window>"u")return;const s=a=>{if(!(a instanceof CustomEvent))return;const d=Ss(a.detail);l(f=>f===d.query?f:d.query),m(f=>Br(f,d.tags)?f:d.tags)};return window.addEventListener("cdc:scenario-filter",s),window.dispatchEvent(new CustomEvent("cdc:scenario-filter-request")),()=>{window.removeEventListener("cdc:scenario-filter",s)}},[]),c.useEffect(()=>{if(typeof window>"u")return;const s=a=>{if(!(a instanceof CustomEvent))return;const d=a.detail;if(!d||!d.scenario){k(null);return}const f=Array.isArray(d.scenario.ops)?d.scenario.ops:[],E=d.scenario.label??"Workspace (live)",j=d.scenario.description??`${f.length} operations`,S=d.scenario.seed??1;k({name:Be,label:E,description:j,seed:S,ops:f})};return window.addEventListener("cdc:workspace-update",s),window.dispatchEvent(new CustomEvent("cdc:workspace-request")),()=>{window.removeEventListener("cdc:workspace-update",s)}},[]),c.useEffect(()=>{C&&C.ops.length&&(Re.current||b(Be))},[C]),c.useEffect(()=>{if(typeof window>"u")return;const s=a=>{if(!(a instanceof CustomEvent))return;const d=a.detail;gt(d)};return window.addEventListener("cdc:comparator-preferences-set",s),()=>{window.removeEventListener("cdc:comparator-preferences-set",s)}},[gt]),c.useEffect(()=>{da({scenarioId:v,presetId:ye,activeMethods:u,methodConfig:J,userPinnedScenario:Re.current,showEventList:Ce,eventOps:Me,eventSearch:oe,eventLogTable:ae,eventLogTxn:te,eventLogMethod:ie,eventLogOp:le,applyOnCommit:ve,consumerRateEnabled:ce,consumerRateLimit:pe,generatorEnabled:de,generatorRate:se})},[v,ye,u,J,Ce,Me,oe,ae,te,ie,le,ve,ce,pe,de,se]);const Pe=c.useRef(null),Lt=c.useRef(null),me=c.useCallback(()=>{Lt.current!=null&&(window.clearInterval(Lt.current),Lt.current=null)},[]),Ye=c.useCallback(()=>{if(re)return;const s={},a=Ts.current;if(a!=null){const S=a*Ie/1e3,w=at.current+S;at.current=Math.min(w,a*5)}let d=a==null?Number.POSITIVE_INFINITY:at.current;const f=S=>S.txnId??`tx-${S.commitTs}`,E=S=>{if(!S.length)return!1;const w=S[S.length-1];return typeof w.txnLast=="boolean"?w.txnLast:typeof w.txnIndex=="number"&&typeof w.txnTotal=="number"?w.txnIndex>=w.txnTotal-1:!0},j=(S,w)=>{const I=ge.current[S]??[];let O=I.length?[...I]:[];if(O.length&&(ge.current[S]=[]),!O.length){const $=w.bus.consume(w.topic,1);if(!$.length)return[];O=$}const P=f(O[0]);for(;!E(O);){const $=w.bus.consume(w.topic,1);if(!$.length)return ge.current[S]=O,[];const U=$[0];if(f(U)!==P){const H=ge.current[S]??[];ge.current[S]=[U,...H];break}O.push(U)}return O};for(const S of u){const w=ke.current[S];if(!w)continue;let I=[],O=0;if(ve){const U=j(S,w);if(!U.length)continue;if(a!=null&&U.length>d){ge.current[S]=U;continue}I=U,O=U.length}else{const U=ge.current[S]??[];if(U.length){if(a!=null&&U.length>d){ge.current[S]=U;continue}I=[...U],O+=U.length,ge.current[S]=[]}const q=a==null?Number.POSITIVE_INFINITY:d-O;if(a==null?!0:q>=1){const z=a==null?50:Math.min(Math.floor(q),50),Q=a==null?50:Math.max(z,0);if(Q>0){const Z=w.bus.consume(w.topic,Q);Z.length&&(I=I.length?I.concat(Z):Z,O+=Z.length)}}if(!I.length)continue}a!=null&&(d=Math.max(d-O,0)),bt(S).applyEvents(I),w.metrics.onConsumed(I);const $=I.map(U=>{const q=U.__seq??0;return Wn(S,U,q)});be(S),s[S]=$}a!=null&&(at.current=d),Object.keys(s).length!==0&&D(S=>{const w={...S};for(const[I,O]of Object.entries(s)){const P=w[I]??[];w[I]=[...P,...O]}return w})},[u,ve,bt,re,be]),Gs=c.useCallback(()=>{me(),Lt.current=window.setInterval(()=>{Pe.current?.tick(Ie),yt(Ie),Ye()},Ie)},[me,Ye,yt]);c.useEffect(()=>{const s=ce?pe:null;Ts.current=s,s==null&&(at.current=0)},[ce,pe]),c.useEffect(()=>{re||Ye()},[re,Ye]),c.useEffect(()=>{D(nt(u)),ee(nt(u)),ke.current={},ge.current={},He.current={},u.forEach(j=>{He.current[j]=new ys}),A(0),X(!1),me(),ze(x);const s=new Co,a=[],d={},f={},E=u.map(j=>{const S=ia(j,O=>$s(j,O));if(f[j]=S,j==="polling"){const O=J.polling;S.configure({poll_interval_ms:O.pollIntervalMs,include_soft_deletes:O.includeSoftDeletes})}else if(j==="trigger"){const O=J.trigger;S.configure({extract_interval_ms:O.extractIntervalMs,trigger_overhead_ms:O.triggerOverheadMs})}else{const O=J.log;S.configure({fetch_interval_ms:O.fetchIntervalMs})}const w={bus:S.bus,metrics:S.metrics,topic:S.topic,applySchemaChange:S.applySchemaChange};d[j]=w;const I=S.onEvent(O=>{D(P=>{const $={...P},U=$[j]??[];return $[j]=[...U,O],$})});return a.push(I),S});return ke.current=d,ns.current=f,u.forEach(j=>be(j,{lastOffset:-1})),s.attach(E),s.load(x),s.reset(x.seed),s.onTick(j=>A(j)),Pe.current=s,()=>{s.pause(),me(),a.forEach(j=>j()),ns.current={}}},[u,x,me,J,be,$s,ze]);const er=c.useCallback(s=>{M(a=>{if(a.includes(s))return a.length<=Fn?a:a.filter(f=>f!==s);const d=[...a,s];return fe.filter(f=>d.includes(f))})},[]),tr=c.useCallback(s=>{Qt(a=>{const d=new Set(a);let f=!1;return d.has(s)?d.size>1&&(d.delete(s),f=!0):(d.add(s),f=!0),f&&B("comparator.event.filter",{scenario:x.name,op:s,active:d.has(s)}),f?d:a})},[x.name]),sr=c.useCallback(s=>{ot(s)},[]),nr=c.useCallback(()=>{Kt(s=>{const a=!s;return B("comparator.panel.layout",{scenario:x.name,showEvents:a}),a})},[x.name]),rr=c.useCallback(()=>{Yt(s=>{const a=!s;return B("comparator.consumer.rate_toggle",{scenario:x.name,enabled:a}),a}),ce&&B("comparator.consumer.rate_reset",{scenario:x.name})},[ce,x.name]),or=c.useCallback(s=>{const a=$t(s,pe);a!==pe&&(Xt(a),B("comparator.consumer.rate_adjust",{scenario:x.name,rate:a}))},[pe,x.name]),ar=c.useCallback(()=>{Zt(s=>{const a=!s;return B("comparator.generator.toggle",{scenario:x.name,enabled:a}),a})},[x.name]),ir=c.useCallback(s=>{const a=ws(s,se);a!==se&&(es(a),B("comparator.generator.rate_adjust",{scenario:x.name,rate:a}))},[se,x.name]),lr=c.useCallback(()=>{xt(vs,Ko),B("comparator.generator.burst",{scenario:x.name,count:vs})},[xt,x.name]),cr=c.useCallback(s=>{s.methodId&&Pt(s.methodId)?je(s.methodId):je(null),Oe(s.table??null),Ne(s.txnId??""),Le(s.op?s.op.toLowerCase():null)},[je,Le,Oe,Ne]),dr=c.useCallback(()=>{if(Ke.length===0)return;const s=co(Ke);if(!s)return;const a=new Blob([s],{type:"application/x-ndjson"}),d=URL.createObjectURL(a),f=document.createElement("a");f.href=d,f.download=`${x.name}-event-log.ndjson`,f.click(),URL.revokeObjectURL(d),B("comparator.event.download",{scenario:x.name,events:Ke.length})},[Ke,x.name]),ur=c.useCallback(s=>{const a=He.current[s];if(!a)return;const d=a.snapshot(),f=(x.name||"scenario").replace(/[^a-z0-9-_]+/gi,"-"),E={scenario:x.name,method:s,tables:d},j=new Blob([JSON.stringify(E,null,2)],{type:"application/json"}),S=URL.createObjectURL(j),w=document.createElement("a");w.href=S,w.download=`${f}-${s}-destination.json`,w.click(),URL.revokeObjectURL(S);const I=d.reduce((O,P)=>O+(P.rows?.length??0),0);B("comparator.destination.download",{scenario:x.name,method:s,tables:d.length,rows:I})},[x.name]),hr=c.useCallback(()=>{ee(s=>{const a={...s};return u.forEach(d=>{a[d]=[]}),a}),Us.current=new WeakMap,B("comparator.event.clear",{scenario:x.name})},[u,x.name]),pr=c.useCallback(s=>{const a=JSON.stringify({method:s.methodId??null,methodLabel:s.methodLabel??null,op:s.op,offset:s.offset??null,topic:s.topic??null,table:s.table??null,ts_ms:s.tsMs??null,pk:s.pk??null,txnId:s.txnId??null,before:s.before??null,after:s.after??null},null,2);navigator.clipboard.writeText(a).then(()=>B("comparator.event.copy",{scenario:x.name,method:s.methodId??null,op:s.op,offset:s.offset??null})).catch(()=>{B("comparator.event.copy.error",{scenario:x.name,method:s.methodId??null})})},[x.name]),mr=c.useCallback(s=>{if(typeof window>"u")return;const a=typeof s.op=="string"?s.op.trim().toLowerCase():"";if(a!=="c"&&a!=="u"&&a!=="d")return;const d={op:a,before:s.before??null,after:s.after??null,ts_ms:typeof s.tsMs=="number"?s.tsMs:void 0,table:s.table??void 0,key:s.pk?{id:s.pk}:void 0};window.dispatchEvent(new CustomEvent("cdc:workspace-replay-event",{detail:d})),B("comparator.event.replay",{scenario:x.name,method:s.methodId??null,table:s.table??null,op:a})},[x.name]),fr=c.useCallback(s=>{Vt(s)&&(Se(s),B("comparator.preset.select",{presetId:s}))},[]),gr=c.useCallback(s=>{l(s),Te(s,h),B("comparator.scenario.filter",{query:s})},[Te,h]),br=c.useCallback(s=>{const a=h.includes(s),d=a?h.filter(f=>f!==s):[...h,s];m(d),Te(_,d),B("comparator.scenario.tag_toggle",{tag:s,active:!a})},[Te,_,h]),xr=c.useCallback(()=>{h.length&&(m([]),Te(_,[]),B("comparator.scenario.tag_clear"))},[Te,_,h]),yr=c.useCallback(s=>{Re.current=!0,b(s),B("comparator.scenario.select",{scenario:s})},[]),vr=c.useCallback(s=>{B("comparator.scenario.preview",{scenario:s.name,tags:s.tags??[]}),window.dispatchEvent(new CustomEvent("cdc:preview-scenario",{detail:s}))},[]),Y=c.useMemo(()=>u.map(s=>{const a=T[s]??[];return{method:s,events:a,metrics:ua(a,ne,x,s,xe,lt.current)}}),[u,ne,T,x,xe]),kt=c.useMemo(()=>Y.some(s=>s.events.length>0),[Y]),ht=c.useMemo(()=>{const s=x.comparator;if(!s||!s.summary)return null;const a=s.summary?he(s.summary)??s.summary:null;if(!a)return null;const d=Eo(a,Ns),f=he(s.analytics)??[],E=he(s.diffs)??[],j=he(s.overlay)??[],S=s.preset?he(s.preset)??s.preset:null,w=s.tags.length?[...s.tags]:Array.isArray(x.tags)?[...x.tags]:[],I=f.reduce((q,H)=>{const z=Number(H.total);return Number.isFinite(z)?q+z:q},0),O=Array.isArray(s.lanes)?s.lanes.reduce((q,H)=>{const z=Number(H.eventCount);return Number.isFinite(z)?q+z:q},0):0,P=typeof x.stats?.ops=="number"&&Number.isFinite(x.stats.ops)?x.stats.ops:x.ops.length,$=I||O||P;if(!($>0))return null;const U=Array.isArray(s.lanes)?s.lanes.map(q=>{const H=typeof q.method=="string"?q.method:void 0;if(!H||!Pt(H))return null;const z=q.metrics&&typeof q.metrics=="object"&&!Array.isArray(q.metrics)?q.metrics:{},Q=(...At)=>{for(const fs of At){const tt=z[fs];if(typeof tt=="number"&&Number.isFinite(tt))return tt}},Z=R[H];return{id:H,label:Z?.label??H,tooltip:Z?.tooltip,produced:Q("produced")??0,consumed:Q("consumed")??0,backlog:Q("backlog")??0,lagP50:Q("lagMsP50","lagP50")??0,lagP95:Q("lagMsP95","lagP95")??0,missedDeletes:Q("missedDeletes"),writeAmplification:Q("writeAmplification"),snapshotRows:Q("snapshotRows"),inserts:Q("insertCount","inserts")??0,updates:Q("updateCount","updates")??0,deletes:Q("deleteCount","deletes")??0,schemaChanges:Q("schemaChangeCount","schemaChanges")??0}}).filter(q=>!!q):[];return{scenarioName:x.name,scenarioLabel:x.label,scenarioDescription:x.description,isLive:x.name===Be,totalEvents:$,summary:d,lanes:U,analytics:f,tags:w,preset:S,diffs:E,overlay:j}},[R,Ns,x]),we=c.useMemo(()=>u.reduce((s,a)=>{const d=xe[a],f=d?.metrics,E={backlog:d?.backlog??0,lastOffset:d?.lastOffset??-1,produced:f?.produced??0,consumed:f?.consumed??0,lagMsP50:f?.lagMsP50??0,lagMsP95:f?.lagMsP95??0,missedDeletes:f?.missedDeletes??0,writeAmplification:f?.writeAmplification??0,snapshotRows:f?.snapshotRows??0,errors:f?.errors??0};return s.set(a,E),s},new Map),[u,xe]);c.useEffect(()=>{typeof window>"u"||ht&&(kt||window.dispatchEvent(new CustomEvent("cdc:comparator-summary",{detail:ht})))},[kt,ht]);const cs=c.useMemo(()=>u.reduce((s,a)=>s+(we.get(a)?.backlog??0),0),[u,we]),_r=c.useMemo(()=>_t?u.reduce((s,a)=>{const d=we.get(a);return d&&(s.produced+=d.produced,s.consumed+=d.consumed,s.backlog+=d.backlog,s.snapshotRows+=d.snapshotRows),s},{produced:0,consumed:0,backlog:0,snapshotRows:0}):{produced:0,consumed:0,backlog:0,snapshotRows:0},[u,we,_t]),N=ha(Y),Ws=c.useMemo(()=>Y.reduce((s,a)=>s+a.events.length,0),[Y]),Xe=c.useMemo(()=>Y.map(({method:s,events:a,metrics:d})=>({method:s,label:R[s].label,total:a.length,inserts:d.insertCount,updates:d.updateCount,deletes:d.deleteCount,schemaChanges:d.schemaChangeCount})),[Y,R]),Hs=c.useMemo(()=>Xe.reduce((s,a)=>s.set(a.method,a),new Map),[Xe]),Ae=c.useMemo(()=>{const s=new Map;return Y.forEach(({method:a,events:d})=>{s.set(a,Oo(a,x.ops,d))}),s},[Y,x.ops]),zs=c.useMemo(()=>u.map(s=>{const a=we.get(s),d=Hs.get(s);return{id:s,label:R[s].label,tooltip:R[s].tooltip,produced:a?.produced??0,consumed:a?.consumed??0,backlog:a?.backlog??0,lagP50:a?.lagMsP50??0,lagP95:a?.lagMsP95??0,missedDeletes:a?.missedDeletes,writeAmplification:a?.writeAmplification,snapshotRows:a?.snapshotRows,inserts:d?.inserts??0,updates:d?.updates??0,deletes:d?.deletes??0,schemaChanges:d?.schemaChanges??0}}),[u,Hs,we,R]),pt=c.useMemo(()=>u.map(s=>{const a=we.get(s),d=R[s].label,f=a?.snapshotRows??0;return`${d} ${f}`}).join(", "),[u,we,R]),Tt=c.useMemo(()=>u.map(s=>{const a=Ae.get(s),d=R[s].label,f=a?.totals??{missing:0,extra:0,ordering:0},E=a?.lag?.max??0,j=[];if(f.missing>0&&j.push({key:"missing",text:`${f.missing} missing`,tone:"missing"}),f.extra>0&&j.push({key:"extra",text:`${f.extra} extra`,tone:"extra"}),f.ordering>0&&j.push({key:"ordering",text:`${f.ordering} ordering`,tone:"ordering"}),E>0&&j.push({key:"lag",text:`${Math.round(E)}ms lag`,tone:"lag"}),Je){const w=dt.get(s),I=w?.schemaVersion??1;w&&!w.hasSchemaColumn?j.push({key:"schema-missing",text:`${qe.name} missing`,tone:"schema"}):I<$e&&j.push({key:"schema-behind",text:`Schema v${I}/${$e}`,tone:"schema"})}j.length===0&&j.push({key:"ok",text:"Aligned",tone:"ok"});const S=!!a?.issues.length||(a?.lag?.samples?.length??0)>0||(a?.lag?.max??0)>0;return{method:s,label:d,chips:j,hasDetails:S}}),[u,dt,Ae,R,$e,Je]),Qs=Re.current,Mt=c.useMemo(()=>{const s={scenarioId:v,presetId:ye,activeMethods:[...u],methodConfig:J,userPinnedScenario:Qs,showEventList:Ce,eventOps:Me,eventSearch:oe,eventLogTable:ae,eventLogTxn:te,eventLogMethod:ie,eventLogOp:le,applyOnCommit:ve,consumerRateEnabled:ce,consumerRateLimit:pe,generatorEnabled:de,generatorRate:se};return Yo(s,N??null,Xe,Ae,Array.isArray(x.tags)?x.tags:[],F,Tt,Y)},[u,Xe,ve,ce,pe,ie,le,ae,te,Me,oe,de,se,Ae,Y,Tt,J,F,ye,x,v,Ce,N,Qs]),wr=c.useCallback(s=>{const a=new Date().toISOString(),d=vn(Mt)?Mt:s.comparator??Mt,f={id:s.id,name:s.name,label:s.label,description:s.description,highlight:s.highlight,tags:s.tags,table:s.table,schemaVersion:s.schemaVersion,seed:s.seed,schema:s.schema??[],rows:s.rows??[],events:s.events??[],ops:s.ops,version:2,exportedAt:a,comparator:d},E=new Blob([JSON.stringify(f,null,2)],{type:"application/json"}),j=document.createElement("a");j.href=URL.createObjectURL(E),j.download=`${s.name}.json`,j.click(),URL.revokeObjectURL(j.href);const S=Array.isArray(s.rows)?s.rows.length:0,w=Array.isArray(s.events)?s.events.length:0;B("workspace.scenario.exported",{scenario:s.name,rows:S,events:w,hasComparator:vn(d),methods:u})},[u,Mt,B]);c.useEffect(()=>{typeof window>"u"||window.dispatchEvent(new CustomEvent("cdc:consumer-paused",{detail:{paused:re,backlog:cs}}))},[re,cs]);const Sr=c.useCallback(()=>{if(!N)return;const s=[];s.push(`${x.label}: ${x.description}`),s.push(`Methods: ${u.map(a=>R[a].label).join(", ")}`),N.bestLag&&s.push(`Fastest ${R[N.bestLag.method].label} at ${Math.round(N.bestLag.metrics.lagMs)}ms`),N.lagSpread>0&&s.push(`${R[N.worstLag.method].label} trails by ${Math.round(N.lagSpread)}ms`),s.push(`Lowest delete capture: ${R[N.lowestDeletes.method].label} (${Math.round(N.lowestDeletes.metrics.deletesPct)}%)`),N.triggerWriteAmplification&&s.push(`Trigger write amplification: ${R[N.triggerWriteAmplification.method].label} ${(N.triggerWriteAmplification.metrics.writeAmplification??0).toFixed(1)}x`),pt&&s.push(`Snapshot rows: ${pt}`),s.push(`Ordering: ${N.orderingIssues.length?N.orderingIssues.map(a=>R[a].label).join(", "):"All lanes aligned"}`),x.tags?.length&&s.push(`Tags: ${x.tags.join(", ")}`),navigator.clipboard.writeText(s.join(`
`)).then(()=>We(!0)).catch(()=>We(!1)),B("comparator.summary.copied",{scenario:x.name,tags:x.tags??[],methods:u})},[N,x,u,R,pt]),Er=c.useCallback(s=>{B("comparator.overlay.inspect",{method:s,scenario:x.name});const a=document.getElementById(`lane-diff-${s}`);a instanceof HTMLDetailsElement?(a.open=!0,a.scrollIntoView({behavior:"smooth",block:"center"})):a&&a.scrollIntoView({behavior:"smooth",block:"center"})},[x.name]),ds=c.useCallback(s=>{if(!x.tags?.includes("schema"))return;const a=Math.max(ne,Ct.current+Ie);Ct.current=a,u.forEach(d=>{ke.current[d]?.applySchemaChange?.(ls,s,qe,a),be(d)}),B("comparator.schema.change",{action:s,table:ls,scenario:x.name,commitTs:a,methods:u})},[u,ne,ke,ls,x.name,x.tags,be]),Cr=c.useMemo(()=>{if(!x.tags?.includes("schema"))return;const s=u[0];if(s)return a=>a!==s?null:n.jsx(oo,{columnName:qe.name,onAdd:()=>ds("add"),onDrop:()=>ds("drop"),disableAdd:ut,disableDrop:!ut,status:Vs})},[u,ds,ut,Vs,x.tags]),Ze=c.useCallback((s,a,d)=>{rt(f=>({...f,[s]:{...f[s],[a]:d}}))},[]),et=c.useCallback(s=>{const a=Pe.current;if(a){ze(x),a.reset(x.seed),D(nt(u)),ee(nt(u));for(const d of u){He.current[d]=new ys;const f=ke.current[d];f&&(f.bus.reset(f.topic),f.metrics.reset(),be(d,{lastOffset:-1}))}A(0),Ct.current=0,s?.keepLoop||(a.pause(),X(!1),me())}},[u,ze,x,x.seed,me,be]),us=c.useCallback(()=>{const s=Pe.current;s&&(et({keepLoop:!0}),s.start(),X(!0),Gs(),mt("play",{scenario:x.name}))},[et,Gs,x.name]),hs=c.useCallback(()=>{Pe.current?.pause(),X(!1),me(),mt("pause",{scenario:x.name})},[me,x.name]),jr=c.useCallback(()=>{rs&&zt(s=>{const a=!s;return B("comparator.consumer.toggle",{scenario:x.name,paused:a}),a||Ye(),a})},[Ye,rs,x.name]),ps=c.useCallback((s=Ie)=>{const a=Pe.current;if(!a)return;const d=qs.current;d||a.start(),a.tick(s),yt(s),d||a.pause(),mt("step",{deltaMs:s,scenario:x.name})},[yt,x.name]),Ks=c.useCallback((s,a)=>{const d=Pe.current;if(!d)return;const f=Math.max(10,a??Ie);et({keepLoop:!1});const E=Math.max(s,0);d.start();let j=0,S=0;for(;j<E&&S<1e4;){const w=Math.min(f,E-j);d.tick(w),j+=w,S+=1}d.pause(),X(!1),mt("seek",{targetMs:s,stepMs:a,scenario:x.name})},[et,x.name]),ms=c.useCallback(()=>{ot(""),je(null),Oe(null),Le(null),Ne(""),et(),mt("reset",{scenario:x.name})},[et,x.name,je,Le,Oe,Ne,ot]);return c.useEffect(()=>{if(typeof window>"u")return;const s={play:()=>us(),pause:()=>hs(),step:d=>ps(d),seek:(d,f)=>Ks(d,f),reset:()=>ms()};window.cdcComparatorClock=s;const a=d=>{if(!(d instanceof CustomEvent))return;const f=d.detail;if(f)switch(f.type){case"play":s.play();break;case"pause":s.pause();break;case"step":s.step(f.deltaMs);break;case"seek":s.seek(f.timeMs,f.stepMs);break;case"reset":s.reset();break}};return window.addEventListener("cdc:comparator-clock",a),()=>{window.removeEventListener("cdc:comparator-clock",a),window.cdcComparatorClock===s&&delete window.cdcComparatorClock}},[hs,ms,Ks,us,ps]),c.useEffect(()=>{typeof window>"u"||window.dispatchEvent(new CustomEvent("cdc:comparator-clock-tick",{detail:{clock:ne}}))},[ne]),c.useEffect(()=>()=>me(),[me]),c.useEffect(()=>{if(typeof window>"u"||!kt&&ht)return;const s=N?{lagSpread:N.lagSpread,bestLag:{method:N.bestLag.method,label:R[N.bestLag.method].label,metrics:N.bestLag.metrics},worstLag:{method:N.worstLag.method,label:R[N.worstLag.method].label,metrics:N.worstLag.metrics},lowestDeletes:{method:N.lowestDeletes.method,label:R[N.lowestDeletes.method].label,metrics:N.lowestDeletes.metrics},highestDeletes:{method:N.highestDeletes.method,label:R[N.highestDeletes.method].label,metrics:N.highestDeletes.metrics},orderingIssues:N.orderingIssues.map(w=>({method:w,label:R[w].label})),triggerWriteAmplification:N.triggerWriteAmplification?{method:N.triggerWriteAmplification.method,label:R[N.triggerWriteAmplification.method].label,value:N.triggerWriteAmplification.metrics.writeAmplification??0}:null}:null,a=Y.map(({method:w,metrics:I})=>({method:w,label:R[w].label,tooltip:R[w].tooltip,metrics:I})),d=x.table??x.ops.find(w=>w.table)?.table??"table";let f=d;try{f=F.topicFormat(d)}catch{f=d}const E={id:F.id,label:F.label,description:F.description,docsHint:F.docsHint,source:{label:F.sourceLabel,tooltip:F.sourceTooltip},log:{label:F.logLabel,tooltip:F.logTooltip},bus:{label:F.busLabel,tooltip:F.busTooltip,exampleTopic:f},destination:{label:F.destinationLabel,tooltip:F.destinationTooltip},methods:fe.map(w=>({id:w,label:R[w].label,tooltip:R[w].tooltip??null}))},j=Y.map(({method:w})=>{const I=Ae.get(w);return I?{method:w,totals:I.totals,issues:I.issues.slice(0,25),lag:I.lag}:{method:w,totals:{missing:0,extra:0,ordering:0},issues:[],lag:{max:0,samples:[]}}}),S=u.map(w=>{const I=Ae.get(w);return I?{method:w,label:R[w].label,totals:I.totals,issues:I.issues.slice(0,10),lag:{max:I.lag.max,samples:I.lag.samples.slice(0,10)}}:{method:w,label:R[w].label,totals:{missing:0,extra:0,ordering:0},issues:[],lag:{max:0,samples:[]}}});window.dispatchEvent(new CustomEvent("cdc:comparator-summary",{detail:{scenarioName:x.name,scenarioLabel:x.label,scenarioDescription:x.description,isLive:x.name===Be,totalEvents:Ws,summary:s,lanes:a,analytics:Xe,tags:h,preset:E,diffs:j,overlay:S}}))},[u,Xe,kt,Ae,Y,R,F,x,ht,h,N,Ws]),n.jsxs("section",{className:"sim-shell","aria-label":"Simulator preview",children:[n.jsxs("header",{className:"sim-shell__header",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"sim-shell__title",children:"CDC Method Comparator"}),n.jsx("p",{className:"sim-shell__description",children:F.description}),n.jsxs("div",{className:"sim-shell__preset-row",role:"list","aria-label":"Selected vendor pipeline",children:[n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":F.sourceTooltip,role:"listitem",children:["Source · ",F.sourceLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":F.logTooltip,role:"listitem",children:["Capture · ",F.logLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":F.busTooltip,role:"listitem",children:["Transport · ",F.busLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":F.destinationTooltip,role:"listitem",children:["Sink · ",F.destinationLabel]})]}),n.jsxs("p",{className:"sim-shell__description sim-shell__description--meta",children:[F.label,F.docsHint?n.jsxs(n.Fragment,{children:[" · ",n.jsx("a",{href:F.docsHint,target:"_blank",rel:"noopener noreferrer",children:"Reference"})]}):null]})]}),n.jsxs("div",{className:"sim-shell__scenario-filter-row",role:"group","aria-label":"Filter scenarios",children:[n.jsxs("label",{className:"sim-shell__scenario-search",children:[n.jsx("span",{children:"Search scenarios"}),n.jsx("input",{type:"search",value:_,onChange:s=>gr(s.target.value),placeholder:"Find by label, description, or tag"})]}),Rs.length>0?n.jsxs("div",{className:"sim-shell__scenario-tags",role:"group","aria-label":"Scenario tags",children:[Rs.map(s=>n.jsxs("button",{type:"button",className:"sim-shell__scenario-tag","data-active":Ds.has(s)?"true":"false","aria-pressed":Ds.has(s),onClick:()=>br(s),children:["#",s]},s)),h.length?n.jsx("button",{type:"button",className:"sim-shell__scenario-tag sim-shell__scenario-tag--clear",onClick:xr,children:"Clear"}):null]}):null]}),n.jsxs("div",{className:"sim-shell__actions sim-shell__actions--scenario",role:"group","aria-label":"Scenario controls",children:[n.jsx("select",{"aria-label":"Vendor preset",value:ye,onChange:s=>fr(s.target.value),children:zn.map(s=>n.jsx("option",{value:s.id,children:s.label},s.id))}),n.jsx("select",{"aria-label":"Scenario",value:v,onChange:s=>yr(s.target.value),children:_e.map(s=>n.jsx("option",{value:s.name,children:s.label},s.name))}),n.jsxs("div",{className:"sim-shell__scenario-actions",children:[n.jsx("button",{type:"button",className:"sim-shell__scenario-sync",onClick:()=>{x.name!==Be&&window.dispatchEvent(new CustomEvent("cdc:apply-scenario-template",{detail:{id:x.name}}))},disabled:x.name===Be,children:"Load in workspace"}),n.jsx("button",{type:"button",className:"sim-shell__scenario-download",onClick:()=>wr(x),children:"Download JSON"}),n.jsx("button",{type:"button",className:"sim-shell__scenario-preview",onClick:()=>vr(x),children:"Preview"})]}),n.jsx("div",{className:"sim-shell__method-toggle",role:"group","aria-label":"Methods to display",children:fe.map(s=>n.jsx("button",{type:"button",className:"sim-shell__method-chip","aria-pressed":u.includes(s),onClick:()=>er(s),"data-tooltip":R[s].tooltip||void 0,children:R[s].label},s))})]})]}),n.jsxs("p",{className:"sim-shell__description","aria-live":"polite",children:[n.jsxs("strong",{children:[x.label,":"]})," ",x.description]}),x.highlight&&n.jsx("p",{className:"sim-shell__description sim-shell__description--highlight","aria-live":"polite",children:x.highlight}),x.tags?.length?n.jsx("div",{className:"sim-shell__tag-row","aria-label":"Scenario tags",children:x.tags.map(s=>n.jsxs("span",{className:"sim-shell__tag-chip",children:["#",s]},s))}):null,x.stats&&n.jsxs("p",{className:"sim-shell__description sim-shell__description--meta","aria-live":"polite",children:[x.stats.rows," rows · ",x.stats.ops," ops"]}),n.jsxs("div",{className:"sim-shell__event-filters",role:"group","aria-label":"Event filters",children:[re&&n.jsx("div",{className:"sim-shell__pause-banner",role:"status","aria-live":"polite",children:"Apply paused. Resume to drain the event bus."}),n.jsxs("label",{className:"sim-shell__event-search",children:[n.jsx("span",{children:"Search events"}),n.jsx("input",{type:"search",value:oe,onChange:s=>sr(s.target.value),placeholder:"Filter by pk, seq, or payload"})]}),n.jsx("div",{className:"sim-shell__event-ops",role:"group","aria-label":"Change operations",children:Ge.map(s=>n.jsx("button",{type:"button",className:"sim-shell__event-op","data-active":Ps.has(s)?"true":"false",onClick:()=>tr(s),children:s.toUpperCase()},s))}),n.jsx("button",{type:"button",className:"sim-shell__event-toggle",onClick:nr,children:Ce?"Hide timeline":"Show timeline"})]}),Kn&&n.jsx(eo,{className:"sim-shell__event-log",events:Yn,stats:_r,totalCount:os.length,filters:Xn,filterOptions:Zn,onFiltersChange:cr,onDownload:dr,onClear:hr,onCopyEvent:pr,onReplayEvent:mr,maxVisibleEvents:Zo}),De&&(De.rows.length>0||De.placeholder)&&n.jsx("section",{className:"sim-shell__harness-history","aria-label":"Harness nightly history",children:n.jsxs("details",{children:[n.jsx("summary",{children:"Harness nightly history"}),De.rows.length>0?n.jsx("div",{className:"sim-shell__harness-history-table-wrapper",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsx("tr",{children:De.headers.map(s=>n.jsx("th",{children:s},s))})}),n.jsx("tbody",{children:De.rows.map((s,a)=>n.jsx("tr",{children:s.map((d,f)=>{const E=d.text||"—",j=d.href?n.jsx("a",{href:d.href,target:"_blank",rel:"noreferrer noopener",children:E}):E,S=d.emphasis?n.jsx("em",{children:j}):j;return n.jsx("td",{children:S},`harness-cell-${a}-${f}`)})},`harness-row-${a}`))})]})}):n.jsx("p",{className:"sim-shell__harness-history-empty",children:De.placeholder??"No harness runs captured yet."})]})}),n.jsxs("div",{className:"sim-shell__actions",role:"group","aria-label":"Playback controls","data-tour-target":"comparator-actions",children:[n.jsx("button",{type:"button",onClick:us,disabled:W,children:"Start"}),n.jsx("button",{type:"button",onClick:hs,disabled:!W,children:"Pause"}),n.jsxs("button",{type:"button",onClick:()=>ps(),children:["Step +",Ie,"ms"]}),n.jsx("button",{type:"button",onClick:ms,children:"Reset"}),rs&&n.jsxs("button",{type:"button",onClick:jr,className:"sim-shell__consumer-toggle","data-tooltip":K.backlog,children:[re?"Resume apply":"Pause apply",_t?` (${cs} queued)`:""]}),n.jsxs("label",{className:"sim-shell__apply-toggle","data-tooltip":K.txnAtomic||void 0,children:[n.jsx("input",{type:"checkbox",checked:ve,onChange:s=>Jt(s.target.checked)}),n.jsx("span",{children:"Apply on commit"})]}),n.jsxs("div",{className:"sim-shell__consumer-rate",role:"group","aria-label":"Apply rate limit","data-enabled":ce?"true":"false",children:[n.jsx("button",{type:"button",onClick:rr,children:ce?"Disable throttle":"Throttle apply"}),n.jsxs("label",{children:[n.jsx("span",{children:ce?`${pe} events/s`:"Unlimited"}),n.jsx("input",{type:"range",min:Un,max:Bn,step:Qo,value:pe,onChange:s=>or(Number(s.target.value)),disabled:!ce})]})]}),n.jsxs("div",{className:"sim-shell__generator",role:"group","aria-label":"Event generator","data-enabled":de?"true":"false",children:[n.jsx("button",{type:"button",onClick:ar,children:de?"Stop generator":"Start generator"}),n.jsxs("label",{children:[n.jsx("span",{children:de?`${se} events/s`:`Set ${se} events/s`}),n.jsx("input",{type:"range",min:qn,max:Vn,step:js,value:se,onChange:s=>ir(Number(s.target.value)),disabled:!de})]}),n.jsxs("button",{type:"button",onClick:lr,children:["Burst +",vs]})]})]}),n.jsx("div",{className:"sim-shell__controls","aria-label":"Method tuning controls",children:fe.map(s=>{const a=u.includes(s);if(s==="polling"){const f=J.polling;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":a?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:R[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Adjust poll cadence and whether soft deletes are surfaced."}),Qn?n.jsxs(n.Fragment,{children:[n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsxs("span",{children:["Poll interval (",(f.pollIntervalMs/1e3).toFixed(1),"s)"]}),n.jsx("input",{type:"range",min:500,max:1e4,step:100,value:f.pollIntervalMs,onChange:E=>Ze("polling","pollIntervalMs",Math.min(1e4,Math.max(500,Number(E.target.value)||500)))})]}),n.jsxs("p",{className:"sim-shell__control-hint",children:["⏱️ Polling every ",(f.pollIntervalMs/1e3).toFixed(1),"s"]})]}):n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Poll interval (ms)"}),n.jsx("input",{type:"number",min:100,step:100,value:f.pollIntervalMs,onChange:E=>Ze("polling","pollIntervalMs",Math.min(1e4,Math.max(100,Number(E.target.value)||500)))})]}),n.jsxs("label",{className:"sim-shell__control-checkbox",children:[n.jsx("input",{type:"checkbox",checked:f.includeSoftDeletes,onChange:E=>Ze("polling","includeSoftDeletes",E.target.checked)}),n.jsx("span",{children:"Include soft delete marker column"})]})]},s)}if(s==="trigger"){const f=J.trigger;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":a?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:R[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Tune audit extractor cadence and per-write trigger overhead."}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Extractor interval (ms)"}),n.jsx("input",{type:"number",min:100,step:50,value:f.extractIntervalMs,onChange:E=>Ze("trigger","extractIntervalMs",Math.max(50,Number(E.target.value)||0))})]}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Trigger overhead (ms)"}),n.jsx("input",{type:"number",min:0,step:1,value:f.triggerOverheadMs,onChange:E=>Ze("trigger","triggerOverheadMs",Math.max(0,Number(E.target.value)||0))})]})]},s)}const d=J.log;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":a?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:R[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Control how frequently the WAL/Binlog fetcher polls for new records."}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Fetch interval (ms)"}),n.jsx("input",{type:"number",min:10,step:10,value:d.fetchIntervalMs,onChange:f=>Ze("log","fetchIntervalMs",Math.max(10,Number(f.target.value)||0))})]})]},s)})}),N&&n.jsxs("div",{className:"sim-shell__summary","aria-live":"polite",children:[n.jsxs("ul",{children:[n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":K.lagSpread,children:"Lag spread:"})," ",R[N.bestLag.method].label," is leading at",` ${N.bestLag.metrics.lagMs.toFixed(0)}ms`,N.lagSpread>0?` — ${R[N.worstLag.method].label} trails by ${N.lagSpread.toFixed(0)}ms`:" (no spread)"]}),n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":K.deleteCapture,children:"Delete capture:"})," ",R[N.lowestDeletes.method].label," is lowest at",` ${N.lowestDeletes.metrics.deletesPct.toFixed(0)}%`," · best is ",R[N.highestDeletes.method].label,` (${N.highestDeletes.metrics.deletesPct.toFixed(0)}%)`]}),pt&&n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":K.snapshot,children:"Snapshot rows:"})," ",pt]}),N.triggerWriteAmplification&&n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":K.triggerOverhead,children:"Trigger overhead:"})," ",R[N.triggerWriteAmplification.method].label," is at"," ",`${(N.triggerWriteAmplification.metrics.writeAmplification??0).toFixed(1)}x`," write amplification"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Ordering:"}),N.orderingIssues.length===0?" All methods preserved ordering":` Issues: ${N.orderingIssues.map(s=>R[s].label).join(", ")}`]})]}),n.jsx("button",{type:"button",className:"sim-shell__summary-copy",onClick:Sr,children:Ee?"Copied":"Copy summary"})]}),Tt.length>0&&n.jsxs("section",{className:"sim-shell__overlay-summary","aria-label":"Lane checks",children:[n.jsxs("header",{children:[n.jsx("h3",{children:"Lane checks"}),n.jsx("p",{children:"Quick glance at diff findings and lag hotspots across active capture methods."})]}),n.jsx("ul",{children:Tt.map(s=>n.jsxs("li",{className:"sim-shell__overlay-row",children:[n.jsx("div",{className:"sim-shell__overlay-label",children:s.label}),n.jsx("div",{className:"sim-shell__overlay-chips",children:s.chips.map(a=>n.jsx("span",{className:`sim-shell__overlay-chip sim-shell__overlay-chip--${a.tone}`,children:a.text},`${s.method}-${a.key}`))}),s.hasDetails&&n.jsx("button",{type:"button",className:"sim-shell__overlay-action",onClick:()=>Er(s.method),children:"Inspect"})]},s.method))})]}),zs.length>0&&n.jsx(no,{lanes:zs,renderSchemaWalkthrough:Cr}),n.jsx("div",{className:"sim-shell__lane-grid","data-tour-target":"comparator-lanes",children:Y.map(({method:s,metrics:a,events:d},f)=>{const E=R[s],j=E.laneDescription,S=Ae.get(s)??null,w=f===0,I=we.get(s),O=ke.current[s],P=dt.get(s),$=P?.rows.slice(0,ea)??[],U=(P?.rows.length??0)>$.length,q=Je&&P?{version:P.schemaVersion,expectedVersion:$e,hasColumn:P.hasSchemaColumn,columnName:qe.name}:Je?{version:0,expectedVersion:$e,hasColumn:!1,columnName:qe.name}:void 0,H=s==="trigger"?I?.writeAmplification??a.writeAmplification??0:void 0,z=[],Q=s==="polling"?"warning":"info";E.callout&&(s==="polling"&&a.deletesPct<100?z.push({text:`${E.callout} (${a.deletesPct.toFixed(0)}% of deletes captured in this scenario)`,tone:Q}):z.push({text:E.callout,tone:Q})),x.tags?.includes("schema")&&(s==="trigger"&&typeof H=="number"&&H>0&&z.push({text:`Write amplification ${H.toFixed(1)}x (extra audit writes per change)`,tone:"info"}),s==="log"&&z.push({text:"Log capture streams schema changes in-order, keeping downstream versions aligned.",tone:"info"}),s==="polling"&&z.push({text:"Polling picks up new columns once refreshed rows include them; expect interim nulls.",tone:"warning"})),x.tags?.includes("transactions")&&z.push({text:ve?"Apply-on-commit groups transaction events before updating destinations so tables stay in sync.":"Apply-on-commit is off: events apply individually, so pausing mid-transaction shows partial state.",tone:ve?"info":"warning"});const Z=Jn.get(s)??d,At=Z.length!==d.length||Qe.length>0||Ps.size<Ge.length,fs=Ce&&Z.length>_s,tt=Ce?Z.slice(Math.max(Z.length-_s,0)):[];return n.jsxs("article",{className:"sim-shell__lane-card",children:[n.jsxs("header",{className:"sim-shell__lane-header",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"sim-shell__lane-title","data-tooltip":E.tooltip||void 0,children:E.label}),n.jsx("p",{className:"sim-shell__lane-copy",children:j})]}),n.jsxs("span",{className:"sim-shell__lane-count",children:[Z.length,At?` / ${d.length}`:""," events"]})]}),n.jsx("div",{className:"sim-shell__metrics","data-tour-target":w?"comparator-metrics":void 0,children:n.jsx(ro,{...a})}),n.jsx(qo,{diff:S,scenarioName:x.name,laneId:s,schemaStatus:q}),_t&&n.jsxs("section",{className:"sim-shell__lane-bus","aria-label":`${E.label} event bus`,"data-paused":re?"true":"false",children:[n.jsxs("header",{children:[n.jsx("h4",{children:"Event Bus"}),n.jsx("span",{children:O?.topic??`cdc.${s}`})]}),n.jsxs("p",{children:[n.jsxs("span",{"data-tooltip":K.backlog,children:["Backlog ",n.jsx("strong",{children:I?.backlog??0}),re?" (apply paused)":""]})," · ",n.jsxs("span",{"data-tooltip":K.offset,children:["Last offset ",I?.lastOffset??-1]})]}),n.jsxs("p",{children:["Produced ",I?.produced??0," · Consumed ",I?.consumed??0]}),n.jsxs("p",{"data-tooltip":K.snapshot,children:["Snapshot rows ",I?.snapshotRows??0]}),n.jsxs("p",{"data-tooltip":K.lagPercentile,children:["Lag p50 ",Math.round(I?.lagMsP50??0),"ms · p95 ",Math.round(I?.lagMsP95??0),"ms"]}),s==="trigger"&&n.jsxs("p",{"data-tooltip":K.triggerWriteAmplification,children:["Write amplification: ",H?.toFixed(1)??"0.0","x"]}),s==="polling"&&n.jsxs("p",{className:"sim-shell__lane-bus-warning","data-tooltip":K.deleteCapture,children:["Missed deletes: ",I?.missedDeletes??0]}),I&&I.errors>0&&n.jsxs("p",{className:"sim-shell__lane-bus-warning",children:["Errors: ",I.errors]})]}),P&&n.jsxs("section",{className:"sim-shell__destination","aria-label":`${E.label} destination snapshot`,children:[n.jsxs("header",{children:[n.jsxs("div",{className:"sim-shell__destination-title",children:[n.jsx("h4",{children:"Destination snapshot"}),n.jsxs("span",{children:["schema v",P.schemaVersion]})]}),n.jsx("div",{className:"sim-shell__destination-actions",children:n.jsx("button",{type:"button",className:"sim-shell__destination-download",onClick:()=>ur(s),disabled:P.rows.length===0,children:"Download JSON"})})]}),$.length>0?n.jsx("div",{className:"sim-shell__destination-table",role:"table",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsx("tr",{children:P.columns.map(V=>n.jsx("th",{"data-highlight":V===qe.name?"true":void 0,children:V},V))})}),n.jsx("tbody",{children:$.map(V=>n.jsx("tr",{children:P.columns.map(Fe=>n.jsx("td",{children:oa(Fe==="id"?V.displayId:Fe==="table"?V.table:V.values[Fe])},`${V.id}-${Fe}`))},V.id))})]})}):n.jsx("p",{className:"sim-shell__destination-empty",children:"No rows applied yet."}),U&&n.jsxs("p",{className:"sim-shell__destination-note",children:["Showing ",$.length," of ",P.rows.length," rows."]})]}),n.jsxs("dl",{className:"sim-shell__lane-config",children:[s==="polling"&&(()=>{const V=J.polling;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Poll interval"}),n.jsxs("dd",{"data-tooltip":K.pollingInterval,children:[V.pollIntervalMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Soft deletes"}),n.jsx("dd",{"data-tooltip":K.pollingSoftDeletes,children:V.includeSoftDeletes?"included":"ignored"})]})]})})(),s==="trigger"&&(()=>{const V=J.trigger;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Extractor interval"}),n.jsxs("dd",{"data-tooltip":K.triggerExtractorInterval,children:[V.extractIntervalMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Trigger overhead"}),n.jsxs("dd",{"data-tooltip":K.triggerOverhead,children:[V.triggerOverheadMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Write amplification"}),n.jsxs("dd",{"data-tooltip":K.triggerWriteAmplification,children:[H?.toFixed(1)??"0.0","x"]})]})]})})(),s==="log"&&(()=>{const V=J.log;return n.jsxs("div",{children:[n.jsx("dt",{children:"Fetch interval"}),n.jsxs("dd",{"data-tooltip":K.logFetchInterval,children:[V.fetchIntervalMs," ms"]})]})})()]}),z.length>0&&n.jsx("div",{className:"sim-shell__callouts",children:z.map((V,Fe)=>n.jsx("p",{className:`sim-shell__callout${V.tone==="warning"?" sim-shell__callout--warning":""}`,"data-tour-target":w&&Fe===0?"comparator-callouts":void 0,children:V.text},`${s}-callout-${Fe}`))}),n.jsxs("section",{className:"sim-shell__lane-why","aria-label":`When to use ${E.label}`,children:[n.jsx("h4",{children:"When to use"}),n.jsx("p",{children:E.whenToUse})]}),Ce?n.jsxs("ul",{className:"sim-shell__event-list","aria-live":"polite",children:[fs&&n.jsx("li",{className:"sim-shell__event sim-shell__event--notice",children:n.jsxs("span",{children:["Showing latest ",_s," of ",Z.length," matching events."]})}),tt.length===0?n.jsx("li",{className:"sim-shell__empty",children:At?"No events match the current filters.":"No events yet."}):tt.map(V=>n.jsxs("li",{className:`sim-shell__event${V.op==="d"?" sim-shell__event--delete":""}`,children:[n.jsx("span",{className:"sim-shell__event-op","data-op":V.op,children:V.op}),n.jsxs("span",{children:["#",V.seq," · pk=",V.pk.id]}),n.jsxs("span",{className:"sim-shell__event-target",children:["ts=",V.ts_ms,"ms"]})]},`${s}-${V.seq}`))]}):n.jsx("p",{className:"sim-shell__lane-hidden",children:"Timeline hidden. Use “Show timeline” to view recent events."})]},s)})}),n.jsxs("footer",{className:"sim-shell__footer",children:["Scenario clock: ",ne,"ms · ",Y.reduce((s,a)=>s+a.events.length,0)," total events emitted"]})]})}function jn(){if(typeof window>"u")return;const e=window.telemetry;if(e&&typeof e.track=="function"&&typeof e.flush=="function")return e;let t;try{t=window.localStorage}catch{t=void 0}const r=bo({storage:t,console:typeof console<"u"?{warn:console.warn.bind(console),debug:console.debug.bind(console)}:void 0});return window.telemetry=r,r}function Ln(){const e=document.getElementById("simShellRoot");if(!e){console.warn("Simulator UI shell mount point not found (simShellRoot).");return}kr.createRoot(e).render(n.jsx(pa,{}))}document.readyState==="loading"?(jn(),document.addEventListener("DOMContentLoaded",Ln,{once:!0})):(jn(),Ln());
