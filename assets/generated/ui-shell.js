import{r as d,j as n,T as rn,S as na,R as aa}from"./event-log-widget.js";class ra{constructor(){this.topics=new Map}publish(e,a){if(a.length===0)return[];const r=this.ensure(e);return a.map(u=>{const m=++r.offset,f={...u,offset:m};return r.queue.push(f),f})}consume(e,a=1){const r=this.ensure(e);return a<=0?[]:r.queue.splice(0,a)}size(e){return this.ensure(e).queue.length}reset(e){if(e){this.topics.delete(e);return}this.topics.clear()}ensure(e){let a=this.topics.get(e);return a||(a={offset:-1,queue:[]},this.topics.set(e,a)),a}}class ia{constructor(){this.produced=0,this.consumed=0,this.backlog=0,this.lagSamples=[],this.missedDeletes=0,this.writeAmplification=0,this.snapshotRows=0,this.errors=0,this.lagAggregators=new Set}onProduced(e){this.produced+=e.length,this.backlog+=e.length}onConsumed(e){this.consumed+=e.length,this.backlog=Math.max(this.backlog-e.length,0);const a=Date.now();e.forEach(r=>{const u=typeof r.commitTs=="number"?r.commitTs:typeof r.ts_ms=="number"?r.ts_ms:a,m=Math.max(a-u,0);this.lagSamples.push(m)}),this.lagSamples.length>2e3&&this.lagSamples.splice(0,this.lagSamples.length-2e3),this.notifyLagAggregators()}registerLagAggregator(e){return this.lagAggregators.add(e),this.safeInvokeAggregator(e),()=>{this.lagAggregators.delete(e)}}recordMissedDelete(e=1){this.missedDeletes+=e}recordWriteAmplification(e=1){this.writeAmplification+=e}recordSnapshotRows(e){this.snapshotRows=e}recordError(){this.errors+=1}reset(){this.produced=0,this.consumed=0,this.backlog=0,this.lagSamples=[],this.missedDeletes=0,this.writeAmplification=0,this.snapshotRows=0,this.errors=0,this.notifyLagAggregators()}snapshot(){const e=[...this.lagSamples].sort((u,m)=>u-m),a=this.percentile(e,.5),r=this.percentile(e,.95);return{produced:this.produced,consumed:this.consumed,backlog:this.backlog,lagMsP50:a,lagMsP95:r,missedDeletes:this.missedDeletes,writeAmplification:this.writeAmplification,snapshotRows:this.snapshotRows,errors:this.errors}}safeInvokeAggregator(e,a){try{const r=a?[...a]:[...this.lagSamples];e(r)}catch{}}notifyLagAggregators(){if(this.lagAggregators.size===0)return;const e=[...this.lagSamples];this.lagAggregators.forEach(a=>{this.safeInvokeAggregator(a,e)})}percentile(e,a){if(!e.length)return 0;const r=Math.max(e.length-1,0)*a,u=Math.floor(r),m=Math.min(u+1,e.length-1);if(u===m)return e[u];const f=r-u;return e[u]+(e[m]-e[u])*f}}class oa{constructor(){this.tasks=new Map,this.nextId=1}every(e,a){const r=this.nextId++,u={id:r,interval:e,handler:a};this.tasks.set(r,u);const m=setInterval(()=>a(),e);return u.timerId=m,r}clear(e){if(e!=null){const a=this.tasks.get(e);a&&a.timerId&&clearInterval(a.timerId),this.tasks.delete(e);return}this.tasks.forEach(a=>{const r=a.timerId;r&&clearInterval(r)}),this.tasks.clear()}}class la{constructor(e,a,r,u,m,f={}){this.mode=e,this.bus=a,this.scheduler=r,this.metrics=u,this.handlers=f,this.state="IDLE",this.topic=m??`cdc.${e.toLowerCase()}`}get currentState(){return this.state}get topicName(){return this.topic}startSnapshot(e){this.state==="IDLE"&&(this.state="SNAPSHOTTING",this.handlers.startSnapshot?.(e,a=>this.emit(a)))}startTailing(){this.state!=="TAILING"&&(this.state="TAILING",this.handlers.startTailing?.(e=>this.emit(e)))}pause(){this.state==="TAILING"&&(this.state="PAUSED")}resume(){this.state==="PAUSED"&&(this.state="TAILING")}stop(){this.state="IDLE",this.scheduler.clear(),this.handlers.stop?.(),this.bus.reset(this.topic),this.metrics.reset()}emit(e){if(e.length===0)return[];const a=this.bus.publish(this.topic,e);return this.metrics.onProduced(a),a}}let ca=0;const Wt=()=>`evt-${Date.now()}-${++ca}`,ft=t=>t?JSON.parse(JSON.stringify(t)):null,Is=(t,e)=>`${t}::${e}`,Os=(t,e)=>({id:t.name,type:t.type,nullable:t.nullable??!1,__ts:e}),Ns=(t,e,a=`tx-${e}`)=>{const r=t?.id??a,u=typeof t?.index=="number",m=u?t.index:void 0,f=typeof t?.total=="number"?t.total:void 0;let v;return typeof t?.last=="boolean"?v=t.last:u&&typeof f=="number"?v=m>=f-1:v=!t,{id:r,index:m,total:f,last:v}};function da(){let t=null,e=null,a=100,r=0;const u=new Map,m=[];let f=0;const v=new Map,M=g=>{const A=v.get(g);return typeof A=="number"&&A>=1?A:(v.set(g,1),1)},I=g=>{const A=M(g),l=A+1;return v.set(g,l),{previous:A,next:l}},k=(g,A,l,h,o)=>{const y=Ns(g.txn,o);return{id:Wt(),kind:A,table:g.table,before:l?{id:g.pk.id,...l,__ts:o}:void 0,after:h?{id:g.pk.id,...h,__ts:o}:void 0,txnId:y.id,txnIndex:y.index,txnTotal:y.total,txnLast:y.last,commitTs:o,schemaVersion:M(g.table),topic:t?.topic??`cdc.${g.table}`,partition:0}},x=(g,A,l,h)=>{if(!e||!t)return;const{previous:o,next:y}=I(g),L=Ns(void 0,h,`schema-${h}`),j={id:Wt(),kind:A==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:g,before:A==="DROP_COLUMN"?Os(l,h):void 0,after:A==="ADD_COLUMN"?Os(l,h):void 0,txnId:L.id,txnIndex:L.index,txnTotal:L.total,txnLast:L.last,commitTs:h,schemaVersion:y,topic:t.topic??`cdc.${g}`,partition:0,schemaChange:{action:A,column:l,previousVersion:o,nextVersion:y}};e([j])};return{id:"LOG_BASED",initialise(g){t=g},configure(g){const A=Number(g.fetch_interval_ms??g.fetchIntervalMs);Number.isFinite(A)&&A>0&&(a=A)},startSnapshot(g=[],A){if(e=A,!g.length||(g.forEach(h=>{const o=h.schema?.version??1;v.set(h.name,o),h.rows.forEach(y=>{const L=Is(h.name,y.id);u.set(L,{id:y.id,table:h.name,data:{...y},version:1,updatedAt:y.__ts??0,deleted:!1})})}),t?.metrics.recordSnapshotRows(u.size),!u.size))return;const l=[];u.forEach(h=>{l.push({id:Wt(),kind:"INSERT",table:h.table,before:void 0,after:{id:h.id,...h.data,__ts:h.updatedAt},txnId:`snapshot-${h.updatedAt}`,txnIndex:0,txnTotal:1,txnLast:!0,commitTs:h.updatedAt,schemaVersion:M(h.table),topic:t?.topic??`cdc.${h.table}`,partition:0})}),e(l),f=m.length},startTailing(g){e=g},applySource(g){if(!t)return;const A=g.t,l=Is(g.table,g.pk.id);if(M(g.table),g.op==="insert")u.set(l,{id:g.pk.id,table:g.table,data:{...g.after},version:1,updatedAt:A,deleted:!1}),m.push(k(g,"INSERT",null,ft(g.after),A));else if(g.op==="update"){const h=u.get(l),o=h?ft(h.data):null,y=h?{...h.data,...g.after}:{...g.after};u.set(l,{id:g.pk.id,table:g.table,data:y,version:(h?.version??0)+1,updatedAt:A,deleted:!1}),m.push(k(g,"UPDATE",o,ft(y),A))}else if(g.op==="delete"){const h=u.get(l);u.set(l,{id:g.pk.id,table:g.table,data:h?{...h.data}:{},version:(h?.version??0)+1,updatedAt:A,deleted:!0}),m.push(k(g,"DELETE",h?ft(h.data):null,null,A))}},applySchemaChange(g,A,l,h){t&&(M(g),A==="ADD_COLUMN"?u.forEach((o,y)=>{o.table===g&&(l.name in o.data||(o.data[l.name]=null,u.set(y,{...o,data:{...o.data}})))}):A==="DROP_COLUMN"&&u.forEach((o,y)=>{if(o.table===g&&l.name in o.data){const L={...o.data};delete L[l.name],u.set(y,{...o,data:L})}}),x(g,A,l,h))},tick(g){if(!e||g-r<a)return;const A=m.slice(f);A.length&&(e(A),f=m.length),r=g},pause(){},resume(){},stop(){u.clear(),m.length=0,f=0,e=null,t=null,v.clear(),r=0}}}let ua=0;const Ht=()=>`evt-${Date.now()}-${++ua}`,Ds=t=>t?JSON.parse(JSON.stringify(t)):null,Rs=(t,e)=>`${t}::${e}`,$s=(t,e)=>({id:t.name,type:t.type,nullable:t.nullable??!1,__ts:e}),Ps=(t,e,a=`tx-${e}`)=>{const r=t?.id??a,m=!1?t.index:void 0,f=void 0;let v;return v=!0,{id:r,index:m,total:f,last:v}};function ha(){let t=null,e=null,a=1e3,r=!1,u=0;const m=new Map,f=new Map,v=new Map,M=[],I=l=>{const h=v.get(l);return typeof h=="number"&&h>=1?h:(v.set(l,1),1)},k=l=>{const h=I(l),o=h+1;return v.set(l,o),{previous:h,next:o}},x=(l,h,o,y,L,j,D,V)=>{const K=Ps(V,j,D);return{id:Ht(),kind:o,table:l,before:y?{id:h,...y,__ts:j}:void 0,after:L?{id:h,...L,__ts:j}:void 0,txnId:K.id,txnIndex:K.index,txnTotal:K.total,txnLast:K.last,commitTs:j,schemaVersion:I(l),topic:t?.topic??`cdc.${l}`,partition:0}},g=(l,h,o,y)=>{const{previous:L,next:j}=k(l),D=Ps(void 0,y,`schema-${y}`);M.push({id:Ht(),kind:h==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:l,before:h==="DROP_COLUMN"?$s(o,y):void 0,after:h==="ADD_COLUMN"?$s(o,y):void 0,txnId:D.id,txnIndex:D.index,txnTotal:D.total,txnLast:D.last,commitTs:y,schemaVersion:j,topic:t?.topic??`cdc.${l}`,partition:0,schemaChange:{action:h,column:o,previousVersion:L,nextVersion:j}})},A=l=>{!l.length||!e||e(l)};return{id:"QUERY_BASED",initialise(l){t=l},configure(l){const h=Number(l.poll_interval_ms??l.pollIntervalMs);Number.isFinite(h)&&h>0&&(a=h),l.include_soft_deletes!=null&&(r=!!l.include_soft_deletes),l.includeSoftDeletes!=null&&(r=!!l.includeSoftDeletes)},startSnapshot(l=[],h){e=h;const o=[];l.forEach(y=>{const L=y.schema?.version??1;v.set(y.name,L),y.rows.forEach(j=>{const D=Rs(y.name,j.id);m.set(D,{id:j.id,table:y.name,data:{...j},version:1,updatedAt:j.__ts??0,deleted:!1}),f.set(D,1);const{id:V,__ts:K,...ke}=j;o.push({id:Ht(),kind:"INSERT",table:y.name,before:void 0,after:{id:V,...ke,__ts:K??0},txnId:`snapshot-${j.__ts??0}`,txnIndex:0,txnTotal:1,txnLast:!0,commitTs:j.__ts??0,schemaVersion:I(y.name),topic:t?.topic??`cdc.${y.name}`,partition:0})})}),t?.metrics.recordSnapshotRows(o.length),A(o)},startTailing(l){e=l},applySource(l){const h=Rs(l.table,l.pk.id),o=l.t;if(I(l.table),l.op==="insert")m.set(h,{id:l.pk.id,table:l.table,data:{...l.after},version:1,updatedAt:o,deleted:!1});else if(l.op==="update"){const y=m.get(h),L=y?{...y.data,...l.after}:{...l.after};m.set(h,{id:l.pk.id,table:l.table,data:L,version:(y?.version??0)+1,updatedAt:o,deleted:!1})}else if(l.op==="delete"){const y=m.get(h);m.set(h,{id:l.pk.id,table:l.table,data:y?{...y.data}:{},version:(y?.version??0)+1,updatedAt:o,deleted:!0})}},applySchemaChange(l,h,o,y){I(l),h==="DROP_COLUMN"&&m.forEach((L,j)=>{if(L.table===l&&o.name in L.data){const D={...L.data};delete D[o.name],m.set(j,{...L,data:D})}}),g(l,h,o,y)},tick(l){if(!e||l-u<a)return;const h=[];M.length&&h.push(...M.splice(0,M.length)),m.forEach((o,y)=>{if(o.updatedAt<=u)return;const L=f.get(y)??0;if(o.deleted){r?(h.push(x(o.table,o.id,"DELETE",Ds(o.data),null,o.updatedAt,`tx-${o.updatedAt}`)),f.set(y,o.version)):(t?.metrics.recordMissedDelete(),f.set(y,o.version));return}if(o.version<=L)return;const j=L===0?"INSERT":"UPDATE";h.push(x(o.table,o.id,j,null,Ds(o.data),o.updatedAt,`tx-${o.updatedAt}`)),f.set(y,o.version)}),A(h),u=l},stop(){m.clear(),f.clear(),v.clear(),M.length=0,e=null,t=null,u=0}}}let pa=0;const Fs=()=>`evt-${Date.now()}-${++pa}`,bt=t=>t?JSON.parse(JSON.stringify(t)):null,ma=(t,e)=>`${t}::${e}`,Us=(t,e)=>({id:t.name,type:t.type,nullable:t.nullable??!1,__ts:e}),Bs=(t,e,a=`tx-${e}`)=>{const r=t?.id??a,u=typeof t?.index=="number",m=u?t.index:void 0,f=typeof t?.total=="number"?t.total:void 0;let v;return typeof t?.last=="boolean"?v=t.last:u&&typeof f=="number"?v=m>=f-1:v=!t,{id:r,index:m,total:f,last:v}};function ga(){let t=null,e=null,a=250,r=8,u=0,m=0;const f=new Map,v=[],M=new Map,I=l=>{const h=M.get(l);return typeof h=="number"&&h>=1?h:(M.set(l,1),1)},k=l=>{const h=I(l),o=h+1;return M.set(l,o),{previous:h,next:o}},x=(l,h,o,y,L)=>{const j=Bs(l.txn,L);return{id:Fs(),kind:h,table:l.table,before:o?{id:l.pk.id,...o,__ts:L}:void 0,after:y?{id:l.pk.id,...y,__ts:L}:void 0,txnId:j.id,txnIndex:j.index,txnTotal:j.total,txnLast:j.last,commitTs:L,schemaVersion:I(l.table),topic:t?.topic??`cdc.${l.table}`,partition:0}},g=(l,h,o,y)=>{const{previous:L,next:j}=k(l),D=Bs(void 0,y,`schema-${y}`),V={id:Fs(),kind:h==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:l,before:h==="DROP_COLUMN"?Us(o,y):void 0,after:h==="ADD_COLUMN"?Us(o,y):void 0,txnId:D.id,txnIndex:D.index,txnTotal:D.total,txnLast:D.last,commitTs:y,schemaVersion:j,topic:t?.topic??`cdc.${l}`,partition:0,schemaChange:{action:h,column:o,previousVersion:L,nextVersion:j}};v.push({event:V})},A=l=>{!l.length||!e||e(l)};return{id:"TRIGGER_BASED",initialise(l){t=l},configure(l){const h=Number(l.extract_interval_ms??l.extractIntervalMs);Number.isFinite(h)&&h>0&&(a=h);const o=Number(l.trigger_overhead_ms??l.triggerOverheadMs);Number.isFinite(o)&&o>=0&&(r=o)},startSnapshot(l=[],h){e=h,t?.metrics.recordSnapshotRows(0)},startTailing(l){e=l},applySource(l){if(!t)return;const h=ma(l.table,l.pk.id),o=l.t+r;let y=null,L=null,j;if(I(l.table),l.op==="insert")j="INSERT",L=bt(l.after),f.set(h,{id:l.pk.id,table:l.table,data:{...l.after},version:1,updatedAt:o,deleted:!1});else if(l.op==="update"){const D=f.get(h);y=D?bt(D.data):null;const V=D?{...D.data,...l.after}:{...l.after};L=bt(V),j="UPDATE",f.set(h,{id:l.pk.id,table:l.table,data:V,version:(D?.version??0)+1,updatedAt:o,deleted:!1})}else if(l.op==="delete"){const D=f.get(h);y=D?bt(D.data):null,L=null,j="DELETE",f.set(h,{id:l.pk.id,table:l.table,data:D?{...D.data}:{},version:(D?.version??0)+1,updatedAt:o,deleted:!0})}else return;v.push({event:x(l,j,y,L,o)}),t.metrics.recordWriteAmplification(1)},applySchemaChange(l,h,o,y){if(!t)return;const L=y+r;I(l),h==="ADD_COLUMN"?f.forEach((j,D)=>{if(j.table===l&&!(o.name in j.data)){const V={...j.data,[o.name]:null};f.set(D,{...j,data:V,version:j.version+1,updatedAt:L})}}):h==="DROP_COLUMN"&&f.forEach((j,D)=>{if(j.table===l&&o.name in j.data){const V={...j.data};delete V[o.name],f.set(D,{...j,data:V,version:j.version+1,updatedAt:L})}}),g(l,h,o,L)},tick(l){if(!e||l-u<a)return;const h=v.slice(m).map(o=>o.event);A(h),m=v.length,u=l},stop(){v.length=0,f.clear(),e=null,t=null,m=0,u=0,M.clear()}}}const wt={MYSQL_DEBEZIUM:{id:"MYSQL_DEBEZIUM",label:"MySQL · Debezium · Kafka",description:"Debezium tails the MySQL binlog and pushes commits to Kafka for downstream consumers.",docsHint:"https://debezium.io/documentation/reference/stable/connectors/mysql.html",sourceLabel:"MySQL primary",sourceTooltip:"InnoDB workload emitting row-level changes for capture.",logLabel:"MySQL binlog (Debezium)",logTooltip:"Debezium connector streams row-format binlog entries in commit order.",busLabel:"Kafka topic",busTooltip:"Kafka transports Debezium change events (e.g. db.orders) to consumers.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Analytics warehouse, service, or cache subscribing to the Kafka topic.",topicFormat:t=>`db.${t}`,methodCopyOverrides:{polling:{label:"Polling (scheduled SQL)",laneDescription:"Batch jobs diff the MySQL table on an interval to detect divergence.",callout:"Misses hard deletes and rapid updates without custom tracking tables.",whenToUse:"Fallback when binlog access is blocked. Accepts lag and data loss for small tables only.",tooltip:"ETL-style SELECT polling against the MySQL primary."},trigger:{label:"Triggers (audit table)",laneDescription:"AFTER triggers write every mutation into an audit table for downstream extract.",callout:"Adds synchronous latency on the write path and increases operational overhead.",whenToUse:"When connectors are unavailable but you still need complete change history.",tooltip:"MySQL triggers populate audit tables that an extractor drains."},log:{label:"Debezium binlog tail",laneDescription:"Debezium streams row-based binlog events into Kafka with schema evolution support.",callout:"Preferred default: low-impact, ordered, near real-time change capture.",whenToUse:"Standard choice for production MySQL workloads when Kafka + Debezium are available.",tooltip:"Debezium connector tailing the MySQL binlog."}}},POSTGRES_LOGICAL:{id:"POSTGRES_LOGICAL",label:"Postgres · Logical decoding · Kafka",description:"Logical decoding streams Postgres WAL changes (pgoutput/wal2json) into Kafka.",docsHint:"https://www.postgresql.org/docs/current/logicaldecoding.html",sourceLabel:"Postgres primary",sourceTooltip:"OLTP Postgres emitting WAL entries for publications.",logLabel:"Logical replication slot",logTooltip:"Logical decoding slot materialises committed WAL changes via pgoutput or wal2json.",busLabel:"Kafka topic",busTooltip:"Kafka topics per publication (e.g. public.orders) fan out change events.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Consumers applying logical changes into warehouses or services.",topicFormat:t=>`public.${t}`,methodCopyOverrides:{polling:{label:"Polling (snapshot queries)",laneDescription:"Incremental SELECT queries compare current rows to previous snapshots.",callout:"Can't observe deletes or mid-transaction updates without tombstone columns.",whenToUse:"Stopgap for small tables when logical replication isn't permitted.",tooltip:"Periodic comparison queries against Postgres source tables."},trigger:{label:"Triggers (audit schema)",laneDescription:"Triggers populate audit tables that an extractor tails outside the WAL.",callout:"Higher write amplification and maintenance across replicas.",whenToUse:"When WAL access is off-limits yet complete history is required.",tooltip:"AFTER triggers write into audit tables for downstream capture."},log:{label:"Logical decoding stream",laneDescription:"Slot-based logical decoding streams ordered WAL changes through Kafka.",callout:"Best balance: ordered, low-impact capture with schema evolution support.",whenToUse:"Primary choice when you can run wal2json/pgoutput connectors.",tooltip:"Logical replication slot feeding Kafka via connectors."}}},SQLSERVER_CDC:{id:"SQLSERVER_CDC",label:"SQL Server · CDC tables · ETL",description:"SQL Server CDC populates change tables that ETL tools ship downstream.",docsHint:"https://learn.microsoft.com/sql/relational-databases/track-changes/about-change-data-capture-sql-server",sourceLabel:"SQL Server OLTP",sourceTooltip:"Source database with CDC enabled on tracked tables.",logLabel:"CDC change tables",logTooltip:"Log reader agent populates [cdc].[schema_table_CT] from the transaction log.",busLabel:"ETL pipeline",busTooltip:"ADF/SSIS or similar ETL pipelines move captured rows to consumers.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Lakehouse, staging DB, or microservice applying captured rows.",topicFormat:t=>`cdc.${t}_ct`,methodCopyOverrides:{polling:{label:"Polling (T-SQL jobs)",laneDescription:"Scheduled queries compare source tables against a shadow copy.",callout:"Hard deletes vanish and rapid updates collapse to last-write wins.",whenToUse:"Only when CDC can't be enabled. Expect drift and operational overhead.",tooltip:"Agent jobs issuing SELECT deltas against the primary."},trigger:{label:"DB triggers (audit tables)",laneDescription:"DDL-driven triggers write into audit tables that ETL picks up.",callout:"Adds synchronous writes and complicates deployments.",whenToUse:"Fallback for editions without CDC but needing full fidelity.",tooltip:"FOR INSERT/UPDATE/DELETE triggers persisting rows into audit tables."},log:{label:"CDC change table stream",laneDescription:"Native CDC surfaces ordered change rows ready for downstream ETL.",callout:"Balanced approach: leverages log reader agent with minimal code.",whenToUse:"Default when SQL Server Enterprise/Standard CDC is available.",tooltip:"Change Data Capture tables populated by the log reader agent."}}},ORACLE_GG:{id:"ORACLE_GG",label:"Oracle · GoldenGate",description:"GoldenGate extracts Oracle redo into trails that replicat apply downstream.",docsHint:"https://docs.oracle.com/en/middleware/goldengate/",sourceLabel:"Oracle primary",sourceTooltip:"Oracle Database generating redo entries for tracked schemas.",logLabel:"Redo / GoldenGate trail",logTooltip:"Extract captures redo logs into GoldenGate trail files.",busLabel:"GoldenGate distribution",busTooltip:"GoldenGate distribution path replicates changes to targets or Kafka.",destinationLabel:"Replica / downstream sink",destinationTooltip:"Target database, cache, or Kafka topic consuming GoldenGate trails.",topicFormat:t=>`ogg.${t}`,methodCopyOverrides:{polling:{label:"Polling (custom jobs)",laneDescription:"Scripts query Oracle tables for deltas outside of GoldenGate.",callout:"Expensive and incomplete without change tracking columns.",whenToUse:"Rare stopgap for small tables when GoldenGate access is unavailable.",tooltip:"Ad-hoc jobs diffing source tables over DB links or snapshots."},trigger:{label:"Triggers (shadow tables)",laneDescription:"Row-level triggers populate shadow tables for downstream capture.",callout:"Adds redo volume and requires meticulous deployment management.",whenToUse:"Fallback when GoldenGate licensing or access is restricted.",tooltip:"Oracle triggers mirroring mutations into custom staging tables."},log:{label:"GoldenGate redo tail",laneDescription:"GoldenGate Extract/Replicat stream redo into ordered trail files.",callout:"Enterprise-grade: minimal source impact with robust replication semantics.",whenToUse:"Primary approach for Oracle sources requiring guaranteed replication.",tooltip:"GoldenGate Extract reading redo logs into trail files."}}},MONGODB_STREAMS:{id:"MONGODB_STREAMS",label:"MongoDB · Change Streams",description:"Change Streams tail the MongoDB oplog and push updates to subscribers.",docsHint:"https://www.mongodb.com/docs/manual/changeStreams/",sourceLabel:"MongoDB replica set",sourceTooltip:"Replica set primary emitting operations into the oplog.",logLabel:"Change stream (oplog)",logTooltip:"Change Stream cursor streams oplog events filtered per namespace.",busLabel:"Driver subscriber",busTooltip:"Driver / connector pushes stream events to downstream sinks (Kafka/Atlas).",destinationLabel:"Streaming sink",destinationTooltip:"Analytical store or service consuming the stream.",topicFormat:t=>`mongo.${t}`,methodCopyOverrides:{polling:{label:"Polling (find queries)",laneDescription:"Scheduled queries diff collections by last-updated timestamps.",callout:"No delete visibility and heavy load for high-churn collections.",whenToUse:"Only for prototypes without Change Stream or oplog access.",tooltip:"find() queries scanning for updated documents on an interval."},trigger:{label:"Hooks (side-write)",laneDescription:"Application-layer hooks write audit documents alongside originals.",callout:"Requires app changes and doubles write throughput.",whenToUse:"When database triggers/log access is unavailable and app control exists.",tooltip:"Custom middleware duplicating writes into audit collections."},log:{label:"Change Stream tail",laneDescription:"Native Change Stream cursor fans out oplog events in order.",callout:"Recommended: low-latency stream with resume tokens and schema support.",whenToUse:"Default for MongoDB replicas when you can open a Change Stream cursor.",tooltip:"MongoDB Change Stream subscription on the oplog."}}}},St="cdc_playground_template_filter_v1",Et="cdc_playground_template_filter_tags_v1",kt={query:"",tags:[]},fa=t=>typeof t=="string"?t:"",on=t=>{if(!Array.isArray(t))return[];const e=new Set,a=[];return t.forEach(r=>{if(r==null)return;const u=String(r).trim();!u||e.has(u)||(e.add(u),a.push(u))}),a},Xt=t=>{if(!t||typeof t!="object")return{...kt};const e=fa(typeof t.query=="string"?t.query:""),a=t.tags;if(Array.isArray(a))return{query:e,tags:on(a)};if(typeof a=="string"){const r=a.trim();return{query:e,tags:r?[r]:[]}}return{query:e,tags:[]}},ba=(t,e)=>{if(t===e)return!0;if(t.length!==e.length)return!1;for(let a=0;a<t.length;a+=1)if(t[a]!==e[a])return!1;return!0},xa=t=>typeof t!="string"?"":t,ya=t=>{if(typeof t!="string"||t.trim().length===0)return[];try{const e=JSON.parse(t);if(Array.isArray(e))return on(e)}catch{}return[]},_a=t=>{if(!t)return{...kt};try{const e=xa(t.getItem(St)),a=ya(t.getItem(Et));return{query:e,tags:a}}catch{return{...kt}}},va=(t,e)=>{if(!e)return;const a=Xt(t);try{a.query?e.setItem(St,a.query):typeof e.removeItem=="function"?e.removeItem(St):e.setItem(St,"")}catch{}try{a.tags.length>0?e.setItem(Et,JSON.stringify(a.tags)):typeof e.removeItem=="function"?e.removeItem(Et):e.setItem(Et,"")}catch{}},wa=t=>typeof t=="string"?t.trim().toLowerCase():"",Gs=t=>Array.isArray(t)?t.map(e=>typeof e=="string"?e.trim():"").filter(e=>e.length>0):[],Sa=t=>{const e=[];return t.label&&e.push(t.label),t.description&&e.push(t.description),t.highlight&&e.push(t.highlight),t.name&&e.push(t.name),Array.isArray(t.tags)&&t.tags.length>0&&e.push(t.tags.join(" ")),e.join(" ").toLowerCase()};function Ea(t,e={}){const a=Array.from(t),{liveScenario:r,liveScenarioName:u,tags:m,query:f}=e;if(r){const I=a.findIndex(k=>k.name===r.name);I>=0?a.splice(I,1,r):a.unshift(r)}const v=Gs(m),M=wa(f);return a.filter(I=>{if(u&&I.name===u)return!0;if(v.length>0){const x=Gs(I.tags??[]);if(!v.every(A=>x.includes(A)))return!1}if(!M)return!0;const k=Sa(I);return k?k.includes(M):!1})}const zt=(t,e)=>{Array.isArray(e)&&e.forEach(a=>{if(typeof a!="string")return;const r=a.trim();r.length>0&&t.add(r)})};function Ca(t,e={}){const a=new Set;return t.forEach(r=>zt(a,r.tags)),e.liveScenario&&zt(a,e.liveScenario.tags),e.additionalTags?.forEach(r=>zt(a,r)),Array.from(a).sort((r,u)=>r.localeCompare(u))}const Zt=t=>{if(Array.isArray(t))return t.map(e=>Zt(e));if(t&&typeof t=="object"){const e={};return Object.entries(t).forEach(([a,r])=>{e[a]=Zt(r)}),e}return t},Ct=t=>Zt(t),ln=t=>({...t}),Vs=t=>({name:t.name,version:t.version,columns:t.columns.map(ln)}),ja=(t,e)=>typeof e=="boolean"?"bool":typeof e=="number"?/_ts$|timestamp$/i.test(t)?"timestamp":"number":e instanceof Date?"timestamp":"string",ka=(t,e=1)=>({name:t,version:e,columns:[{name:"id",type:"string",nullable:!1}]}),qs=t=>{t.columns.some(a=>a.name==="id")||t.columns.unshift({name:"id",type:"string",nullable:!1})},Ws=t=>{const e=Ct(t);return e.id=String(e.id),e};class Qt{constructor(e=[]){this.tables=new Map,e.forEach(a=>this.upsertTable(a))}upsertTable(e){const a=Vs(e.schema);qs(a);const r=new Map;e.rows.forEach(u=>{const m=Ws(Ct(u));r.set(m.id,m)}),this.tables.set(e.name,{schema:a,rows:r})}replaceAll(e){this.tables.clear(),e.forEach(a=>this.upsertTable(a))}getTable(e){const a=this.tables.get(e);if(a)return{name:e,schema:Vs(a.schema),rows:Array.from(a.rows.values()).map(r=>Ct(r))}}listTables(){return Array.from(this.tables.keys()).map(e=>this.getTable(e)).filter(e=>!!e)}clear(){this.tables.clear()}applyEvents(e){e.forEach(a=>this.applyEvent(a))}applyEvent(e){if(!e?.table)return;if(e.kind==="SCHEMA_ADD_COL"||e.kind==="SCHEMA_DROP_COL"){this.applySchemaChange(e);return}const a=this.ensureTableState(e.table,e.schemaVersion);if(e.schemaVersion&&e.schemaVersion>a.schema.version&&(a.schema.version=e.schemaVersion),e.kind==="DELETE"){const M=e.before?.id??e.after?.id;M!=null&&a.rows.delete(String(M));return}const r=e.after??void 0;if(!r)return;const u=Ws(r),m=a.rows.get(u.id),f=m?{...m,...u}:u,v=Ct(f);this.syncSchemaColumns(a,v),a.rows.set(v.id,v)}snapshot(){return this.listTables()}ensureTableState(e,a){let r=this.tables.get(e);return r||(r={schema:ka(e,a??1),rows:new Map},this.tables.set(e,r)),a&&a>r.schema.version&&(r.schema.version=a),qs(r.schema),r}applySchemaChange(e){const a=e.schemaChange;if(!a)return;const r=this.ensureTableState(e.table,a.nextVersion??e.schemaVersion);r.schema.version=Math.max(r.schema.version,a.nextVersion??e.schemaVersion??r.schema.version),e.kind==="SCHEMA_ADD_COL"?this.addColumn(r,a.column):e.kind==="SCHEMA_DROP_COL"&&this.dropColumn(r,a.column.name)}addColumn(e,a){const r=e.schema.columns.find(u=>u.name===a.name);r?(r.type=a.type,a.nullable&&(r.nullable=!0)):e.schema.columns.push(ln(a)),e.rows.forEach(u=>{a.name in u||(u[a.name]=null)})}dropColumn(e,a){a!=="id"&&(e.schema.columns=e.schema.columns.filter(r=>r.name!==a),e.rows.forEach(r=>{a in r&&delete r[a]}))}syncSchemaColumns(e,a){const r=e.schema.columns;Object.entries(a).forEach(([u,m])=>{if(u==="id"||u.startsWith("__"))return;let f=r.find(v=>v.name===u);f||(f={name:u,type:ja(u,m)},r.push(f)),m==null&&(f.nullable=!0)})}}const La=2e3,xt={methods:[],ops:[],tables:[],txns:[]},Hs={empty:"No events yet.",noMatch:"No events match the current filters."},zs=t=>{if(!t)return"";try{const e=JSON.stringify(t);return e?e.length>160?`${e.slice(0,160)}…`:e:""}catch{return""}},Ma=t=>{if(!t)return"—";const e=t.trim();return e?(e.length===1,e.toUpperCase()):"—"},Ta=({events:t,stats:e,totalCount:a,filters:r={},filterOptions:u,onFiltersChange:m,onDownload:f,onClear:v,onCopyEvent:M,onReplayEvent:I,maxVisibleEvents:k=La,emptyMessage:x,noMatchMessage:g,className:A})=>{const l={methods:u?.methods??xt.methods,ops:u?.ops??xt.ops,tables:u?.tables??xt.tables,txns:u?.txns??xt.txns},h=d.useMemo(()=>typeof k!="number"||k<=0?t.length:Math.min(k,t.length),[t.length,k]),[o,y]=d.useState(h);d.useEffect(()=>{y(E=>E<h?h:E>t.length?t.length:E)},[h,t.length]);const L=d.useMemo(()=>{const E=Math.max(o,0),q=Math.max(t.length-E,0);return t.slice(q)},[t,o]),j=L.length<t.length,D=o>h,V=()=>{if(!j)return;const E=h>0?h:t.length;y(q=>Math.min(q+E,t.length))},K=()=>{y(h)},ke=typeof a=="number"?a:t.length,Le=!!r.methodId||!!r.op||!!r.table||!!r.txnId,We={empty:x??Hs.empty,noMatch:g??Hs.noMatch},z=E=>{if(!m)return;const q={methodId:E.methodId===void 0?r.methodId:E.methodId,op:E.op===void 0?r.op:E.op,table:E.table===void 0?r.table:E.table,txnId:E.txnId===void 0?r.txnId:E.txnId},W={methodId:q.methodId||void 0,op:q.op||void 0,table:q.table||void 0,txnId:q.txnId||void 0};m(W)},He=E=>{const q=zs(E.before),W=zs(E.after);return!q&&!W?null:n.jsxs("details",{className:"cdc-event-log__details",children:[n.jsx("summary",{children:"Row image"}),q&&n.jsxs("div",{className:"cdc-event-log__details-row",children:[n.jsx("span",{children:"before"}),n.jsx("code",{children:q})]}),W&&n.jsxs("div",{className:"cdc-event-log__details-row",children:[n.jsx("span",{children:"after"}),n.jsx("code",{children:W})]})]})};return n.jsxs("section",{className:`cdc-event-log${A?` ${A}`:""}`,"aria-label":"Event log",role:"region",children:[n.jsxs("header",{className:"cdc-event-log__header",children:[n.jsxs("div",{className:"cdc-event-log__headline",children:[n.jsx("h3",{children:"Event Log"}),e&&n.jsxs("p",{className:"cdc-event-log__stats",children:[n.jsxs("span",{children:["Produced ",e.produced]})," · ",n.jsxs("span",{children:["Consumed ",e.consumed]})," · ",n.jsxs("span",{children:["Backlog ",e.backlog]}),typeof e.snapshotRows=="number"&&n.jsxs(n.Fragment,{children:[" · ",n.jsxs("span",{children:["Snapshot rows ",e.snapshotRows]})]})]})]}),n.jsxs("div",{className:"cdc-event-log__actions",children:[n.jsxs("span",{children:[t.length," events"]}),n.jsx("button",{type:"button",onClick:f,disabled:!f||t.length===0,children:"Download NDJSON"}),n.jsx("button",{type:"button",onClick:v,disabled:!v||ke===0,children:"Clear"})]})]}),n.jsxs("div",{className:"cdc-event-log__filters",role:"group","aria-label":"Event log filters",children:[n.jsxs("label",{children:[n.jsx("span",{children:"Method"}),n.jsxs("select",{value:r.methodId??"",onChange:E=>z({methodId:E.target.value||void 0}),disabled:!m||l.methods.length===0,children:[n.jsx("option",{value:"",children:"All methods"}),l.methods.map(E=>n.jsx("option",{value:E.id,children:E.label},E.id))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Operation"}),n.jsxs("select",{value:r.op??"",onChange:E=>z({op:E.target.value||void 0}),disabled:!m||l.ops.length===0,children:[n.jsx("option",{value:"",children:"All ops"}),l.ops.map(E=>n.jsx("option",{value:E,children:E.toUpperCase()},E))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Table"}),n.jsxs("select",{value:r.table??"",onChange:E=>z({table:E.target.value||void 0}),disabled:!m||l.tables.length===0,children:[n.jsx("option",{value:"",children:"All tables"}),l.tables.map(E=>n.jsx("option",{value:E,children:E},E))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Txn"}),n.jsxs("select",{value:r.txnId??"",onChange:E=>z({txnId:E.target.value||void 0}),disabled:!m||l.txns.length===0,children:[n.jsx("option",{value:"",children:"All txns"}),l.txns.map(E=>n.jsx("option",{value:E,children:E},E))]})]})]}),t.length===0?n.jsx("p",{className:"cdc-event-log__empty",children:ke>0||Le?We.noMatch:We.empty}):n.jsxs("ul",{className:"cdc-event-log__list",children:[t.length>L.length&&n.jsxs("li",{className:"cdc-event-log__notice",children:[n.jsxs("span",{children:["Showing latest ",L.length," of ",t.length," events."]}),n.jsxs("div",{className:"cdc-event-log__notice-actions",children:[n.jsx("button",{type:"button",onClick:V,disabled:!j,children:"Load more"}),D&&n.jsx("button",{type:"button",onClick:K,children:"Show latest"})]})]}),L.map(E=>{const q=Ma(E.op),W=typeof E.offset=="number"?E.offset:E.offset==null?"—":E.offset,Lt=E.topic??"—",Q=E.table??"—",st=E.pk??"—",be=E.txnId??"",Me=typeof E.tsMs=="number"?E.tsMs:"—",Y=typeof E.op=="string"?E.op.trim().toLowerCase():"",Mt=Y==="c"||Y==="u"||Y==="d";return n.jsxs("li",{className:"cdc-event-log__item",children:[n.jsx("span",{className:"cdc-event-log__method",children:E.methodLabel??E.methodId??"—"}),n.jsx("span",{className:"cdc-event-log__op","data-op":q,children:q}),n.jsxs("span",{className:"cdc-event-log__offset",children:["offset ",W]}),n.jsx("span",{className:"cdc-event-log__topic",children:Lt}),n.jsxs("span",{className:"cdc-event-log__table",children:["table ",Q]}),n.jsxs("span",{className:"cdc-event-log__meta",children:["ts=",Me,"ms · pk=",st,be?` · txn=${be}`:""]}),E.meta?n.jsx("span",{className:"cdc-event-log__extra",children:E.meta}):null,I?n.jsx("button",{type:"button",className:"cdc-event-log__replay",onClick:()=>I?.(E),disabled:!Mt,children:"Replay"}):null,n.jsx("button",{type:"button",className:"cdc-event-log__copy",onClick:()=>M?.(E),disabled:!M,children:"Copy"}),He(E)]},E.id)})]})]})};function Aa(t){const e=t.op?.toUpperCase?.()??"?",a=t.pk??"∅",r=t.expectedIndex!=null?`#${t.expectedIndex}`:void 0,u=t.actualIndex!=null?`#${t.actualIndex}`:void 0;return t.type==="missing"?`Missing ${e} for pk=${a} (${r??"expected"} @ ${t.expectedTime??"?"}ms)`:t.type==="extra"?`Unexpected ${e} for pk=${a} (${u??"emitted"} @ ${t.actualTime??"?"}ms)`:`Out-of-order ${e} pk=${a} (expected ${r??"?"} before actual ${u??"?"})`}const Ia=({diff:t,scenarioName:e,laneId:a,schemaStatus:r,onDiffDetailsOpened:u})=>{if(!t)return null;const{totals:m,issues:f,lag:v}=t,M=m.missing>0||m.extra>0||m.ordering>0,I=f.slice(0,6);let k=null;return r&&(r.hasColumn?r.version<r.expectedVersion&&(k=`Schema behind: v${r.version} (expected v${r.expectedVersion})`):k=`${r.columnName} column missing in destination`),!M&&v.max<=0&&!k?null:n.jsxs("div",{className:"sim-shell__lane-diff","data-has-issues":M?"true":"false",role:"note",children:[n.jsxs("div",{className:"sim-shell__lane-diff-summary",children:[M?n.jsxs(n.Fragment,{children:[m.missing>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--missing",children:[m.missing," missing"]}),m.extra>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--extra",children:[m.extra," extra"]}),m.ordering>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--ordering",children:[m.ordering," ordering"]})]}):n.jsx("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--ok",children:"Operations aligned"}),v.max>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--lag",children:["Max lag ",Math.round(v.max),"ms"]})]}),k&&n.jsx("p",{className:"sim-shell__lane-diff-schema",children:k}),(I.length>0||v.samples.length>0)&&n.jsxs("details",{id:a?`lane-diff-${a}`:void 0,className:"sim-shell__lane-diff-details",onToggle:x=>{x.target.open&&u?.({method:t.method,issueCount:t.issues.length,maxLag:t.lag.max,scenario:e})},children:[n.jsx("summary",{children:"Diff details"}),I.length>0&&n.jsx("ul",{className:"sim-shell__lane-diff-list",children:I.map((x,g)=>n.jsx("li",{children:Aa(x)},`${x.type}-${x.op}-${x.pk??"∅"}-${g}`))}),f.length>I.length&&n.jsxs("p",{className:"sim-shell__lane-diff-more",children:["+",f.length-I.length," additional difference(s)"]}),v.samples.length>0&&n.jsxs("div",{className:"sim-shell__lane-diff-lag",children:[n.jsx("h4",{children:"Lag hotspots"}),n.jsx("ul",{children:v.samples.map(x=>n.jsxs("li",{children:[Math.round(x.lagMs),"ms on ",x.op.toUpperCase()," pk=",x.pk??"∅"]},`${x.op}-${x.pk??"∅"}-${x.actualTime??"?"}`))})]})]})]})},Ge=rn,Z=t=>Number.isFinite(t)?t.toLocaleString():"—",Qs=t=>Number.isFinite(t)?`${Math.round(t)}ms`:"—",Oa=({lanes:t,renderSchemaWalkthrough:e})=>{const a=t.reduce((r,u)=>(r.produced+=u.produced,r.consumed+=u.consumed,r.backlog+=u.backlog,r),{produced:0,consumed:0,backlog:0});return n.jsxs("section",{className:"sim-shell__metrics-dashboard","aria-label":"Runtime metrics",children:[n.jsx("header",{className:"sim-shell__metrics-dashboard-header",children:n.jsxs("div",{children:[n.jsx("h3",{children:"Runtime metrics"}),n.jsxs("p",{children:["Produced ",Z(a.produced)," · Consumed ",Z(a.consumed)," · Backlog ",Z(a.backlog)]})]})}),n.jsx("div",{className:"sim-shell__metrics-dashboard-grid",children:t.map(r=>n.jsxs("article",{className:"sim-shell__metrics-dashboard-card",children:[n.jsx("header",{children:n.jsx("h4",{"data-tooltip":r.tooltip||void 0,children:r.label})}),e&&n.jsx("div",{className:"sim-shell__schema-demo-inline",children:e(r.id)}),n.jsxs("dl",{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Produced"}),n.jsx("dd",{children:Z(r.produced)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Consumed"}),n.jsx("dd",{children:Z(r.consumed)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Backlog"}),n.jsx("dd",{"data-tooltip":Ge.backlog,children:Z(r.backlog)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Lag p50"}),n.jsx("dd",{"data-tooltip":Ge.lagPercentile,children:Qs(r.lagP50)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Lag p95"}),n.jsx("dd",{"data-tooltip":Ge.lagPercentile,children:Qs(r.lagP95)})]}),typeof r.snapshotRows=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Snapshot rows"}),n.jsx("dd",{"data-tooltip":Ge.snapshot,children:Z(r.snapshotRows)})]}),(typeof r.inserts=="number"||typeof r.updates=="number"||typeof r.deletes=="number")&&n.jsxs("div",{children:[n.jsx("dt",{children:"Change mix"}),n.jsxs("dd",{children:["C ",Z(r.inserts??0)," · U ",Z(r.updates??0)," · D ",Z(r.deletes??0),typeof r.schemaChanges=="number"&&r.schemaChanges>0?` · Schema ${Z(r.schemaChanges)}`:""]})]}),typeof r.missedDeletes=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Missed deletes"}),n.jsx("dd",{"data-tooltip":Ge.deleteCapture,children:Z(r.missedDeletes)})]}),typeof r.writeAmplification=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Write amplification"}),n.jsxs("dd",{"data-tooltip":Ge.triggerWriteAmplification,children:[r.writeAmplification.toFixed(1),"x"]})]})]})]},r.id))})]})},Na=({lagMs:t,throughput:e,deletesPct:a,orderingOk:r,consistent:u,writeAmplification:m,insertCount:f,updateCount:v,deleteCount:M,schemaChangeCount:I})=>n.jsxs("div",{role:"status","aria-live":"polite",children:[n.jsxs("span",{children:["Lag: ",t,"ms"]})," ·",n.jsxs("span",{children:["TPS: ",e.toFixed(1)]})," ·",n.jsxs("span",{children:["Deletes: ",Math.round(a),"%"]})," ·",n.jsxs("span",{children:["Ordering: ",r?"OK":"KO"]})," ·",n.jsxs("span",{children:["Consistency: ",u?"OK":"Drift"]})," ","·",n.jsxs("span",{children:["Ops C/U/D: ",f,"/",v,"/",M]}),I>0&&n.jsxs(n.Fragment,{children:[" ","·",n.jsxs("span",{children:["Schema: ",I]})]}),typeof m=="number"&&n.jsxs(n.Fragment,{children:[" ","·",n.jsxs("span",{children:["Trigger WA: ",m.toFixed(1),"x"]})]})]}),Da=({onAdd:t,onDrop:e,columnName:a,disabled:r,disableAdd:u,disableDrop:m,status:f})=>n.jsxs("section",{className:"sim-shell__schema-demo","aria-label":"Schema walkthrough",children:[n.jsxs("header",{children:[n.jsx("h4",{children:"Schema walkthrough"}),n.jsxs("p",{children:["Add or drop ",n.jsx("code",{children:a})," while events stream to compare capture behaviour."]})]}),f?n.jsx("p",{className:"sim-shell__schema-demo-status",children:f}):null,n.jsxs("div",{className:"sim-shell__schema-demo-buttons",children:[n.jsxs("button",{type:"button",onClick:t,disabled:r||u,"data-tour-target":"schema-add",children:["Add ",a]}),n.jsxs("button",{type:"button",onClick:e,disabled:r||m,"data-tour-target":"schema-drop",children:["Drop ",a]})]})]});class Ra{constructor(){this.scenario=null,this.engines=[],this.idx=0,this.now=0,this.playing=!1}attach(e){this.engines=e}load(e){this.scenario=e,this.idx=0,this.now=0,this.playing=!1}reset(e){this.engines.forEach(a=>a.reset(e)),this.idx=0,this.now=0}onTick(e){this.onTickCb=e}start(){this.playing=!0}pause(){this.playing=!1}tick(e){if(!this.playing||!this.scenario)return;this.now+=e;const{ops:a}=this.scenario;for(;this.idx<a.length&&a[this.idx].t<=this.now;){const r=a[this.idx++];this.engines.forEach(u=>u.applySourceOp(r))}this.engines.forEach(r=>r.tick(this.now)),this.onTickCb?.(this.now)}}const $a=new Set(["c","u","d"]);function Pa(t){switch(t.op){case"insert":return"c";case"update":return"u";case"delete":return"d";default:return null}}function Fa(t){return t.map((e,a)=>{const r=Pa(e);if(!r)return null;const u=e.pk?.id!=null?String(e.pk.id):"";return{key:`${r}::${u}`,op:r,pk:u,index:a,time:e.t}}).filter(e=>!!e)}function Ua(t){return t.map((e,a)=>{if(!$a.has(e.op))return null;const r=e.pk?.id!=null?String(e.pk.id):"",u=e.op;return{key:`${u}::${r}`,op:u,pk:r,index:a,time:e.ts_ms}}).filter(e=>!!e)}function Ks(t){const e=new Map;for(const a of t){const r=e.get(a.key);r?r.push(a):e.set(a.key,[a])}return e}function Ba(t,e){const a=[],r=[],u=[],m=Ks(t),f=Ks(e),v=new Set([...m.keys(),...f.keys()]);for(const M of v){const I=m.get(M)??[],k=f.get(M)??[],x=Math.min(I.length,k.length);for(let g=0;g<x;g++){const A=I[g],l=k[g];a.push({expected:A,actual:l,lagMs:Math.max(0,l.time-A.time)})}for(let g=x;g<I.length;g++)r.push(I[g]);for(let g=x;g<k.length;g++)u.push(k[g])}return{matched:a,missing:r,extra:u}}function Ga(t){const e=[],a=[...t].sort((u,m)=>u.actual.index-m.actual.index);let r=-1/0;for(const u of a)u.expected.index<r?e.push({type:"ordering",op:u.expected.op,pk:u.expected.pk,expectedIndex:u.expected.index,actualIndex:u.actual.index,expectedTime:u.expected.time,actualTime:u.actual.time}):r=u.expected.index;return e}function Va(t){return t.filter(e=>e.lagMs>0).sort((e,a)=>a.lagMs-e.lagMs).slice(0,5).map(e=>({op:e.expected.op,pk:e.expected.pk,expectedTime:e.expected.time,actualTime:e.actual.time,lagMs:e.lagMs}))}function qa(t,e,a){const r=Fa(e),u=Ua(a),{matched:m,missing:f,extra:v}=Ba(r,u),M=[];for(const x of f)M.push({type:"missing",op:x.op,pk:x.pk,expectedIndex:x.index,expectedTime:x.time});for(const x of v)M.push({type:"extra",op:x.op,pk:x.pk,actualIndex:x.index,actualTime:x.time});M.push(...Ga(m));const I=Va(m),k=I.reduce((x,g)=>Math.max(x,g.lagMs),0);return{method:t,totals:{missing:M.filter(x=>x.type==="missing").length,extra:M.filter(x=>x.type==="extra").length,ordering:M.filter(x=>x.type==="ordering").length},issues:M,lag:{max:k,samples:I}}}const Wa=`# Harness Nightly History

Run \`GITHUB_TOKEN=... npm run harness:history\` to refresh this summary. The script aggregates the latest Harness Nightly artifacts and records table-level parity results here so the app can surface them inline.

| Run | Date | Conclusion | Events | Missing | Extra | Max Lag (ms) | Tables | Mismatches |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| _No runs captured yet._ |   |   |   |   |   |   |   |   |

`;function G(t,e={},a={}){if(typeof window>"u")return;const r=window.telemetry;!r||typeof r.track!="function"||r.track(t,e,a)}function tt(t,e={}){G("comparator.clock.control",{action:t,...e})}function Ha({onDiffDetailsOpened:t,...e}){const a=r=>{t?.(r),G("comparator.diff.opened",{method:r.method,issues:r.issueCount,maxLag:r.maxLag,scenario:r.scenario})};return n.jsx(Ia,{...e,onDiffDetailsOpened:a})}function za(t){const e={...t};return t.pk&&(e.pk={...t.pk}),t.after&&(e.after={...t.after}),t.txn&&(e.txn={...t.txn}),e}function Qa(t){return{id:t.id,name:t.id||t.name,label:t.label,description:t.description,highlight:t.highlight,stats:{rows:t.rows.length,ops:t.ops.length},table:t.table,tags:[...t.tags],schema:t.schema.length?t.schema.map(e=>({...e})):void 0,rows:t.rows.length?t.rows.map(e=>({...e})):void 0,events:t.events.length?t.events.map(e=>({...e})):void 0,schemaVersion:t.schemaVersion,seed:t.seed,ops:t.ops.map(za)}}const cn=na;cn.length===0&&typeof console<"u"&&console.warn("No scenario templates were loaded from assets/shared-scenarios.js; the comparator scenario gallery will be empty.");const yt=cn.map(Qa),dn={polling:{label:"Polling (Query)",laneDescription:"Simple, but lossy. Periodic scans read current state only; hard deletes and mid-poll updates can disappear.",callout:"Polling reads current state only. Hard deletes and intermediate updates are not captured.",whenToUse:"Simple, but lossy. Periodic scans read current state only. Hard deletes and intermediate updates between polls are not observable. Good for small, non-critical syncs where some lag and loss is acceptable."},trigger:{label:"Trigger (Audit)",laneDescription:"Complete, but intrusive. Database triggers write to an audit table and add synchronous source overhead.",callout:"Triggers add write overhead to source transactions.",whenToUse:"Complete, but intrusive. Triggers capture every change into an audit table, but add write latency and operational overhead on the source. Use when log access isn’t available."},log:{label:"Log (WAL)",laneDescription:"Default choice. Streams the transaction log post-commit for ordered, low-latency change events.",callout:"Log-based CDC is the preferred default when available.",whenToUse:"Default choice. Reads the database’s transaction log post-commit. Lowest source impact, complete and ordered changes, near-real-time. Requires connector setup and ops discipline."}};typeof window<"u"&&(window.CDC_METHOD_COPY=dn);const Ve="workspace-live",un="cdc_comparator_prefs_v1",Ce={name:"priority_flag",type:"bool"};function Ka(t,e,a,r){if(a.length===0)return 0;const u=t[e]?.metrics.writeAmplification;if(typeof u=="number"&&u>=0)return u;const m=r.ops.filter(f=>f.table===a[0]?.table);return m.length?a.length/m.length:a.length}const pe=["polling","trigger","log"],hn=2,_e=100,pn=10,mn=300,es=120,Ja=10,gn=10,fn=600,bn=120,ts=10,Kt=40,Ya=5,je=["c","u","d","s"],Js="MYSQL_DEBEZIUM",Xa="workspace",Za=t=>({...t}),er=t=>t.type?String(t.type).toLowerCase():"string",tr=t=>{const e=t.find(a=>a.pk);return e&&e.name?e.name:"id"},Ys=(t,e,a)=>Array.isArray(a)&&a.length>0?a.reduce((r,u)=>(u===e||Object.prototype.hasOwnProperty.call(t,u)&&(r[u]=t[u]),r),{}):Object.entries(t).reduce((r,[u,m])=>(u===e||(r[u]=m),r),{}),Xs=(t,e,a,r)=>{const u=er(t);if(u==="number"){const f=e.seq*10+a;return typeof r=="number"?r+1:f}if(u==="bool"||u==="boolean")return typeof r=="boolean"?!r:a%2===0;if(u==="timestamp")return e.logicalTime+a+1;const m=`${e.seq}_${a}_${e.opCounter}`;return typeof r=="string"?`${t.name}_${m}`:`${t.name}_${m}`},sr=t=>{const e=Array.isArray(t.schema)&&t.schema.length>0?t.schema.map(f=>({...f})):[{name:"id",type:"string",pk:!0}],a=tr(e),r=new Map;(Array.isArray(t.rows)?t.rows:[]).forEach(f=>{if(!f||typeof f!="object")return;const v=f,M=v[a]??v.id;if(M==null)return;const I=String(M),k={};Object.entries(v).forEach(([x,g])=>{if(x===a){k[x]=String(g);return}x==="id"&&a!=="id"||(k[x]=g)}),Object.prototype.hasOwnProperty.call(k,a)||(k[a]=I),r.set(I,k)});const m=Array.isArray(t.ops)?t.ops.reduce((f,v)=>Math.max(f,v.t??0),0):0;return{table:t.table??Xa,columns:e,pkField:a,rows:r,logicalTime:m,seq:r.size+1,opCounter:0}},nr=(t,e,a)=>{const r=Math.max(1,Math.floor(e)||1),u=Array.from(t.rows.keys()),m=t.columns.filter(k=>k.name!==t.pkField);let f="insert";if(u.length>0&&m.length>0){const k=t.opCounter%6;(k===0||k===4)&&u.length>1?f="delete":k===1||k===2||k===3?f="update":f="insert"}else u.length>1&&m.length===0&&(f=t.opCounter%3===0?"delete":"insert");const v=t.opCounter;t.opCounter+=1;const M=Math.max(t.logicalTime,a);t.logicalTime=M+r;const I=t.logicalTime;if(f==="insert"){const k=`gen-${t.seq++}`,x={[t.pkField]:k};m.forEach((l,h)=>{x[l.name]=Xs(l,t,h)}),t.rows.set(k,x);const g=Ys(x,t.pkField);return{op:{t:I,op:"insert",table:t.table,pk:{id:k},after:g},kind:f}}if(f==="update"&&u.length>0&&m.length>0){const k=v%u.length,x=u[k],g=t.rows.get(x);if(!g)return null;const A=m[v%m.length],l=Xs(A,t,v,g[A.name]),h=Za(g);h[A.name]=l,t.rows.set(x,h);const o=Ys(h,t.pkField,[A.name]);return{op:{t:I,op:"update",table:t.table,pk:{id:x},after:o},kind:f}}if(f==="delete"&&u.length>0){const k=v%u.length,x=u[k];return t.rows.delete(x),{op:{t:I,op:"delete",table:t.table,pk:{id:x}},kind:f}}return null};function jt(t){return typeof t=="string"&&Object.prototype.hasOwnProperty.call(wt,t)}const ar=dn,H=rn,Jt=200,rr=2e3,ir=6;function or(){if(typeof window>"u")return new Set;const e=window.cdcFeatureFlags?.all?.();if(Array.isArray(e)&&e.length)return new Set(e.map(String));const a=window.APPWRITE_CFG?.featureFlags;return Array.isArray(a)&&a.length?new Set(a.map(String)):new Set}const lr={polling:{pollIntervalMs:500,includeSoftDeletes:!1},trigger:{extractIntervalMs:250,triggerOverheadMs:8},log:{fetchIntervalMs:50}},cr={polling:"QUERY_BASED",trigger:"TRIGGER_BASED",log:"LOG_BASED"},dr={polling:"polling",trigger:"trigger",log:"log"},Zs=t=>{switch(t){case"polling":return ha();case"trigger":return ga();case"log":default:return da()}},en=t=>{if(!t)return null;const e={...t};return delete e.__ts,e},ur=t=>{if(t==null)return"—";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="number")return Number.isFinite(t)?t.toString():"—";if(t instanceof Date)return t.toISOString();if(typeof t=="object")try{return JSON.stringify(t)}catch{return"[object]"}return String(t)},xn=(t,e,a)=>{const r=e.kind==="INSERT"?"c":e.kind==="UPDATE"?"u":e.kind==="DELETE"?"d":"s",u=e.schemaChange?{action:e.schemaChange.action,column:{name:e.schemaChange.column.name,type:e.schemaChange.column.type,nullable:e.schemaChange.column.nullable},previousVersion:e.schemaChange.previousVersion,nextVersion:e.schemaChange.nextVersion}:null,m=e.after?.id??e.before?.id??u?.column?.name??null,f=m!=null?String(m):"";return{source:"demo-db",table:e.table,op:r,pk:{id:f},before:en(e.before),after:en(e.after),ts_ms:e.commitTs,tx:{id:e.txnId??`tx-${e.commitTs}`,lsn:typeof e.offset=="number"?e.offset:null,index:typeof e.txnIndex=="number"?e.txnIndex:void 0,total:typeof e.txnTotal=="number"?e.txnTotal:void 0,last:typeof e.txnLast=="boolean"?e.txnLast:typeof e.txnTotal=="number"&&typeof e.txnIndex=="number"?e.txnIndex>=e.txnTotal-1:!0},seq:a,meta:{method:dr[t]},schemaChange:u}};function hr(t,e){const a=new ra,r=new ia,u=new oa,m=`cdc.${t}`;let f=Zs(t),v,M={bus:a,metrics:r,scheduler:u,topic:m},I={},k=0;const x=new Set,g=o=>{const y=o.__seq,L=typeof y=="number"&&y>0?y:++k;return o.__seq=L,{...xn(t,o,L),offset:o.offset,topic:o.topic??m}},A=o=>y=>{const L=o(y);if(L.length){const j=L.map(D=>g(D));e(j),j.forEach(D=>x.forEach(V=>V(D)))}return L},l=()=>{f.initialise?.(M),f.configure?.(I),v=new la(cr[t],a,u,r,m,{startSnapshot:(o,y)=>f.startSnapshot?.(o,L=>A(y)(L)),startTailing:o=>f.startTailing?.(y=>A(o)(y)),stop:()=>f.stop?.()}),v.startSnapshot([]),v.startTailing()};return l(),{name:t,configure(o){I={...o},f.configure?.(o)},reset(o){v.stop(),u.clear(),r.reset(),a.reset(m),k=0,f=Zs(t),M={bus:a,metrics:r,scheduler:u,topic:m},l()},applySourceOp(o){f.applySource?.(o)},applySchemaChange(o,y,L,j){const D=y==="add"?"ADD_COLUMN":"DROP_COLUMN";f.applySchemaChange?.(o,D,L,j)},tick(o){f.tick?.(o)},onEvent(o){return x.add(o),()=>x.delete(o)},bus:a,metrics:r,topic:m}}function pr(t,e){return hr(t,e)}function qe(t){return t.reduce((e,a)=>(e[a]=[],e),{})}function mr(t){return{polling:{...t.polling},trigger:{...t.trigger},log:{...t.log}}}function _t(t,e,a){let r=typeof t=="number"?t:Number(t);return Number.isFinite(r)?(typeof a=="number"&&(r=Math.max(a,r)),r):e}function vt(t,e=es){if(typeof t!="number"||!Number.isFinite(t))return e;const a=Math.round(t);return Number.isFinite(a)?Math.min(mn,Math.max(pn,a)):e}function Yt(t,e=bn){if(typeof t!="number"||!Number.isFinite(t))return e;const a=Math.round(t/ts)*ts;return Number.isFinite(a)?Math.min(fn,Math.max(gn,a)):e}function tn(t){if(!Array.isArray(t))return[...pe];const e=[];return pe.forEach(a=>{t.includes(a)&&!e.includes(a)&&e.push(a)}),e.length>=hn?e:[...pe]}function gr(t){const e=Array.from(je);if(!Array.isArray(t)||t.length===0)return new Set(e);const a=[];return t.forEach(r=>{if(je.includes(r)){const u=r;a.includes(u)||a.push(u)}}),a.length?new Set(a):new Set(e)}function sn(t){return typeof t=="string"&&pe.includes(t)}function nn(t){const e=mr(lr);return t&&(t.polling&&(t.polling.pollIntervalMs!=null&&(e.polling.pollIntervalMs=_t(t.polling.pollIntervalMs,e.polling.pollIntervalMs,50)),t.polling.includeSoftDeletes!=null&&(e.polling.includeSoftDeletes=!!t.polling.includeSoftDeletes)),t.trigger&&(t.trigger.extractIntervalMs!=null&&(e.trigger.extractIntervalMs=_t(t.trigger.extractIntervalMs,e.trigger.extractIntervalMs,50)),t.trigger.triggerOverheadMs!=null&&(e.trigger.triggerOverheadMs=_t(t.trigger.triggerOverheadMs,e.trigger.triggerOverheadMs,0))),t.log&&t.log.fetchIntervalMs!=null&&(e.log.fetchIntervalMs=_t(t.log.fetchIntervalMs,e.log.fetchIntervalMs,10))),e}function fr(){if(typeof window>"u")return null;try{const t=window.localStorage.getItem(un);if(!t)return null;const e=JSON.parse(t);return{scenarioId:typeof e.scenarioId=="string"?e.scenarioId:void 0,presetId:jt(e.presetId)?e.presetId:void 0,activeMethods:Array.isArray(e.activeMethods)?e.activeMethods:void 0,methodConfig:e.methodConfig??void 0,userPinnedScenario:typeof e.userPinnedScenario=="boolean"?e.userPinnedScenario:void 0,showEventList:typeof e.showEventList=="boolean"?e.showEventList:void 0,eventOps:Array.isArray(e.eventOps)?e.eventOps:void 0,eventSearch:typeof e.eventSearch=="string"?e.eventSearch:void 0,eventLogTable:typeof e.eventLogTable=="string"?e.eventLogTable:void 0,eventLogTxn:typeof e.eventLogTxn=="string"?e.eventLogTxn:void 0,eventLogMethod:typeof e.eventLogMethod=="string"?e.eventLogMethod:void 0,eventLogOp:typeof e.eventLogOp=="string"?e.eventLogOp:void 0,applyOnCommit:typeof e.applyOnCommit=="boolean"?e.applyOnCommit:void 0,consumerRateEnabled:typeof e.consumerRateEnabled=="boolean"?e.consumerRateEnabled:void 0,consumerRateLimit:typeof e.consumerRateLimit=="number"?e.consumerRateLimit:void 0,generatorEnabled:typeof e.generatorEnabled=="boolean"?e.generatorEnabled:void 0,generatorRate:typeof e.generatorRate=="number"?e.generatorRate:void 0}}catch(t){return console.warn("Comparator prefs load failed",t),null}}function br(t){if(!(typeof window>"u"))try{window.localStorage.setItem(un,JSON.stringify(t))}catch(e){console.warn("Comparator prefs save failed",e)}}function xr(t,e,a,r,u,m){const f=t.length?t[t.length-1]:null,v=f?Math.max(e-f.ts_ms,0):e,M=e>0?t.length/(e/1e3):0;let I=0,k=0,x=0,g=0;t.forEach(j=>{j.op==="c"?I+=1:j.op==="u"?k+=1:j.op==="d"&&(x+=1),j.schemaChange&&(g+=1)});const A=a.ops.filter(j=>j.op==="delete").length,l=m?.deletes??0,h=A+l,o=h===0?100:x/h*100,y=t.every((j,D)=>{if(D===0)return!0;const V=t[D-1];return j.ts_ms>=V.ts_ms});return{lagMs:v,throughput:M,deletesPct:o,orderingOk:y,consistent:y&&(r==="polling"?x===h:!0),writeAmplification:r==="trigger"?Ka(u,r,t,a)??0:void 0,insertCount:I,updateCount:k,deleteCount:x,schemaChangeCount:g}}function yr(t){if(t.length===0)return null;const e=[...t].sort((x,g)=>x.metrics.lagMs-g.metrics.lagMs),a=e[0],r=e[e.length-1],u=r.metrics.lagMs-a.metrics.lagMs,m=[...t].sort((x,g)=>x.metrics.deletesPct-g.metrics.deletesPct),f=m[0],v=m[m.length-1],M=t.filter(x=>!x.metrics.orderingOk).map(x=>x.method),I=t.filter(x=>x.method==="trigger"&&typeof x.metrics.writeAmplification=="number"),k=I.length?I.reduce((x,g)=>x.metrics.writeAmplification?g.metrics.writeAmplification&&g.metrics.writeAmplification>x.metrics.writeAmplification?g:x:g):null;return{bestLag:a,worstLag:r,lagSpread:u,lowestDeletes:f,highestDeletes:v,orderingIssues:M,triggerWriteAmplification:k}}function _r(){const t=d.useRef(null);t.current===null&&(t.current=fr());const e=t.current||void 0,a=tn(e?.activeMethods),r=nn(e?.methodConfig),u=e?.presetId&&jt(e.presetId)?e.presetId:Js,m=sn(e?.eventLogMethod)?e?.eventLogMethod:null,f=typeof e?.eventLogOp=="string"&&e.eventLogOp.trim()?e.eventLogOp.trim().toLowerCase():null,v=d.useMemo(()=>typeof window>"u"?{...kt}:_a(window.localStorage),[]),[M,I]=d.useState(null),[k,x]=d.useState(()=>e?.scenarioId??yt[0].name),[g,A]=d.useState(()=>v.query),[l,h]=d.useState(()=>v.tags),[o,y]=d.useState(()=>a),[L,j]=d.useState(()=>qe(a)),[D,V]=d.useState(()=>qe(a)),[K,ke]=d.useState(()=>({})),[Le,We]=d.useState(u),[z,He]=d.useState(0),[E,q]=d.useState(!1),[W,Lt]=d.useState(!1),[Q,st]=d.useState(()=>r),[be,Me]=d.useState(!1),[Y,Mt]=d.useState(()=>e?.eventSearch??""),[ss,yn]=d.useState(()=>gr(e?.eventOps)),[Te,_n]=d.useState(e?.showEventList??!0),[ae,Tt]=d.useState(e?.eventLogTable??null),[ee,At]=d.useState(e?.eventLogTxn??""),[re,nt]=d.useState(m),[ie,It]=d.useState(f),[ve,ns]=d.useState(e?.applyOnCommit??!1),[oe,as]=d.useState(e?.consumerRateEnabled??!1),[me,rs]=d.useState(()=>vt(e?.consumerRateLimit,es)),[le,is]=d.useState(e?.generatorEnabled??!1),[te,os]=d.useState(()=>Yt(e?.generatorRate,bn)),[Ot,vn]=d.useState(()=>or()),xe=d.useRef({}),ce=d.useRef({}),Ae=d.useRef({}),ls=d.useRef(e?.consumerRateEnabled??!1?vt(e?.consumerRateLimit,es):null),ze=d.useRef(0),Nt=d.useRef(null),Qe=d.useRef(0),cs=d.useRef(te),ds=d.useRef(le),Ke=d.useRef({inserts:0,updates:0,deletes:0}),Dt=d.useRef({}),us=d.useRef(o),hs=d.useRef(z),F=wt[Le]??wt[Js],wn=d.useMemo(()=>Object.values(wt).map(s=>({id:s.id,label:s.label})),[]),R=d.useMemo(()=>{const s=F.methodCopyOverrides??{};return pe.reduce((i,c)=>{const p=ar[c],C=s[c];return i[c]={label:C?.label??p.label,laneDescription:C?.laneDescription??p.laneDescription,callout:C?.callout??p.callout,whenToUse:C?.whenToUse??p.whenToUse,tooltip:C?.tooltip??p.tooltip},i},{})},[F]),ps=d.useMemo(()=>new Set(l),[l]),ms=d.useMemo(()=>Ca(yt,{liveScenario:M??void 0,additionalTags:[l]}),[M,l]);d.useEffect(()=>{typeof window>"u"||va({query:g,tags:l},window.localStorage)},[g,l]),d.useEffect(()=>{if(typeof window>"u")return;const s=()=>{ye(g,l)};return window.addEventListener("cdc:scenario-filter-request",s),()=>{window.removeEventListener("cdc:scenario-filter-request",s)}},[ye,g,l]);const ye=d.useCallback((s,i)=>{if(typeof window>"u")return;const c=Xt({query:s,tags:i});window.dispatchEvent(new CustomEvent("cdc:scenario-filter",{detail:c}))},[]),gs=d.useMemo(()=>Wa.trim(),[]),at=d.useCallback(s=>{let i=Ae.current[s];return i||(i=new Qt,Ae.current[s]=i),i},[]),Ie=d.useCallback(s=>{Nt.current=sr(s),Qe.current=0,Ke.current={inserts:0,updates:0,deletes:0}},[]),rt=d.useCallback((s,i)=>{const c=Nt.current;if(!c||s<=0)return;const p=us.current;if(!p.length)return;const C=Dt.current;for(let S=0;S<s;S+=1){const w=nr(c,i,hs.current);w&&(p.forEach(_=>{C[_]?.applySourceOp(w.op)}),w.kind==="insert"?Ke.current.inserts+=1:w.kind==="update"?Ke.current.updates+=1:w.kind==="delete"&&(Ke.current.deletes+=1))}},[]),it=d.useCallback(s=>{if(!ds.current||!Nt.current)return;const i=cs.current;if(!Number.isFinite(i)||i<=0)return;Qe.current+=i*s/1e3;const c=Math.floor(Qe.current);if(c<=0)return;Qe.current-=c;const p=c>0?s/c:s;rt(c,p)},[rt]),de=d.useCallback((s,i)=>{const c=xe.current[s];if(!c)return;const p=c.metrics.snapshot(),C=c.bus.size(c.topic);ke(S=>({...S,[s]:{metrics:p,backlog:C,lastOffset:i?.lastOffset??S[s]?.lastOffset??-1}}))},[]),fs=d.useCallback((s,i)=>{i.length&&(V(c=>{const p={...c},C=p[s]??[];return p[s]=[...C,...i],p}),de(s,{lastOffset:i[i.length-1]?.offset??-1}))},[de]);d.useEffect(()=>{if(typeof window>"u")return;const s=i=>{if(!(i instanceof CustomEvent))return;const c=i.detail,p=Array.isArray(c)?c:[];vn(new Set(p.map(String)))};return window.addEventListener("cdc:feature-flags",s),()=>{window.removeEventListener("cdc:feature-flags",s)}},[]);const ot=d.useCallback(s=>Ot.size===0?!0:Ot.has(s),[Ot]),lt=ot("ff_event_bus"),Rt=ot("ff_pause_resume"),Sn=ot("ff_query_slider"),En=ot("ff_event_log"),Oe=d.useMemo(()=>Array.from(ss).sort(),[ss]),bs=d.useMemo(()=>new Set(Oe),[Oe]),Ne=d.useMemo(()=>Y.trim().toLowerCase().split(/\s+/).filter(Boolean),[Y]),xs=d.useMemo(()=>Ne.join("|"),[Ne]),ys=d.useRef(new WeakMap),ct=d.useCallback(s=>{const i=new Set(Oe),c=i.size<je.length,p=Ne.length>0,C=ys.current,S=new Map,w=_=>{const T=C.get(_);if(T)return T;const O=[String(_.seq??""),_.op,_.pk?.id??"",_.table??""];_.after&&O.push(...Object.values(_.after).map($=>String($??""))),_.before&&O.push(...Object.values(_.before).map($=>String($??"")));const P=O.join(" ").toLowerCase();return C.set(_,P),P};return o.forEach(_=>{const T=s[_]??[];if(!c&&!p){S.set(_,T);return}const O=T.filter(P=>{if(!i.has(P.op))return!1;if(!p)return!0;const $=w(P);return Ne.every(B=>$.includes(B))});S.set(_,O)}),S},[o,Oe,Ne]),Cn=d.useMemo(()=>ct(L),[ct,L,xs]),_s=d.useMemo(()=>ct(D),[ct,D,xs]),Je=d.useMemo(()=>{const s=[],i=new Set,c=new Set,p=new Set;return o.forEach(C=>{(_s.get(C)??[]).forEach(w=>{const _=w.table??"";_&&i.add(_);const T=w.tx?.id??null;T&&c.add(T);const O=typeof w.op=="string"?w.op.trim().toLowerCase():"";O&&p.add(O),s.push({method:C,event:w})})}),s.sort((C,S)=>{const w=C.event.offset??C.event.seq??0,_=S.event.offset??S.event.seq??0;return w!==_?w-_:(C.event.ts_ms??0)-(S.event.ts_ms??0)}),{events:s,tables:Array.from(i).sort(),txns:Array.from(c).sort(),ops:Array.from(p)}},[o,_s]),$t=Je.events,dt=Je.tables,ut=Je.txns,Pt=d.useMemo(()=>{const s=new Set(Je.ops),i=je.filter(p=>s.has(p)),c=Array.from(s).filter(p=>!je.includes(p));return c.sort(),[...i,...c]},[Je.ops]),De=d.useMemo(()=>$t.filter(({method:s,event:i})=>{if(re&&s!==re||ae&&(i.table??"")!==ae||ee&&(i.tx?.id??"")!==ee)return!1;const c=typeof i.op=="string"?i.op.trim().toLowerCase():"";return!(ie&&c!==ie)}),[$t,re,ie,ae,ee]),jn=d.useMemo(()=>De.map(({method:s,event:i},c)=>{const p=typeof i.offset=="number"?i.offset:null,C=typeof i.seq=="number"?i.seq:null,S=typeof i.ts_ms=="number"?i.ts_ms:null,w=[s,p!=null?`offset-${p}`:null,C!=null?`seq-${C}`:null,S!=null?`ts-${S}`:null,c].filter(Boolean),_=i.pk?.id!=null?String(i.pk.id):null,T=i.schemaChange?n.jsxs("span",{className:"sim-shell__event-log-schema",children:[i.schemaChange.action==="ADD_COLUMN"?"Added":"Dropped"," column ",i.schemaChange.column.name,` · v${i.schemaChange.previousVersion}→v${i.schemaChange.nextVersion}`]}):void 0;return{id:w.length?w.join("|"):`${s}-${c}`,methodId:s,methodLabel:R[s].label,op:i.op??"",offset:p,topic:i.topic??null,table:i.table??null,tsMs:S,pk:_,txnId:i.tx?.id??null,before:i.before??null,after:i.after??null,meta:T}}),[De,R]),kn=d.useMemo(()=>({methodId:re??void 0,op:ie??void 0,table:ae??void 0,txnId:ee||void 0}),[re,ie,ae,ee]),Ln=d.useMemo(()=>({methods:pe.map(s=>({id:s,label:R[s].label})),ops:Pt,tables:dt,txns:ut}),[dt,ut,R]),Ye=d.useMemo(()=>{const s=new Map;return o.forEach(i=>{const p=at(i).snapshot(),C=["table","id"],S=new Set(C);let w=1;p.forEach(O=>{w=Math.max(w,O.schema?.version??1),O.schema?.columns.forEach(P=>{if(!P)return;const $=P.name;!$||$==="id"||$.startsWith("__")||S.has($)||(S.add($),C.push($))})}),p.forEach(O=>{O.rows.forEach(P=>{Object.keys(P).forEach($=>{$==="id"||$.startsWith("__")||S.has($)||(S.add($),C.push($))})})});const _=p.flatMap(O=>O.rows.map(P=>{const $=String(P.id),B={};return C.forEach(J=>{if(J==="table"||J==="id"||J.startsWith("__"))return;const ue=P[J];B[J]=ue??null}),{id:`${O.name}::${$}`,displayId:$,table:O.name,values:B}})).sort((O,P)=>O.id.localeCompare(P.id,void 0,{numeric:!0,sensitivity:"base"})),T=S.has(Ce.name);s.set(i,{columns:C,rows:_,schemaVersion:w,hasSchemaColumn:T})}),s},[o,at,L]),vs=d.useRef(E),ht=d.useRef(0);d.useEffect(()=>{re&&!o.includes(re)&&nt(null)},[o,re]),d.useEffect(()=>{ae&&!dt.includes(ae)&&Tt(null)},[dt,ae]),d.useEffect(()=>{ie&&!Pt.includes(ie)&&It(null)},[Pt,ie]),d.useEffect(()=>{ee&&!ut.includes(ee)&&At("")},[ut,ee]),d.useEffect(()=>{us.current=o},[o]),d.useEffect(()=>{hs.current=z},[z]),d.useEffect(()=>{ds.current=le,le||(Qe.current=0)},[le]),d.useEffect(()=>{cs.current=te},[te]),d.useEffect(()=>{Ie(b)},[b,Ie]);const Re=d.useRef(e?.userPinnedScenario??!1),ge=d.useMemo(()=>Ea(yt,{liveScenario:M??void 0,liveScenarioName:Ve,query:g,tags:l}),[M,g,l]),b=d.useMemo(()=>ge.length?ge.find(s=>s.name===k)??ge[0]:yt[0],[k,ge]),pt=d.useMemo(()=>{const s=new Map;return o.forEach(i=>{const c=Ye.get(i);s.set(i,{present:c?.hasSchemaColumn??!1,version:c?.schemaVersion??1})}),s},[o,Ye]),Xe=d.useMemo(()=>o.length>0?o.every(s=>pt.get(s)?.present??!1):!1,[o,pt]),we=d.useMemo(()=>{let s=1;return o.forEach(i=>{const c=pt.get(i);c&&c.version>s&&(s=c.version)}),s},[o,pt]),$e=d.useMemo(()=>!!b.tags?.includes("schema"),[b.tags]),ws=d.useMemo(()=>{if(!$e)return null;const s=`v${we}`;return Xe?`${s} · column present`:`${s} · column absent`},[Xe,we,$e]);d.useEffect(()=>{ht.current=0},[b.name]);const Ft=d.useMemo(()=>b.table?b.table:b.ops.find(i=>i.table)?.table??"table",[b.ops,b.table]);d.useEffect(()=>{if(!be)return;const s=window.setTimeout(()=>Me(!1),2e3);return()=>window.clearTimeout(s)},[be]),d.useEffect(()=>{if(typeof window>"u")return;const s=window.setTimeout(()=>{G("comparator.event.search",{scenario:b.name,query:Y,hasQuery:!!Y.trim()})},400);return()=>window.clearTimeout(s)},[Y,b.name]),d.useEffect(()=>{vs.current=E},[E]),d.useEffect(()=>{ge.length&&(ge.some(s=>s.name===k)||(Re.current=!1,x(ge[0].name)))},[k,ge]),d.useEffect(()=>{if(!be)return;const s=window.setTimeout(()=>Me(!1),2e3);return()=>window.clearTimeout(s)},[be]),d.useEffect(()=>{if(typeof window>"u")return;const s=i=>{if(!(i instanceof CustomEvent))return;const c=Xt(i.detail);A(p=>p===c.query?p:c.query),h(p=>ba(p,c.tags)?p:c.tags)};return window.addEventListener("cdc:scenario-filter",s),window.dispatchEvent(new CustomEvent("cdc:scenario-filter-request")),()=>{window.removeEventListener("cdc:scenario-filter",s)}},[]),d.useEffect(()=>{if(typeof window>"u")return;const s=i=>{if(!(i instanceof CustomEvent))return;const c=i.detail;if(!c||!c.scenario){I(null);return}const p=Array.isArray(c.scenario.ops)?c.scenario.ops:[],C=c.scenario.label??"Workspace (live)",S=c.scenario.description??`${p.length} operations`,w=c.scenario.seed??1;I({name:Ve,label:C,description:S,seed:w,ops:p})};return window.addEventListener("cdc:workspace-update",s),window.dispatchEvent(new CustomEvent("cdc:workspace-request")),()=>{window.removeEventListener("cdc:workspace-update",s)}},[]),d.useEffect(()=>{M&&M.ops.length&&(Re.current||x(Ve))},[M]),d.useEffect(()=>{if(typeof window>"u")return;const s=i=>{if(!(i instanceof CustomEvent))return;const c=i.detail;if(!c){Re.current=!1;return}c.userPinnedScenario!=null&&(Re.current=!!c.userPinnedScenario),c.activeMethods&&y(tn(c.activeMethods)),c.methodConfig&&st(nn(c.methodConfig)),c.scenarioId&&x(c.scenarioId),c.presetId&&jt(c.presetId)&&We(c.presetId),typeof c.applyOnCommit=="boolean"&&ns(c.applyOnCommit),typeof c.consumerRateEnabled=="boolean"&&as(c.consumerRateEnabled),typeof c.consumerRateLimit=="number"&&rs(vt(c.consumerRateLimit)),typeof c.generatorEnabled=="boolean"&&is(c.generatorEnabled),typeof c.generatorRate=="number"&&os(Yt(c.generatorRate))};return window.addEventListener("cdc:comparator-preferences-set",s),()=>{window.removeEventListener("cdc:comparator-preferences-set",s)}},[]),d.useEffect(()=>{br({scenarioId:k,presetId:Le,activeMethods:o,methodConfig:Q,userPinnedScenario:Re.current,showEventList:Te,eventOps:Oe,eventSearch:Y,eventLogTable:ae,eventLogTxn:ee,eventLogMethod:re,eventLogOp:ie,applyOnCommit:ve,consumerRateEnabled:oe,consumerRateLimit:me,generatorEnabled:le,generatorRate:te})},[k,Le,o,Q,Te,Oe,Y,ae,ee,re,ie,ve,oe,me,le,te]);const Se=d.useRef(null),mt=d.useRef(null),se=d.useCallback(()=>{mt.current!=null&&(window.clearInterval(mt.current),mt.current=null)},[]),Pe=d.useCallback(()=>{if(W)return;const s={},i=ls.current;if(i!=null){const w=i*_e/1e3,_=ze.current+w;ze.current=Math.min(_,i*5)}let c=i==null?Number.POSITIVE_INFINITY:ze.current;const p=w=>w.txnId??`tx-${w.commitTs}`,C=w=>{if(!w.length)return!1;const _=w[w.length-1];return typeof _.txnLast=="boolean"?_.txnLast:typeof _.txnIndex=="number"&&typeof _.txnTotal=="number"?_.txnIndex>=_.txnTotal-1:!0},S=(w,_)=>{const T=ce.current[w]??[];let O=T.length?[...T]:[];if(O.length&&(ce.current[w]=[]),!O.length){const $=_.bus.consume(_.topic,1);if(!$.length)return[];O=$}const P=p(O[0]);for(;!C(O);){const $=_.bus.consume(_.topic,1);if(!$.length)return ce.current[w]=O,[];const B=$[0];if(p(B)!==P){const ue=ce.current[w]??[];ce.current[w]=[B,...ue];break}O.push(B)}return O};for(const w of o){const _=xe.current[w];if(!_)continue;let T=[],O=0;if(ve){const B=S(w,_);if(!B.length)continue;if(i!=null&&B.length>c){ce.current[w]=B;continue}T=B,O=B.length}else{const B=ce.current[w]??[];if(B.length){if(i!=null&&B.length>c){ce.current[w]=B;continue}T=[...B],O+=B.length,ce.current[w]=[]}const J=i==null?Number.POSITIVE_INFINITY:c-O;if(i==null?!0:J>=1){const he=i==null?50:Math.min(Math.floor(J),50),et=i==null?50:Math.max(he,0);if(et>0){const ne=_.bus.consume(_.topic,et);ne.length&&(T=T.length?T.concat(ne):ne,O+=ne.length)}}if(!T.length)continue}i!=null&&(c=Math.max(c-O,0)),at(w).applyEvents(T),_.metrics.onConsumed(T);const $=T.map(B=>{const J=B.__seq??0;return xn(w,B,J)});de(w),s[w]=$}i!=null&&(ze.current=c),Object.keys(s).length!==0&&j(w=>{const _={...w};for(const[T,O]of Object.entries(s)){const P=_[T]??[];_[T]=[...P,...O]}return _})},[o,ve,at,W,de]),Ss=d.useCallback(()=>{se(),mt.current=window.setInterval(()=>{Se.current?.tick(_e),it(_e),Pe()},_e)},[se,Pe,it]);d.useEffect(()=>{const s=oe?me:null;ls.current=s,s==null&&(ze.current=0)},[oe,me]),d.useEffect(()=>{W||Pe()},[W,Pe]),d.useEffect(()=>{j(qe(o)),V(qe(o)),xe.current={},ce.current={},Ae.current={},o.forEach(S=>{Ae.current[S]=new Qt}),He(0),q(!1),se(),Ie(b);const s=new Ra,i=[],c={},p={},C=o.map(S=>{const w=pr(S,O=>fs(S,O));if(p[S]=w,S==="polling"){const O=Q.polling;w.configure({poll_interval_ms:O.pollIntervalMs,include_soft_deletes:O.includeSoftDeletes})}else if(S==="trigger"){const O=Q.trigger;w.configure({extract_interval_ms:O.extractIntervalMs,trigger_overhead_ms:O.triggerOverheadMs})}else{const O=Q.log;w.configure({fetch_interval_ms:O.fetchIntervalMs})}const _={bus:w.bus,metrics:w.metrics,topic:w.topic,applySchemaChange:w.applySchemaChange};c[S]=_;const T=w.onEvent(O=>{j(P=>{const $={...P},B=$[S]??[];return $[S]=[...B,O],$})});return i.push(T),w});return xe.current=c,Dt.current=p,o.forEach(S=>de(S,{lastOffset:-1})),s.attach(C),s.load(b),s.reset(b.seed),s.onTick(S=>He(S)),Se.current=s,()=>{s.pause(),se(),i.forEach(S=>S()),Dt.current={}}},[o,b,se,Q,de,fs,Ie]);const Mn=d.useCallback(s=>{y(i=>{if(i.includes(s))return i.length<=hn?i:i.filter(p=>p!==s);const c=[...i,s];return pe.filter(p=>c.includes(p))})},[]),Tn=d.useCallback(s=>{yn(i=>{const c=new Set(i);let p=!1;return c.has(s)?c.size>1&&(c.delete(s),p=!0):(c.add(s),p=!0),p&&G("comparator.event.filter",{scenario:b.name,op:s,active:c.has(s)}),p?c:i})},[b.name]),An=d.useCallback(s=>{Mt(s)},[]),In=d.useCallback(()=>{_n(s=>{const i=!s;return G("comparator.panel.layout",{scenario:b.name,showEvents:i}),i})},[b.name]),On=d.useCallback(()=>{as(s=>{const i=!s;return G("comparator.consumer.rate_toggle",{scenario:b.name,enabled:i}),i}),oe&&G("comparator.consumer.rate_reset",{scenario:b.name})},[oe,b.name]),Nn=d.useCallback(s=>{const i=vt(s,me);i!==me&&(rs(i),G("comparator.consumer.rate_adjust",{scenario:b.name,rate:i}))},[me,b.name]),Dn=d.useCallback(()=>{is(s=>{const i=!s;return G("comparator.generator.toggle",{scenario:b.name,enabled:i}),i})},[b.name]),Rn=d.useCallback(s=>{const i=Yt(s,te);i!==te&&(os(i),G("comparator.generator.rate_adjust",{scenario:b.name,rate:i}))},[te,b.name]),$n=d.useCallback(()=>{rt(Kt,Ya),G("comparator.generator.burst",{scenario:b.name,count:Kt})},[rt,b.name]),Pn=d.useCallback(s=>{s.methodId&&sn(s.methodId)?nt(s.methodId):nt(null),Tt(s.table??null),At(s.txnId??""),It(s.op?s.op.toLowerCase():null)},[nt,It,Tt,At]),Fn=d.useCallback(()=>{if(De.length===0)return;const s=De.map(({method:C,event:S})=>JSON.stringify({method:C,offset:S.offset??null,seq:S.seq,ts_ms:S.ts_ms,op:S.op,pk:S.pk,table:S.table,before:S.before,after:S.after,topic:S.topic})),i=new Blob([s.join(`
`)],{type:"application/json"}),c=URL.createObjectURL(i),p=document.createElement("a");p.href=c,p.download=`${b.name}-event-log.ndjson`,p.click(),URL.revokeObjectURL(c),G("comparator.event.download",{scenario:b.name,events:De.length})},[De,b.name]),Un=d.useCallback(s=>{const i=Ae.current[s];if(!i)return;const c=i.snapshot(),p=(b.name||"scenario").replace(/[^a-z0-9-_]+/gi,"-"),C={scenario:b.name,method:s,tables:c},S=new Blob([JSON.stringify(C,null,2)],{type:"application/json"}),w=URL.createObjectURL(S),_=document.createElement("a");_.href=w,_.download=`${p}-${s}-destination.json`,_.click(),URL.revokeObjectURL(w);const T=c.reduce((O,P)=>O+(P.rows?.length??0),0);G("comparator.destination.download",{scenario:b.name,method:s,tables:c.length,rows:T})},[b.name]),Bn=d.useCallback(()=>{V(s=>{const i={...s};return o.forEach(c=>{i[c]=[]}),i}),ys.current=new WeakMap,G("comparator.event.clear",{scenario:b.name})},[o,b.name]),Gn=d.useCallback(s=>{const i=JSON.stringify({method:s.methodId??null,methodLabel:s.methodLabel??null,op:s.op,offset:s.offset??null,topic:s.topic??null,table:s.table??null,ts_ms:s.tsMs??null,pk:s.pk??null,txnId:s.txnId??null,before:s.before??null,after:s.after??null},null,2);navigator.clipboard.writeText(i).then(()=>G("comparator.event.copy",{scenario:b.name,method:s.methodId??null,op:s.op,offset:s.offset??null})).catch(()=>{G("comparator.event.copy.error",{scenario:b.name,method:s.methodId??null})})},[b.name]),Vn=d.useCallback(s=>{if(typeof window>"u")return;const i=typeof s.op=="string"?s.op.trim().toLowerCase():"";if(i!=="c"&&i!=="u"&&i!=="d")return;const c={op:i,before:s.before??null,after:s.after??null,ts_ms:typeof s.tsMs=="number"?s.tsMs:void 0,table:s.table??void 0,key:s.pk?{id:s.pk}:void 0};window.dispatchEvent(new CustomEvent("cdc:workspace-replay-event",{detail:c})),G("comparator.event.replay",{scenario:b.name,method:s.methodId??null,table:s.table??null,op:i})},[b.name]),qn=d.useCallback(s=>{jt(s)&&(We(s),G("comparator.preset.select",{presetId:s}))},[]),Wn=d.useCallback(s=>{A(s),ye(s,l),G("comparator.scenario.filter",{query:s})},[ye,l]),Hn=d.useCallback(s=>{const i=l.includes(s),c=i?l.filter(p=>p!==s):[...l,s];h(c),ye(g,c),G("comparator.scenario.tag_toggle",{tag:s,active:!i})},[ye,g,l]),zn=d.useCallback(()=>{l.length&&(h([]),ye(g,[]),G("comparator.scenario.tag_clear"))},[ye,g,l]),Qn=d.useCallback(s=>{Re.current=!0,x(s),G("comparator.scenario.select",{scenario:s})},[]),Kn=d.useCallback(s=>{const i={id:s.id,name:s.name,label:s.label,description:s.description,highlight:s.highlight,tags:s.tags,table:s.table,schemaVersion:s.schemaVersion,seed:s.seed,schema:s.schema??[],rows:s.rows??[],events:s.events??[],ops:s.ops},c=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),p=document.createElement("a");p.href=URL.createObjectURL(c),p.download=`${s.name}.json`,p.click(),URL.revokeObjectURL(p.href)},[]),Jn=d.useCallback(s=>{G("comparator.scenario.preview",{scenario:s.name,tags:s.tags??[]}),window.dispatchEvent(new CustomEvent("cdc:preview-scenario",{detail:s}))},[]),X=d.useMemo(()=>o.map(s=>{const i=L[s]??[];return{method:s,events:i,metrics:xr(i,z,b,s,K,Ke.current)}}),[o,z,L,b,K]),fe=d.useMemo(()=>o.reduce((s,i)=>{const c=K[i],p=c?.metrics,C={backlog:c?.backlog??0,lastOffset:c?.lastOffset??-1,produced:p?.produced??0,consumed:p?.consumed??0,lagMsP50:p?.lagMsP50??0,lagMsP95:p?.lagMsP95??0,missedDeletes:p?.missedDeletes??0,writeAmplification:p?.writeAmplification??0,snapshotRows:p?.snapshotRows??0,errors:p?.errors??0};return s.set(i,C),s},new Map),[o,K]),Ut=d.useMemo(()=>o.reduce((s,i)=>s+(fe.get(i)?.backlog??0),0),[o,fe]),Yn=d.useMemo(()=>lt?o.reduce((s,i)=>{const c=fe.get(i);return c&&(s.produced+=c.produced,s.consumed+=c.consumed,s.backlog+=c.backlog,s.snapshotRows+=c.snapshotRows),s},{produced:0,consumed:0,backlog:0,snapshotRows:0}):{produced:0,consumed:0,backlog:0,snapshotRows:0},[o,fe,lt]),N=yr(X),Es=d.useMemo(()=>X.reduce((s,i)=>s+i.events.length,0),[X]),gt=d.useMemo(()=>X.map(({method:s,events:i,metrics:c})=>({method:s,label:R[s].label,total:i.length,inserts:c.insertCount,updates:c.updateCount,deletes:c.deleteCount,schemaChanges:c.schemaChangeCount})),[X,R]),Cs=d.useMemo(()=>gt.reduce((s,i)=>s.set(i.method,i),new Map),[gt]),Fe=d.useMemo(()=>{const s=new Map;return X.forEach(({method:i,events:c})=>{s.set(i,qa(i,b.ops,c))}),s},[X,b.ops]),js=d.useMemo(()=>o.map(s=>{const i=fe.get(s),c=Cs.get(s);return{id:s,label:R[s].label,tooltip:R[s].tooltip,produced:i?.produced??0,consumed:i?.consumed??0,backlog:i?.backlog??0,lagP50:i?.lagMsP50??0,lagP95:i?.lagMsP95??0,missedDeletes:i?.missedDeletes,writeAmplification:i?.writeAmplification,snapshotRows:i?.snapshotRows,inserts:c?.inserts??0,updates:c?.updates??0,deletes:c?.deletes??0,schemaChanges:c?.schemaChanges??0}}),[o,Cs,fe,R]),Ze=d.useMemo(()=>o.map(s=>{const i=fe.get(s),c=R[s].label,p=i?.snapshotRows??0;return`${c} ${p}`}).join(", "),[o,fe,R]),ks=d.useMemo(()=>o.map(s=>{const i=Fe.get(s),c=R[s].label,p=i?.totals??{missing:0,extra:0,ordering:0},C=i?.lag?.max??0,S=[];if(p.missing>0&&S.push({key:"missing",text:`${p.missing} missing`,tone:"missing"}),p.extra>0&&S.push({key:"extra",text:`${p.extra} extra`,tone:"extra"}),p.ordering>0&&S.push({key:"ordering",text:`${p.ordering} ordering`,tone:"ordering"}),C>0&&S.push({key:"lag",text:`${Math.round(C)}ms lag`,tone:"lag"}),$e){const _=Ye.get(s),T=_?.schemaVersion??1;_&&!_.hasSchemaColumn?S.push({key:"schema-missing",text:`${Ce.name} missing`,tone:"schema"}):T<we&&S.push({key:"schema-behind",text:`Schema v${T}/${we}`,tone:"schema"})}S.length===0&&S.push({key:"ok",text:"Aligned",tone:"ok"});const w=!!i?.issues.length||(i?.lag?.samples?.length??0)>0||(i?.lag?.max??0)>0;return{method:s,label:c,chips:S,hasDetails:w}}),[o,Ye,Fe,R,we,$e]);d.useEffect(()=>{typeof window>"u"||window.dispatchEvent(new CustomEvent("cdc:consumer-paused",{detail:{paused:W,backlog:Ut}}))},[W,Ut]);const Xn=d.useCallback(()=>{if(!N)return;const s=[];s.push(`${b.label}: ${b.description}`),s.push(`Methods: ${o.map(i=>R[i].label).join(", ")}`),N.bestLag&&s.push(`Fastest ${R[N.bestLag.method].label} at ${Math.round(N.bestLag.metrics.lagMs)}ms`),N.lagSpread>0&&s.push(`${R[N.worstLag.method].label} trails by ${Math.round(N.lagSpread)}ms`),s.push(`Lowest delete capture: ${R[N.lowestDeletes.method].label} (${Math.round(N.lowestDeletes.metrics.deletesPct)}%)`),N.triggerWriteAmplification&&s.push(`Trigger write amplification: ${R[N.triggerWriteAmplification.method].label} ${(N.triggerWriteAmplification.metrics.writeAmplification??0).toFixed(1)}x`),Ze&&s.push(`Snapshot rows: ${Ze}`),s.push(`Ordering: ${N.orderingIssues.length?N.orderingIssues.map(i=>R[i].label).join(", "):"All lanes aligned"}`),b.tags?.length&&s.push(`Tags: ${b.tags.join(", ")}`),navigator.clipboard.writeText(s.join(`
`)).then(()=>Me(!0)).catch(()=>Me(!1)),G("comparator.summary.copied",{scenario:b.name,tags:b.tags??[],methods:o})},[N,b,o,R,Ze]),Zn=d.useCallback(s=>{G("comparator.overlay.inspect",{method:s,scenario:b.name});const i=document.getElementById(`lane-diff-${s}`);i instanceof HTMLDetailsElement?(i.open=!0,i.scrollIntoView({behavior:"smooth",block:"center"})):i&&i.scrollIntoView({behavior:"smooth",block:"center"})},[b.name]),Bt=d.useCallback(s=>{if(!b.tags?.includes("schema"))return;const i=Math.max(z,ht.current+_e);ht.current=i,o.forEach(c=>{xe.current[c]?.applySchemaChange?.(Ft,s,Ce,i),de(c)}),G("comparator.schema.change",{action:s,table:Ft,scenario:b.name,commitTs:i,methods:o})},[o,z,xe,Ft,b.name,b.tags,de]),ea=d.useMemo(()=>{if(!b.tags?.includes("schema"))return;const s=o[0];if(s)return i=>i!==s?null:n.jsx(Da,{columnName:Ce.name,onAdd:()=>Bt("add"),onDrop:()=>Bt("drop"),disableAdd:Xe,disableDrop:!Xe,status:ws})},[o,Bt,Xe,ws,b.tags]),Ue=d.useCallback((s,i,c)=>{st(p=>({...p,[s]:{...p[s],[i]:c}}))},[]),Be=d.useCallback(s=>{const i=Se.current;if(i){Ie(b),i.reset(b.seed),j(qe(o)),V(qe(o));for(const c of o){Ae.current[c]=new Qt;const p=xe.current[c];p&&(p.bus.reset(p.topic),p.metrics.reset(),de(c,{lastOffset:-1}))}He(0),ht.current=0,s?.keepLoop||(i.pause(),q(!1),se())}},[o,Ie,b,b.seed,se,de]),Gt=d.useCallback(()=>{const s=Se.current;s&&(Be({keepLoop:!0}),s.start(),q(!0),Ss(),tt("play",{scenario:b.name}))},[Be,Ss,b.name]),Vt=d.useCallback(()=>{Se.current?.pause(),q(!1),se(),tt("pause",{scenario:b.name})},[se,b.name]),ta=d.useCallback(()=>{Rt&&Lt(s=>{const i=!s;return G("comparator.consumer.toggle",{scenario:b.name,paused:i}),i||Pe(),i})},[Pe,Rt,b.name]),qt=d.useCallback((s=_e)=>{const i=Se.current;if(!i)return;const c=vs.current;c||i.start(),i.tick(s),it(s),c||i.pause(),tt("step",{deltaMs:s,scenario:b.name})},[it,b.name]),Ls=d.useCallback((s,i)=>{const c=Se.current;if(!c)return;const p=Math.max(10,i??_e);Be({keepLoop:!1});const C=Math.max(s,0);c.start();let S=0,w=0;for(;S<C&&w<1e4;){const _=Math.min(p,C-S);c.tick(_),S+=_,w+=1}c.pause(),q(!1),tt("seek",{targetMs:s,stepMs:i,scenario:b.name})},[Be,b.name]),Ms=d.useCallback(()=>{Be(),tt("reset",{scenario:b.name})},[Be,b.name]);return d.useEffect(()=>{if(typeof window>"u")return;const s={play:()=>Gt(),pause:()=>Vt(),step:c=>qt(c),seek:(c,p)=>Ls(c,p),reset:()=>Ms()};window.cdcComparatorClock=s;const i=c=>{if(!(c instanceof CustomEvent))return;const p=c.detail;if(p)switch(p.type){case"play":s.play();break;case"pause":s.pause();break;case"step":s.step(p.deltaMs);break;case"seek":s.seek(p.timeMs,p.stepMs);break;case"reset":s.reset();break}};return window.addEventListener("cdc:comparator-clock",i),()=>{window.removeEventListener("cdc:comparator-clock",i),window.cdcComparatorClock===s&&delete window.cdcComparatorClock}},[Vt,Ms,Ls,Gt,qt]),d.useEffect(()=>{typeof window>"u"||window.dispatchEvent(new CustomEvent("cdc:comparator-clock-tick",{detail:{clock:z}}))},[z]),d.useEffect(()=>()=>se(),[se]),d.useEffect(()=>{if(typeof window>"u")return;const s=N?{lagSpread:N.lagSpread,bestLag:{method:N.bestLag.method,label:R[N.bestLag.method].label,metrics:N.bestLag.metrics},worstLag:{method:N.worstLag.method,label:R[N.worstLag.method].label,metrics:N.worstLag.metrics},lowestDeletes:{method:N.lowestDeletes.method,label:R[N.lowestDeletes.method].label,metrics:N.lowestDeletes.metrics},highestDeletes:{method:N.highestDeletes.method,label:R[N.highestDeletes.method].label,metrics:N.highestDeletes.metrics},orderingIssues:N.orderingIssues.map(_=>({method:_,label:R[_].label})),triggerWriteAmplification:N.triggerWriteAmplification?{method:N.triggerWriteAmplification.method,label:R[N.triggerWriteAmplification.method].label,value:N.triggerWriteAmplification.metrics.writeAmplification??0}:null}:null,i=X.map(({method:_,metrics:T})=>({method:_,label:R[_].label,tooltip:R[_].tooltip,metrics:T})),c=b.table??b.ops.find(_=>_.table)?.table??"table";let p=c;try{p=F.topicFormat(c)}catch{p=c}const C={id:F.id,label:F.label,description:F.description,docsHint:F.docsHint,source:{label:F.sourceLabel,tooltip:F.sourceTooltip},log:{label:F.logLabel,tooltip:F.logTooltip},bus:{label:F.busLabel,tooltip:F.busTooltip,exampleTopic:p},destination:{label:F.destinationLabel,tooltip:F.destinationTooltip},methods:pe.map(_=>({id:_,label:R[_].label,tooltip:R[_].tooltip??null}))},S=X.map(({method:_})=>{const T=Fe.get(_);return T?{method:_,totals:T.totals,issues:T.issues.slice(0,25),lag:T.lag}:{method:_,totals:{missing:0,extra:0,ordering:0},issues:[],lag:{max:0,samples:[]}}}),w=o.map(_=>{const T=Fe.get(_);return T?{method:_,label:R[_].label,totals:T.totals,issues:T.issues.slice(0,10),lag:{max:T.lag.max,samples:T.lag.samples.slice(0,10)}}:{method:_,label:R[_].label,totals:{missing:0,extra:0,ordering:0},issues:[],lag:{max:0,samples:[]}}});window.dispatchEvent(new CustomEvent("cdc:comparator-summary",{detail:{scenarioName:b.name,scenarioLabel:b.label,scenarioDescription:b.description,isLive:b.name===Ve,totalEvents:Es,summary:s,lanes:i,analytics:gt,tags:l,preset:C,diffs:S,overlay:w}}))},[X,b,N,Es,gt,l,Fe,R,F,o]),n.jsxs("section",{className:"sim-shell","aria-label":"Simulator preview",children:[n.jsxs("header",{className:"sim-shell__header",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"sim-shell__title",children:"CDC Method Comparator"}),n.jsx("p",{className:"sim-shell__description",children:F.description}),n.jsxs("div",{className:"sim-shell__preset-row",role:"list","aria-label":"Selected vendor pipeline",children:[n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":F.sourceTooltip,role:"listitem",children:["Source · ",F.sourceLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":F.logTooltip,role:"listitem",children:["Capture · ",F.logLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":F.busTooltip,role:"listitem",children:["Transport · ",F.busLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":F.destinationTooltip,role:"listitem",children:["Sink · ",F.destinationLabel]})]}),n.jsxs("p",{className:"sim-shell__description sim-shell__description--meta",children:[F.label,F.docsHint?n.jsxs(n.Fragment,{children:[" · ",n.jsx("a",{href:F.docsHint,target:"_blank",rel:"noopener noreferrer",children:"Reference"})]}):null]})]}),n.jsxs("div",{className:"sim-shell__scenario-filter-row",role:"group","aria-label":"Filter scenarios",children:[n.jsxs("label",{className:"sim-shell__scenario-search",children:[n.jsx("span",{children:"Search scenarios"}),n.jsx("input",{type:"search",value:g,onChange:s=>Wn(s.target.value),placeholder:"Find by label, description, or tag"})]}),ms.length>0?n.jsxs("div",{className:"sim-shell__scenario-tags",role:"group","aria-label":"Scenario tags",children:[ms.map(s=>n.jsxs("button",{type:"button",className:"sim-shell__scenario-tag","data-active":ps.has(s)?"true":"false","aria-pressed":ps.has(s),onClick:()=>Hn(s),children:["#",s]},s)),l.length?n.jsx("button",{type:"button",className:"sim-shell__scenario-tag sim-shell__scenario-tag--clear",onClick:zn,children:"Clear"}):null]}):null]}),n.jsxs("div",{className:"sim-shell__actions sim-shell__actions--scenario",role:"group","aria-label":"Scenario controls",children:[n.jsx("select",{"aria-label":"Vendor preset",value:Le,onChange:s=>qn(s.target.value),children:wn.map(s=>n.jsx("option",{value:s.id,children:s.label},s.id))}),n.jsx("select",{"aria-label":"Scenario",value:k,onChange:s=>Qn(s.target.value),children:ge.map(s=>n.jsx("option",{value:s.name,children:s.label},s.name))}),n.jsxs("div",{className:"sim-shell__scenario-actions",children:[n.jsx("button",{type:"button",className:"sim-shell__scenario-sync",onClick:()=>{b.name!==Ve&&window.dispatchEvent(new CustomEvent("cdc:apply-scenario-template",{detail:{id:b.name}}))},disabled:b.name===Ve,children:"Load in workspace"}),n.jsx("button",{type:"button",className:"sim-shell__scenario-download",onClick:()=>Kn(b),children:"Download JSON"}),n.jsx("button",{type:"button",className:"sim-shell__scenario-preview",onClick:()=>Jn(b),children:"Preview"})]}),n.jsx("div",{className:"sim-shell__method-toggle",role:"group","aria-label":"Methods to display",children:pe.map(s=>n.jsx("button",{type:"button",className:"sim-shell__method-chip","aria-pressed":o.includes(s),onClick:()=>Mn(s),"data-tooltip":R[s].tooltip||void 0,children:R[s].label},s))})]})]}),n.jsxs("p",{className:"sim-shell__description","aria-live":"polite",children:[n.jsxs("strong",{children:[b.label,":"]})," ",b.description]}),b.highlight&&n.jsx("p",{className:"sim-shell__description sim-shell__description--highlight","aria-live":"polite",children:b.highlight}),b.tags?.length?n.jsx("div",{className:"sim-shell__tag-row","aria-label":"Scenario tags",children:b.tags.map(s=>n.jsxs("span",{className:"sim-shell__tag-chip",children:["#",s]},s))}):null,b.stats&&n.jsxs("p",{className:"sim-shell__description sim-shell__description--meta","aria-live":"polite",children:[b.stats.rows," rows · ",b.stats.ops," ops"]}),n.jsxs("div",{className:"sim-shell__event-filters",role:"group","aria-label":"Event filters",children:[W&&n.jsx("div",{className:"sim-shell__pause-banner",role:"status","aria-live":"polite",children:"Apply paused. Resume to drain the event bus."}),n.jsxs("label",{className:"sim-shell__event-search",children:[n.jsx("span",{children:"Search events"}),n.jsx("input",{type:"search",value:Y,onChange:s=>An(s.target.value),placeholder:"Filter by pk, seq, or payload"})]}),n.jsx("div",{className:"sim-shell__event-ops",role:"group","aria-label":"Change operations",children:je.map(s=>n.jsx("button",{type:"button",className:"sim-shell__event-op","data-active":bs.has(s)?"true":"false",onClick:()=>Tn(s),children:s.toUpperCase()},s))}),n.jsx("button",{type:"button",className:"sim-shell__event-toggle",onClick:In,children:Te?"Hide timeline":"Show timeline"})]}),En&&n.jsx(Ta,{className:"sim-shell__event-log",events:jn,stats:Yn,totalCount:$t.length,filters:kn,filterOptions:Ln,onFiltersChange:Pn,onDownload:Fn,onClear:Bn,onCopyEvent:Gn,onReplayEvent:Vn,maxVisibleEvents:rr}),gs&&n.jsx("section",{className:"sim-shell__harness-history","aria-label":"Harness nightly history",children:n.jsxs("details",{children:[n.jsx("summary",{children:"Harness nightly history"}),n.jsx("pre",{children:gs})]})}),n.jsxs("div",{className:"sim-shell__actions",role:"group","aria-label":"Playback controls","data-tour-target":"comparator-actions",children:[n.jsx("button",{type:"button",onClick:Gt,disabled:E,children:"Start"}),n.jsx("button",{type:"button",onClick:Vt,disabled:!E,children:"Pause"}),n.jsxs("button",{type:"button",onClick:()=>qt(),children:["Step +",_e,"ms"]}),Rt&&n.jsxs("button",{type:"button",onClick:ta,className:"sim-shell__consumer-toggle","data-tooltip":H.backlog,children:[W?"Resume apply":"Pause apply",lt?` (${Ut} queued)`:""]}),n.jsxs("label",{className:"sim-shell__apply-toggle","data-tooltip":H.txnAtomic||void 0,children:[n.jsx("input",{type:"checkbox",checked:ve,onChange:s=>ns(s.target.checked)}),n.jsx("span",{children:"Apply on commit"})]}),n.jsxs("div",{className:"sim-shell__consumer-rate",role:"group","aria-label":"Apply rate limit","data-enabled":oe?"true":"false",children:[n.jsx("button",{type:"button",onClick:On,children:oe?"Disable throttle":"Throttle apply"}),n.jsxs("label",{children:[n.jsx("span",{children:oe?`${me} events/s`:"Unlimited"}),n.jsx("input",{type:"range",min:pn,max:mn,step:Ja,value:me,onChange:s=>Nn(Number(s.target.value)),disabled:!oe})]})]}),n.jsxs("div",{className:"sim-shell__generator",role:"group","aria-label":"Event generator","data-enabled":le?"true":"false",children:[n.jsx("button",{type:"button",onClick:Dn,children:le?"Stop generator":"Start generator"}),n.jsxs("label",{children:[n.jsx("span",{children:le?`${te} events/s`:`Set ${te} events/s`}),n.jsx("input",{type:"range",min:gn,max:fn,step:ts,value:te,onChange:s=>Rn(Number(s.target.value)),disabled:!le})]}),n.jsxs("button",{type:"button",onClick:$n,children:["Burst +",Kt]})]})]}),n.jsx("div",{className:"sim-shell__controls","aria-label":"Method tuning controls",children:pe.map(s=>{const i=o.includes(s);if(s==="polling"){const p=Q.polling;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":i?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:R[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Adjust poll cadence and whether soft deletes are surfaced."}),Sn?n.jsxs(n.Fragment,{children:[n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsxs("span",{children:["Poll interval (",(p.pollIntervalMs/1e3).toFixed(1),"s)"]}),n.jsx("input",{type:"range",min:500,max:1e4,step:100,value:p.pollIntervalMs,onChange:C=>Ue("polling","pollIntervalMs",Math.min(1e4,Math.max(500,Number(C.target.value)||500)))})]}),n.jsxs("p",{className:"sim-shell__control-hint",children:["⏱️ Polling every ",(p.pollIntervalMs/1e3).toFixed(1),"s"]})]}):n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Poll interval (ms)"}),n.jsx("input",{type:"number",min:100,step:100,value:p.pollIntervalMs,onChange:C=>Ue("polling","pollIntervalMs",Math.min(1e4,Math.max(100,Number(C.target.value)||500)))})]}),n.jsxs("label",{className:"sim-shell__control-checkbox",children:[n.jsx("input",{type:"checkbox",checked:p.includeSoftDeletes,onChange:C=>Ue("polling","includeSoftDeletes",C.target.checked)}),n.jsx("span",{children:"Include soft delete marker column"})]})]},s)}if(s==="trigger"){const p=Q.trigger;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":i?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:R[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Tune audit extractor cadence and per-write trigger overhead."}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Extractor interval (ms)"}),n.jsx("input",{type:"number",min:100,step:50,value:p.extractIntervalMs,onChange:C=>Ue("trigger","extractIntervalMs",Math.max(50,Number(C.target.value)||0))})]}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Trigger overhead (ms)"}),n.jsx("input",{type:"number",min:0,step:1,value:p.triggerOverheadMs,onChange:C=>Ue("trigger","triggerOverheadMs",Math.max(0,Number(C.target.value)||0))})]})]},s)}const c=Q.log;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":i?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:R[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Control how frequently the WAL/Binlog fetcher polls for new records."}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Fetch interval (ms)"}),n.jsx("input",{type:"number",min:10,step:10,value:c.fetchIntervalMs,onChange:p=>Ue("log","fetchIntervalMs",Math.max(10,Number(p.target.value)||0))})]})]},s)})}),N&&n.jsxs("div",{className:"sim-shell__summary","aria-live":"polite",children:[n.jsxs("ul",{children:[n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":H.lagSpread,children:"Lag spread:"})," ",R[N.bestLag.method].label," is leading at",` ${N.bestLag.metrics.lagMs.toFixed(0)}ms`,N.lagSpread>0?` — ${R[N.worstLag.method].label} trails by ${N.lagSpread.toFixed(0)}ms`:" (no spread)"]}),n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":H.deleteCapture,children:"Delete capture:"})," ",R[N.lowestDeletes.method].label," is lowest at",` ${N.lowestDeletes.metrics.deletesPct.toFixed(0)}%`," · best is ",R[N.highestDeletes.method].label,` (${N.highestDeletes.metrics.deletesPct.toFixed(0)}%)`]}),Ze&&n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":H.snapshot,children:"Snapshot rows:"})," ",Ze]}),N.triggerWriteAmplification&&n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":H.triggerOverhead,children:"Trigger overhead:"})," ",R[N.triggerWriteAmplification.method].label," is at"," ",`${(N.triggerWriteAmplification.metrics.writeAmplification??0).toFixed(1)}x`," write amplification"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Ordering:"}),N.orderingIssues.length===0?" All methods preserved ordering":` Issues: ${N.orderingIssues.map(s=>R[s].label).join(", ")}`]})]}),n.jsx("button",{type:"button",className:"sim-shell__summary-copy",onClick:Xn,children:be?"Copied":"Copy summary"})]}),ks.length>0&&n.jsxs("section",{className:"sim-shell__overlay-summary","aria-label":"Lane checks",children:[n.jsxs("header",{children:[n.jsx("h3",{children:"Lane checks"}),n.jsx("p",{children:"Quick glance at diff findings and lag hotspots across active capture methods."})]}),n.jsx("ul",{children:ks.map(s=>n.jsxs("li",{className:"sim-shell__overlay-row",children:[n.jsx("div",{className:"sim-shell__overlay-label",children:s.label}),n.jsx("div",{className:"sim-shell__overlay-chips",children:s.chips.map(i=>n.jsx("span",{className:`sim-shell__overlay-chip sim-shell__overlay-chip--${i.tone}`,children:i.text},`${s.method}-${i.key}`))}),s.hasDetails&&n.jsx("button",{type:"button",className:"sim-shell__overlay-action",onClick:()=>Zn(s.method),children:"Inspect"})]},s.method))})]}),js.length>0&&n.jsx(Oa,{lanes:js,renderSchemaWalkthrough:ea}),n.jsx("div",{className:"sim-shell__lane-grid","data-tour-target":"comparator-lanes",children:X.map(({method:s,metrics:i,events:c},p)=>{const C=R[s],S=C.laneDescription,w=Fe.get(s)??null,_=p===0,T=fe.get(s),O=xe.current[s],P=Ye.get(s),$=P?.rows.slice(0,ir)??[],B=(P?.rows.length??0)>$.length,J=$e&&P?{version:P.schemaVersion,expectedVersion:we,hasColumn:P.hasSchemaColumn,columnName:Ce.name}:$e?{version:0,expectedVersion:we,hasColumn:!1,columnName:Ce.name}:void 0,ue=s==="trigger"?T?.writeAmplification??i.writeAmplification??0:void 0,he=[],et=s==="polling"?"warning":"info";C.callout&&(s==="polling"&&i.deletesPct<100?he.push({text:`${C.callout} (${i.deletesPct.toFixed(0)}% of deletes captured in this scenario)`,tone:et}):he.push({text:C.callout,tone:et})),b.tags?.includes("schema")&&(s==="trigger"&&typeof ue=="number"&&ue>0&&he.push({text:`Write amplification ${ue.toFixed(1)}x (extra audit writes per change)`,tone:"info"}),s==="log"&&he.push({text:"Log capture streams schema changes in-order, keeping downstream versions aligned.",tone:"info"}),s==="polling"&&he.push({text:"Polling picks up new columns once refreshed rows include them; expect interim nulls.",tone:"warning"})),b.tags?.includes("transactions")&&he.push({text:ve?"Apply-on-commit groups transaction events before updating destinations so tables stay in sync.":"Apply-on-commit is off: events apply individually, so pausing mid-transaction shows partial state.",tone:ve?"info":"warning"});const ne=Cn.get(s)??c,Ts=ne.length!==c.length||Ne.length>0||bs.size<je.length,sa=Te&&ne.length>Jt,As=Te?ne.slice(Math.max(ne.length-Jt,0)):[];return n.jsxs("article",{className:"sim-shell__lane-card",children:[n.jsxs("header",{className:"sim-shell__lane-header",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"sim-shell__lane-title","data-tooltip":C.tooltip||void 0,children:C.label}),n.jsx("p",{className:"sim-shell__lane-copy",children:S})]}),n.jsxs("span",{className:"sim-shell__lane-count",children:[ne.length,Ts?` / ${c.length}`:""," events"]})]}),n.jsx("div",{className:"sim-shell__metrics","data-tour-target":_?"comparator-metrics":void 0,children:n.jsx(Na,{...i})}),n.jsx(Ha,{diff:w,scenarioName:b.name,laneId:s,schemaStatus:J}),lt&&n.jsxs("section",{className:"sim-shell__lane-bus","aria-label":`${C.label} event bus`,"data-paused":W?"true":"false",children:[n.jsxs("header",{children:[n.jsx("h4",{children:"Event Bus"}),n.jsx("span",{children:O?.topic??`cdc.${s}`})]}),n.jsxs("p",{children:[n.jsxs("span",{"data-tooltip":H.backlog,children:["Backlog ",n.jsx("strong",{children:T?.backlog??0}),W?" (apply paused)":""]})," · ",n.jsxs("span",{"data-tooltip":H.offset,children:["Last offset ",T?.lastOffset??-1]})]}),n.jsxs("p",{children:["Produced ",T?.produced??0," · Consumed ",T?.consumed??0]}),n.jsxs("p",{"data-tooltip":H.snapshot,children:["Snapshot rows ",T?.snapshotRows??0]}),n.jsxs("p",{"data-tooltip":H.lagPercentile,children:["Lag p50 ",Math.round(T?.lagMsP50??0),"ms · p95 ",Math.round(T?.lagMsP95??0),"ms"]}),s==="trigger"&&n.jsxs("p",{"data-tooltip":H.triggerWriteAmplification,children:["Write amplification: ",ue?.toFixed(1)??"0.0","x"]}),s==="polling"&&n.jsxs("p",{className:"sim-shell__lane-bus-warning","data-tooltip":H.deleteCapture,children:["Missed deletes: ",T?.missedDeletes??0]}),T&&T.errors>0&&n.jsxs("p",{className:"sim-shell__lane-bus-warning",children:["Errors: ",T.errors]})]}),P&&n.jsxs("section",{className:"sim-shell__destination","aria-label":`${C.label} destination snapshot`,children:[n.jsxs("header",{children:[n.jsxs("div",{className:"sim-shell__destination-title",children:[n.jsx("h4",{children:"Destination snapshot"}),n.jsxs("span",{children:["schema v",P.schemaVersion]})]}),n.jsx("div",{className:"sim-shell__destination-actions",children:n.jsx("button",{type:"button",className:"sim-shell__destination-download",onClick:()=>Un(s),disabled:P.rows.length===0,children:"Download JSON"})})]}),$.length>0?n.jsx("div",{className:"sim-shell__destination-table",role:"table",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsx("tr",{children:P.columns.map(U=>n.jsx("th",{"data-highlight":U===Ce.name?"true":void 0,children:U},U))})}),n.jsx("tbody",{children:$.map(U=>n.jsx("tr",{children:P.columns.map(Ee=>n.jsx("td",{children:ur(Ee==="id"?U.displayId:Ee==="table"?U.table:U.values[Ee])},`${U.id}-${Ee}`))},U.id))})]})}):n.jsx("p",{className:"sim-shell__destination-empty",children:"No rows applied yet."}),B&&n.jsxs("p",{className:"sim-shell__destination-note",children:["Showing ",$.length," of ",P.rows.length," rows."]})]}),n.jsxs("dl",{className:"sim-shell__lane-config",children:[s==="polling"&&(()=>{const U=Q.polling;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Poll interval"}),n.jsxs("dd",{"data-tooltip":H.pollingInterval,children:[U.pollIntervalMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Soft deletes"}),n.jsx("dd",{"data-tooltip":H.pollingSoftDeletes,children:U.includeSoftDeletes?"included":"ignored"})]})]})})(),s==="trigger"&&(()=>{const U=Q.trigger;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Extractor interval"}),n.jsxs("dd",{"data-tooltip":H.triggerExtractorInterval,children:[U.extractIntervalMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Trigger overhead"}),n.jsxs("dd",{"data-tooltip":H.triggerOverhead,children:[U.triggerOverheadMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Write amplification"}),n.jsxs("dd",{"data-tooltip":H.triggerWriteAmplification,children:[ue?.toFixed(1)??"0.0","x"]})]})]})})(),s==="log"&&(()=>{const U=Q.log;return n.jsxs("div",{children:[n.jsx("dt",{children:"Fetch interval"}),n.jsxs("dd",{"data-tooltip":H.logFetchInterval,children:[U.fetchIntervalMs," ms"]})]})})()]}),he.length>0&&n.jsx("div",{className:"sim-shell__callouts",children:he.map((U,Ee)=>n.jsx("p",{className:`sim-shell__callout${U.tone==="warning"?" sim-shell__callout--warning":""}`,"data-tour-target":_&&Ee===0?"comparator-callouts":void 0,children:U.text},`${s}-callout-${Ee}`))}),n.jsxs("section",{className:"sim-shell__lane-why","aria-label":`When to use ${C.label}`,children:[n.jsx("h4",{children:"When to use"}),n.jsx("p",{children:C.whenToUse})]}),Te?n.jsxs("ul",{className:"sim-shell__event-list","aria-live":"polite",children:[sa&&n.jsx("li",{className:"sim-shell__event sim-shell__event--notice",children:n.jsxs("span",{children:["Showing latest ",Jt," of ",ne.length," matching events."]})}),As.length===0?n.jsx("li",{className:"sim-shell__empty",children:Ts?"No events match the current filters.":"No events yet."}):As.map(U=>n.jsxs("li",{className:`sim-shell__event${U.op==="d"?" sim-shell__event--delete":""}`,children:[n.jsx("span",{className:"sim-shell__event-op","data-op":U.op,children:U.op}),n.jsxs("span",{children:["#",U.seq," · pk=",U.pk.id]}),n.jsxs("span",{className:"sim-shell__event-target",children:["ts=",U.ts_ms,"ms"]})]},`${s}-${U.seq}`))]}):n.jsx("p",{className:"sim-shell__lane-hidden",children:"Timeline hidden. Use “Show timeline” to view recent events."})]},s)})}),n.jsxs("footer",{className:"sim-shell__footer",children:["Scenario clock: ",z,"ms · ",X.reduce((s,i)=>s+i.events.length,0)," total events emitted"]})]})}function an(){const t=document.getElementById("simShellRoot");if(!t){console.warn("Simulator UI shell mount point not found (simShellRoot).");return}aa.createRoot(t).render(n.jsx(_r,{}))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",an,{once:!0}):an();
