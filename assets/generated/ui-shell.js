import{r as c,j as n,T as Vn,S as Br,R as qr}from"./event-log-widget.js";class Wr{constructor(){this.topics=new Map}publish(t,r){if(r.length===0)return[];const o=this.ensure(t);return r.map(i=>{const u=++o.offset,m={...i,offset:u};return o.queue.push(m),m})}consume(t,r=1){const o=this.ensure(t);return r<=0?[]:o.queue.splice(0,r)}size(t){return this.ensure(t).queue.length}reset(t){if(t){this.topics.delete(t);return}this.topics.clear()}ensure(t){let r=this.topics.get(t);return r||(r={offset:-1,queue:[]},this.topics.set(t,r)),r}}class Vr{constructor(){this.produced=0,this.consumed=0,this.backlog=0,this.lagSamples=[],this.missedDeletes=0,this.writeAmplification=0,this.triggerWrites=0,this.sourceWrites=0,this.snapshotRows=0,this.errors=0,this.lagAggregators=new Set}onProduced(t){this.produced+=t.length,this.backlog+=t.length}onConsumed(t){this.consumed+=t.length,this.backlog=Math.max(this.backlog-t.length,0);const r=Date.now();t.forEach(o=>{const i=typeof o.commitTs=="number"?o.commitTs:typeof o.ts_ms=="number"?o.ts_ms:r,u=Math.max(r-i,0);this.lagSamples.push(u)}),this.lagSamples.length>2e3&&this.lagSamples.splice(0,this.lagSamples.length-2e3),this.notifyLagAggregators()}registerLagAggregator(t){return this.lagAggregators.add(t),this.safeInvokeAggregator(t),()=>{this.lagAggregators.delete(t)}}recordMissedDelete(t=1){this.missedDeletes+=t}recordWriteAmplification(t=1,r=1){Number.isFinite(t)&&t>0&&(this.triggerWrites+=t),Number.isFinite(r)&&r>0&&(this.sourceWrites+=r),this.sourceWrites>0?this.writeAmplification=(this.sourceWrites+this.triggerWrites)/this.sourceWrites:this.writeAmplification=0}recordSnapshotRows(t){this.snapshotRows=t}recordError(){this.errors+=1}reset(){this.produced=0,this.consumed=0,this.backlog=0,this.lagSamples=[],this.missedDeletes=0,this.writeAmplification=0,this.triggerWrites=0,this.sourceWrites=0,this.snapshotRows=0,this.errors=0,this.notifyLagAggregators()}snapshot(){const t=[...this.lagSamples].sort((i,u)=>i-u),r=this.percentile(t,.5),o=this.percentile(t,.95);return{produced:this.produced,consumed:this.consumed,backlog:this.backlog,lagMsP50:r,lagMsP95:o,missedDeletes:this.missedDeletes,writeAmplification:this.writeAmplification,snapshotRows:this.snapshotRows,errors:this.errors}}safeInvokeAggregator(t,r){try{const o=r?[...r]:[...this.lagSamples];t(o)}catch{}}notifyLagAggregators(){if(this.lagAggregators.size===0)return;const t=[...this.lagSamples];this.lagAggregators.forEach(r=>{this.safeInvokeAggregator(r,t)})}percentile(t,r){if(!t.length)return 0;const o=Math.max(t.length-1,0)*r,i=Math.floor(o),u=Math.min(i+1,t.length-1);if(i===u)return t[i];const m=o-i;return t[i]+(t[u]-t[i])*m}}class Gr{constructor(){this.tasks=new Map,this.nextId=1}every(t,r){const o=this.nextId++,i={id:o,interval:t,handler:r};this.tasks.set(o,i);const u=setInterval(()=>r(),t);return i.timerId=u,o}clear(t){if(t!=null){const r=this.tasks.get(t);r&&r.timerId&&clearInterval(r.timerId),this.tasks.delete(t);return}this.tasks.forEach(r=>{const o=r.timerId;o&&clearInterval(o)}),this.tasks.clear()}}class Hr{constructor(t,r,o,i,u,m={}){this.mode=t,this.bus=r,this.scheduler=o,this.metrics=i,this.handlers=m,this.state="IDLE",this.topic=u??`cdc.${t.toLowerCase()}`}get currentState(){return this.state}get topicName(){return this.topic}startSnapshot(t){this.state==="IDLE"&&(this.state="SNAPSHOTTING",this.handlers.startSnapshot?.(t,r=>this.emit(r)))}startTailing(){this.state!=="TAILING"&&(this.state="TAILING",this.handlers.startTailing?.(t=>this.emit(t)))}pause(){this.state==="TAILING"&&(this.state="PAUSED")}resume(){this.state==="PAUSED"&&(this.state="TAILING")}stop(){this.state="IDLE",this.scheduler.clear(),this.handlers.stop?.(),this.bus.reset(this.topic),this.metrics.reset()}emit(t){if(t.length===0)return[];const r=this.bus.publish(this.topic,t);return this.metrics.onProduced(r),r}}let zr=0;const ks=()=>`evt-${Date.now()}-${++zr}`,Gt=e=>e?JSON.parse(JSON.stringify(e)):null,hn=(e,t)=>`${e}::${t}`,pn=(e,t)=>({id:e.name,type:e.type,nullable:e.nullable??!1,__ts:t}),mn=(e,t,r=`tx-${t}`)=>{const o=e?.id??r,i=typeof e?.index=="number",u=i?e.index:void 0,m=typeof e?.total=="number"?e.total:void 0;let g;return typeof e?.last=="boolean"?g=e.last:i&&typeof m=="number"?g=u>=m-1:g=!e,{id:o,index:u,total:m,last:g}};function Qr(){let e=null,t=null,r=100,o=0;const i=new Map,u=[];let m=0;const g=new Map,M=x=>{const L=g.get(x);return typeof L=="number"&&L>=1?L:(g.set(x,1),1)},C=x=>{const L=M(x),d=L+1;return g.set(x,d),{previous:L,next:d}},T=(x,L,d,h,p)=>{const v=mn(x.txn,p);return{id:ks(),kind:L,table:x.table,before:d?{id:x.pk.id,...d,__ts:p}:void 0,after:h?{id:x.pk.id,...h,__ts:p}:void 0,txnId:v.id,txnIndex:v.index,txnTotal:v.total,txnLast:v.last,commitTs:p,schemaVersion:M(x.table),topic:e?.topic??`cdc.${x.table}`,partition:0}},_=(x,L,d,h)=>{if(!t||!e)return;const{previous:p,next:v}=C(x),k=mn(void 0,h,`schema-${h}`),A={id:ks(),kind:L==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:x,before:L==="DROP_COLUMN"?pn(d,h):void 0,after:L==="ADD_COLUMN"?pn(d,h):void 0,txnId:k.id,txnIndex:k.index,txnTotal:k.total,txnLast:k.last,commitTs:h,schemaVersion:v,topic:e.topic??`cdc.${x}`,partition:0,schemaChange:{action:L,column:d,previousVersion:p,nextVersion:v}};t([A])};return{id:"LOG_BASED",initialise(x){e=x},configure(x){const L=Number(x.fetch_interval_ms??x.fetchIntervalMs);Number.isFinite(L)&&L>0&&(r=L)},startSnapshot(x=[],L){if(t=L,!x.length||(x.forEach(h=>{const p=h.schema?.version??1;g.set(h.name,p),h.rows.forEach(v=>{const k=hn(h.name,v.id);i.set(k,{id:v.id,table:h.name,data:{...v},version:1,updatedAt:v.__ts??0,deleted:!1})})}),e?.metrics.recordSnapshotRows(i.size),!i.size))return;const d=[];i.forEach(h=>{d.push({id:ks(),kind:"INSERT",table:h.table,before:void 0,after:{id:h.id,...h.data,__ts:h.updatedAt},txnId:`snapshot-${h.updatedAt}`,txnIndex:0,txnTotal:1,txnLast:!0,commitTs:h.updatedAt,schemaVersion:M(h.table),topic:e?.topic??`cdc.${h.table}`,partition:0})}),t(d),m=u.length},startTailing(x){t=x},applySource(x){if(!e)return;const L=x.t,d=hn(x.table,x.pk.id);if(M(x.table),x.op==="insert")i.set(d,{id:x.pk.id,table:x.table,data:{...x.after},version:1,updatedAt:L,deleted:!1}),u.push(T(x,"INSERT",null,Gt(x.after),L));else if(x.op==="update"){const h=i.get(d),p=h?Gt(h.data):null,v=h?{...h.data,...x.after}:{...x.after};i.set(d,{id:x.pk.id,table:x.table,data:v,version:(h?.version??0)+1,updatedAt:L,deleted:!1}),u.push(T(x,"UPDATE",p,Gt(v),L))}else if(x.op==="delete"){const h=i.get(d);i.set(d,{id:x.pk.id,table:x.table,data:h?{...h.data}:{},version:(h?.version??0)+1,updatedAt:L,deleted:!0}),u.push(T(x,"DELETE",h?Gt(h.data):null,null,L))}},applySchemaChange(x,L,d,h){e&&(M(x),L==="ADD_COLUMN"?i.forEach((p,v)=>{p.table===x&&(d.name in p.data||(p.data[d.name]=null,i.set(v,{...p,data:{...p.data}})))}):L==="DROP_COLUMN"&&i.forEach((p,v)=>{if(p.table===x&&d.name in p.data){const k={...p.data};delete k[d.name],i.set(v,{...p,data:k})}}),_(x,L,d,h))},tick(x){if(!t||x-o<r)return;const L=u.slice(m);L.length&&(t(L),m=u.length),o=x},pause(){},resume(){},stop(){i.clear(),u.length=0,m=0,t=null,e=null,g.clear(),o=0}}}let Kr=0;const Ms=()=>`evt-${Date.now()}-${++Kr}`,fn=e=>e?JSON.parse(JSON.stringify(e)):null,gn=(e,t)=>`${e}::${t}`,bn=(e,t)=>({id:e.name,type:e.type,nullable:e.nullable??!1,__ts:t}),xn=(e,t,r=`tx-${t}`)=>{const o=e?.id??r,u=!1?e.index:void 0,m=void 0;let g;return g=!0,{id:o,index:u,total:m,last:g}};function Jr(){let e=null,t=null,r=1e3,o=!1,i=0;const u=new Map,m=new Map,g=new Map,M=[],C=d=>{const h=g.get(d);return typeof h=="number"&&h>=1?h:(g.set(d,1),1)},T=d=>{const h=C(d),p=h+1;return g.set(d,p),{previous:h,next:p}},_=(d,h,p,v,k,A,O,z)=>{const B=xn(z,A,O);return{id:Ms(),kind:p,table:d,before:v?{id:h,...v,__ts:A}:void 0,after:k?{id:h,...k,__ts:A}:void 0,txnId:B.id,txnIndex:B.index,txnTotal:B.total,txnLast:B.last,commitTs:A,schemaVersion:C(d),topic:e?.topic??`cdc.${d}`,partition:0}},x=(d,h,p,v)=>{const{previous:k,next:A}=T(d),O=xn(void 0,v,`schema-${v}`);M.push({id:Ms(),kind:h==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:d,before:h==="DROP_COLUMN"?bn(p,v):void 0,after:h==="ADD_COLUMN"?bn(p,v):void 0,txnId:O.id,txnIndex:O.index,txnTotal:O.total,txnLast:O.last,commitTs:v,schemaVersion:A,topic:e?.topic??`cdc.${d}`,partition:0,schemaChange:{action:h,column:p,previousVersion:k,nextVersion:A}})},L=d=>{!d.length||!t||t(d)};return{id:"QUERY_BASED",initialise(d){e=d},configure(d){const h=Number(d.poll_interval_ms??d.pollIntervalMs);Number.isFinite(h)&&h>0&&(r=h),d.include_soft_deletes!=null&&(o=!!d.include_soft_deletes),d.includeSoftDeletes!=null&&(o=!!d.includeSoftDeletes)},startSnapshot(d=[],h){t=h;const p=[];d.forEach(v=>{const k=v.schema?.version??1;g.set(v.name,k),v.rows.forEach(A=>{const O=gn(v.name,A.id);u.set(O,{id:A.id,table:v.name,data:{...A},version:1,updatedAt:A.__ts??0,deleted:!1}),m.set(O,1);const{id:z,__ts:B,...Oe}=A;p.push({id:Ms(),kind:"INSERT",table:v.name,before:void 0,after:{id:z,...Oe,__ts:B??0},txnId:`snapshot-${A.__ts??0}`,txnIndex:0,txnTotal:1,txnLast:!0,commitTs:A.__ts??0,schemaVersion:C(v.name),topic:e?.topic??`cdc.${v.name}`,partition:0})})}),e?.metrics.recordSnapshotRows(p.length),L(p)},startTailing(d){t=d},applySource(d){const h=gn(d.table,d.pk.id),p=d.t;if(C(d.table),d.op==="insert")u.set(h,{id:d.pk.id,table:d.table,data:{...d.after},version:1,updatedAt:p,deleted:!1});else if(d.op==="update"){const v=u.get(h),k=v?{...v.data,...d.after}:{...d.after};u.set(h,{id:d.pk.id,table:d.table,data:k,version:(v?.version??0)+1,updatedAt:p,deleted:!1})}else if(d.op==="delete"){const v=u.get(h);u.set(h,{id:d.pk.id,table:d.table,data:v?{...v.data}:{},version:(v?.version??0)+1,updatedAt:p,deleted:!0})}},applySchemaChange(d,h,p,v){C(d),h==="ADD_COLUMN"?u.forEach((k,A)=>{if(k.table!==d||Object.prototype.hasOwnProperty.call(k.data,p.name))return;const O={...k.data,[p.name]:null};u.set(A,{...k,data:O})}):h==="DROP_COLUMN"&&u.forEach((k,A)=>{if(k.table===d&&p.name in k.data){const O={...k.data};delete O[p.name],u.set(A,{...k,data:O})}}),x(d,h,p,v)},tick(d){if(!t||d-i<r)return;const h=[];M.length&&h.push(...M.splice(0,M.length)),u.forEach((p,v)=>{if(p.updatedAt<=i)return;const k=m.get(v)??0;if(p.deleted){o?(h.push(_(p.table,p.id,"DELETE",fn(p.data),null,p.updatedAt,`tx-${p.updatedAt}`)),m.set(v,p.version)):(e?.metrics.recordMissedDelete(),m.set(v,p.version));return}if(p.version<=k)return;const A=k===0?"INSERT":"UPDATE";h.push(_(p.table,p.id,A,null,fn(p.data),p.updatedAt,`tx-${p.updatedAt}`)),m.set(v,p.version)}),L(h),i=d},stop(){u.clear(),m.clear(),g.clear(),M.length=0,t=null,e=null,i=0}}}let Yr=0;const yn=()=>`evt-${Date.now()}-${++Yr}`,Ht=e=>e?JSON.parse(JSON.stringify(e)):null,Xr=(e,t)=>`${e}::${t}`,vn=(e,t)=>({id:e.name,type:e.type,nullable:e.nullable??!1,__ts:t}),_n=(e,t,r=`tx-${t}`)=>{const o=e?.id??r,i=typeof e?.index=="number",u=i?e.index:void 0,m=typeof e?.total=="number"?e.total:void 0;let g;return typeof e?.last=="boolean"?g=e.last:i&&typeof m=="number"?g=u>=m-1:g=!e,{id:o,index:u,total:m,last:g}};function Zr(){let e=null,t=null,r=250,o=8,i=0,u=0;const m=new Map,g=[],M=new Map,C=d=>{const h=M.get(d);return typeof h=="number"&&h>=1?h:(M.set(d,1),1)},T=d=>{const h=C(d),p=h+1;return M.set(d,p),{previous:h,next:p}},_=(d,h,p,v,k)=>{const A=_n(d.txn,k);return{id:yn(),kind:h,table:d.table,before:p?{id:d.pk.id,...p,__ts:k}:void 0,after:v?{id:d.pk.id,...v,__ts:k}:void 0,txnId:A.id,txnIndex:A.index,txnTotal:A.total,txnLast:A.last,commitTs:k,schemaVersion:C(d.table),topic:e?.topic??`cdc.${d.table}`,partition:0}},x=(d,h,p,v)=>{const{previous:k,next:A}=T(d),O=_n(void 0,v,`schema-${v}`),z={id:yn(),kind:h==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:d,before:h==="DROP_COLUMN"?vn(p,v):void 0,after:h==="ADD_COLUMN"?vn(p,v):void 0,txnId:O.id,txnIndex:O.index,txnTotal:O.total,txnLast:O.last,commitTs:v,schemaVersion:A,topic:e?.topic??`cdc.${d}`,partition:0,schemaChange:{action:h,column:p,previousVersion:k,nextVersion:A}};g.push({event:z})},L=d=>{!d.length||!t||t(d)};return{id:"TRIGGER_BASED",initialise(d){e=d},configure(d){const h=Number(d.extract_interval_ms??d.extractIntervalMs);Number.isFinite(h)&&h>0&&(r=h);const p=Number(d.trigger_overhead_ms??d.triggerOverheadMs);Number.isFinite(p)&&p>=0&&(o=p)},startSnapshot(d=[],h){t=h,e?.metrics.recordSnapshotRows(0)},startTailing(d){t=d},applySource(d){if(!e)return;const h=Xr(d.table,d.pk.id),p=d.t+o;let v=null,k=null,A;if(C(d.table),d.op==="insert")A="INSERT",k=Ht(d.after),m.set(h,{id:d.pk.id,table:d.table,data:{...d.after},version:1,updatedAt:p,deleted:!1});else if(d.op==="update"){const O=m.get(h);v=O?Ht(O.data):null;const z=O?{...O.data,...d.after}:{...d.after};k=Ht(z),A="UPDATE",m.set(h,{id:d.pk.id,table:d.table,data:z,version:(O?.version??0)+1,updatedAt:p,deleted:!1})}else if(d.op==="delete"){const O=m.get(h);v=O?Ht(O.data):null,k=null,A="DELETE",m.set(h,{id:d.pk.id,table:d.table,data:O?{...O.data}:{},version:(O?.version??0)+1,updatedAt:p,deleted:!0})}else return;g.push({event:_(d,A,v,k,p)}),e.metrics.recordWriteAmplification(1)},applySchemaChange(d,h,p,v){if(!e)return;const k=v+o;C(d),h==="ADD_COLUMN"?m.forEach((A,O)=>{if(A.table===d&&!(p.name in A.data)){const z={...A.data,[p.name]:null};m.set(O,{...A,data:z,version:A.version+1,updatedAt:k})}}):h==="DROP_COLUMN"&&m.forEach((A,O)=>{if(A.table===d&&p.name in A.data){const z={...A.data};delete z[p.name],m.set(O,{...A,data:z,version:A.version+1,updatedAt:k})}}),x(d,h,p,k)},tick(d){if(!t||d-i<r)return;const h=g.slice(u).map(p=>p.event);L(h),u=g.length,i=d},stop(){g.length=0,m.clear(),t=null,e=null,u=0,i=0,M.clear()}}}const Zt={MYSQL_DEBEZIUM:{id:"MYSQL_DEBEZIUM",label:"MySQL · Debezium · Kafka",description:"Debezium tails the MySQL binlog and pushes commits to Kafka for downstream consumers.",docsHint:"https://debezium.io/documentation/reference/stable/connectors/mysql.html",sourceLabel:"MySQL primary",sourceTooltip:"InnoDB workload emitting row-level changes for capture.",logLabel:"MySQL binlog (Debezium)",logTooltip:"Debezium connector streams row-format binlog entries in commit order.",busLabel:"Kafka topic",busTooltip:"Kafka transports Debezium change events (e.g. db.orders) to consumers.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Analytics warehouse, service, or cache subscribing to the Kafka topic.",topicFormat:e=>`db.${e}`,methodCopyOverrides:{polling:{label:"Polling (scheduled SQL)",laneDescription:"Batch jobs diff the MySQL table on an interval to detect divergence.",callout:"Misses hard deletes and rapid updates without custom tracking tables.",whenToUse:"Fallback when binlog access is blocked. Accepts lag and data loss for small tables only.",tooltip:"ETL-style SELECT polling against the MySQL primary."},trigger:{label:"Triggers (audit table)",laneDescription:"AFTER triggers write every mutation into an audit table for downstream extract.",callout:"Adds synchronous latency on the write path and increases operational overhead.",whenToUse:"When connectors are unavailable but you still need complete change history.",tooltip:"MySQL triggers populate audit tables that an extractor drains."},log:{label:"Debezium binlog tail",laneDescription:"Debezium streams row-based binlog events into Kafka with schema evolution support.",callout:"Preferred default: low-impact, ordered, near real-time change capture.",whenToUse:"Standard choice for production MySQL workloads when Kafka + Debezium are available.",tooltip:"Debezium connector tailing the MySQL binlog."}}},POSTGRES_LOGICAL:{id:"POSTGRES_LOGICAL",label:"Postgres · Logical decoding · Kafka",description:"Logical decoding streams Postgres WAL changes (pgoutput/wal2json) into Kafka.",docsHint:"https://www.postgresql.org/docs/current/logicaldecoding.html",sourceLabel:"Postgres primary",sourceTooltip:"OLTP Postgres emitting WAL entries for publications.",logLabel:"Logical replication slot",logTooltip:"Logical decoding slot materialises committed WAL changes via pgoutput or wal2json.",busLabel:"Kafka topic",busTooltip:"Kafka topics per publication (e.g. public.orders) fan out change events.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Consumers applying logical changes into warehouses or services.",topicFormat:e=>`public.${e}`,methodCopyOverrides:{polling:{label:"Polling (snapshot queries)",laneDescription:"Incremental SELECT queries compare current rows to previous snapshots.",callout:"Can't observe deletes or mid-transaction updates without tombstone columns.",whenToUse:"Stopgap for small tables when logical replication isn't permitted.",tooltip:"Periodic comparison queries against Postgres source tables."},trigger:{label:"Triggers (audit schema)",laneDescription:"Triggers populate audit tables that an extractor tails outside the WAL.",callout:"Higher write amplification and maintenance across replicas.",whenToUse:"When WAL access is off-limits yet complete history is required.",tooltip:"AFTER triggers write into audit tables for downstream capture."},log:{label:"Logical decoding stream",laneDescription:"Slot-based logical decoding streams ordered WAL changes through Kafka.",callout:"Best balance: ordered, low-impact capture with schema evolution support.",whenToUse:"Primary choice when you can run wal2json/pgoutput connectors.",tooltip:"Logical replication slot feeding Kafka via connectors."}}},SQLSERVER_CDC:{id:"SQLSERVER_CDC",label:"SQL Server · CDC tables · ETL",description:"SQL Server CDC populates change tables that ETL tools ship downstream.",docsHint:"https://learn.microsoft.com/sql/relational-databases/track-changes/about-change-data-capture-sql-server",sourceLabel:"SQL Server OLTP",sourceTooltip:"Source database with CDC enabled on tracked tables.",logLabel:"CDC change tables",logTooltip:"Log reader agent populates [cdc].[schema_table_CT] from the transaction log.",busLabel:"ETL pipeline",busTooltip:"ADF/SSIS or similar ETL pipelines move captured rows to consumers.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Lakehouse, staging DB, or microservice applying captured rows.",topicFormat:e=>`cdc.${e}_ct`,methodCopyOverrides:{polling:{label:"Polling (T-SQL jobs)",laneDescription:"Scheduled queries compare source tables against a shadow copy.",callout:"Hard deletes vanish and rapid updates collapse to last-write wins.",whenToUse:"Only when CDC can't be enabled. Expect drift and operational overhead.",tooltip:"Agent jobs issuing SELECT deltas against the primary."},trigger:{label:"DB triggers (audit tables)",laneDescription:"DDL-driven triggers write into audit tables that ETL picks up.",callout:"Adds synchronous writes and complicates deployments.",whenToUse:"Fallback for editions without CDC but needing full fidelity.",tooltip:"FOR INSERT/UPDATE/DELETE triggers persisting rows into audit tables."},log:{label:"CDC change table stream",laneDescription:"Native CDC surfaces ordered change rows ready for downstream ETL.",callout:"Balanced approach: leverages log reader agent with minimal code.",whenToUse:"Default when SQL Server Enterprise/Standard CDC is available.",tooltip:"Change Data Capture tables populated by the log reader agent."}}},ORACLE_GG:{id:"ORACLE_GG",label:"Oracle · GoldenGate",description:"GoldenGate extracts Oracle redo into trails that replicat apply downstream.",docsHint:"https://docs.oracle.com/en/middleware/goldengate/",sourceLabel:"Oracle primary",sourceTooltip:"Oracle Database generating redo entries for tracked schemas.",logLabel:"Redo / GoldenGate trail",logTooltip:"Extract captures redo logs into GoldenGate trail files.",busLabel:"GoldenGate distribution",busTooltip:"GoldenGate distribution path replicates changes to targets or Kafka.",destinationLabel:"Replica / downstream sink",destinationTooltip:"Target database, cache, or Kafka topic consuming GoldenGate trails.",topicFormat:e=>`ogg.${e}`,methodCopyOverrides:{polling:{label:"Polling (custom jobs)",laneDescription:"Scripts query Oracle tables for deltas outside of GoldenGate.",callout:"Expensive and incomplete without change tracking columns.",whenToUse:"Rare stopgap for small tables when GoldenGate access is unavailable.",tooltip:"Ad-hoc jobs diffing source tables over DB links or snapshots."},trigger:{label:"Triggers (shadow tables)",laneDescription:"Row-level triggers populate shadow tables for downstream capture.",callout:"Adds redo volume and requires meticulous deployment management.",whenToUse:"Fallback when GoldenGate licensing or access is restricted.",tooltip:"Oracle triggers mirroring mutations into custom staging tables."},log:{label:"GoldenGate redo tail",laneDescription:"GoldenGate Extract/Replicat stream redo into ordered trail files.",callout:"Enterprise-grade: minimal source impact with robust replication semantics.",whenToUse:"Primary approach for Oracle sources requiring guaranteed replication.",tooltip:"GoldenGate Extract reading redo logs into trail files."}}},MONGODB_STREAMS:{id:"MONGODB_STREAMS",label:"MongoDB · Change Streams",description:"Change Streams tail the MongoDB oplog and push updates to subscribers.",docsHint:"https://www.mongodb.com/docs/manual/changeStreams/",sourceLabel:"MongoDB replica set",sourceTooltip:"Replica set primary emitting operations into the oplog.",logLabel:"Change stream (oplog)",logTooltip:"Change Stream cursor streams oplog events filtered per namespace.",busLabel:"Driver subscriber",busTooltip:"Driver / connector pushes stream events to downstream sinks (Kafka/Atlas).",destinationLabel:"Streaming sink",destinationTooltip:"Analytical store or service consuming the stream.",topicFormat:e=>`mongo.${e}`,methodCopyOverrides:{polling:{label:"Polling (find queries)",laneDescription:"Scheduled queries diff collections by last-updated timestamps.",callout:"No delete visibility and heavy load for high-churn collections.",whenToUse:"Only for prototypes without Change Stream or oplog access.",tooltip:"find() queries scanning for updated documents on an interval."},trigger:{label:"Hooks (side-write)",laneDescription:"Application-layer hooks write audit documents alongside originals.",callout:"Requires app changes and doubles write throughput.",whenToUse:"When database triggers/log access is unavailable and app control exists.",tooltip:"Custom middleware duplicating writes into audit collections."},log:{label:"Change Stream tail",laneDescription:"Native Change Stream cursor fans out oplog events in order.",callout:"Recommended: low-latency stream with resume tokens and schema support.",whenToUse:"Default for MongoDB replicas when you can open a Change Stream cursor.",tooltip:"MongoDB Change Stream subscription on the oplog."}}}},es="cdc_playground_template_filter_v1",ts="cdc_playground_template_filter_tags_v1",rs={query:"",tags:[]},eo=e=>typeof e=="string"?e:"",Gn=e=>{if(!Array.isArray(e))return[];const t=new Set,r=[];return e.forEach(o=>{if(o==null)return;const i=String(o).trim();!i||t.has(i)||(t.add(i),r.push(i))}),r},Ds=e=>{if(!e||typeof e!="object")return{...rs};const t=eo(typeof e.query=="string"?e.query:""),r=e.tags;if(Array.isArray(r))return{query:t,tags:Gn(r)};if(typeof r=="string"){const o=r.trim();return{query:t,tags:o?[o]:[]}}return{query:t,tags:[]}},to=(e,t)=>{if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(e[r]!==t[r])return!1;return!0},so=e=>typeof e!="string"?"":e,no=e=>{if(typeof e!="string"||e.trim().length===0)return[];try{const t=JSON.parse(e);if(Array.isArray(t))return Gn(t)}catch{}return[]},ro=e=>{if(!e)return{...rs};try{const t=so(e.getItem(es)),r=no(e.getItem(ts));return{query:t,tags:r}}catch{return{...rs}}},oo=(e,t)=>{if(!t)return;const r=Ds(e);try{r.query?t.setItem(es,r.query):typeof t.removeItem=="function"?t.removeItem(es):t.setItem(es,"")}catch{}try{r.tags.length>0?t.setItem(ts,JSON.stringify(r.tags)):typeof t.removeItem=="function"?t.removeItem(ts):t.setItem(ts,"")}catch{}},ao=e=>typeof e=="string"?e.trim().toLowerCase():"",wn=e=>Array.isArray(e)?e.map(t=>typeof t=="string"?t.trim():"").filter(t=>t.length>0):[],io=e=>{const t=[];return e.label&&t.push(e.label),e.description&&t.push(e.description),e.highlight&&t.push(e.highlight),e.name&&t.push(e.name),Array.isArray(e.tags)&&e.tags.length>0&&t.push(e.tags.join(" ")),t.join(" ").toLowerCase()};function lo(e,t={}){const r=Array.from(e),{liveScenario:o,liveScenarioName:i,tags:u,query:m}=t;if(o){const T=r.findIndex(_=>_.name===o.name);T>=0?r.splice(T,1,o):r.unshift(o)}const g=wn(u),C=ao(m).split(/\s+/).map(T=>T.trim()).filter(T=>T.length>0);return r.filter(T=>{if(i&&T.name===i)return!0;if(g.length>0){const x=wn(T.tags??[]);if(!g.every(d=>x.includes(d)))return!1}if(C.length===0)return!0;const _=io(T);return _?C.every(x=>_.includes(x)):!1})}const Ts=(e,t)=>{Array.isArray(t)&&t.forEach(r=>{if(typeof r!="string")return;const o=r.trim();o.length>0&&e.add(o)})};function co(e,t={}){const r=new Set;return e.forEach(o=>Ts(r,o.tags)),t.liveScenario&&Ts(r,t.liveScenario.tags),t.additionalTags?.forEach(o=>Ts(r,o)),Array.from(r).sort((o,i)=>o.localeCompare(i))}const $s=e=>{if(Array.isArray(e))return e.map(t=>$s(t));if(e&&typeof e=="object"){const t={};return Object.entries(e).forEach(([r,o])=>{t[r]=$s(o)}),t}return e},ss=e=>$s(e),Hn=e=>({...e}),Sn=e=>({name:e.name,version:e.version,columns:e.columns.map(Hn)}),uo=(e,t)=>typeof t=="boolean"?"bool":typeof t=="number"?/_ts$|timestamp$/i.test(e)?"timestamp":"number":t instanceof Date?"timestamp":"string",ho=(e,t=1)=>({name:e,version:t,columns:[{name:"id",type:"string",nullable:!1}]}),En=e=>{e.columns.some(r=>r.name==="id")||e.columns.unshift({name:"id",type:"string",nullable:!1})},Cn=e=>{const t=ss(e);return t.id=String(t.id),t};class As{constructor(t=[]){this.tables=new Map,t.forEach(r=>this.upsertTable(r))}upsertTable(t){const r=Sn(t.schema);En(r);const o=new Map;t.rows.forEach(i=>{const u=Cn(ss(i));o.set(u.id,u)}),this.tables.set(t.name,{schema:r,rows:o})}replaceAll(t){this.tables.clear(),t.forEach(r=>this.upsertTable(r))}getTable(t){const r=this.tables.get(t);if(r)return{name:t,schema:Sn(r.schema),rows:Array.from(r.rows.values()).map(o=>ss(o))}}listTables(){return Array.from(this.tables.keys()).map(t=>this.getTable(t)).filter(t=>!!t)}clear(){this.tables.clear()}applyEvents(t){t.forEach(r=>this.applyEvent(r))}applyEvent(t){if(!t?.table)return;if(t.kind==="SCHEMA_ADD_COL"||t.kind==="SCHEMA_DROP_COL"){this.applySchemaChange(t);return}const r=this.ensureTableState(t.table,t.schemaVersion);if(t.schemaVersion&&t.schemaVersion>r.schema.version&&(r.schema.version=t.schemaVersion),t.kind==="DELETE"){const M=t.before?.id??t.after?.id;M!=null&&r.rows.delete(String(M));return}const o=t.after??void 0;if(!o)return;const i=Cn(o),u=r.rows.get(i.id),m=u?{...u,...i}:i,g=ss(m);this.syncSchemaColumns(r,g),r.rows.set(g.id,g)}snapshot(){return this.listTables()}ensureTableState(t,r){let o=this.tables.get(t);return o||(o={schema:ho(t,r??1),rows:new Map},this.tables.set(t,o)),r&&r>o.schema.version&&(o.schema.version=r),En(o.schema),o}applySchemaChange(t){const r=t.schemaChange;if(!r)return;const o=this.ensureTableState(t.table,r.nextVersion??t.schemaVersion);o.schema.version=Math.max(o.schema.version,r.nextVersion??t.schemaVersion??o.schema.version),t.kind==="SCHEMA_ADD_COL"?this.addColumn(o,r.column):t.kind==="SCHEMA_DROP_COL"&&this.dropColumn(o,r.column.name)}addColumn(t,r){const o=t.schema.columns.find(i=>i.name===r.name);o?(o.type=r.type,r.nullable&&(o.nullable=!0)):t.schema.columns.push(Hn(r)),t.rows.forEach(i=>{r.name in i||(i[r.name]=null)})}dropColumn(t,r){r!=="id"&&(t.schema.columns=t.schema.columns.filter(o=>o.name!==r),t.rows.forEach(o=>{r in o&&delete o[r]}))}syncSchemaColumns(t,r){const o=t.schema.columns;Object.entries(r).forEach(([i,u])=>{if(i==="id"||i.startsWith("__"))return;let m=o.find(g=>g.name===i);m||(m={name:i,type:uo(i,u)},o.push(m)),u==null&&(m.nullable=!0)})}}const po=2e3,zt={methods:[],ops:[],tables:[],txns:[]},jn={empty:"No events yet.",noMatch:"No events match the current filters."},Ln=(e,t,r)=>{const o=new Map;e.forEach(m=>{const g=t(m);if(!g)return;const M=r(m);o.has(g)||o.set(g,{label:M,count:0}),o.get(g).count+=1});const i=e.length||1,u=Array.from(o.entries()).map(([m,g])=>({id:m,label:g.label,count:g.count,percent:Math.round(g.count/i*100)}));return u.sort((m,g)=>g.count!==m.count?g.count-m.count:m.label.localeCompare(g.label)),u},kn=e=>{if(!e)return"";try{const t=JSON.stringify(e);return t?t.length>160?`${t.slice(0,160)}…`:t:""}catch{return""}},Ps=e=>{if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const r=t.toLowerCase();return["c","create","insert","i"].includes(r)?"insert":["u","update"].includes(r)?"update":["d","delete"].includes(r)?"delete":r},Mn=e=>{const t=Ps(e);if(t==="insert"||t==="update"||t==="delete")return t.toUpperCase();if(typeof e!="string")return"—";const r=e.trim();return r?r.toUpperCase():"—"},mo=({events:e,stats:t,totalCount:r,filters:o={},filterOptions:i,onFiltersChange:u,onDownload:m,onClear:g,onCopyEvent:M,onReplayEvent:C,maxVisibleEvents:T=po,emptyMessage:_,noMatchMessage:x,className:L})=>{const d={methods:i?.methods??zt.methods,ops:i?.ops??zt.ops,tables:i?.tables??zt.tables,txns:i?.txns??zt.txns},h=c.useMemo(()=>typeof T!="number"||T<=0?e.length:Math.min(T,e.length),[e.length,T]),[p,v]=c.useState(h);c.useEffect(()=>{v(E=>E<h?h:E>e.length?e.length:E)},[h,e.length]);const k=c.useMemo(()=>{const E=Math.max(p,0),Q=Math.max(e.length-E,0);return e.slice(Q)},[e,p]),A=c.useMemo(()=>e.length?k.length===e.length?`${k.length} visible`:`Latest ${k.length} of ${e.length}`:"",[e.length,k.length]),O=c.useMemo(()=>Ln(k,E=>Ps(E.op),E=>Mn(E.op)),[k]),z=c.useMemo(()=>Ln(k,E=>E.methodId??E.methodLabel??"",E=>E.methodLabel||E.methodId||""),[k]),B=k.length<e.length,Oe=p>h,I=()=>{if(!B)return;const E=h>0?h:e.length;v(Q=>Math.min(Q+E,e.length))},Ze=()=>{v(h)},Ee=typeof r=="number"?r:e.length,et=!!o.methodId||!!o.op||!!o.table||!!o.txnId,mt={empty:_??jn.empty,noMatch:x??jn.noMatch},ve=E=>{if(!u)return;const Q={methodId:E.methodId===void 0?o.methodId:E.methodId,op:E.op===void 0?o.op:E.op,table:E.table===void 0?o.table:E.table,txnId:E.txnId===void 0?o.txnId:E.txnId},te={methodId:Q.methodId||void 0,op:Q.op||void 0,table:Q.table||void 0,txnId:Q.txnId||void 0};u(te)},tt=E=>{const Q=kn(E.before),te=kn(E.after);return!Q&&!te?null:n.jsxs("details",{className:"cdc-event-log__details",children:[n.jsx("summary",{children:"Row image"}),Q&&n.jsxs("div",{className:"cdc-event-log__details-row",children:[n.jsx("span",{children:"before"}),n.jsx("code",{children:Q})]}),te&&n.jsxs("div",{className:"cdc-event-log__details-row",children:[n.jsx("span",{children:"after"}),n.jsx("code",{children:te})]})]})};return n.jsxs("section",{className:`cdc-event-log${L?` ${L}`:""}`,"aria-label":"Event log",role:"region",children:[n.jsxs("header",{className:"cdc-event-log__header",children:[n.jsxs("div",{className:"cdc-event-log__headline",children:[n.jsx("h3",{children:"Event Log"}),t&&n.jsxs("p",{className:"cdc-event-log__stats",children:[n.jsxs("span",{children:["Produced ",t.produced]})," · ",n.jsxs("span",{children:["Consumed ",t.consumed]})," · ",n.jsxs("span",{children:["Backlog ",t.backlog]}),typeof t.snapshotRows=="number"&&n.jsxs(n.Fragment,{children:[" · ",n.jsxs("span",{children:["Snapshot rows ",t.snapshotRows]})]})]})]}),n.jsxs("div",{className:"cdc-event-log__actions",children:[n.jsxs("span",{children:[e.length," events"]}),n.jsx("button",{type:"button",onClick:m,disabled:!m||e.length===0,children:"Download NDJSON"}),n.jsx("button",{type:"button",onClick:g,disabled:!g||Ee===0,children:"Clear"})]})]}),n.jsxs("div",{className:"cdc-event-log__filters",role:"group","aria-label":"Event log filters",children:[n.jsxs("label",{children:[n.jsx("span",{children:"Method"}),n.jsxs("select",{value:o.methodId??"",onChange:E=>ve({methodId:E.target.value||void 0}),disabled:!u||d.methods.length===0,children:[n.jsx("option",{value:"",children:"All methods"}),d.methods.map(E=>n.jsx("option",{value:E.id,children:E.label},E.id))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Operation"}),n.jsxs("select",{value:o.op??"",onChange:E=>ve({op:E.target.value||void 0}),disabled:!u||d.ops.length===0,children:[n.jsx("option",{value:"",children:"All ops"}),d.ops.map(E=>n.jsx("option",{value:E,children:E.toUpperCase()},E))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Table"}),n.jsxs("select",{value:o.table??"",onChange:E=>ve({table:E.target.value||void 0}),disabled:!u||d.tables.length===0,children:[n.jsx("option",{value:"",children:"All tables"}),d.tables.map(E=>n.jsx("option",{value:E,children:E},E))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Txn"}),n.jsxs("select",{value:o.txnId??"",onChange:E=>ve({txnId:E.target.value||void 0}),disabled:!u||d.txns.length===0,children:[n.jsx("option",{value:"",children:"All txns"}),d.txns.map(E=>n.jsx("option",{value:E,children:E},E))]})]})]}),k.length>0&&n.jsxs("div",{className:"cdc-event-log__summary",role:"status","aria-live":"polite",children:[n.jsxs("div",{className:"cdc-event-log__summary-block",children:[n.jsxs("div",{className:"cdc-event-log__summary-heading",children:[n.jsx("h4",{children:"Change mix"}),A?n.jsx("span",{children:A}):null]}),n.jsx("div",{className:"cdc-event-log__summary-pills",children:O.length>0?O.map(E=>n.jsxs("span",{className:"cdc-event-log__pill",children:[n.jsx("strong",{children:E.label}),n.jsxs("span",{children:[E.count," · ",E.percent,"%"]})]},E.id)):n.jsx("span",{className:"cdc-event-log__pill cdc-event-log__pill--muted",children:"No op codes"})})]}),n.jsxs("div",{className:"cdc-event-log__summary-block",children:[n.jsxs("div",{className:"cdc-event-log__summary-heading",children:[n.jsx("h4",{children:"Method mix"}),A?n.jsx("span",{children:A}):null]}),n.jsx("div",{className:"cdc-event-log__summary-pills",children:z.length>0?z.map(E=>n.jsxs("span",{className:"cdc-event-log__pill",children:[n.jsx("strong",{children:E.label||"Unknown"}),n.jsxs("span",{children:[E.count," · ",E.percent,"%"]})]},E.id)):n.jsx("span",{className:"cdc-event-log__pill cdc-event-log__pill--muted",children:"No method labels"})})]})]}),e.length===0?n.jsx("p",{className:"cdc-event-log__empty",children:Ee>0||et?mt.noMatch:mt.empty}):n.jsxs("ul",{className:"cdc-event-log__list",children:[e.length>k.length&&n.jsxs("li",{className:"cdc-event-log__notice",children:[n.jsxs("span",{children:["Showing latest ",k.length," of ",e.length," events."]}),n.jsxs("div",{className:"cdc-event-log__notice-actions",children:[n.jsx("button",{type:"button",onClick:I,disabled:!B,children:"Load more"}),Oe&&n.jsx("button",{type:"button",onClick:Ze,children:"Show latest"})]})]}),k.map(E=>{const Q=Mn(E.op),te=Ps(E.op),ae=typeof E.offset=="number"?E.offset:E.offset==null?"—":E.offset,ft=E.topic??"—",Re=E.table??"—",De=E.pk??"—",se=E.txnId??"",as=typeof E.tsMs=="number"?E.tsMs:"—",Y=te==="insert"||te==="update"||te==="delete";return n.jsxs("li",{className:"cdc-event-log__item",children:[n.jsx("span",{className:"cdc-event-log__method",children:E.methodLabel??E.methodId??"—"}),n.jsx("span",{className:"cdc-event-log__op","data-op":Q,children:Q}),n.jsxs("span",{className:"cdc-event-log__offset",children:["offset ",ae]}),n.jsx("span",{className:"cdc-event-log__topic",children:ft}),n.jsxs("span",{className:"cdc-event-log__table",children:["table ",Re]}),n.jsxs("span",{className:"cdc-event-log__meta",children:["ts=",as,"ms · pk=",De,se?` · txn=${se}`:""]}),E.meta?n.jsx("span",{className:"cdc-event-log__extra",children:E.meta}):null,C?n.jsx("button",{type:"button",className:"cdc-event-log__replay",onClick:()=>C?.(E),disabled:!Y,children:"Replay"}):null,n.jsx("button",{type:"button",className:"cdc-event-log__copy",onClick:()=>M?.(E),disabled:!M,children:"Copy"}),tt(E)]},E.id)})]})]})};function fo(e){const t=e.op?.toUpperCase?.()??"?",r=e.pk??"∅",o=e.expectedIndex!=null?`#${e.expectedIndex}`:void 0,i=e.actualIndex!=null?`#${e.actualIndex}`:void 0;return e.type==="missing"?`Missing ${t} for pk=${r} (${o??"expected"} @ ${e.expectedTime??"?"}ms)`:e.type==="extra"?`Unexpected ${t} for pk=${r} (${i??"emitted"} @ ${e.actualTime??"?"}ms)`:`Out-of-order ${t} pk=${r} (expected ${o??"?"} before actual ${i??"?"})`}const go=({diff:e,scenarioName:t,laneId:r,schemaStatus:o,onDiffDetailsOpened:i})=>{if(!e)return null;const{totals:u,issues:m,lag:g}=e,M=u.missing>0||u.extra>0||u.ordering>0,C=m.slice(0,6);let T=null;return o&&(o.hasColumn?o.version<o.expectedVersion&&(T=`Schema behind: v${o.version} (expected v${o.expectedVersion})`):T=`${o.columnName} column missing in destination`),!M&&g.max<=0&&!T?null:n.jsxs("div",{className:"sim-shell__lane-diff","data-has-issues":M?"true":"false",role:"note",children:[n.jsxs("div",{className:"sim-shell__lane-diff-summary",children:[M?n.jsxs(n.Fragment,{children:[u.missing>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--missing",children:[u.missing," missing"]}),u.extra>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--extra",children:[u.extra," extra"]}),u.ordering>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--ordering",children:[u.ordering," ordering"]})]}):n.jsx("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--ok",children:"Operations aligned"}),g.max>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--lag",children:["Max lag ",Math.round(g.max),"ms"]})]}),T&&n.jsx("p",{className:"sim-shell__lane-diff-schema",children:T}),(C.length>0||g.samples.length>0)&&n.jsxs("details",{id:r?`lane-diff-${r}`:void 0,className:"sim-shell__lane-diff-details",onToggle:_=>{_.target.open&&i?.({method:e.method,issueCount:e.issues.length,maxLag:e.lag.max,scenario:t})},children:[n.jsx("summary",{children:"Diff details"}),C.length>0&&n.jsx("ul",{className:"sim-shell__lane-diff-list",children:C.map((_,x)=>n.jsx("li",{children:fo(_)},`${_.type}-${_.op}-${_.pk??"∅"}-${x}`))}),m.length>C.length&&n.jsxs("p",{className:"sim-shell__lane-diff-more",children:["+",m.length-C.length," additional difference(s)"]}),g.samples.length>0&&n.jsxs("div",{className:"sim-shell__lane-diff-lag",children:[n.jsx("h4",{children:"Lag hotspots"}),n.jsx("ul",{children:g.samples.map(_=>n.jsxs("li",{children:[Math.round(_.lagMs),"ms on ",_.op.toUpperCase()," pk=",_.pk??"∅"]},`${_.op}-${_.pk??"∅"}-${_.actualTime??"?"}`))})]})]})]})},Ke=Vn,zn=.05,bo=1+zn,xo=e=>e.replace(/\.0$/,"");function Se(e){return typeof e=="number"&&Number.isFinite(e)&&e>=bo}function yo(e){return`${(Number.isFinite(e)?Math.max(e,0):0).toFixed(1)}x`}function Je(e){const t=yo(e),r=Number.isFinite(e)?Math.max(e-1,0):0;if(r<zn)return t;const o=r>=10?0:r>=1?1:2,i=xo(r.toFixed(o));return`${t} (~${i} extra writes/change)`}const he=e=>Number.isFinite(e)?e.toLocaleString():"—",Tn=e=>Number.isFinite(e)?`${Math.round(e)}ms`:"—",vo=({lanes:e,renderSchemaWalkthrough:t})=>{const r=e.reduce((o,i)=>(o.produced+=i.produced,o.consumed+=i.consumed,o.backlog+=i.backlog,o),{produced:0,consumed:0,backlog:0});return n.jsxs("section",{className:"sim-shell__metrics-dashboard","aria-label":"Runtime metrics",children:[n.jsx("header",{className:"sim-shell__metrics-dashboard-header",children:n.jsxs("div",{children:[n.jsx("h3",{children:"Runtime metrics"}),n.jsxs("p",{children:["Produced ",he(r.produced)," · Consumed ",he(r.consumed)," · Backlog ",he(r.backlog)]})]})}),n.jsx("div",{className:"sim-shell__metrics-dashboard-grid",children:e.map(o=>n.jsxs("article",{className:"sim-shell__metrics-dashboard-card",children:[n.jsx("header",{children:n.jsx("h4",{"data-tooltip":o.tooltip||void 0,children:o.label})}),t&&n.jsx("div",{className:"sim-shell__schema-demo-inline",children:t(o.id)}),n.jsxs("dl",{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Produced"}),n.jsx("dd",{children:he(o.produced)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Consumed"}),n.jsx("dd",{children:he(o.consumed)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Backlog"}),n.jsx("dd",{"data-tooltip":Ke.backlog,children:he(o.backlog)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Lag p50"}),n.jsx("dd",{"data-tooltip":Ke.lagPercentile,children:Tn(o.lagP50)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Lag p95"}),n.jsx("dd",{"data-tooltip":Ke.lagPercentile,children:Tn(o.lagP95)})]}),typeof o.snapshotRows=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Snapshot rows"}),n.jsx("dd",{"data-tooltip":Ke.snapshot,children:he(o.snapshotRows)})]}),(typeof o.inserts=="number"||typeof o.updates=="number"||typeof o.deletes=="number")&&n.jsxs("div",{children:[n.jsx("dt",{children:"Change mix"}),n.jsxs("dd",{children:["C ",he(o.inserts??0)," · U ",he(o.updates??0)," · D ",he(o.deletes??0),typeof o.schemaChanges=="number"&&o.schemaChanges>0?` · Schema ${he(o.schemaChanges)}`:""]})]}),typeof o.missedDeletes=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Missed deletes"}),n.jsx("dd",{"data-tooltip":Ke.deleteCapture,children:he(o.missedDeletes)})]}),Se(o.writeAmplification)&&n.jsxs("div",{children:[n.jsx("dt",{children:"Write amplification"}),n.jsx("dd",{"data-tooltip":Ke.triggerWriteAmplification,children:Je(o.writeAmplification)})]})]})]},o.id))})]})},_o=({lagMs:e,throughput:t,deletesPct:r,orderingOk:o,consistent:i,writeAmplification:u,insertCount:m,updateCount:g,deleteCount:M,schemaChangeCount:C})=>n.jsxs("div",{role:"status","aria-live":"polite",children:[n.jsxs("span",{children:["Lag: ",e,"ms"]})," ·",n.jsxs("span",{children:["TPS: ",t.toFixed(1)]})," ·",n.jsxs("span",{children:["Deletes: ",Math.round(r),"%"]})," ·",n.jsxs("span",{children:["Ordering: ",o?"OK":"KO"]})," ·",n.jsxs("span",{children:["Consistency: ",i?"OK":"Drift"]})," ","·",n.jsxs("span",{children:["Ops C/U/D: ",m,"/",g,"/",M]}),C>0&&n.jsxs(n.Fragment,{children:[" ","·",n.jsxs("span",{children:["Schema: ",C]})]}),Se(u)&&n.jsxs(n.Fragment,{children:[" ","·",n.jsxs("span",{"data-tooltip":Ke.triggerWriteAmplification,children:["Trigger WA: ",Je(u)]})]})]}),wo=({onAdd:e,onDrop:t,columnName:r,disabled:o,disableAdd:i,disableDrop:u,status:m})=>n.jsxs("section",{className:"sim-shell__schema-demo","aria-label":"Schema walkthrough",children:[n.jsxs("header",{children:[n.jsx("h4",{children:"Schema walkthrough"}),n.jsxs("p",{children:["Add or drop ",n.jsx("code",{children:r})," while events stream to compare capture behaviour."]})]}),m?n.jsx("p",{className:"sim-shell__schema-demo-status",children:m}):null,n.jsxs("div",{className:"sim-shell__schema-demo-buttons",children:[n.jsxs("button",{type:"button",onClick:e,disabled:o||i,"data-tour-target":"schema-add",children:["Add ",r]}),n.jsxs("button",{type:"button",onClick:t,disabled:o||u,"data-tour-target":"schema-drop",children:["Drop ",r]})]})]}),jt=e=>{if(Array.isArray(e))return e.map(t=>jt(t));if(e&&typeof e=="object"){const t={};return Object.entries(e).forEach(([r,o])=>{t[r]=jt(o)}),t}return e},He=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"&&e.trim().length>0){const t=Number(e);return Number.isFinite(t)?t:null}return null},So=e=>{if(typeof e=="boolean")return e;if(typeof e=="string"){const t=e.trim().toLowerCase();if(t==="true")return!0;if(t==="false")return!1}return null},Ye=e=>{if(e==null)return null;if(typeof e=="string"){const t=e.trim();return t.length>0?t:null}return typeof e=="number"&&Number.isFinite(e)?String(e):typeof e=="boolean"?e?"true":"false":null},Eo=e=>{if(!e)return null;if(typeof e=="object"){const r=e;if(r&&Object.prototype.hasOwnProperty.call(r,"id")){const o=Ye(r.id);return o?{id:o}:null}}const t=Ye(e);return t?{id:t}:null},Co=e=>{const t=e.event??{},r=Ye(e.method),o=He(t.offset),i=He(t.seq),u=He(t.ts_ms)??He(t.tsMs)??He(t.ts),m=Ye(t.op),g=Ye(t.table),M=Eo(t.pk),C=t.before==null?null:jt(t.before),T=t.after==null?null:jt(t.after),_=Ye(t.topic),x=t.tx??null,L=Ye(x?.id??t.txnId),d=He(x?.index??t.txnIndex),h=He(x?.total??t.txnTotal),p=So(x?.last??t.txnLast),v=t.schemaChange==null?null:jt(t.schemaChange);return{method:r??null,offset:o,seq:i,ts_ms:u,op:m,table:g,pk:M,before:C,after:T,topic:_,txn_id:L,txn_index:d,txn_total:h,txn_last:p,schema_change:v}},jo=(e,t={})=>{const r=t.newline??`
`,o=[];for(const i of e){if(!i||typeof i!="object")continue;const u=Co(i);o.push(JSON.stringify(u))}return o.join(r)},Lo="cdc_telemetry_buffer_v1",ko=200,Qn={activation:{key:"activation",label:"Activation",description:"Do new users reach their first comparator insight?"},funnel_drop:{key:"funnel_drop",label:"Funnel drop",description:"Where do users abandon the guided comparator walkthrough?"},adoption:{key:"adoption",label:"Adoption",description:"Which comparator features become part of regular usage?"},quality_gate:{key:"quality_gate",label:"Quality gate",description:"Do reliability issues or errors block comparator adoption?"},scenario_completeness:{key:"scenario_completeness",label:"Scenario completeness",description:"Which templates lead to full replay, export, and comparator review?"},collaboration:{key:"collaboration",label:"Collaboration",description:"How often do teams share scenarios or comparator snapshots?"}},An={"comparator.scenario.select":"activation","comparator.scenario.preview":"activation","comparator.preset.select":"activation","comparator.scenario.filter":"activation","comparator.scenario.tag_toggle":"funnel_drop","comparator.scenario.tag_clear":"funnel_drop","comparator.summary.copied":"activation","comparator.diff.opened":"funnel_drop","comparator.overlay.inspect":"activation","comparator.schema.change":"activation","comparator.clock.control":"funnel_drop","comparator.consumer.toggle":"funnel_drop","comparator.consumer.rate_toggle":"funnel_drop","comparator.consumer.rate_adjust":"activation","comparator.consumer.rate_reset":"activation","comparator.event.search":"activation","comparator.event.filter":"activation","comparator.panel.layout":"adoption","comparator.event.download":"adoption","comparator.event.clear":"adoption","comparator.event.copy":"activation","comparator.event.copy.error":"quality_gate","comparator.event.replay":"activation","comparator.destination.download":"adoption","comparator.generator.toggle":"adoption","comparator.generator.rate_adjust":"adoption","comparator.generator.burst":"activation","tour.started":"funnel_drop","tour.completed":"activation","tour.dismissed":"funnel_drop","workspace.share.generated":"collaboration","workspace.scenario.imported":"scenario_completeness","workspace.scenario.template_loaded":"activation","workspace.scenario.exported":"scenario_completeness","telemetry.flush":"activation"},Kn=e=>!!e&&typeof e=="object"&&!Array.isArray(e),os=e=>{if(!Kn(e))return{};const t={};return Object.keys(e).forEach(r=>{t[r]=e[r]}),t},Mo=()=>({getItem:()=>null,setItem:()=>{}}),To=e=>{try{return e.toISOString()}catch{return new Date().toISOString()}},Ao=e=>{if(!Kn(e))return null;const t=typeof e.event=="string"?e.event:null;if(!t)return null;const r=os(e.payload),o=os(e.context),i=typeof e.recordedAt=="string"?e.recordedAt:typeof e.recorded_at=="string"?e.recorded_at:null,u=i&&!Number.isNaN(Date.parse(i))?i:new Date().toISOString(),m=e.question,g=typeof m=="string"&&m in Qn?m:null;return{event:t,payload:r,context:o,question:g,recordedAt:u}},Io=e=>({event:e.event,payload:e.payload,context:e.context,question:e.question,recordedAt:e.recordedAt}),No=(e={})=>{const t=e.storage??(typeof window<"u"&&window.localStorage?window.localStorage:Mo()),r=e.storageKey??Lo,o=Math.max(1,e.maxEntries??ko),i=e.now??(()=>new Date),u=e.console??(typeof console<"u"?{warn:console.warn.bind(console),debug:console.debug.bind(console)}:{warn:()=>{},debug:()=>{}}),g=(()=>{try{const L=t.getItem(r);if(!L)return[];const d=JSON.parse(L);return Array.isArray(d)?d.map(Ao).filter(p=>!!p).slice(-o):[]}catch(L){return u.warn("Telemetry buffer load failed",L),[]}})(),M=()=>{try{const L=g.slice(-o).map(Io);t.setItem(r,JSON.stringify(L))}catch(L){u.warn("Telemetry buffer save failed",L)}};return{buffer:g,track:(L,d={},h={})=>{if(typeof L!="string"||!L.trim())return;const p=L.trim(),v={event:p,payload:os(d),context:os(h),question:An[p]??null,recordedAt:To(i())};g.push(v),g.length>o&&g.splice(0,g.length-o),M(),v.context.debug&&u.debug("[telemetry]",v)},flush:()=>{if(g.length===0)return[];const L=g.slice();return g.length=0,M(),L},questions:()=>Object.values(Qn).map(L=>({...L})),taxonomy:()=>({...An})}},Oo=e=>{const t=new Map,r=i=>{if(!e)return t.get(i)??null;try{const u=e.getItem(i);return typeof u=="string"?u:u??null}catch{return t.get(i)??null}},o=i=>{if(!e)return!1;try{return typeof e.removeItem=="function"?e.removeItem(i):e.setItem(i,""),!0}catch{return!1}};return{getItem(i){return t.has(i)?t.get(i)??null:r(i)},setItem(i,u){if(e)try{e.setItem(i,u),t.delete(i);return}catch{}t.set(i,u)},removeItem(i){t.delete(i),o(i)||t.set(i,null)}}},In=e=>{const t=e.trim();if(!t.startsWith("|")||t==="|")return[];const r=t.split("|");return r.shift(),r.length>0&&r[r.length-1].trim()===""&&r.pop(),r.map(o=>o.trim())},Jn=e=>{let t=e.trim(),r=!1;const o=["*","_"];let i=!0;for(;i&&t.length>=2;)i=!1,o.forEach(u=>{if(t.startsWith(u)&&t.endsWith(u)){const m=t.slice(u.length,t.length-u.length).trim();m.length>=0&&(t=m,r=!0,i=!0)}});return{text:t,emphasis:r}},Ro=e=>{const t=e.match(/^\[([^\]]+)\]\(([^)]+)\)$/);if(!t)return{text:e};const[,r,o]=t;return{text:r.trim(),href:o.trim()}},Yn=e=>e.replace(/&nbsp;/gi," ").replace(/&#160;/g," "),Do=e=>{if(!e)return{text:""};const t=Yn(e),{text:r,emphasis:o}=Jn(t),i=Ro(r);return{text:i.text.trim(),href:i.href,emphasis:o}},$o=e=>e.length>0&&e.every(t=>/^:?[-=]+:?$/u.test(t.replace(/\s+/g,""))),Po=e=>{if(!e.length)return!1;const t=e[0].text.trim().toLowerCase();return t.length>0&&t.includes("no runs")&&t.includes("captured")},Fo=e=>{const t=e.split(/\r?\n/).map(g=>g.trim()).filter(g=>g.startsWith("|"));if(t.length<2)return null;const r=In(t[0]);if(!r.length)return null;const o=r.map(g=>Jn(Yn(g)).text),i=t.slice(1),u=[];let m=null;return i.forEach(g=>{const M=In(g);if(!M.length||$o(M))return;const C=M.map(Do);if(Po(C)){m=C[0].text.trim();return}C.every(T=>T.text==="")||u.push(C)}),{headers:o,rows:u,placeholder:m}};function Uo(e,t){const r=structuredClone(e??{}),o=(i,u,m)=>{if(!i)return;const g=i[u],M=typeof g=="string"?g:m,C=M?t[M]:void 0;g!=null&&typeof g=="object"&&"label"in g||(i[u]={label:C?.label??String(M??g??""),tooltip:C?.tooltip,value:typeof g=="number"?g:g?.value??g})};return o(r,"bestLag",r?.bestLagId),o(r,"triggerWriteAmplification",r?.triggerWriteAmplificationId),Array.isArray(r.lanes)&&(r.lanes=r.lanes.map(i=>{const u=typeof i?.method=="string"?i.method:void 0,m=u?t[u]:void 0;return{...i,id:u,label:m?.label??u,tooltip:m?.tooltip}}).filter(Boolean)),r}class Bo{constructor(){this.scenario=null,this.engines=[],this.idx=0,this.now=0,this.playing=!1}attach(t){this.engines=t}load(t){this.scenario=t,this.idx=0,this.now=0,this.playing=!1}reset(t){this.engines.forEach(r=>r.reset(t)),this.idx=0,this.now=0}onTick(t){this.onTickCb=t}start(){this.playing=!0}pause(){this.playing=!1}tick(t){if(!this.playing||!this.scenario)return;this.now+=t;const{ops:r}=this.scenario;for(;this.idx<r.length&&r[this.idx].t<=this.now;){const o=r[this.idx++];this.engines.forEach(i=>i.applySourceOp(o))}this.engines.forEach(o=>o.tick(this.now)),this.onTickCb?.(this.now)}}const qo=new Set(["c","u","d"]);function Wo(e){switch(e.op){case"insert":return"c";case"update":return"u";case"delete":return"d";default:return null}}function Vo(e){return e.map((t,r)=>{const o=Wo(t);if(!o)return null;const i=t.pk?.id!=null?String(t.pk.id):"";return{key:`${o}::${i}`,op:o,pk:i,index:r,time:t.t}}).filter(t=>!!t)}function Go(e){return e.map((t,r)=>{if(!qo.has(t.op))return null;const o=t.pk?.id!=null?String(t.pk.id):"",i=t.op;return{key:`${i}::${o}`,op:i,pk:o,index:r,time:t.ts_ms}}).filter(t=>!!t)}function Nn(e){const t=new Map;for(const r of e){const o=t.get(r.key);o?o.push(r):t.set(r.key,[r])}return t}function Ho(e,t){const r=[],o=[],i=[],u=Nn(e),m=Nn(t),g=new Set([...u.keys(),...m.keys()]);for(const M of g){const C=u.get(M)??[],T=m.get(M)??[],_=Math.min(C.length,T.length);for(let x=0;x<_;x++){const L=C[x],d=T[x];r.push({expected:L,actual:d,lagMs:Math.max(0,d.time-L.time)})}for(let x=_;x<C.length;x++)o.push(C[x]);for(let x=_;x<T.length;x++)i.push(T[x])}return{matched:r,missing:o,extra:i}}function zo(e){const t=[],r=[...e].sort((i,u)=>i.actual.index-u.actual.index);let o=-1/0;for(const i of r)i.expected.index<o?t.push({type:"ordering",op:i.expected.op,pk:i.expected.pk,expectedIndex:i.expected.index,actualIndex:i.actual.index,expectedTime:i.expected.time,actualTime:i.actual.time}):o=i.expected.index;return t}function Qo(e){return e.filter(t=>t.lagMs>0).sort((t,r)=>r.lagMs-t.lagMs).slice(0,5).map(t=>({op:t.expected.op,pk:t.expected.pk,expectedTime:t.expected.time,actualTime:t.actual.time,lagMs:t.lagMs}))}function Ko(e,t,r){const o=Vo(t),i=Go(r),{matched:u,missing:m,extra:g}=Ho(o,i),M=[];for(const _ of m)M.push({type:"missing",op:_.op,pk:_.pk,expectedIndex:_.index,expectedTime:_.time});for(const _ of g)M.push({type:"extra",op:_.op,pk:_.pk,actualIndex:_.index,actualTime:_.time});M.push(...zo(u));const C=Qo(u),T=C.reduce((_,x)=>Math.max(_,x.lagMs),0);return{method:e,totals:{missing:M.filter(_=>_.type==="missing").length,extra:M.filter(_=>_.type==="extra").length,ordering:M.filter(_=>_.type==="ordering").length},issues:M,lag:{max:T,samples:C}}}const Jo=`# Harness Nightly History

Run \`GITHUB_TOKEN=... npm run harness:history\` to refresh this summary. The script aggregates the latest Harness Nightly artifacts and records table-level parity results here so the app can surface them inline.

| Run | Date | Conclusion | Events | Missing | Extra | Max Lag (ms) | Tables | Mismatches |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| _No runs captured yet._ |   |   |   |   |   |   |   |   |

`,Yo="workspace",Xo=e=>({...e}),Zo=e=>!Array.isArray(e)||e.length===0?[{name:"id",type:"string",pk:!0}]:e.filter(t=>t&&typeof t.name=="string").map(t=>{const r={name:t.name,type:"string",pk:!!t.pk},o=t.type;if(typeof o=="string"){const i=o.toLowerCase();i==="number"||i==="bool"||i==="timestamp"?r.type=i:i==="string"&&(r.type="string")}return typeof t.nullable=="boolean"&&(r.nullable=t.nullable),r}),ea=e=>e.type?String(e.type).toLowerCase():"string",ta=e=>{const t=e.find(r=>r.pk);return t?.name?t.name:"id"},On=(e,t,r)=>Array.isArray(r)&&r.length>0?r.reduce((o,i)=>(i===t||Object.prototype.hasOwnProperty.call(e,i)&&(o[i]=e[i]),o),{}):Object.entries(e).reduce((o,[i,u])=>(i===t||(o[i]=u),o),{}),Rn=(e,t,r,o)=>{const i=ea(e);if(i==="number"){const m=t.seq*10+r;return typeof o=="number"?o+1:m}if(i==="bool"||i==="boolean")return typeof o=="boolean"?!o:r%2===0;if(i==="timestamp")return t.logicalTime+r+1;const u=`${t.seq}_${r}_${t.opCounter}`;return`${e.name}_${u}`},sa=(e,t={})=>{const r=Zo(e.schema),o=ta(r),i=new Map;(Array.isArray(e.rows)?e.rows:[]).forEach(M=>{if(!M||typeof M!="object")return;const C=M,T=C[o]??C.id;if(T==null)return;const _=String(T),x={};Object.entries(C).forEach(([L,d])=>{if(L===o){x[L]=String(d);return}L==="id"&&o!=="id"||(x[L]=d)}),Object.prototype.hasOwnProperty.call(x,o)||(x[o]=_),i.set(_,x)});const m=Array.isArray(e.ops)?e.ops.reduce((M,C)=>Math.max(M,C?.t??0),0):0;return{table:typeof e.table=="string"&&e.table.trim().length?e.table:t.fallbackTable??Yo,columns:r,pkField:o,rows:i,logicalTime:m,seq:i.size+1,opCounter:0}},na=(e,t,r)=>{const o=Math.max(1,Math.floor(t)||1),i=Array.from(e.rows.keys()),u=e.columns.filter(T=>T.name!==e.pkField);let m="insert";if(i.length>0&&u.length>0){const T=e.opCounter%6;(T===0||T===4)&&i.length>1?m="delete":T===1||T===2||T===3?m="update":m="insert"}else i.length>1&&u.length===0&&(m=e.opCounter%3===0?"delete":"insert");const g=e.opCounter;e.opCounter+=1;const M=Math.max(e.logicalTime,r);e.logicalTime=M+o;const C=e.logicalTime;if(m==="insert"){const T=`gen-${e.seq++}`,_={[e.pkField]:T};u.forEach((d,h)=>{_[d.name]=Rn(d,e,h)}),e.rows.set(T,_);const x=On(_,e.pkField);return{op:{t:C,op:"insert",table:e.table,pk:{id:T},after:x},kind:m}}if(m==="update"&&i.length>0&&u.length>0){const T=g%i.length,_=i[T],x=e.rows.get(_);if(!x)return null;const L=u[g%u.length],d=Rn(L,e,g,x[L.name]),h=Xo(x);h[L.name]=d,e.rows.set(_,h);const p=On(h,e.pkField,[L.name]);return{op:{t:C,op:"update",table:e.table,pk:{id:_},after:p},kind:m}}if(m==="delete"&&i.length>0){const T=g%i.length,_=i[T];return e.rows.delete(_),{op:{t:C,op:"delete",table:e.table,pk:{id:_}},kind:m}}return null};function V(e,t={},r={}){if(typeof window>"u")return;const o=window.telemetry;!o||typeof o.track!="function"||o.track(e,t,r)}function Ct(e,t={}){V("comparator.clock.control",{action:e,...t})}function ra({onDiffDetailsOpened:e,...t}){const r=o=>{e?.(o),V("comparator.diff.opened",{method:o.method,issues:o.issueCount,maxLag:o.maxLag,scenario:o.scenario})};return n.jsx(go,{...t,onDiffDetailsOpened:r})}function oa(e){const t={...e};return e.pk&&(t.pk={...e.pk}),e.after&&(t.after={...e.after}),e.txn&&(t.txn={...e.txn}),t}function aa(e){if(e==null)return e;try{return JSON.parse(JSON.stringify(e))}catch{return e}}function ia(e){return{id:e.id,name:e.id||e.name,label:e.label,description:e.description,highlight:e.highlight,stats:{rows:e.rows.length,ops:e.ops.length},table:e.table,tags:[...e.tags],schema:e.schema.length?e.schema.map(t=>({...t})):void 0,rows:e.rows.length?e.rows.map(t=>({...t})):void 0,events:e.events.length?e.events.map(t=>({...t})):void 0,schemaVersion:e.schemaVersion,seed:e.seed,ops:e.ops.map(oa),comparator:e.comparator?aa(e.comparator):null}}const Xn=Br;Xn.length===0&&typeof console<"u"&&console.warn("No scenario templates were loaded from assets/shared-scenarios.js; the comparator scenario gallery will be empty.");const Qt=Xn.map(ia),Zn={polling:{label:"Polling (Query)",laneDescription:"Simple, but lossy. Periodic scans read current state only; hard deletes and mid-poll updates can disappear.",callout:"Polling reads current state only. Hard deletes and intermediate updates are not captured.",whenToUse:"Simple, but lossy. Periodic scans read current state only. Hard deletes and intermediate updates between polls are not observable. Good for small, non-critical syncs where some lag and loss is acceptable."},trigger:{label:"Trigger (Audit)",laneDescription:"Complete, but intrusive. Database triggers write to an audit table and add synchronous source overhead.",callout:"Triggers add write overhead to source transactions.",whenToUse:"Complete, but intrusive. Triggers capture every change into an audit table, but add write latency and operational overhead on the source. Use when log access isn’t available."},log:{label:"Log (WAL)",laneDescription:"Default choice. Streams the transaction log post-commit for ordered, low-latency change events.",callout:"Log-based CDC is the preferred default when available.",whenToUse:"Default choice. Reads the database’s transaction log post-commit. Lowest source impact, complete and ordered changes, near-real-time. Requires connector setup and ops discipline."}};typeof window<"u"&&(window.CDC_METHOD_COPY=Zn);const ze="workspace-live",er="cdc_comparator_prefs_v1",Qe={name:"priority_flag",type:"bool"},la=()=>{if(typeof window>"u")return null;try{return window.localStorage}catch{return null}},qs=(()=>{let e=null,t=null;return()=>{const r=la();return(!e||r!==t)&&(e=Oo(r),t=r),e}})();function ca(e,t,r,o){if(r.length===0)return 0;const i=e[t]?.metrics.writeAmplification;if(typeof i=="number"&&i>=0)return i;const u=o.ops.filter(m=>m.table===r[0]?.table);return u.length?r.length/u.length:r.length}function da(e){return!Number.isFinite(e)||e<=0?null:{key:"write-amplification",text:`${e.toFixed(1)}x write amplification`,tone:"amplification"}}const pt=["polling","trigger","log"],tr=2,Ne=100,sr=10,nr=300,Fs=120,ua=10,rr=10,or=600,ar=120,Us=10,Is=40,ha=5,Kt=32,Xe=["c","u","d","s"],Dn="MYSQL_DEBEZIUM";function ns(e){return typeof e=="string"&&Object.prototype.hasOwnProperty.call(Zt,e)}const pa=e=>e?{columns:[...e.columns],rows:e.rows.map(t=>({id:t.id,displayId:t.displayId,table:t.table,values:{...t.values}})),schemaVersion:e.schemaVersion,hasSchemaColumn:e.hasSchemaColumn}:null,pe=e=>{if(e==null)return e;try{return JSON.parse(JSON.stringify(e))}catch{return null}},ma=e=>{if(!e)return null;const t=e.methodCopyOverrides?pe(e.methodCopyOverrides)??void 0:void 0;return{id:e.id,label:e.label,description:e.description,docsHint:e.docsHint,sourceLabel:e.sourceLabel,sourceTooltip:e.sourceTooltip,logLabel:e.logLabel,logTooltip:e.logTooltip,busLabel:e.busLabel,busTooltip:e.busTooltip,destinationLabel:e.destinationLabel,destinationTooltip:e.destinationTooltip,methodCopyOverrides:t}};function fa(e,t,r,o,i,u,m,g){const M=pe(e),C=t?pe(t):null,T=pe(r)??[],_=m?pe(m):null,x=Array.from(o.values()).map(d=>pe(d)).filter(d=>!!d),L=g.map(d=>{const h=pe(d.metrics);return h?{method:d.method,eventCount:d.events.length,metrics:h}:null}).filter(d=>!!d);return{preferences:M,summary:C,analytics:T,diffs:x,tags:[...i],preset:ma(u),overlay:_,lanes:L}}function $n(e){return e?!!(e.preferences&&Object.keys(e.preferences).length>0)||!!e.summary||(e.analytics?.length??0)>0||(e.diffs?.length??0)>0||(e.tags?.length??0)>0||!!e.preset||(e.overlay?.length??0)>0||(e.lanes?.length??0)>0:!1}const ga=Zn,K=Vn,Ns=200,ba=2e3,xa=6;function ya(){if(typeof window>"u")return new Set;const t=window.cdcFeatureFlags?.all?.();if(Array.isArray(t)&&t.length)return new Set(t.map(String));const r=window.APPWRITE_CFG?.featureFlags;return Array.isArray(r)&&r.length?new Set(r.map(String)):new Set}const va={polling:{pollIntervalMs:500,includeSoftDeletes:!1},trigger:{extractIntervalMs:250,triggerOverheadMs:8},log:{fetchIntervalMs:50}},_a={polling:"QUERY_BASED",trigger:"TRIGGER_BASED",log:"LOG_BASED"},wa={polling:"polling",trigger:"trigger",log:"log"},Pn=e=>{switch(e){case"polling":return Jr();case"trigger":return Zr();case"log":default:return Qr()}},Fn=e=>{if(!e)return null;const t={...e};return delete t.__ts,t},Sa=e=>{if(e==null)return"—";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="number")return Number.isFinite(e)?e.toString():"—";if(e instanceof Date)return e.toISOString();if(typeof e=="object")try{return JSON.stringify(e)}catch{return"[object]"}return String(e)},Bs=(e,t,r)=>{const o=t.kind==="INSERT"?"c":t.kind==="UPDATE"?"u":t.kind==="DELETE"?"d":"s",i=t.schemaChange?{action:t.schemaChange.action,column:{name:t.schemaChange.column.name,type:t.schemaChange.column.type,nullable:t.schemaChange.column.nullable},previousVersion:t.schemaChange.previousVersion,nextVersion:t.schemaChange.nextVersion}:null,u=t.after?.id??t.before?.id??i?.column?.name??null,m=u!=null?String(u):"";return{source:"demo-db",table:t.table,op:o,pk:{id:m},before:Fn(t.before),after:Fn(t.after),ts_ms:t.commitTs,tx:{id:t.txnId??`tx-${t.commitTs}`,lsn:typeof t.offset=="number"?t.offset:null,index:typeof t.txnIndex=="number"?t.txnIndex:void 0,total:typeof t.txnTotal=="number"?t.txnTotal:void 0,last:typeof t.txnLast=="boolean"?t.txnLast:typeof t.txnTotal=="number"&&typeof t.txnIndex=="number"?t.txnIndex>=t.txnTotal-1:!0},seq:r,meta:{method:wa[e]},schemaChange:i}};function Ea(e,t){const r=new Wr,o=new Vr,i=new Gr,u=`cdc.${e}`;let m=Pn(e),g,M={bus:r,metrics:o,scheduler:i,topic:u},C={},T=0;const _=new Set,x=p=>{const v=p.__seq,k=typeof v=="number"&&v>0?v:++T;return p.__seq=k,{...Bs(e,p,k),offset:p.offset,topic:p.topic??u}},L=p=>v=>{const k=p(v);if(k.length){const A=k.map(O=>x(O));t(A),A.forEach(O=>_.forEach(z=>z(O)))}return k},d=()=>{m.initialise?.(M),m.configure?.(C),g=new Hr(_a[e],r,i,o,u,{startSnapshot:(p,v)=>m.startSnapshot?.(p,k=>L(v)(k)),startTailing:p=>m.startTailing?.(v=>L(p)(v)),stop:()=>m.stop?.()}),g.startSnapshot([]),g.startTailing()};return d(),{name:e,configure(p){C={...p},m.configure?.(p)},reset(p){g.stop(),i.clear(),o.reset(),r.reset(u),T=0,m=Pn(e),M={bus:r,metrics:o,scheduler:i,topic:u},d()},applySourceOp(p){m.applySource?.(p)},applySchemaChange(p,v,k,A){const O=v==="add"?"ADD_COLUMN":"DROP_COLUMN";m.applySchemaChange?.(p,O,k,A)},tick(p){m.tick?.(p)},onEvent(p){return _.add(p),()=>_.delete(p)},bus:r,metrics:o,topic:u}}function Ca(e,t){return Ea(e,t)}function ht(e){return e.reduce((t,r)=>(t[r]=[],t),{})}function ja(e){return{polling:{...e.polling},trigger:{...e.trigger},log:{...e.log}}}function Jt(e,t,r){let o=typeof e=="number"?e:Number(e);return Number.isFinite(o)?(typeof r=="number"&&(o=Math.max(r,o)),o):t}function Yt(e,t=Fs){if(typeof e!="number"||!Number.isFinite(e))return t;const r=Math.round(e);return Number.isFinite(r)?Math.min(nr,Math.max(sr,r)):t}function Os(e,t=ar){if(typeof e!="number"||!Number.isFinite(e))return t;const r=Math.round(e/Us)*Us;return Number.isFinite(r)?Math.min(or,Math.max(rr,r)):t}function Rs(e,t=pt){const r=[...t];if(!Array.isArray(e))return r;const o=[];t.forEach(u=>{e.includes(u)&&!o.includes(u)&&o.push(u)});const i=Math.min(tr,t.length);return o.length>=i?o:r}function Un(e){const t=Array.from(Xe);if(!Array.isArray(e)||e.length===0)return new Set(t);const r=[];return e.forEach(o=>{if(Xe.includes(o)){const i=o;r.includes(i)||r.push(i)}}),r.length?new Set(r):new Set(t)}function Xt(e,t=pt){return typeof e=="string"&&t.includes(e)}function Bn(e){const t=ja(va);return e&&(e.polling&&(e.polling.pollIntervalMs!=null&&(t.polling.pollIntervalMs=Jt(e.polling.pollIntervalMs,t.polling.pollIntervalMs,50)),e.polling.includeSoftDeletes!=null&&(t.polling.includeSoftDeletes=!!e.polling.includeSoftDeletes)),e.trigger&&(e.trigger.extractIntervalMs!=null&&(t.trigger.extractIntervalMs=Jt(e.trigger.extractIntervalMs,t.trigger.extractIntervalMs,50)),e.trigger.triggerOverheadMs!=null&&(t.trigger.triggerOverheadMs=Jt(e.trigger.triggerOverheadMs,t.trigger.triggerOverheadMs,0))),e.log&&e.log.fetchIntervalMs!=null&&(t.log.fetchIntervalMs=Jt(e.log.fetchIntervalMs,t.log.fetchIntervalMs,10))),t}function La(){if(typeof window>"u")return null;try{const t=qs().getItem(er);if(!t)return null;const r=JSON.parse(t);return{scenarioId:typeof r.scenarioId=="string"?r.scenarioId:void 0,presetId:ns(r.presetId)?r.presetId:void 0,activeMethods:Array.isArray(r.activeMethods)?r.activeMethods:void 0,methodConfig:r.methodConfig??void 0,userPinnedScenario:typeof r.userPinnedScenario=="boolean"?r.userPinnedScenario:void 0,showEventList:typeof r.showEventList=="boolean"?r.showEventList:void 0,eventOps:Array.isArray(r.eventOps)?r.eventOps:void 0,eventSearch:typeof r.eventSearch=="string"?r.eventSearch:void 0,eventLogTable:typeof r.eventLogTable=="string"?r.eventLogTable:void 0,eventLogTxn:typeof r.eventLogTxn=="string"?r.eventLogTxn:void 0,eventLogMethod:typeof r.eventLogMethod=="string"?r.eventLogMethod:void 0,eventLogOp:typeof r.eventLogOp=="string"?r.eventLogOp:void 0,applyOnCommit:typeof r.applyOnCommit=="boolean"?r.applyOnCommit:void 0,consumerRateEnabled:typeof r.consumerRateEnabled=="boolean"?r.consumerRateEnabled:void 0,consumerRateLimit:typeof r.consumerRateLimit=="number"?r.consumerRateLimit:void 0,generatorEnabled:typeof r.generatorEnabled=="boolean"?r.generatorEnabled:void 0,generatorRate:typeof r.generatorRate=="number"?r.generatorRate:void 0}}catch(e){return console.warn("Comparator prefs load failed",e),null}}function ka(e){if(!(typeof window>"u"))try{qs().setItem(er,JSON.stringify(e))}catch(t){console.warn("Comparator prefs save failed",t)}}function Ma(e,t,r,o,i,u){const m=e.length?e[e.length-1]:null,g=m?Math.max(t-m.ts_ms,0):t,M=t>0?e.length/(t/1e3):0;let C=0,T=0,_=0,x=0;e.forEach(A=>{A.op==="c"?C+=1:A.op==="u"?T+=1:A.op==="d"&&(_+=1),A.schemaChange&&(x+=1)});const L=r.ops.filter(A=>A.op==="delete").length,d=u?.deletes??0,h=L+d,p=h===0?100:_/h*100,v=e.every((A,O)=>{if(O===0)return!0;const z=e[O-1];return A.ts_ms>=z.ts_ms});return{lagMs:g,throughput:M,deletesPct:p,orderingOk:v,consistent:v&&(o==="polling"?_===h:!0),writeAmplification:o==="trigger"?ca(i,o,e,r)??0:void 0,insertCount:C,updateCount:T,deleteCount:_,schemaChangeCount:x}}function Ta(e){if(e.length===0)return null;const t=[...e].sort((_,x)=>_.metrics.lagMs-x.metrics.lagMs),r=t[0],o=t[t.length-1],i=o.metrics.lagMs-r.metrics.lagMs,u=[...e].sort((_,x)=>_.metrics.deletesPct-x.metrics.deletesPct),m=u[0],g=u[u.length-1],M=e.filter(_=>!_.metrics.orderingOk).map(_=>_.method),C=e.filter(_=>_.method==="trigger"&&Se(_.metrics.writeAmplification)),T=C.length?C.reduce((_,x)=>Se(_.metrics.writeAmplification)?Se(x.metrics.writeAmplification)&&x.metrics.writeAmplification>_.metrics.writeAmplification?x:_:x):null;return{bestLag:r,worstLag:o,lagSpread:i,lowestDeletes:m,highestDeletes:g,orderingIssues:M,triggerWriteAmplification:T}}function Aa(){const e=c.useRef(null);e.current===null&&(e.current=La());const t=e.current||void 0,r=c.useMemo(()=>qs(),[]),o=c.useMemo(()=>ya(),[]),i=o.size===0||o.has("ff_trigger_mode"),u=o.size===0||o.has("ff_schema_demo"),m=o.size===0||o.has("ff_multitable"),g=o.size===0||o.has("ff_metrics"),M=o.size===0||o.has("ff_walkthrough"),C=c.useMemo(()=>i?[...pt]:pt.filter(s=>s!=="trigger"),[i]),T=c.useMemo(()=>Rs(t?.activeMethods,C),[C,t?.activeMethods]),_=Bn(t?.methodConfig),x=t?.presetId&&ns(t.presetId)?t.presetId:Dn,L=Xt(t?.eventLogMethod,C)?t?.eventLogMethod:null,d=typeof t?.eventLogOp=="string"&&t.eventLogOp.trim()?t.eventLogOp.trim().toLowerCase():null,h=c.useMemo(()=>typeof window>"u"?{...rs}:ro(r),[r]),[p,v]=c.useState(null),[k,A]=c.useState(()=>t?.scenarioId??Qt[0].name),[O,z]=c.useState(()=>h.query),[B,Oe]=c.useState(()=>h.tags),[I,Ze]=c.useState(()=>T),[Ee,et]=c.useState(()=>ht(T)),[mt,ve]=c.useState(()=>ht(T)),[tt,E]=c.useState(()=>({})),[Q,te]=c.useState(x),[ae,ft]=c.useState(0),[Re,De]=c.useState(!1),[se,as]=c.useState(!1),[Y,is]=c.useState(()=>_),[gt,Lt]=c.useState(!1),[be,bt]=c.useState(()=>t?.eventSearch??""),[Ws,ls]=c.useState(()=>Un(t?.eventOps)),[Ce,cs]=c.useState(t?.showEventList??!0),[ie,$e]=c.useState(t?.eventLogTable??null),[ne,Pe]=c.useState(t?.eventLogTxn??""),[le,je]=c.useState(L),[ce,Le]=c.useState(d),[de,kt]=c.useState(t?.applyOnCommit??!1),[ee,ds]=c.useState(t?.consumerRateEnabled??!1),[re,us]=c.useState(()=>Yt(t?.consumerRateLimit,Fs)),[ue,hs]=c.useState(t?.generatorEnabled??!1),[oe,ps]=c.useState(()=>Os(t?.generatorRate,ar)),ke=c.useRef({}),me=c.useRef({}),st=c.useRef({}),Mt=c.useRef(t?.consumerRateEnabled??!1?Yt(t?.consumerRateLimit,Fs):null),Fe=c.useRef(0),ms=c.useRef(null),xt=c.useRef(0),Vs=c.useRef(oe),Gs=c.useRef(ue),yt=c.useRef({inserts:0,updates:0,deletes:0}),fs=c.useRef({}),Hs=c.useRef(I),zs=c.useRef(ae),q=Zt[Q]??Zt[Dn],ir=c.useMemo(()=>Object.values(Zt).map(s=>({id:s.id,label:s.label})),[]),$=c.useMemo(()=>{const s=q.methodCopyOverrides??{};return pt.reduce((a,l)=>{const f=ga[l],j=s[l];return a[l]={label:j?.label??f.label,laneDescription:j?.laneDescription??f.laneDescription,callout:j?.callout??f.callout,whenToUse:j?.whenToUse??f.whenToUse,tooltip:j?.tooltip??f.tooltip},a},{})},[q]),Qs=c.useMemo(()=>pt.reduce((s,a)=>{const l=$[a];return s[a]={label:l.label,tooltip:l.tooltip},s},{}),[$]),Ks=c.useMemo(()=>new Set(B),[B]),Js=c.useMemo(()=>co(Qt,{liveScenario:p??void 0,additionalTags:[B]}),[p,B]);c.useEffect(()=>{typeof window>"u"||oo({query:O,tags:B},r)},[O,B,r]);const Me=c.useCallback((s,a)=>{if(typeof window>"u")return;const l=Ds({query:s,tags:a});window.dispatchEvent(new CustomEvent("cdc:scenario-filter",{detail:l}))},[]),Tt=c.useCallback(s=>{if(!s){qe.current=!1;return}if("userPinnedScenario"in s&&(qe.current=!!s.userPinnedScenario),s.activeMethods&&Ze(Rs(s.activeMethods,C)),s.methodConfig&&is(Bn(s.methodConfig)),s.scenarioId&&A(s.scenarioId),s.presetId&&ns(s.presetId)&&te(s.presetId),"showEventList"in s&&typeof s.showEventList=="boolean"&&cs(s.showEventList),"eventOps"in s&&ls(Un(s.eventOps)),"eventSearch"in s&&typeof s.eventSearch=="string"&&bt(s.eventSearch),"eventLogTable"in s){const a=typeof s.eventLogTable=="string"&&s.eventLogTable.trim().length>0?s.eventLogTable:null;$e(a)}if("eventLogTxn"in s&&Pe(typeof s.eventLogTxn=="string"?s.eventLogTxn:""),"eventLogMethod"in s){const a=Xt(s.eventLogMethod,C)?s.eventLogMethod:null;je(a)}if("eventLogOp"in s)if(typeof s.eventLogOp=="string"){const a=s.eventLogOp.trim().toLowerCase();Le(a||null)}else Le(null);"applyOnCommit"in s&&typeof s.applyOnCommit=="boolean"&&kt(s.applyOnCommit),"consumerRateEnabled"in s&&typeof s.consumerRateEnabled=="boolean"&&ds(s.consumerRateEnabled),"consumerRateLimit"in s&&typeof s.consumerRateLimit=="number"&&us(Yt(s.consumerRateLimit)),"generatorEnabled"in s&&typeof s.generatorEnabled=="boolean"&&hs(s.generatorEnabled),"generatorRate"in s&&typeof s.generatorRate=="number"&&ps(Os(s.generatorRate))},[C,Ze,is,A,te,cs,ls,bt,$e,Pe,je,Le,kt,ds,us,hs,ps]);c.useEffect(()=>{if(typeof window>"u")return;const s=()=>{Me(O,B)};return window.addEventListener("cdc:scenario-filter-request",s),()=>{window.removeEventListener("cdc:scenario-filter-request",s)}},[Me,O,B]);const Ue=c.useMemo(()=>Fo(Jo),[]),nt=c.useCallback(s=>{let a=st.current[s];return a||(a=new As,st.current[s]=a),a},[]),rt=c.useCallback(s=>{ms.current=sa(s),xt.current=0,yt.current={inserts:0,updates:0,deletes:0}},[]),At=c.useCallback((s,a)=>{const l=ms.current;if(!l||s<=0)return;const f=Hs.current;if(!f.length)return;const j=fs.current;for(let w=0;w<s;w+=1){const S=na(l,a,zs.current);S&&(f.forEach(y=>{j[y]?.applySourceOp(S.op)}),S.kind==="insert"?yt.current.inserts+=1:S.kind==="update"?yt.current.updates+=1:S.kind==="delete"&&(yt.current.deletes+=1))}},[]),It=c.useCallback(s=>{if(!Gs.current||!ms.current)return;const a=Vs.current;if(!Number.isFinite(a)||a<=0)return;xt.current+=a*s/1e3;const l=Math.floor(xt.current);if(l<=0)return;xt.current-=l;const f=l>0?s/l:s;At(l,f)},[At]),xe=c.useCallback((s,a)=>{const l=ke.current[s];if(!l)return;const f=l.metrics.snapshot(),j=l.bus.size(l.topic);E(w=>({...w,[s]:{metrics:f,backlog:j,lastOffset:a?.lastOffset??w[s]?.lastOffset??-1}}))},[]),Ys=c.useCallback((s,a)=>{a.length&&(ve(l=>{const f={...l},j=f[s]??[];return f[s]=[...j,...a],f}),xe(s,{lastOffset:a[a.length-1]?.offset??-1}))},[xe]);c.useEffect(()=>{if(typeof window>"u")return;const s=a=>{if(!(a instanceof CustomEvent))return;const l=a.detail,f=Array.isArray(l)?l:[];setFeatureFlags(new Set(f.map(String)))};return window.addEventListener("cdc:feature-flags",s),()=>{window.removeEventListener("cdc:feature-flags",s)}},[]);const Nt=c.useCallback(s=>o.size===0?!0:o.has(s),[o]),Ot=Nt("ff_event_bus"),gs=Nt("ff_pause_resume"),lr=Nt("ff_query_slider"),cr=Nt("ff_event_log");c.useEffect(()=>{Ze(s=>{const a=Rs(s,C);return a.length===s.length&&a.every((l,f)=>l===s[f])?s:a})},[C]),c.useEffect(()=>{!m&&de&&kt(!1)},[de,m]);const Te=c.useMemo(()=>Array.from(Ws).sort(),[Ws]),Xs=c.useMemo(()=>new Set(Te),[Te]),ot=c.useMemo(()=>be.trim().toLowerCase().split(/\s+/).filter(Boolean),[be]),Zs=c.useMemo(()=>ot.join("|"),[ot]),en=c.useRef(new WeakMap),Rt=c.useCallback(s=>{const a=new Set(Te),l=a.size<Xe.length,f=ot.length>0,j=en.current,w=new Map,S=y=>{const N=j.get(y);if(N)return N;const D=[String(y.seq??""),y.op,y.pk?.id??"",y.table??""];y.after&&D.push(...Object.values(y.after).map(P=>String(P??""))),y.before&&D.push(...Object.values(y.before).map(P=>String(P??"")));const F=D.join(" ").toLowerCase();return j.set(y,F),F};return I.forEach(y=>{const N=s[y]??[];if(!l&&!f){w.set(y,N);return}const D=N.filter(F=>{if(!a.has(F.op))return!1;if(!f)return!0;const P=S(F);return ot.every(U=>P.includes(U))});w.set(y,D)}),w},[I,Te,ot]),dr=c.useMemo(()=>Rt(Ee),[Rt,Ee,Zs]),tn=c.useMemo(()=>Rt(mt),[Rt,mt,Zs]),vt=c.useMemo(()=>{const s=[],a=new Set,l=new Set,f=new Set;return I.forEach(j=>{(tn.get(j)??[]).forEach(S=>{const y=S.table??"";y&&a.add(y);const N=S.tx?.id??null;N&&l.add(N);const D=typeof S.op=="string"?S.op.trim().toLowerCase():"";D&&f.add(D),s.push({method:j,event:S})})}),s.sort((j,w)=>{const S=j.event.offset??j.event.seq??0,y=w.event.offset??w.event.seq??0;return S!==y?S-y:(j.event.ts_ms??0)-(w.event.ts_ms??0)}),{events:s,tables:Array.from(a).sort(),txns:Array.from(l).sort(),ops:Array.from(f)}},[I,tn]),bs=vt.events,Dt=vt.tables,$t=vt.txns,xs=c.useMemo(()=>{const s=new Set(vt.ops),a=Xe.filter(f=>s.has(f)),l=Array.from(s).filter(f=>!Xe.includes(f));return l.sort(),[...a,...l]},[vt.ops]),at=c.useMemo(()=>bs.filter(({method:s,event:a})=>{if(le&&s!==le||ie&&(a.table??"")!==ie||ne&&(a.tx?.id??"")!==ne)return!1;const l=typeof a.op=="string"?a.op.trim().toLowerCase():"";return!(ce&&l!==ce)}),[bs,le,ce,ie,ne]),ur=c.useMemo(()=>at.map(({method:s,event:a},l)=>{const f=typeof a.offset=="number"?a.offset:null,j=typeof a.seq=="number"?a.seq:null,w=typeof a.ts_ms=="number"?a.ts_ms:null,S=[s,f!=null?`offset-${f}`:null,j!=null?`seq-${j}`:null,w!=null?`ts-${w}`:null,l].filter(Boolean),y=a.pk?.id!=null?String(a.pk.id):null,N=a.schemaChange?n.jsxs("span",{className:"sim-shell__event-log-schema",children:[a.schemaChange.action==="ADD_COLUMN"?"Added":"Dropped"," column ",a.schemaChange.column.name,` · v${a.schemaChange.previousVersion}→v${a.schemaChange.nextVersion}`]}):void 0;return{id:S.length?S.join("|"):`${s}-${l}`,methodId:s,methodLabel:$[s].label,op:a.op??"",offset:f,topic:a.topic??null,table:a.table??null,tsMs:w,pk:y,txnId:a.tx?.id??null,before:a.before??null,after:a.after??null,meta:N}}),[at,$]),hr=c.useMemo(()=>({methodId:le??void 0,op:ce??void 0,table:ie??void 0,txnId:ne||void 0}),[le,ce,ie,ne]),pr=c.useMemo(()=>({methods:C.map(s=>({id:s,label:$[s].label})),ops:xs,tables:Dt,txns:$t}),[Dt,$t,C,$]),_e=c.useMemo(()=>{const s=new Map;return I.forEach(a=>{const f=nt(a).snapshot(),j=["table","id"],w=new Set(j);let S=1;f.forEach(D=>{S=Math.max(S,D.schema?.version??1),D.schema?.columns.forEach(F=>{if(!F)return;const P=F.name;!P||P==="id"||P.startsWith("__")||w.has(P)||(w.add(P),j.push(P))})}),f.forEach(D=>{D.rows.forEach(F=>{Object.keys(F).forEach(P=>{P==="id"||P.startsWith("__")||w.has(P)||(w.add(P),j.push(P))})})});const y=f.flatMap(D=>D.rows.map(F=>{const P=String(F.id),U={};return j.forEach(W=>{if(W==="table"||W==="id"||W.startsWith("__"))return;const J=F[W];U[W]=J??null}),{id:`${D.name}::${P}`,displayId:P,table:D.name,values:U}})).sort((D,F)=>D.id.localeCompare(F.id,void 0,{numeric:!0,sensitivity:"base"})),N=w.has(Qe.name);s.set(a,{columns:j,rows:y,schemaVersion:S,hasSchemaColumn:N})}),s},[I,nt,Ee]),Be=c.useRef(new Map),sn=c.useRef(Re),Pt=c.useRef(0),ys=c.useCallback(s=>{const a=Be.current;a.has(s)||a.set(s,[]);const l=a.get(s),f=nt(s).snapshot().reduce((w,S)=>w+S.rows.length,0),j=l[l.length-1];(l.length===0||j!==f)&&(l.push(f),l.length>Kt&&l.splice(0,l.length-Kt))},[nt]);c.useEffect(()=>{const s=Be.current,a=new Set(I);for(const l of Array.from(s.keys()))a.has(l)||s.delete(l);I.forEach(l=>{s.has(l)||s.set(l,[]);const j=_e.get(l)?.rows.length??0,w=s.get(l);if(!w)return;const S=w[w.length-1];(w.length===0||S!==j)&&(w.push(j),w.length>Kt&&w.splice(0,w.length-Kt))})},[I,_e]),c.useEffect(()=>{le&&!I.includes(le)&&je(null)},[I,le]),c.useEffect(()=>{ie&&!Dt.includes(ie)&&$e(null)},[Dt,ie]),c.useEffect(()=>{ce&&!xs.includes(ce)&&Le(null)},[xs,ce]),c.useEffect(()=>{ne&&!$t.includes(ne)&&Pe("")},[$t,ne]),c.useEffect(()=>{Hs.current=I},[I]),c.useEffect(()=>{zs.current=ae},[ae]),c.useEffect(()=>{Gs.current=ue,ue||(xt.current=0)},[ue]),c.useEffect(()=>{Vs.current=oe},[oe]);const qe=c.useRef(t?.userPinnedScenario??!1),vs=c.useRef(null),we=c.useMemo(()=>lo(Qt,{liveScenario:p??void 0,liveScenarioName:ze,query:O,tags:B}),[p,O,B]),b=c.useMemo(()=>we.length?we.find(s=>s.name===k)??we[0]:Qt[0],[k,we]);c.useEffect(()=>{rt(b)},[b,rt]),c.useEffect(()=>{const s=b.comparator?.preferences;if(!s||typeof s!="object"){vs.current=null;return}vs.current!==b.name&&(Tt(s),vs.current=b.name)},[Tt,b]);const Ft=c.useMemo(()=>{const s=new Map;return I.forEach(a=>{const l=_e.get(a);s.set(a,{present:l?.hasSchemaColumn??!1,version:l?.schemaVersion??1})}),s},[I,_e]),_t=c.useMemo(()=>I.length>0?I.every(s=>Ft.get(s)?.present??!1):!1,[I,Ft]),We=c.useMemo(()=>{let s=1;return I.forEach(a=>{const l=Ft.get(a);l&&l.version>s&&(s=l.version)}),s},[I,Ft]),it=c.useMemo(()=>!!b.tags?.includes("schema"),[b.tags]),nn=c.useMemo(()=>{if(!it)return null;const s=`v${We}`;return _t?`${s} · column present`:`${s} · column absent`},[_t,We,it]);c.useEffect(()=>{Pt.current=0},[b.name]);const _s=c.useMemo(()=>b.table?b.table:b.ops.find(a=>a.table)?.table??"table",[b.ops,b.table]);c.useEffect(()=>{if(!gt)return;const s=window.setTimeout(()=>Lt(!1),2e3);return()=>window.clearTimeout(s)},[gt]),c.useEffect(()=>{if(typeof window>"u")return;const s=window.setTimeout(()=>{V("comparator.event.search",{scenario:b.name,query:be,hasQuery:!!be.trim()})},400);return()=>window.clearTimeout(s)},[be,b.name]),c.useEffect(()=>{sn.current=Re},[Re]),c.useEffect(()=>{we.length&&(we.some(s=>s.name===k)||(qe.current=!1,A(we[0].name)))},[k,we]),c.useEffect(()=>{if(!gt)return;const s=window.setTimeout(()=>Lt(!1),2e3);return()=>window.clearTimeout(s)},[gt]),c.useEffect(()=>{if(typeof window>"u")return;const s=a=>{if(!(a instanceof CustomEvent))return;const l=Ds(a.detail);z(f=>f===l.query?f:l.query),Oe(f=>to(f,l.tags)?f:l.tags)};return window.addEventListener("cdc:scenario-filter",s),window.dispatchEvent(new CustomEvent("cdc:scenario-filter-request")),()=>{window.removeEventListener("cdc:scenario-filter",s)}},[]),c.useEffect(()=>{if(typeof window>"u")return;const s=a=>{if(!(a instanceof CustomEvent))return;const l=a.detail;if(!l||!l.scenario){v(null);return}const f=Array.isArray(l.scenario.ops)?l.scenario.ops:[],j=l.scenario.label??"Workspace (live)",w=l.scenario.description??`${f.length} operations`,S=l.scenario.seed??1;v({name:ze,label:j,description:w,seed:S,ops:f})};return window.addEventListener("cdc:workspace-update",s),window.dispatchEvent(new CustomEvent("cdc:workspace-request")),()=>{window.removeEventListener("cdc:workspace-update",s)}},[]),c.useEffect(()=>{p&&p.ops.length&&(qe.current||A(ze))},[p]),c.useEffect(()=>{if(typeof window>"u")return;const s=a=>{if(!(a instanceof CustomEvent))return;const l=a.detail;Tt(l)};return window.addEventListener("cdc:comparator-preferences-set",s),()=>{window.removeEventListener("cdc:comparator-preferences-set",s)}},[Tt]),c.useEffect(()=>{ka({scenarioId:k,presetId:Q,activeMethods:I,methodConfig:Y,userPinnedScenario:qe.current,showEventList:Ce,eventOps:Te,eventSearch:be,eventLogTable:ie,eventLogTxn:ne,eventLogMethod:le,eventLogOp:ce,applyOnCommit:de,consumerRateEnabled:ee,consumerRateLimit:re,generatorEnabled:ue,generatorRate:oe})},[k,Q,I,Y,Ce,Te,be,ie,ne,le,ce,de,ee,re,ue,oe]);const Ve=c.useRef(null),Ut=c.useRef(null),fe=c.useCallback(()=>{Ut.current!=null&&(window.clearInterval(Ut.current),Ut.current=null)},[]),lt=c.useCallback(()=>{if(se)return;const s={},a=Mt.current;if(a!=null){const S=a*Ne/1e3,y=Fe.current+S;Fe.current=Math.min(y,a*5)}let l=a==null?Number.POSITIVE_INFINITY:Fe.current;const f=S=>S.txnId??`tx-${S.commitTs}`,j=S=>{if(!S.length)return!1;const y=S[S.length-1];return typeof y.txnLast=="boolean"?y.txnLast:typeof y.txnIndex=="number"&&typeof y.txnTotal=="number"?y.txnIndex>=y.txnTotal-1:!0},w=(S,y)=>{const N=me.current[S]??[];let D=N.length?[...N]:[];if(D.length&&(me.current[S]=[]),!D.length){const P=y.bus.consume(y.topic,1);if(!P.length)return[];D=P}const F=f(D[0]);for(;!j(D);){const P=y.bus.consume(y.topic,1);if(!P.length)return me.current[S]=D,[];const U=P[0];if(f(U)!==F){const J=me.current[S]??[];me.current[S]=[U,...J];break}D.push(U)}return D};for(const S of I){const y=ke.current[S];if(!y)continue;let N=[],D=0;if(de){const U=w(S,y);if(!U.length)continue;if(a!=null&&U.length>l){me.current[S]=U;continue}N=U,D=U.length}else{const U=me.current[S]??[];if(U.length){if(a!=null&&U.length>l){me.current[S]=U;continue}N=[...U],D+=U.length,me.current[S]=[]}const W=a==null?Number.POSITIVE_INFINITY:l-D;if(a==null?!0:W>=1){const Z=a==null?50:Math.min(Math.floor(W),50),H=a==null?50:Math.max(Z,0);if(H>0){const ye=y.bus.consume(y.topic,H);ye.length&&(N=N.length?N.concat(ye):ye,D+=ye.length)}}if(!N.length)continue}a!=null&&(l=Math.max(l-D,0));const F=nt(S),P=[];de?(F.applyEvents(N),y.metrics.onConsumed(N),ys(S),N.forEach(U=>{const W=U.__seq??0;P.push(Bs(S,U,W))})):N.forEach(U=>{F.applyEvents([U]),y.metrics.onConsumed([U]),ys(S);const W=U.__seq??0;P.push(Bs(S,U,W))}),xe(S),s[S]=P}a!=null&&(Fe.current=l),Object.keys(s).length!==0&&et(S=>{const y={...S};for(const[N,D]of Object.entries(s)){const F=y[N]??[];y[N]=[...F,...D]}return y})},[I,de,nt,se,ys,xe]),rn=c.useCallback(()=>{fe(),Ut.current=window.setInterval(()=>{Ve.current?.tick(Ne),It(Ne),lt()},Ne)},[fe,lt,It]);c.useEffect(()=>{const s=ee?re:null;Mt.current=s,s==null&&(Fe.current=0)},[ee,re]),c.useEffect(()=>{se||lt()},[se,lt]),c.useEffect(()=>{et(ht(I)),ve(ht(I)),ke.current={},me.current={},st.current={},I.forEach(w=>{st.current[w]=new As}),Be.current=new Map,I.forEach(w=>{Be.current.set(w,[])}),ft(0),De(!1),fe(),rt(b);const s=new Bo,a=[],l={},f={},j=I.map(w=>{const S=Ca(w,D=>Ys(w,D));if(f[w]=S,w==="polling"){const D=Y.polling;S.configure({poll_interval_ms:D.pollIntervalMs,include_soft_deletes:D.includeSoftDeletes})}else if(w==="trigger"){const D=Y.trigger;S.configure({extract_interval_ms:D.extractIntervalMs,trigger_overhead_ms:D.triggerOverheadMs})}else{const D=Y.log;S.configure({fetch_interval_ms:D.fetchIntervalMs})}const y={bus:S.bus,metrics:S.metrics,topic:S.topic,applySchemaChange:S.applySchemaChange};l[w]=y;const N=S.onEvent(D=>{et(F=>{const P={...F},U=P[w]??[];return P[w]=[...U,D],P})});return a.push(N),S});return ke.current=l,fs.current=f,I.forEach(w=>xe(w,{lastOffset:-1})),s.attach(j),s.load(b),s.reset(b.seed),s.onTick(w=>ft(w)),Ve.current=s,()=>{s.pause(),fe(),a.forEach(w=>w()),fs.current={}}},[I,b,fe,Y,xe,Ys,rt]);const mr=c.useCallback(s=>{Ze(a=>{const l=Math.min(tr,C.length);if(a.includes(s))return a.length<=l?a:a.filter(j=>j!==s);if(!C.includes(s))return a;const f=[...a,s];return C.filter(j=>f.includes(j))})},[C]),fr=c.useCallback(s=>{ls(a=>{const l=new Set(a);let f=!1;return l.has(s)?l.size>1&&(l.delete(s),f=!0):(l.add(s),f=!0),f&&V("comparator.event.filter",{scenario:b.name,op:s,active:l.has(s)}),f?l:a})},[b.name]),gr=c.useCallback(s=>{bt(s)},[]),br=c.useCallback(()=>{cs(s=>{const a=!s;return V("comparator.panel.layout",{scenario:b.name,showEvents:a}),a})},[b.name]),xr=c.useCallback(()=>{ds(s=>{const a=!s;return V("comparator.consumer.rate_toggle",{scenario:b.name,enabled:a}),Mt.current=a?re:null,a||(Fe.current=0),a}),ee&&V("comparator.consumer.rate_reset",{scenario:b.name})},[ee,re,b.name]),yr=c.useCallback(s=>{const a=Yt(s,re);a!==re&&(us(a),ee&&(Mt.current=a),V("comparator.consumer.rate_adjust",{scenario:b.name,rate:a}))},[ee,re,b.name]),vr=c.useCallback(()=>{hs(s=>{const a=!s;return V("comparator.generator.toggle",{scenario:b.name,enabled:a}),a})},[b.name]),_r=c.useCallback(s=>{const a=Os(s,oe);a!==oe&&(ps(a),V("comparator.generator.rate_adjust",{scenario:b.name,rate:a}))},[oe,b.name]),wr=c.useCallback(()=>{At(Is,ha),V("comparator.generator.burst",{scenario:b.name,count:Is})},[At,b.name]),Sr=c.useCallback(s=>{s.methodId&&Xt(s.methodId)?je(s.methodId):je(null),$e(s.table??null),Pe(s.txnId??""),Le(s.op?s.op.toLowerCase():null)},[je,Le,$e,Pe]),Er=c.useCallback(()=>{if(at.length===0)return;const s=jo(at);if(!s)return;const a=new Blob([s],{type:"application/x-ndjson"}),l=URL.createObjectURL(a),f=document.createElement("a");f.href=l,f.download=`${b.name}-event-log.ndjson`,f.click(),URL.revokeObjectURL(l),V("comparator.event.download",{scenario:b.name,events:at.length})},[at,b.name]),Cr=c.useCallback(s=>{const a=st.current[s];if(!a)return;const l=a.snapshot(),f=(b.name||"scenario").replace(/[^a-z0-9-_]+/gi,"-"),j={scenario:b.name,method:s,tables:l},w=new Blob([JSON.stringify(j,null,2)],{type:"application/json"}),S=URL.createObjectURL(w),y=document.createElement("a");y.href=S,y.download=`${f}-${s}-destination.json`,y.click(),URL.revokeObjectURL(S);const N=l.reduce((D,F)=>D+(F.rows?.length??0),0);V("comparator.destination.download",{scenario:b.name,method:s,tables:l.length,rows:N})},[b.name]),jr=c.useCallback(()=>{ve(s=>{const a={...s};return I.forEach(l=>{a[l]=[]}),a}),en.current=new WeakMap,V("comparator.event.clear",{scenario:b.name})},[I,b.name]),Lr=c.useCallback(s=>{const a=JSON.stringify({method:s.methodId??null,methodLabel:s.methodLabel??null,op:s.op,offset:s.offset??null,topic:s.topic??null,table:s.table??null,ts_ms:s.tsMs??null,pk:s.pk??null,txnId:s.txnId??null,before:s.before??null,after:s.after??null},null,2);navigator.clipboard.writeText(a).then(()=>V("comparator.event.copy",{scenario:b.name,method:s.methodId??null,op:s.op,offset:s.offset??null})).catch(()=>{V("comparator.event.copy.error",{scenario:b.name,method:s.methodId??null})})},[b.name]),kr=c.useCallback(s=>{if(typeof window>"u")return;const a=typeof s.op=="string"?s.op.trim().toLowerCase():"";if(a!=="c"&&a!=="u"&&a!=="d")return;const l={op:a,before:s.before??null,after:s.after??null,ts_ms:typeof s.tsMs=="number"?s.tsMs:void 0,table:s.table??void 0,key:s.pk?{id:s.pk}:void 0};window.dispatchEvent(new CustomEvent("cdc:workspace-replay-event",{detail:l})),V("comparator.event.replay",{scenario:b.name,method:s.methodId??null,table:s.table??null,op:a})},[b.name]),Mr=c.useCallback(s=>{ns(s)&&(te(s),V("comparator.preset.select",{presetId:s}))},[]),Tr=c.useCallback(s=>{z(s),Me(s,B),V("comparator.scenario.filter",{query:s})},[Me,B]),Ar=c.useCallback(s=>{const a=B.includes(s),l=a?B.filter(f=>f!==s):[...B,s];Oe(l),Me(O,l),V("comparator.scenario.tag_toggle",{tag:s,active:!a})},[Me,O,B]),Ir=c.useCallback(()=>{B.length&&(Oe([]),Me(O,[]),V("comparator.scenario.tag_clear"))},[Me,O,B]),Nr=c.useCallback(s=>{qe.current=!0,A(s),V("comparator.scenario.select",{scenario:s})},[]),Or=c.useCallback(s=>{V("comparator.scenario.preview",{scenario:s.name,tags:s.tags??[]}),window.dispatchEvent(new CustomEvent("cdc:preview-scenario",{detail:s}))},[]),X=c.useMemo(()=>I.map(s=>{const a=Ee[s]??[];return{method:s,events:a,metrics:Ma(a,ae,b,s,tt,yt.current)}}),[I,ae,Ee,b,tt]),Bt=c.useMemo(()=>X.some(s=>s.events.length>0),[X]),wt=c.useMemo(()=>{const s=b.comparator;if(!s||!s.summary)return null;const a=s.summary?pe(s.summary)??s.summary:null;if(!a)return null;const l=Uo(a,Qs),f=pe(s.analytics)??[],j=pe(s.diffs)??[],w=pe(s.overlay)??[],S=s.preset?pe(s.preset)??s.preset:null,y=s.tags.length?[...s.tags]:Array.isArray(b.tags)?[...b.tags]:[],N=f.reduce((W,J)=>{const Z=Number(J.total);return Number.isFinite(Z)?W+Z:W},0),D=Array.isArray(s.lanes)?s.lanes.reduce((W,J)=>{const Z=Number(J.eventCount);return Number.isFinite(Z)?W+Z:W},0):0,F=typeof b.stats?.ops=="number"&&Number.isFinite(b.stats.ops)?b.stats.ops:b.ops.length,P=N||D||F;if(!(P>0))return null;const U=Array.isArray(s.lanes)?s.lanes.map(W=>{const J=typeof W.method=="string"?W.method:void 0;if(!J||!Xt(J))return null;const Z=W.metrics&&typeof W.metrics=="object"&&!Array.isArray(W.metrics)?W.metrics:{},H=(...Ie)=>{for(const Vt of Ie){const Et=Z[Vt];if(typeof Et=="number"&&Number.isFinite(Et))return Et}},ye=$[J];return{id:J,label:ye?.label??J,tooltip:ye?.tooltip,produced:H("produced")??0,consumed:H("consumed")??0,backlog:H("backlog")??0,lagP50:H("lagMsP50","lagP50")??0,lagP95:H("lagMsP95","lagP95")??0,missedDeletes:H("missedDeletes"),writeAmplification:H("writeAmplification"),snapshotRows:H("snapshotRows"),inserts:H("insertCount","inserts")??0,updates:H("updateCount","updates")??0,deletes:H("deleteCount","deletes")??0,schemaChanges:H("schemaChangeCount","schemaChanges")??0}}).filter(W=>!!W):[];return{scenarioName:b.name,scenarioLabel:b.label,scenarioDescription:b.description,isLive:b.name===ze,totalEvents:P,summary:l,lanes:U,analytics:f,tags:y,preset:S,diffs:j,overlay:w}},[$,Qs,b]),ge=c.useMemo(()=>I.reduce((s,a)=>{const l=tt[a],f=l?.metrics,j={backlog:l?.backlog??0,lastOffset:l?.lastOffset??-1,produced:f?.produced??0,consumed:f?.consumed??0,lagMsP50:f?.lagMsP50??0,lagMsP95:f?.lagMsP95??0,missedDeletes:f?.missedDeletes??0,writeAmplification:f?.writeAmplification??0,snapshotRows:f?.snapshotRows??0,errors:f?.errors??0};return s.set(a,j),s},new Map),[I,tt]);c.useEffect(()=>{typeof window>"u"||wt&&(Bt||window.dispatchEvent(new CustomEvent("cdc:comparator-summary",{detail:wt})))},[Bt,wt]);const ws=c.useMemo(()=>I.reduce((s,a)=>s+(ge.get(a)?.backlog??0),0),[I,ge]),Rr=c.useMemo(()=>Ot?I.reduce((s,a)=>{const l=ge.get(a);return l&&(s.produced+=l.produced,s.consumed+=l.consumed,s.backlog+=l.backlog,s.snapshotRows+=l.snapshotRows),s},{produced:0,consumed:0,backlog:0,snapshotRows:0}):{produced:0,consumed:0,backlog:0,snapshotRows:0},[I,ge,Ot]),R=Ta(X),on=c.useMemo(()=>X.reduce((s,a)=>s+a.events.length,0),[X]),ct=c.useMemo(()=>X.map(({method:s,events:a,metrics:l})=>({method:s,label:$[s].label,total:a.length,inserts:l.insertCount,updates:l.updateCount,deletes:l.deleteCount,schemaChanges:l.schemaChangeCount})),[X,$]),an=c.useMemo(()=>ct.reduce((s,a)=>s.set(a.method,a),new Map),[ct]),Ae=c.useMemo(()=>{const s=new Map;return X.forEach(({method:a,events:l})=>{s.set(a,Ko(a,b.ops,l))}),s},[X,b.ops]),ln=c.useMemo(()=>g?I.map(s=>{const a=ge.get(s),l=an.get(s);return{id:s,label:$[s].label,tooltip:$[s].tooltip,produced:a?.produced??0,consumed:a?.consumed??0,backlog:a?.backlog??0,lagP50:a?.lagMsP50??0,lagP95:a?.lagMsP95??0,missedDeletes:a?.missedDeletes,writeAmplification:a?.writeAmplification,snapshotRows:a?.snapshotRows,inserts:l?.inserts??0,updates:l?.updates??0,deletes:l?.deletes??0,schemaChanges:l?.schemaChanges??0}}):[],[I,an,ge,g,$]),St=c.useMemo(()=>I.map(s=>{const a=ge.get(s),l=$[s].label,f=a?.snapshotRows??0;return`${l} ${f}`}).join(", "),[I,ge,$]),qt=c.useMemo(()=>I.map(s=>{const a=Ae.get(s),l=$[s].label,f=a?.totals??{missing:0,extra:0,ordering:0},j=a?.lag?.max??0,w=[];if(f.missing>0&&w.push({key:"missing",text:`${f.missing} missing`,tone:"missing"}),f.extra>0&&w.push({key:"extra",text:`${f.extra} extra`,tone:"extra"}),f.ordering>0&&w.push({key:"ordering",text:`${f.ordering} ordering`,tone:"ordering"}),j>0&&w.push({key:"lag",text:`${Math.round(j)}ms lag`,tone:"lag"}),s==="trigger"){const y=ge.get(s)?.writeAmplification??0,N=da(y);N&&w.push(N)}if(it){const y=_e.get(s),N=y?.schemaVersion??1;y&&!y.hasSchemaColumn?w.push({key:"schema-missing",text:`${Qe.name} missing`,tone:"schema"}):N<We&&w.push({key:"schema-behind",text:`Schema v${N}/${We}`,tone:"schema"})}w.length===0&&w.push({key:"ok",text:"Aligned",tone:"ok"});const S=!!a?.issues.length||(a?.lag?.samples?.length??0)>0||(a?.lag?.max??0)>0;return{method:s,label:l,chips:w,hasDetails:S}}),[I,_e,Ae,ge,$,We,it]),cn=qe.current,Wt=c.useMemo(()=>{const s={scenarioId:k,presetId:Q,activeMethods:[...I],methodConfig:Y,userPinnedScenario:cn,showEventList:Ce,eventOps:Te,eventSearch:be,eventLogTable:ie,eventLogTxn:ne,eventLogMethod:le,eventLogOp:ce,applyOnCommit:de,consumerRateEnabled:ee,consumerRateLimit:re,generatorEnabled:ue,generatorRate:oe};return fa(s,R??null,ct,Ae,Array.isArray(b.tags)?b.tags:[],q,qt,X)},[I,ct,de,ee,re,le,ce,ie,ne,Te,be,ue,oe,Ae,X,qt,Y,q,Q,b,k,Ce,R,cn]),Dr=c.useCallback(s=>{const a=new Date().toISOString(),l=$n(Wt)?Wt:s.comparator??Wt,f={id:s.id,name:s.name,label:s.label,description:s.description,highlight:s.highlight,tags:s.tags,table:s.table,schemaVersion:s.schemaVersion,seed:s.seed,schema:s.schema??[],rows:s.rows??[],events:s.events??[],ops:s.ops,version:2,exportedAt:a,comparator:l},j=new Blob([JSON.stringify(f,null,2)],{type:"application/json"}),w=document.createElement("a");w.href=URL.createObjectURL(j),w.download=`${s.name}.json`,w.click(),URL.revokeObjectURL(w.href);const S=Array.isArray(s.rows)?s.rows.length:0,y=Array.isArray(s.events)?s.events.length:0;V("workspace.scenario.exported",{scenario:s.name,rows:S,events:y,hasComparator:$n(l),methods:I})},[I,Wt,V]);c.useEffect(()=>{typeof window>"u"||window.dispatchEvent(new CustomEvent("cdc:consumer-paused",{detail:{paused:se,backlog:ws}}))},[se,ws]);const $r=c.useCallback(()=>{if(!R)return;const s=[];if(s.push(`${b.label}: ${b.description}`),s.push(`Methods: ${I.map(a=>$[a].label).join(", ")}`),R.bestLag&&s.push(`Fastest ${$[R.bestLag.method].label} at ${Math.round(R.bestLag.metrics.lagMs)}ms`),R.lagSpread>0&&s.push(`${$[R.worstLag.method].label} trails by ${Math.round(R.lagSpread)}ms`),s.push(`Lowest delete capture: ${$[R.lowestDeletes.method].label} (${Math.round(R.lowestDeletes.metrics.deletesPct)}%)`),R.triggerWriteAmplification&&Se(R.triggerWriteAmplification.metrics.writeAmplification)){const a=Je(R.triggerWriteAmplification.metrics.writeAmplification);s.push(`Trigger write amplification: ${$[R.triggerWriteAmplification.method].label} ${a}`)}St&&s.push(`Snapshot rows: ${St}`),s.push(`Ordering: ${R.orderingIssues.length?R.orderingIssues.map(a=>$[a].label).join(", "):"All lanes aligned"}`),b.tags?.length&&s.push(`Tags: ${b.tags.join(", ")}`),navigator.clipboard.writeText(s.join(`
`)).then(()=>Lt(!0)).catch(()=>Lt(!1)),V("comparator.summary.copied",{scenario:b.name,tags:b.tags??[],methods:I})},[R,b,I,$,St]),Pr=c.useCallback(s=>{V("comparator.overlay.inspect",{method:s,scenario:b.name});const a=document.getElementById(`lane-diff-${s}`);a instanceof HTMLDetailsElement?(a.open=!0,a.scrollIntoView({behavior:"smooth",block:"center"})):a&&a.scrollIntoView({behavior:"smooth",block:"center"})},[b.name]),Ss=c.useCallback(s=>{if(!u||!b.tags?.includes("schema"))return;const a=Math.max(ae,Pt.current+Ne);Pt.current=a,I.forEach(l=>{ke.current[l]?.applySchemaChange?.(_s,s,Qe,a),xe(l)}),V("comparator.schema.change",{action:s,table:_s,scenario:b.name,commitTs:a,methods:I})},[I,ae,ke,u,_s,b.name,b.tags,xe]),Fr=c.useMemo(()=>{if(!u||!b.tags?.includes("schema"))return;const s=I[0];if(s)return a=>a!==s?null:n.jsx(wo,{columnName:Qe.name,onAdd:()=>Ss("add"),onDrop:()=>Ss("drop"),disableAdd:_t,disableDrop:!_t,status:nn})},[I,Ss,_t,u,nn,b.tags]),dt=c.useCallback((s,a,l)=>{is(f=>({...f,[s]:{...f[s],[a]:l}}))},[]),ut=c.useCallback(s=>{const a=Ve.current;if(a){rt(b),a.reset(b.seed),et(ht(I)),ve(ht(I)),me.current={},Be.current.forEach(l=>l.splice(0));for(const l of I){st.current[l]=new As;const f=ke.current[l];f&&(f.bus.reset(f.topic),f.metrics.reset(),xe(l,{lastOffset:-1}))}ft(0),Fe.current=0,Pt.current=0,s?.keepLoop||(a.pause(),De(!1),fe())}},[I,rt,b,b.seed,fe,xe]),Es=c.useCallback(()=>{const s=Ve.current;s&&(ut({keepLoop:!0}),s.start(),De(!0),rn(),Ct("play",{scenario:b.name}))},[ut,rn,b.name]),Cs=c.useCallback(()=>{Ve.current?.pause(),De(!1),fe(),Ct("pause",{scenario:b.name})},[fe,b.name]),Ur=c.useCallback(()=>{gs&&as(s=>{const a=!s;return V("comparator.consumer.toggle",{scenario:b.name,paused:a}),a||lt(),a})},[lt,gs,b.name]),js=c.useCallback((s=Ne)=>{const a=Ve.current;if(!a)return;const l=sn.current;l||a.start(),a.tick(s),It(s),l||a.pause(),Ct("step",{deltaMs:s,scenario:b.name})},[It,b.name]),dn=c.useCallback((s,a)=>{const l=Ve.current;if(!l)return;const f=Math.max(10,a??Ne);ut({keepLoop:!1});const j=Math.max(s,0);l.start();let w=0,S=0;for(;w<j&&S<1e4;){const y=Math.min(f,j-w);l.tick(y),w+=y,S+=1}l.pause(),De(!1),Ct("seek",{targetMs:s,stepMs:a,scenario:b.name})},[ut,b.name]),Ls=c.useCallback(()=>{bt(""),je(null),$e(null),Le(null),Pe(""),ut(),Ct("reset",{scenario:b.name})},[ut,b.name,je,Le,$e,Pe,bt]);return c.useEffect(()=>{if(typeof window>"u")return;const s={play:()=>Es(),pause:()=>Cs(),step:l=>js(l),seek:(l,f)=>dn(l,f),reset:()=>Ls()};window.cdcComparatorClock=s;const a=l=>{if(!(l instanceof CustomEvent))return;const f=l.detail;if(f)switch(f.type){case"play":s.play();break;case"pause":s.pause();break;case"step":s.step(f.deltaMs);break;case"seek":s.seek(f.timeMs,f.stepMs);break;case"reset":s.reset();break}};return window.addEventListener("cdc:comparator-clock",a),()=>{window.removeEventListener("cdc:comparator-clock",a),window.cdcComparatorClock===s&&delete window.cdcComparatorClock}},[Cs,Ls,dn,Es,js]),c.useEffect(()=>{if(typeof window>"u")return;const s={getLaneSnapshot:a=>pa(_e.get(a)),getLaneHistory:a=>[...Be.current.get(a)??[]],resetHistory:()=>{Be.current.forEach(a=>a.splice(0))}};return window.cdcComparatorDebug=s,()=>{window.cdcComparatorDebug===s&&delete window.cdcComparatorDebug}},[_e,I]),c.useEffect(()=>{typeof window>"u"||window.dispatchEvent(new CustomEvent("cdc:comparator-clock-tick",{detail:{clock:ae}}))},[ae]),c.useEffect(()=>()=>fe(),[fe]),c.useEffect(()=>{if(typeof window>"u"||!Bt&&wt)return;const s=R?{lagSpread:R.lagSpread,bestLag:{method:R.bestLag.method,label:$[R.bestLag.method].label,metrics:R.bestLag.metrics},worstLag:{method:R.worstLag.method,label:$[R.worstLag.method].label,metrics:R.worstLag.metrics},lowestDeletes:{method:R.lowestDeletes.method,label:$[R.lowestDeletes.method].label,metrics:R.lowestDeletes.metrics},highestDeletes:{method:R.highestDeletes.method,label:$[R.highestDeletes.method].label,metrics:R.highestDeletes.metrics},orderingIssues:R.orderingIssues.map(y=>({method:y,label:$[y].label})),triggerWriteAmplification:R.triggerWriteAmplification&&Se(R.triggerWriteAmplification.metrics.writeAmplification)?{method:R.triggerWriteAmplification.method,label:$[R.triggerWriteAmplification.method].label,value:R.triggerWriteAmplification.metrics.writeAmplification??0}:null}:null,a=X.map(({method:y,metrics:N})=>({method:y,label:$[y].label,tooltip:$[y].tooltip,metrics:N})),l=b.table??b.ops.find(y=>y.table)?.table??"table";let f=l;try{f=q.topicFormat(l)}catch{f=l}const j={id:q.id,label:q.label,description:q.description,docsHint:q.docsHint,source:{label:q.sourceLabel,tooltip:q.sourceTooltip},log:{label:q.logLabel,tooltip:q.logTooltip},bus:{label:q.busLabel,tooltip:q.busTooltip,exampleTopic:f},destination:{label:q.destinationLabel,tooltip:q.destinationTooltip},methods:C.map(y=>({id:y,label:$[y].label,tooltip:$[y].tooltip??null}))},w=X.map(({method:y})=>{const N=Ae.get(y);return N?{method:y,totals:N.totals,issues:N.issues.slice(0,25),lag:N.lag}:{method:y,totals:{missing:0,extra:0,ordering:0},issues:[],lag:{max:0,samples:[]}}}),S=I.map(y=>{const N=Ae.get(y);return N?{method:y,label:$[y].label,totals:N.totals,issues:N.issues.slice(0,10),lag:{max:N.lag.max,samples:N.lag.samples.slice(0,10)}}:{method:y,label:$[y].label,totals:{missing:0,extra:0,ordering:0},issues:[],lag:{max:0,samples:[]}}});window.dispatchEvent(new CustomEvent("cdc:comparator-summary",{detail:{scenarioName:b.name,scenarioLabel:b.label,scenarioDescription:b.description,isLive:b.name===ze,totalEvents:on,summary:s,lanes:a,analytics:ct,tags:B,preset:j,diffs:w,overlay:S}}))},[I,ct,Bt,Ae,X,$,q,b,wt,B,R,on]),n.jsxs("section",{className:"sim-shell","aria-label":"Simulator preview",children:[n.jsxs("header",{className:"sim-shell__header",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"sim-shell__title",children:"CDC Method Comparator"}),n.jsx("p",{className:"sim-shell__description",children:q.description}),n.jsxs("div",{className:"sim-shell__preset-row",role:"list","aria-label":"Selected vendor pipeline",children:[n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":q.sourceTooltip,role:"listitem",children:["Source · ",q.sourceLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":q.logTooltip,role:"listitem",children:["Capture · ",q.logLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":q.busTooltip,role:"listitem",children:["Transport · ",q.busLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":q.destinationTooltip,role:"listitem",children:["Sink · ",q.destinationLabel]})]}),n.jsxs("p",{className:"sim-shell__description sim-shell__description--meta",children:[q.label,q.docsHint?n.jsxs(n.Fragment,{children:[" · ",n.jsx("a",{href:q.docsHint,target:"_blank",rel:"noopener noreferrer",children:"Reference"})]}):null]})]}),n.jsxs("div",{className:"sim-shell__scenario-filter-row",role:"group","aria-label":"Filter scenarios",children:[n.jsxs("label",{className:"sim-shell__scenario-search",children:[n.jsx("span",{children:"Search scenarios"}),n.jsx("input",{type:"search",value:O,onChange:s=>Tr(s.target.value),placeholder:"Find by label, description, or tag"})]}),Js.length>0?n.jsxs("div",{className:"sim-shell__scenario-tags",role:"group","aria-label":"Scenario tags",children:[Js.map(s=>n.jsxs("button",{type:"button",className:"sim-shell__scenario-tag","data-active":Ks.has(s)?"true":"false","aria-pressed":Ks.has(s),onClick:()=>Ar(s),children:["#",s]},s)),B.length?n.jsx("button",{type:"button",className:"sim-shell__scenario-tag sim-shell__scenario-tag--clear",onClick:Ir,children:"Clear"}):null]}):null]}),n.jsxs("div",{className:"sim-shell__actions sim-shell__actions--scenario",role:"group","aria-label":"Scenario controls",children:[n.jsx("select",{"aria-label":"Vendor preset",value:Q,onChange:s=>Mr(s.target.value),children:ir.map(s=>n.jsx("option",{value:s.id,children:s.label},s.id))}),n.jsx("select",{"aria-label":"Scenario",value:k,onChange:s=>Nr(s.target.value),children:we.map(s=>n.jsx("option",{value:s.name,children:s.label},s.name))}),n.jsxs("div",{className:"sim-shell__scenario-actions",children:[n.jsx("button",{type:"button",className:"sim-shell__scenario-sync",onClick:()=>{b.name!==ze&&window.dispatchEvent(new CustomEvent("cdc:apply-scenario-template",{detail:{id:b.name}}))},disabled:b.name===ze,children:"Load in workspace"}),n.jsx("button",{type:"button",className:"sim-shell__scenario-download",onClick:()=>Dr(b),children:"Download JSON"}),n.jsx("button",{type:"button",className:"sim-shell__scenario-preview",onClick:()=>Or(b),children:"Preview"})]}),n.jsx("div",{className:"sim-shell__method-toggle",role:"group","aria-label":"Methods to display",children:C.map(s=>n.jsx("button",{type:"button",className:"sim-shell__method-chip","aria-pressed":I.includes(s),onClick:()=>mr(s),"data-tooltip":$[s].tooltip||void 0,children:$[s].label},s))})]})]}),n.jsxs("p",{className:"sim-shell__description","aria-live":"polite",children:[n.jsxs("strong",{children:[b.label,":"]})," ",b.description]}),b.highlight&&n.jsx("p",{className:"sim-shell__description sim-shell__description--highlight","aria-live":"polite",children:b.highlight}),b.tags?.length?n.jsx("div",{className:"sim-shell__tag-row","aria-label":"Scenario tags",children:b.tags.map(s=>n.jsxs("span",{className:"sim-shell__tag-chip",children:["#",s]},s))}):null,b.stats&&n.jsxs("p",{className:"sim-shell__description sim-shell__description--meta","aria-live":"polite",children:[b.stats.rows," rows · ",b.stats.ops," ops"]}),n.jsxs("div",{className:"sim-shell__event-filters",role:"group","aria-label":"Event filters",children:[se&&n.jsx("div",{className:"sim-shell__pause-banner",role:"status","aria-live":"polite",children:"Apply paused. Resume to drain the event bus."}),n.jsxs("label",{className:"sim-shell__event-search",children:[n.jsx("span",{children:"Search events"}),n.jsx("input",{type:"search",value:be,onChange:s=>gr(s.target.value),placeholder:"Filter by pk, seq, or payload"})]}),n.jsx("div",{className:"sim-shell__event-ops",role:"group","aria-label":"Change operations",children:Xe.map(s=>n.jsx("button",{type:"button",className:"sim-shell__event-op","data-active":Xs.has(s)?"true":"false",onClick:()=>fr(s),children:s.toUpperCase()},s))}),n.jsx("button",{type:"button",className:"sim-shell__event-toggle",onClick:br,children:Ce?"Hide timeline":"Show timeline"})]}),cr&&n.jsx(mo,{className:"sim-shell__event-log",events:ur,stats:Rr,totalCount:bs.length,filters:hr,filterOptions:pr,onFiltersChange:Sr,onDownload:Er,onClear:jr,onCopyEvent:Lr,onReplayEvent:kr,maxVisibleEvents:ba}),Ue&&(Ue.rows.length>0||Ue.placeholder)&&n.jsx("section",{className:"sim-shell__harness-history","aria-label":"Harness nightly history",children:n.jsxs("details",{children:[n.jsx("summary",{children:"Harness nightly history"}),Ue.rows.length>0?n.jsx("div",{className:"sim-shell__harness-history-table-wrapper",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsx("tr",{children:Ue.headers.map(s=>n.jsx("th",{children:s},s))})}),n.jsx("tbody",{children:Ue.rows.map((s,a)=>n.jsx("tr",{children:s.map((l,f)=>{const j=l.text||"—",w=l.href?n.jsx("a",{href:l.href,target:"_blank",rel:"noreferrer noopener",children:j}):j,S=l.emphasis?n.jsx("em",{children:w}):w;return n.jsx("td",{children:S},`harness-cell-${a}-${f}`)})},`harness-row-${a}`))})]})}):n.jsx("p",{className:"sim-shell__harness-history-empty",children:Ue.placeholder??"No harness runs captured yet."})]})}),n.jsxs("div",{className:"sim-shell__actions",role:"group","aria-label":"Playback controls","data-tour-target":M?"comparator-actions":void 0,children:[n.jsx("button",{type:"button",onClick:Es,disabled:Re,children:"Start"}),n.jsx("button",{type:"button",onClick:Cs,disabled:!Re,children:"Pause"}),n.jsxs("button",{type:"button",onClick:()=>js(),children:["Step +",Ne,"ms"]}),n.jsx("button",{type:"button",onClick:Ls,children:"Reset"}),gs&&n.jsxs("button",{type:"button",onClick:Ur,className:"sim-shell__consumer-toggle","data-tooltip":K.backlog,children:[se?"Resume apply":"Pause apply",Ot?` (${ws} queued)`:""]}),m&&n.jsxs("label",{className:"sim-shell__apply-toggle","data-tooltip":K.txnAtomic||void 0,children:[n.jsx("input",{type:"checkbox",checked:de,onChange:s=>kt(s.target.checked)}),n.jsx("span",{children:"Apply on commit"})]}),n.jsxs("div",{className:"sim-shell__consumer-rate",role:"group","aria-label":"Apply rate limit","data-enabled":ee?"true":"false",children:[n.jsx("button",{type:"button",onClick:xr,children:ee?"Disable throttle":"Throttle apply"}),n.jsxs("label",{children:[n.jsx("span",{children:ee?`${re} events/s`:"Unlimited"}),n.jsx("input",{type:"range",min:sr,max:nr,step:ua,value:re,onChange:s=>yr(Number(s.target.value)),disabled:!ee})]})]}),n.jsxs("div",{className:"sim-shell__generator",role:"group","aria-label":"Event generator","data-enabled":ue?"true":"false",children:[n.jsx("button",{type:"button",onClick:vr,children:ue?"Stop generator":"Start generator"}),n.jsxs("label",{children:[n.jsx("span",{children:ue?`${oe} events/s`:`Set ${oe} events/s`}),n.jsx("input",{type:"range",min:rr,max:or,step:Us,value:oe,onChange:s=>_r(Number(s.target.value)),disabled:!ue})]}),n.jsxs("button",{type:"button",onClick:wr,children:["Burst +",Is]})]})]}),n.jsx("div",{className:"sim-shell__controls","aria-label":"Method tuning controls",children:C.map(s=>{const a=I.includes(s);if(s==="polling"){const f=Y.polling;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":a?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:$[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Adjust poll cadence and whether soft deletes are surfaced."}),lr?n.jsxs(n.Fragment,{children:[n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsxs("span",{children:["Poll interval (",(f.pollIntervalMs/1e3).toFixed(1),"s)"]}),n.jsx("input",{type:"range",min:500,max:1e4,step:100,value:f.pollIntervalMs,onChange:j=>dt("polling","pollIntervalMs",Math.min(1e4,Math.max(500,Number(j.target.value)||500)))})]}),n.jsxs("p",{className:"sim-shell__control-hint",children:["⏱️ Polling every ",(f.pollIntervalMs/1e3).toFixed(1),"s"]})]}):n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Poll interval (ms)"}),n.jsx("input",{type:"number",min:100,step:100,value:f.pollIntervalMs,onChange:j=>dt("polling","pollIntervalMs",Math.min(1e4,Math.max(100,Number(j.target.value)||500)))})]}),n.jsxs("label",{className:"sim-shell__control-checkbox",children:[n.jsx("input",{type:"checkbox",checked:f.includeSoftDeletes,onChange:j=>dt("polling","includeSoftDeletes",j.target.checked)}),n.jsx("span",{children:"Include soft delete marker column"})]})]},s)}if(s==="trigger"){const f=Y.trigger;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":a?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:$[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Tune audit extractor cadence and per-write trigger overhead."}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Extractor interval (ms)"}),n.jsx("input",{type:"number",min:100,step:50,value:f.extractIntervalMs,onChange:j=>dt("trigger","extractIntervalMs",Math.max(50,Number(j.target.value)||0))})]}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Trigger overhead (ms)"}),n.jsx("input",{type:"number",min:0,step:1,value:f.triggerOverheadMs,onChange:j=>dt("trigger","triggerOverheadMs",Math.max(0,Number(j.target.value)||0))})]})]},s)}const l=Y.log;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":a?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:$[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Control how frequently the WAL/Binlog fetcher polls for new records."}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Fetch interval (ms)"}),n.jsx("input",{type:"number",min:10,step:10,value:l.fetchIntervalMs,onChange:f=>dt("log","fetchIntervalMs",Math.max(10,Number(f.target.value)||0))})]})]},s)})}),g&&R&&n.jsxs("div",{className:"sim-shell__summary","aria-live":"polite",children:[n.jsxs("ul",{children:[n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":K.lagSpread,children:"Lag spread:"})," ",$[R.bestLag.method].label," is leading at",` ${R.bestLag.metrics.lagMs.toFixed(0)}ms`,R.lagSpread>0?` — ${$[R.worstLag.method].label} trails by ${R.lagSpread.toFixed(0)}ms`:" (no spread)"]}),n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":K.deleteCapture,children:"Delete capture:"})," ",$[R.lowestDeletes.method].label," is lowest at",` ${R.lowestDeletes.metrics.deletesPct.toFixed(0)}%`," · best is ",$[R.highestDeletes.method].label,` (${R.highestDeletes.metrics.deletesPct.toFixed(0)}%)`]}),St&&n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":K.snapshot,children:"Snapshot rows:"})," ",St]}),R.triggerWriteAmplification&&Se(R.triggerWriteAmplification.metrics.writeAmplification)&&n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":K.triggerOverhead,children:"Trigger overhead:"})," ",$[R.triggerWriteAmplification.method].label," is at"," ",Je(R.triggerWriteAmplification.metrics.writeAmplification)," ","write amplification"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Ordering:"}),R.orderingIssues.length===0?" All methods preserved ordering":` Issues: ${R.orderingIssues.map(s=>$[s].label).join(", ")}`]})]}),n.jsx("button",{type:"button",className:"sim-shell__summary-copy",onClick:$r,children:gt?"Copied":"Copy summary"})]}),qt.length>0&&n.jsxs("section",{className:"sim-shell__overlay-summary","aria-label":"Lane checks",children:[n.jsxs("header",{children:[n.jsx("h3",{children:"Lane checks"}),n.jsx("p",{children:"Quick glance at diff findings and lag hotspots across active capture methods."})]}),n.jsx("ul",{children:qt.map(s=>n.jsxs("li",{className:"sim-shell__overlay-row",children:[n.jsx("div",{className:"sim-shell__overlay-label",children:s.label}),n.jsx("div",{className:"sim-shell__overlay-chips",children:s.chips.map(a=>n.jsx("span",{className:`sim-shell__overlay-chip sim-shell__overlay-chip--${a.tone}`,children:a.text},`${s.method}-${a.key}`))}),s.hasDetails&&n.jsx("button",{type:"button",className:"sim-shell__overlay-action",onClick:()=>Pr(s.method),children:"Inspect"})]},s.method))})]}),ln.length>0&&n.jsx(vo,{lanes:ln,renderSchemaWalkthrough:Fr}),n.jsx("div",{className:"sim-shell__lane-grid","data-tour-target":M?"comparator-lanes":void 0,children:X.map(({method:s,metrics:a,events:l},f)=>{const j=$[s],w=j.laneDescription,S=Ae.get(s)??null,y=f===0,N=ge.get(s),D=ke.current[s],F=_e.get(s),P=F?.rows.slice(0,xa)??[],U=(F?.rows.length??0)>P.length,W=u&&it&&F?{version:F.schemaVersion,expectedVersion:We,hasColumn:F.hasSchemaColumn,columnName:Qe.name}:u&&it?{version:0,expectedVersion:We,hasColumn:!1,columnName:Qe.name}:void 0,J=s==="trigger"?N?.writeAmplification??a.writeAmplification:void 0,Z=Se(J)?J:void 0,H=[],ye=s==="polling"?"warning":"info";j.callout&&(s==="polling"&&a.deletesPct<100?H.push({text:`${j.callout} (${a.deletesPct.toFixed(0)}% of deletes captured in this scenario)`,tone:ye}):H.push({text:j.callout,tone:ye})),u&&b.tags?.includes("schema")&&(s==="trigger"&&typeof Z=="number"&&H.push({text:`Write amplification ${Je(Z)}`,tone:"info"}),s==="log"&&H.push({text:"Log capture streams schema changes in-order, keeping downstream versions aligned.",tone:"info"}),s==="polling"&&H.push({text:"Polling picks up new columns once refreshed rows include them; expect interim nulls.",tone:"warning"})),b.tags?.includes("transactions")&&H.push({text:de?"Apply-on-commit groups transaction events before updating destinations so tables stay in sync.":"Apply-on-commit is off: events apply individually, so pausing mid-transaction shows partial state.",tone:de?"info":"warning"});const Ie=dr.get(s)??l,Vt=Ie.length!==l.length||ot.length>0||Xs.size<Xe.length,Et=Ce&&Ie.length>Ns,un=Ce?Ie.slice(Math.max(Ie.length-Ns,0)):[];return n.jsxs("article",{className:"sim-shell__lane-card",children:[n.jsxs("header",{className:"sim-shell__lane-header","data-tour-target":M&&y&&f===0?"comparator-callouts":void 0,children:[n.jsxs("div",{children:[n.jsx("h3",{className:"sim-shell__lane-title","data-tooltip":j.tooltip||void 0,children:j.label}),n.jsx("p",{className:"sim-shell__lane-copy",children:w})]}),n.jsxs("span",{className:"sim-shell__lane-count",children:[Ie.length,Vt?` / ${l.length}`:""," events"]})]}),g&&n.jsx("div",{className:"sim-shell__metrics","data-tour-target":M&&y?"comparator-metrics":void 0,children:n.jsx(_o,{...a})}),n.jsx(ra,{diff:S,scenarioName:b.name,laneId:s,schemaStatus:W}),Ot&&n.jsxs("section",{className:"sim-shell__lane-bus","aria-label":`${j.label} event bus`,"data-paused":se?"true":"false",children:[n.jsxs("header",{children:[n.jsx("h4",{children:"Event Bus"}),n.jsx("span",{children:D?.topic??`cdc.${s}`})]}),n.jsxs("p",{children:[n.jsxs("span",{"data-tooltip":K.backlog,children:["Backlog ",n.jsx("strong",{children:N?.backlog??0}),se?" (apply paused)":""]})," · ",n.jsxs("span",{"data-tooltip":K.offset,children:["Last offset ",N?.lastOffset??-1]})]}),n.jsxs("p",{children:["Produced ",N?.produced??0," · Consumed ",N?.consumed??0]}),n.jsxs("p",{"data-tooltip":K.snapshot,children:["Snapshot rows ",N?.snapshotRows??0]}),n.jsxs("p",{"data-tooltip":K.lagPercentile,children:["Lag p50 ",Math.round(N?.lagMsP50??0),"ms · p95 ",Math.round(N?.lagMsP95??0),"ms"]}),s==="trigger"&&typeof Z=="number"&&n.jsxs("p",{"data-tooltip":K.triggerWriteAmplification,children:["Write amplification: ",Je(Z)]}),s==="polling"&&n.jsxs("p",{className:"sim-shell__lane-bus-warning","data-tooltip":K.deleteCapture,children:["Missed deletes: ",N?.missedDeletes??0]}),N&&N.errors>0&&n.jsxs("p",{className:"sim-shell__lane-bus-warning",children:["Errors: ",N.errors]})]}),F&&n.jsxs("section",{className:"sim-shell__destination","aria-label":`${j.label} destination snapshot`,children:[n.jsxs("header",{children:[n.jsxs("div",{className:"sim-shell__destination-title",children:[n.jsx("h4",{children:"Destination snapshot"}),n.jsxs("span",{children:["schema v",F.schemaVersion]})]}),n.jsx("div",{className:"sim-shell__destination-actions",children:n.jsx("button",{type:"button",className:"sim-shell__destination-download",onClick:()=>Cr(s),disabled:F.rows.length===0,children:"Download JSON"})})]}),P.length>0?n.jsx("div",{className:"sim-shell__destination-table",role:"table",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsx("tr",{children:F.columns.map(G=>n.jsx("th",{"data-highlight":G===Qe.name?"true":void 0,children:G},G))})}),n.jsx("tbody",{children:P.map(G=>n.jsx("tr",{children:F.columns.map(Ge=>n.jsx("td",{children:Sa(Ge==="id"?G.displayId:Ge==="table"?G.table:G.values[Ge])},`${G.id}-${Ge}`))},G.id))})]})}):n.jsx("p",{className:"sim-shell__destination-empty",children:"No rows applied yet."}),U&&n.jsxs("p",{className:"sim-shell__destination-note",children:["Showing ",P.length," of ",F.rows.length," rows."]})]}),n.jsxs("dl",{className:"sim-shell__lane-config",children:[s==="polling"&&(()=>{const G=Y.polling;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Poll interval"}),n.jsxs("dd",{"data-tooltip":K.pollingInterval,children:[G.pollIntervalMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Soft deletes"}),n.jsx("dd",{"data-tooltip":K.pollingSoftDeletes,children:G.includeSoftDeletes?"included":"ignored"})]})]})})(),s==="trigger"&&(()=>{const G=Y.trigger;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Extractor interval"}),n.jsxs("dd",{"data-tooltip":K.triggerExtractorInterval,children:[G.extractIntervalMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Trigger overhead"}),n.jsxs("dd",{"data-tooltip":K.triggerOverhead,children:[G.triggerOverheadMs," ms"]})]}),typeof Z=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Write amplification"}),n.jsx("dd",{"data-tooltip":K.triggerWriteAmplification,children:Je(Z)})]})]})})(),s==="log"&&(()=>{const G=Y.log;return n.jsxs("div",{children:[n.jsx("dt",{children:"Fetch interval"}),n.jsxs("dd",{"data-tooltip":K.logFetchInterval,children:[G.fetchIntervalMs," ms"]})]})})()]}),H.length>0&&n.jsx("div",{className:"sim-shell__callouts",children:H.map((G,Ge)=>n.jsx("p",{className:`sim-shell__callout${G.tone==="warning"?" sim-shell__callout--warning":""}`,"data-tour-target":M&&y&&Ge===0?"comparator-callouts":void 0,children:G.text},`${s}-callout-${Ge}`))}),n.jsxs("section",{className:"sim-shell__lane-why","aria-label":`When to use ${j.label}`,children:[n.jsx("h4",{children:"When to use"}),n.jsx("p",{children:j.whenToUse})]}),Ce?n.jsxs("ul",{className:"sim-shell__event-list","aria-live":"polite",children:[Et&&n.jsx("li",{className:"sim-shell__event sim-shell__event--notice",children:n.jsxs("span",{children:["Showing latest ",Ns," of ",Ie.length," matching events."]})}),un.length===0?n.jsx("li",{className:"sim-shell__empty",children:Vt?"No events match the current filters.":"No events yet."}):un.map(G=>n.jsxs("li",{className:`sim-shell__event${G.op==="d"?" sim-shell__event--delete":""}`,children:[n.jsx("span",{className:"sim-shell__event-op","data-op":G.op,children:G.op}),n.jsxs("span",{children:["#",G.seq," · pk=",G.pk.id]}),n.jsxs("span",{className:"sim-shell__event-target",children:["ts=",G.ts_ms,"ms"]})]},`${s}-${G.seq}`))]}):n.jsx("p",{className:"sim-shell__lane-hidden",children:"Timeline hidden. Use “Show timeline” to view recent events."})]},s)})}),n.jsxs("footer",{className:"sim-shell__footer",children:["Scenario clock: ",ae,"ms · ",X.reduce((s,a)=>s+a.events.length,0)," total events emitted"]})]})}function qn(){if(typeof window>"u")return;const e=window.telemetry;if(e&&typeof e.track=="function"&&typeof e.flush=="function")return e;let t;try{t=window.localStorage}catch{t=void 0}const r=No({storage:t,console:typeof console<"u"?{warn:console.warn.bind(console),debug:console.debug.bind(console)}:void 0});return window.telemetry=r,r}function Wn(){const e=document.getElementById("simShellRoot");if(!e){console.warn("Simulator UI shell mount point not found (simShellRoot).");return}qr.createRoot(e).render(n.jsx(Aa,{}))}document.readyState==="loading"?(qn(),document.addEventListener("DOMContentLoaded",Wn,{once:!0})):(qn(),Wn());
