import{r as d,j as n,T as Fs,S as In,R as An}from"./event-log-widget.js";class Dn{constructor(){this.topics=new Map}publish(e,a){if(a.length===0)return[];const r=this.ensure(e);return a.map(u=>{const m=++r.offset,v={...u,offset:m};return r.queue.push(v),v})}consume(e,a=1){const r=this.ensure(e);return a<=0?[]:r.queue.splice(0,a)}size(e){return this.ensure(e).queue.length}reset(e){if(e){this.topics.delete(e);return}this.topics.clear()}ensure(e){let a=this.topics.get(e);return a||(a={offset:-1,queue:[]},this.topics.set(e,a)),a}}class On{constructor(){this.produced=0,this.consumed=0,this.backlog=0,this.lagSamples=[],this.missedDeletes=0,this.writeAmplification=0,this.snapshotRows=0,this.errors=0,this.lagAggregators=new Set}onProduced(e){this.produced+=e.length,this.backlog+=e.length}onConsumed(e){this.consumed+=e.length,this.backlog=Math.max(this.backlog-e.length,0);const a=Date.now();e.forEach(r=>{const u=typeof r.commitTs=="number"?r.commitTs:typeof r.ts_ms=="number"?r.ts_ms:a,m=Math.max(a-u,0);this.lagSamples.push(m)}),this.lagSamples.length>2e3&&this.lagSamples.splice(0,this.lagSamples.length-2e3),this.notifyLagAggregators()}registerLagAggregator(e){return this.lagAggregators.add(e),this.safeInvokeAggregator(e),()=>{this.lagAggregators.delete(e)}}recordMissedDelete(e=1){this.missedDeletes+=e}recordWriteAmplification(e=1){this.writeAmplification+=e}recordSnapshotRows(e){this.snapshotRows=e}recordError(){this.errors+=1}reset(){this.produced=0,this.consumed=0,this.backlog=0,this.lagSamples=[],this.missedDeletes=0,this.writeAmplification=0,this.snapshotRows=0,this.errors=0,this.notifyLagAggregators()}snapshot(){const e=[...this.lagSamples].sort((u,m)=>u-m),a=this.percentile(e,.5),r=this.percentile(e,.95);return{produced:this.produced,consumed:this.consumed,backlog:this.backlog,lagMsP50:a,lagMsP95:r,missedDeletes:this.missedDeletes,writeAmplification:this.writeAmplification,snapshotRows:this.snapshotRows,errors:this.errors}}safeInvokeAggregator(e,a){try{const r=a?[...a]:[...this.lagSamples];e(r)}catch{}}notifyLagAggregators(){if(this.lagAggregators.size===0)return;const e=[...this.lagSamples];this.lagAggregators.forEach(a=>{this.safeInvokeAggregator(a,e)})}percentile(e,a){if(!e.length)return 0;const r=Math.max(e.length-1,0)*a,u=Math.floor(r),m=Math.min(u+1,e.length-1);if(u===m)return e[u];const v=r-u;return e[u]+(e[m]-e[u])*v}}class Nn{constructor(){this.tasks=new Map,this.nextId=1}every(e,a){const r=this.nextId++,u={id:r,interval:e,handler:a};this.tasks.set(r,u);const m=setInterval(()=>a(),e);return u.timerId=m,r}clear(e){if(e!=null){const a=this.tasks.get(e);a&&a.timerId&&clearInterval(a.timerId),this.tasks.delete(e);return}this.tasks.forEach(a=>{const r=a.timerId;r&&clearInterval(r)}),this.tasks.clear()}}class Rn{constructor(e,a,r,u,m,v={}){this.mode=e,this.bus=a,this.scheduler=r,this.metrics=u,this.handlers=v,this.state="IDLE",this.topic=m??`cdc.${e.toLowerCase()}`}get currentState(){return this.state}get topicName(){return this.topic}startSnapshot(e){this.state==="IDLE"&&(this.state="SNAPSHOTTING",this.handlers.startSnapshot?.(e,a=>this.emit(a)))}startTailing(){this.state!=="TAILING"&&(this.state="TAILING",this.handlers.startTailing?.(e=>this.emit(e)))}pause(){this.state==="TAILING"&&(this.state="PAUSED")}resume(){this.state==="PAUSED"&&(this.state="TAILING")}stop(){this.state="IDLE",this.scheduler.clear(),this.handlers.stop?.(),this.bus.reset(this.topic),this.metrics.reset()}emit(e){if(e.length===0)return[];const a=this.bus.publish(this.topic,e);return this.metrics.onProduced(a),a}}let $n=0;const Rt=()=>`evt-${Date.now()}-${++$n}`,ct=t=>t?JSON.parse(JSON.stringify(t)):null,ms=(t,e)=>`${t}::${e}`,gs=(t,e)=>({id:t.name,type:t.type,nullable:t.nullable??!1,__ts:e}),fs=(t,e,a=`tx-${e}`)=>{const r=t?.id??a,u=typeof t?.index=="number",m=u?t.index:void 0,v=typeof t?.total=="number"?t.total:void 0;let E;return typeof t?.last=="boolean"?E=t.last:u&&typeof v=="number"?E=m>=v-1:E=!t,{id:r,index:m,total:v,last:E}};function Pn(){let t=null,e=null,a=100,r=0;const u=new Map,m=[];let v=0;const E=new Map,M=g=>{const T=E.get(g);return typeof T=="number"&&T>=1?T:(E.set(g,1),1)},I=g=>{const T=M(g),l=T+1;return E.set(g,l),{previous:T,next:l}},D=(g,T,l,p,o)=>{const b=fs(g.txn,o);return{id:Rt(),kind:T,table:g.table,before:l?{id:g.pk.id,...l,__ts:o}:void 0,after:p?{id:g.pk.id,...p,__ts:o}:void 0,txnId:b.id,txnIndex:b.index,txnTotal:b.total,txnLast:b.last,commitTs:o,schemaVersion:M(g.table),topic:t?.topic??`cdc.${g.table}`,partition:0}},_=(g,T,l,p)=>{if(!e||!t)return;const{previous:o,next:b}=I(g),j=fs(void 0,p,`schema-${p}`),k={id:Rt(),kind:T==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:g,before:T==="DROP_COLUMN"?gs(l,p):void 0,after:T==="ADD_COLUMN"?gs(l,p):void 0,txnId:j.id,txnIndex:j.index,txnTotal:j.total,txnLast:j.last,commitTs:p,schemaVersion:b,topic:t.topic??`cdc.${g}`,partition:0,schemaChange:{action:T,column:l,previousVersion:o,nextVersion:b}};e([k])};return{id:"LOG_BASED",initialise(g){t=g},configure(g){const T=Number(g.fetch_interval_ms??g.fetchIntervalMs);Number.isFinite(T)&&T>0&&(a=T)},startSnapshot(g=[],T){if(e=T,!g.length||(g.forEach(p=>{const o=p.schema?.version??1;E.set(p.name,o),p.rows.forEach(b=>{const j=ms(p.name,b.id);u.set(j,{id:b.id,table:p.name,data:{...b},version:1,updatedAt:b.__ts??0,deleted:!1})})}),t?.metrics.recordSnapshotRows(u.size),!u.size))return;const l=[];u.forEach(p=>{l.push({id:Rt(),kind:"INSERT",table:p.table,before:void 0,after:{id:p.id,...p.data,__ts:p.updatedAt},txnId:`snapshot-${p.updatedAt}`,txnIndex:0,txnTotal:1,txnLast:!0,commitTs:p.updatedAt,schemaVersion:M(p.table),topic:t?.topic??`cdc.${p.table}`,partition:0})}),e(l),v=m.length},startTailing(g){e=g},applySource(g){if(!t)return;const T=g.t,l=ms(g.table,g.pk.id);if(M(g.table),g.op==="insert")u.set(l,{id:g.pk.id,table:g.table,data:{...g.after},version:1,updatedAt:T,deleted:!1}),m.push(D(g,"INSERT",null,ct(g.after),T));else if(g.op==="update"){const p=u.get(l),o=p?ct(p.data):null,b=p?{...p.data,...g.after}:{...g.after};u.set(l,{id:g.pk.id,table:g.table,data:b,version:(p?.version??0)+1,updatedAt:T,deleted:!1}),m.push(D(g,"UPDATE",o,ct(b),T))}else if(g.op==="delete"){const p=u.get(l);u.set(l,{id:g.pk.id,table:g.table,data:p?{...p.data}:{},version:(p?.version??0)+1,updatedAt:T,deleted:!0}),m.push(D(g,"DELETE",p?ct(p.data):null,null,T))}},applySchemaChange(g,T,l,p){t&&(M(g),T==="ADD_COLUMN"?u.forEach((o,b)=>{o.table===g&&(l.name in o.data||(o.data[l.name]=null,u.set(b,{...o,data:{...o.data}})))}):T==="DROP_COLUMN"&&u.forEach((o,b)=>{if(o.table===g&&l.name in o.data){const j={...o.data};delete j[l.name],u.set(b,{...o,data:j})}}),_(g,T,l,p))},tick(g){if(!e||g-r<a)return;const T=m.slice(v);T.length&&(e(T),v=m.length),r=g},pause(){},resume(){},stop(){u.clear(),m.length=0,v=0,e=null,t=null,E.clear(),r=0}}}let Fn=0;const $t=()=>`evt-${Date.now()}-${++Fn}`,bs=t=>t?JSON.parse(JSON.stringify(t)):null,xs=(t,e)=>`${t}::${e}`,vs=(t,e)=>({id:t.name,type:t.type,nullable:t.nullable??!1,__ts:e}),ys=(t,e,a=`tx-${e}`)=>{const r=t?.id??a,m=!1?t.index:void 0,v=void 0;let E;return E=!0,{id:r,index:m,total:v,last:E}};function Un(){let t=null,e=null,a=1e3,r=!1,u=0;const m=new Map,v=new Map,E=new Map,M=[],I=l=>{const p=E.get(l);return typeof p=="number"&&p>=1?p:(E.set(l,1),1)},D=l=>{const p=I(l),o=p+1;return E.set(l,o),{previous:p,next:o}},_=(l,p,o,b,j,k,N,q)=>{const Q=ys(q,k,N);return{id:$t(),kind:o,table:l,before:b?{id:p,...b,__ts:k}:void 0,after:j?{id:p,...j,__ts:k}:void 0,txnId:Q.id,txnIndex:Q.index,txnTotal:Q.total,txnLast:Q.last,commitTs:k,schemaVersion:I(l),topic:t?.topic??`cdc.${l}`,partition:0}},g=(l,p,o,b)=>{const{previous:j,next:k}=D(l),N=ys(void 0,b,`schema-${b}`);M.push({id:$t(),kind:p==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:l,before:p==="DROP_COLUMN"?vs(o,b):void 0,after:p==="ADD_COLUMN"?vs(o,b):void 0,txnId:N.id,txnIndex:N.index,txnTotal:N.total,txnLast:N.last,commitTs:b,schemaVersion:k,topic:t?.topic??`cdc.${l}`,partition:0,schemaChange:{action:p,column:o,previousVersion:j,nextVersion:k}})},T=l=>{!l.length||!e||e(l)};return{id:"QUERY_BASED",initialise(l){t=l},configure(l){const p=Number(l.poll_interval_ms??l.pollIntervalMs);Number.isFinite(p)&&p>0&&(a=p),l.include_soft_deletes!=null&&(r=!!l.include_soft_deletes),l.includeSoftDeletes!=null&&(r=!!l.includeSoftDeletes)},startSnapshot(l=[],p){e=p;const o=[];l.forEach(b=>{const j=b.schema?.version??1;E.set(b.name,j),b.rows.forEach(k=>{const N=xs(b.name,k.id);m.set(N,{id:k.id,table:b.name,data:{...k},version:1,updatedAt:k.__ts??0,deleted:!1}),v.set(N,1);const{id:q,__ts:Q,...je}=k;o.push({id:$t(),kind:"INSERT",table:b.name,before:void 0,after:{id:q,...je,__ts:Q??0},txnId:`snapshot-${k.__ts??0}`,txnIndex:0,txnTotal:1,txnLast:!0,commitTs:k.__ts??0,schemaVersion:I(b.name),topic:t?.topic??`cdc.${b.name}`,partition:0})})}),t?.metrics.recordSnapshotRows(o.length),T(o)},startTailing(l){e=l},applySource(l){const p=xs(l.table,l.pk.id),o=l.t;if(I(l.table),l.op==="insert")m.set(p,{id:l.pk.id,table:l.table,data:{...l.after},version:1,updatedAt:o,deleted:!1});else if(l.op==="update"){const b=m.get(p),j=b?{...b.data,...l.after}:{...l.after};m.set(p,{id:l.pk.id,table:l.table,data:j,version:(b?.version??0)+1,updatedAt:o,deleted:!1})}else if(l.op==="delete"){const b=m.get(p);m.set(p,{id:l.pk.id,table:l.table,data:b?{...b.data}:{},version:(b?.version??0)+1,updatedAt:o,deleted:!0})}},applySchemaChange(l,p,o,b){I(l),p==="DROP_COLUMN"&&m.forEach((j,k)=>{if(j.table===l&&o.name in j.data){const N={...j.data};delete N[o.name],m.set(k,{...j,data:N})}}),g(l,p,o,b)},tick(l){if(!e||l-u<a)return;const p=[];M.length&&p.push(...M.splice(0,M.length)),m.forEach((o,b)=>{if(o.updatedAt<=u)return;const j=v.get(b)??0;if(o.deleted){r?(p.push(_(o.table,o.id,"DELETE",bs(o.data),null,o.updatedAt,`tx-${o.updatedAt}`)),v.set(b,o.version)):(t?.metrics.recordMissedDelete(),v.set(b,o.version));return}if(o.version<=j)return;const k=j===0?"INSERT":"UPDATE";p.push(_(o.table,o.id,k,null,bs(o.data),o.updatedAt,`tx-${o.updatedAt}`)),v.set(b,o.version)}),T(p),u=l},stop(){m.clear(),v.clear(),E.clear(),M.length=0,e=null,t=null,u=0}}}let Bn=0;const _s=()=>`evt-${Date.now()}-${++Bn}`,dt=t=>t?JSON.parse(JSON.stringify(t)):null,Vn=(t,e)=>`${t}::${e}`,ws=(t,e)=>({id:t.name,type:t.type,nullable:t.nullable??!1,__ts:e}),Ss=(t,e,a=`tx-${e}`)=>{const r=t?.id??a,u=typeof t?.index=="number",m=u?t.index:void 0,v=typeof t?.total=="number"?t.total:void 0;let E;return typeof t?.last=="boolean"?E=t.last:u&&typeof v=="number"?E=m>=v-1:E=!t,{id:r,index:m,total:v,last:E}};function qn(){let t=null,e=null,a=250,r=8,u=0,m=0;const v=new Map,E=[],M=new Map,I=l=>{const p=M.get(l);return typeof p=="number"&&p>=1?p:(M.set(l,1),1)},D=l=>{const p=I(l),o=p+1;return M.set(l,o),{previous:p,next:o}},_=(l,p,o,b,j)=>{const k=Ss(l.txn,j);return{id:_s(),kind:p,table:l.table,before:o?{id:l.pk.id,...o,__ts:j}:void 0,after:b?{id:l.pk.id,...b,__ts:j}:void 0,txnId:k.id,txnIndex:k.index,txnTotal:k.total,txnLast:k.last,commitTs:j,schemaVersion:I(l.table),topic:t?.topic??`cdc.${l.table}`,partition:0}},g=(l,p,o,b)=>{const{previous:j,next:k}=D(l),N=Ss(void 0,b,`schema-${b}`),q={id:_s(),kind:p==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:l,before:p==="DROP_COLUMN"?ws(o,b):void 0,after:p==="ADD_COLUMN"?ws(o,b):void 0,txnId:N.id,txnIndex:N.index,txnTotal:N.total,txnLast:N.last,commitTs:b,schemaVersion:k,topic:t?.topic??`cdc.${l}`,partition:0,schemaChange:{action:p,column:o,previousVersion:j,nextVersion:k}};E.push({event:q})},T=l=>{!l.length||!e||e(l)};return{id:"TRIGGER_BASED",initialise(l){t=l},configure(l){const p=Number(l.extract_interval_ms??l.extractIntervalMs);Number.isFinite(p)&&p>0&&(a=p);const o=Number(l.trigger_overhead_ms??l.triggerOverheadMs);Number.isFinite(o)&&o>=0&&(r=o)},startSnapshot(l=[],p){e=p,t?.metrics.recordSnapshotRows(0)},startTailing(l){e=l},applySource(l){if(!t)return;const p=Vn(l.table,l.pk.id),o=l.t+r;let b=null,j=null,k;if(I(l.table),l.op==="insert")k="INSERT",j=dt(l.after),v.set(p,{id:l.pk.id,table:l.table,data:{...l.after},version:1,updatedAt:o,deleted:!1});else if(l.op==="update"){const N=v.get(p);b=N?dt(N.data):null;const q=N?{...N.data,...l.after}:{...l.after};j=dt(q),k="UPDATE",v.set(p,{id:l.pk.id,table:l.table,data:q,version:(N?.version??0)+1,updatedAt:o,deleted:!1})}else if(l.op==="delete"){const N=v.get(p);b=N?dt(N.data):null,j=null,k="DELETE",v.set(p,{id:l.pk.id,table:l.table,data:N?{...N.data}:{},version:(N?.version??0)+1,updatedAt:o,deleted:!0})}else return;E.push({event:_(l,k,b,j,o)}),t.metrics.recordWriteAmplification(1)},applySchemaChange(l,p,o,b){if(!t)return;const j=b+r;I(l),p==="ADD_COLUMN"?v.forEach((k,N)=>{if(k.table===l&&!(o.name in k.data)){const q={...k.data,[o.name]:null};v.set(N,{...k,data:q,version:k.version+1,updatedAt:j})}}):p==="DROP_COLUMN"&&v.forEach((k,N)=>{if(k.table===l&&o.name in k.data){const q={...k.data};delete q[o.name],v.set(N,{...k,data:q,version:k.version+1,updatedAt:j})}}),g(l,p,o,j)},tick(l){if(!e||l-u<a)return;const p=E.slice(m).map(o=>o.event);T(p),m=E.length,u=l},stop(){E.length=0,v.clear(),e=null,t=null,m=0,u=0,M.clear()}}}const gt={MYSQL_DEBEZIUM:{id:"MYSQL_DEBEZIUM",label:"MySQL · Debezium · Kafka",description:"Debezium tails the MySQL binlog and pushes commits to Kafka for downstream consumers.",docsHint:"https://debezium.io/documentation/reference/stable/connectors/mysql.html",sourceLabel:"MySQL primary",sourceTooltip:"InnoDB workload emitting row-level changes for capture.",logLabel:"MySQL binlog (Debezium)",logTooltip:"Debezium connector streams row-format binlog entries in commit order.",busLabel:"Kafka topic",busTooltip:"Kafka transports Debezium change events (e.g. db.orders) to consumers.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Analytics warehouse, service, or cache subscribing to the Kafka topic.",topicFormat:t=>`db.${t}`,methodCopyOverrides:{polling:{label:"Polling (scheduled SQL)",laneDescription:"Batch jobs diff the MySQL table on an interval to detect divergence.",callout:"Misses hard deletes and rapid updates without custom tracking tables.",whenToUse:"Fallback when binlog access is blocked. Accepts lag and data loss for small tables only.",tooltip:"ETL-style SELECT polling against the MySQL primary."},trigger:{label:"Triggers (audit table)",laneDescription:"AFTER triggers write every mutation into an audit table for downstream extract.",callout:"Adds synchronous latency on the write path and increases operational overhead.",whenToUse:"When connectors are unavailable but you still need complete change history.",tooltip:"MySQL triggers populate audit tables that an extractor drains."},log:{label:"Debezium binlog tail",laneDescription:"Debezium streams row-based binlog events into Kafka with schema evolution support.",callout:"Preferred default: low-impact, ordered, near real-time change capture.",whenToUse:"Standard choice for production MySQL workloads when Kafka + Debezium are available.",tooltip:"Debezium connector tailing the MySQL binlog."}}},POSTGRES_LOGICAL:{id:"POSTGRES_LOGICAL",label:"Postgres · Logical decoding · Kafka",description:"Logical decoding streams Postgres WAL changes (pgoutput/wal2json) into Kafka.",docsHint:"https://www.postgresql.org/docs/current/logicaldecoding.html",sourceLabel:"Postgres primary",sourceTooltip:"OLTP Postgres emitting WAL entries for publications.",logLabel:"Logical replication slot",logTooltip:"Logical decoding slot materialises committed WAL changes via pgoutput or wal2json.",busLabel:"Kafka topic",busTooltip:"Kafka topics per publication (e.g. public.orders) fan out change events.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Consumers applying logical changes into warehouses or services.",topicFormat:t=>`public.${t}`,methodCopyOverrides:{polling:{label:"Polling (snapshot queries)",laneDescription:"Incremental SELECT queries compare current rows to previous snapshots.",callout:"Can't observe deletes or mid-transaction updates without tombstone columns.",whenToUse:"Stopgap for small tables when logical replication isn't permitted.",tooltip:"Periodic comparison queries against Postgres source tables."},trigger:{label:"Triggers (audit schema)",laneDescription:"Triggers populate audit tables that an extractor tails outside the WAL.",callout:"Higher write amplification and maintenance across replicas.",whenToUse:"When WAL access is off-limits yet complete history is required.",tooltip:"AFTER triggers write into audit tables for downstream capture."},log:{label:"Logical decoding stream",laneDescription:"Slot-based logical decoding streams ordered WAL changes through Kafka.",callout:"Best balance: ordered, low-impact capture with schema evolution support.",whenToUse:"Primary choice when you can run wal2json/pgoutput connectors.",tooltip:"Logical replication slot feeding Kafka via connectors."}}},SQLSERVER_CDC:{id:"SQLSERVER_CDC",label:"SQL Server · CDC tables · ETL",description:"SQL Server CDC populates change tables that ETL tools ship downstream.",docsHint:"https://learn.microsoft.com/sql/relational-databases/track-changes/about-change-data-capture-sql-server",sourceLabel:"SQL Server OLTP",sourceTooltip:"Source database with CDC enabled on tracked tables.",logLabel:"CDC change tables",logTooltip:"Log reader agent populates [cdc].[schema_table_CT] from the transaction log.",busLabel:"ETL pipeline",busTooltip:"ADF/SSIS or similar ETL pipelines move captured rows to consumers.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Lakehouse, staging DB, or microservice applying captured rows.",topicFormat:t=>`cdc.${t}_ct`,methodCopyOverrides:{polling:{label:"Polling (T-SQL jobs)",laneDescription:"Scheduled queries compare source tables against a shadow copy.",callout:"Hard deletes vanish and rapid updates collapse to last-write wins.",whenToUse:"Only when CDC can't be enabled. Expect drift and operational overhead.",tooltip:"Agent jobs issuing SELECT deltas against the primary."},trigger:{label:"DB triggers (audit tables)",laneDescription:"DDL-driven triggers write into audit tables that ETL picks up.",callout:"Adds synchronous writes and complicates deployments.",whenToUse:"Fallback for editions without CDC but needing full fidelity.",tooltip:"FOR INSERT/UPDATE/DELETE triggers persisting rows into audit tables."},log:{label:"CDC change table stream",laneDescription:"Native CDC surfaces ordered change rows ready for downstream ETL.",callout:"Balanced approach: leverages log reader agent with minimal code.",whenToUse:"Default when SQL Server Enterprise/Standard CDC is available.",tooltip:"Change Data Capture tables populated by the log reader agent."}}},ORACLE_GG:{id:"ORACLE_GG",label:"Oracle · GoldenGate",description:"GoldenGate extracts Oracle redo into trails that replicat apply downstream.",docsHint:"https://docs.oracle.com/en/middleware/goldengate/",sourceLabel:"Oracle primary",sourceTooltip:"Oracle Database generating redo entries for tracked schemas.",logLabel:"Redo / GoldenGate trail",logTooltip:"Extract captures redo logs into GoldenGate trail files.",busLabel:"GoldenGate distribution",busTooltip:"GoldenGate distribution path replicates changes to targets or Kafka.",destinationLabel:"Replica / downstream sink",destinationTooltip:"Target database, cache, or Kafka topic consuming GoldenGate trails.",topicFormat:t=>`ogg.${t}`,methodCopyOverrides:{polling:{label:"Polling (custom jobs)",laneDescription:"Scripts query Oracle tables for deltas outside of GoldenGate.",callout:"Expensive and incomplete without change tracking columns.",whenToUse:"Rare stopgap for small tables when GoldenGate access is unavailable.",tooltip:"Ad-hoc jobs diffing source tables over DB links or snapshots."},trigger:{label:"Triggers (shadow tables)",laneDescription:"Row-level triggers populate shadow tables for downstream capture.",callout:"Adds redo volume and requires meticulous deployment management.",whenToUse:"Fallback when GoldenGate licensing or access is restricted.",tooltip:"Oracle triggers mirroring mutations into custom staging tables."},log:{label:"GoldenGate redo tail",laneDescription:"GoldenGate Extract/Replicat stream redo into ordered trail files.",callout:"Enterprise-grade: minimal source impact with robust replication semantics.",whenToUse:"Primary approach for Oracle sources requiring guaranteed replication.",tooltip:"GoldenGate Extract reading redo logs into trail files."}}},MONGODB_STREAMS:{id:"MONGODB_STREAMS",label:"MongoDB · Change Streams",description:"Change Streams tail the MongoDB oplog and push updates to subscribers.",docsHint:"https://www.mongodb.com/docs/manual/changeStreams/",sourceLabel:"MongoDB replica set",sourceTooltip:"Replica set primary emitting operations into the oplog.",logLabel:"Change stream (oplog)",logTooltip:"Change Stream cursor streams oplog events filtered per namespace.",busLabel:"Driver subscriber",busTooltip:"Driver / connector pushes stream events to downstream sinks (Kafka/Atlas).",destinationLabel:"Streaming sink",destinationTooltip:"Analytical store or service consuming the stream.",topicFormat:t=>`mongo.${t}`,methodCopyOverrides:{polling:{label:"Polling (find queries)",laneDescription:"Scheduled queries diff collections by last-updated timestamps.",callout:"No delete visibility and heavy load for high-churn collections.",whenToUse:"Only for prototypes without Change Stream or oplog access.",tooltip:"find() queries scanning for updated documents on an interval."},trigger:{label:"Hooks (side-write)",laneDescription:"Application-layer hooks write audit documents alongside originals.",callout:"Requires app changes and doubles write throughput.",whenToUse:"When database triggers/log access is unavailable and app control exists.",tooltip:"Custom middleware duplicating writes into audit collections."},log:{label:"Change Stream tail",laneDescription:"Native Change Stream cursor fans out oplog events in order.",callout:"Recommended: low-latency stream with resume tokens and schema support.",whenToUse:"Default for MongoDB replicas when you can open a Change Stream cursor.",tooltip:"MongoDB Change Stream subscription on the oplog."}}}},ft="cdc_playground_template_filter_v1",bt="cdc_playground_template_filter_tags_v1",yt={query:"",tags:[]},Gn=t=>typeof t=="string"?t:"",Us=t=>{if(!Array.isArray(t))return[];const e=new Set,a=[];return t.forEach(r=>{if(r==null)return;const u=String(r).trim();!u||e.has(u)||(e.add(u),a.push(u))}),a},Bt=t=>{if(!t||typeof t!="object")return{...yt};const e=Gn(typeof t.query=="string"?t.query:""),a=t.tags;if(Array.isArray(a))return{query:e,tags:Us(a)};if(typeof a=="string"){const r=a.trim();return{query:e,tags:r?[r]:[]}}return{query:e,tags:[]}},Wn=(t,e)=>{if(t===e)return!0;if(t.length!==e.length)return!1;for(let a=0;a<t.length;a+=1)if(t[a]!==e[a])return!1;return!0},Hn=t=>typeof t!="string"?"":t,zn=t=>{if(typeof t!="string"||t.trim().length===0)return[];try{const e=JSON.parse(t);if(Array.isArray(e))return Us(e)}catch{}return[]},Qn=t=>{if(!t)return{...yt};try{const e=Hn(t.getItem(ft)),a=zn(t.getItem(bt));return{query:e,tags:a}}catch{return{...yt}}},Kn=(t,e)=>{if(!e)return;const a=Bt(t);try{a.query?e.setItem(ft,a.query):typeof e.removeItem=="function"?e.removeItem(ft):e.setItem(ft,"")}catch{}try{a.tags.length>0?e.setItem(bt,JSON.stringify(a.tags)):typeof e.removeItem=="function"?e.removeItem(bt):e.setItem(bt,"")}catch{}},Jn=t=>typeof t=="string"?t.trim().toLowerCase():"",Es=t=>Array.isArray(t)?t.map(e=>typeof e=="string"?e.trim():"").filter(e=>e.length>0):[],Yn=t=>{const e=[];return t.label&&e.push(t.label),t.description&&e.push(t.description),t.highlight&&e.push(t.highlight),t.name&&e.push(t.name),Array.isArray(t.tags)&&t.tags.length>0&&e.push(t.tags.join(" ")),e.join(" ").toLowerCase()};function Xn(t,e={}){const a=Array.from(t),{liveScenario:r,liveScenarioName:u,tags:m,query:v}=e;if(r){const I=a.findIndex(D=>D.name===r.name);I>=0?a.splice(I,1,r):a.unshift(r)}const E=Es(m),M=Jn(v);return a.filter(I=>{if(u&&I.name===u)return!0;if(E.length>0){const _=Es(I.tags??[]);if(!E.every(T=>_.includes(T)))return!1}if(!M)return!0;const D=Yn(I);return D?D.includes(M):!1})}const Pt=(t,e)=>{Array.isArray(e)&&e.forEach(a=>{if(typeof a!="string")return;const r=a.trim();r.length>0&&t.add(r)})};function Zn(t,e={}){const a=new Set;return t.forEach(r=>Pt(a,r.tags)),e.liveScenario&&Pt(a,e.liveScenario.tags),e.additionalTags?.forEach(r=>Pt(a,r)),Array.from(a).sort((r,u)=>r.localeCompare(u))}const Vt=t=>{if(Array.isArray(t))return t.map(e=>Vt(e));if(t&&typeof t=="object"){const e={};return Object.entries(t).forEach(([a,r])=>{e[a]=Vt(r)}),e}return t},xt=t=>Vt(t),Bs=t=>({...t}),js=t=>({name:t.name,version:t.version,columns:t.columns.map(Bs)}),ea=(t,e)=>typeof e=="boolean"?"bool":typeof e=="number"?/_ts$|timestamp$/i.test(t)?"timestamp":"number":e instanceof Date?"timestamp":"string",ta=(t,e=1)=>({name:t,version:e,columns:[{name:"id",type:"string",nullable:!1}]}),Cs=t=>{t.columns.some(a=>a.name==="id")||t.columns.unshift({name:"id",type:"string",nullable:!1})},Ls=t=>{const e=xt(t);return e.id=String(e.id),e};class Ft{constructor(e=[]){this.tables=new Map,e.forEach(a=>this.upsertTable(a))}upsertTable(e){const a=js(e.schema);Cs(a);const r=new Map;e.rows.forEach(u=>{const m=Ls(xt(u));r.set(m.id,m)}),this.tables.set(e.name,{schema:a,rows:r})}replaceAll(e){this.tables.clear(),e.forEach(a=>this.upsertTable(a))}getTable(e){const a=this.tables.get(e);if(a)return{name:e,schema:js(a.schema),rows:Array.from(a.rows.values()).map(r=>xt(r))}}listTables(){return Array.from(this.tables.keys()).map(e=>this.getTable(e)).filter(e=>!!e)}clear(){this.tables.clear()}applyEvents(e){e.forEach(a=>this.applyEvent(a))}applyEvent(e){if(!e?.table)return;if(e.kind==="SCHEMA_ADD_COL"||e.kind==="SCHEMA_DROP_COL"){this.applySchemaChange(e);return}const a=this.ensureTableState(e.table,e.schemaVersion);if(e.schemaVersion&&e.schemaVersion>a.schema.version&&(a.schema.version=e.schemaVersion),e.kind==="DELETE"){const M=e.before?.id??e.after?.id;M!=null&&a.rows.delete(String(M));return}const r=e.after??void 0;if(!r)return;const u=Ls(r),m=a.rows.get(u.id),v=m?{...m,...u}:u,E=xt(v);this.syncSchemaColumns(a,E),a.rows.set(E.id,E)}snapshot(){return this.listTables()}ensureTableState(e,a){let r=this.tables.get(e);return r||(r={schema:ta(e,a??1),rows:new Map},this.tables.set(e,r)),a&&a>r.schema.version&&(r.schema.version=a),Cs(r.schema),r}applySchemaChange(e){const a=e.schemaChange;if(!a)return;const r=this.ensureTableState(e.table,a.nextVersion??e.schemaVersion);r.schema.version=Math.max(r.schema.version,a.nextVersion??e.schemaVersion??r.schema.version),e.kind==="SCHEMA_ADD_COL"?this.addColumn(r,a.column):e.kind==="SCHEMA_DROP_COL"&&this.dropColumn(r,a.column.name)}addColumn(e,a){const r=e.schema.columns.find(u=>u.name===a.name);r?(r.type=a.type,a.nullable&&(r.nullable=!0)):e.schema.columns.push(Bs(a)),e.rows.forEach(u=>{a.name in u||(u[a.name]=null)})}dropColumn(e,a){a!=="id"&&(e.schema.columns=e.schema.columns.filter(r=>r.name!==a),e.rows.forEach(r=>{a in r&&delete r[a]}))}syncSchemaColumns(e,a){const r=e.schema.columns;Object.entries(a).forEach(([u,m])=>{if(u==="id"||u.startsWith("__"))return;let v=r.find(E=>E.name===u);v||(v={name:u,type:ea(u,m)},r.push(v)),m==null&&(v.nullable=!0)})}}const sa=2e3,ut={methods:[],ops:[],tables:[],txns:[]},ks={empty:"No events yet.",noMatch:"No events match the current filters."},Ms=t=>{if(!t)return"";try{const e=JSON.stringify(t);return e?e.length>160?`${e.slice(0,160)}…`:e:""}catch{return""}},na=t=>{if(!t)return"—";const e=t.trim();return e?(e.length===1,e.toUpperCase()):"—"},aa=({events:t,stats:e,totalCount:a,filters:r={},filterOptions:u,onFiltersChange:m,onDownload:v,onClear:E,onCopyEvent:M,onReplayEvent:I,maxVisibleEvents:D=sa,emptyMessage:_,noMatchMessage:g,className:T})=>{const l={methods:u?.methods??ut.methods,ops:u?.ops??ut.ops,tables:u?.tables??ut.tables,txns:u?.txns??ut.txns},p=d.useMemo(()=>typeof D!="number"||D<=0?t.length:Math.min(D,t.length),[t.length,D]),[o,b]=d.useState(p);d.useEffect(()=>{b(w=>w<p?p:w>t.length?t.length:w)},[p,t.length]);const j=d.useMemo(()=>{const w=Math.max(o,0),G=Math.max(t.length-w,0);return t.slice(G)},[t,o]),k=j.length<t.length,N=o>p,q=()=>{if(!k)return;const w=p>0?p:t.length;b(G=>Math.min(G+w,t.length))},Q=()=>{b(p)},je=typeof a=="number"?a:t.length,Ce=!!r.methodId||!!r.op||!!r.table||!!r.txnId,Ve={empty:_??ks.empty,noMatch:g??ks.noMatch},J=w=>{if(!m)return;const G={methodId:w.methodId===void 0?r.methodId:w.methodId,op:w.op===void 0?r.op:w.op,table:w.table===void 0?r.table:w.table,txnId:w.txnId===void 0?r.txnId:w.txnId},W={methodId:G.methodId||void 0,op:G.op||void 0,table:G.table||void 0,txnId:G.txnId||void 0};m(W)},qe=w=>{const G=Ms(w.before),W=Ms(w.after);return!G&&!W?null:n.jsxs("details",{className:"cdc-event-log__details",children:[n.jsx("summary",{children:"Row image"}),G&&n.jsxs("div",{className:"cdc-event-log__details-row",children:[n.jsx("span",{children:"before"}),n.jsx("code",{children:G})]}),W&&n.jsxs("div",{className:"cdc-event-log__details-row",children:[n.jsx("span",{children:"after"}),n.jsx("code",{children:W})]})]})};return n.jsxs("section",{className:`cdc-event-log${T?` ${T}`:""}`,"aria-label":"Event log",role:"region",children:[n.jsxs("header",{className:"cdc-event-log__header",children:[n.jsxs("div",{className:"cdc-event-log__headline",children:[n.jsx("h3",{children:"Event Log"}),e&&n.jsxs("p",{className:"cdc-event-log__stats",children:[n.jsxs("span",{children:["Produced ",e.produced]})," · ",n.jsxs("span",{children:["Consumed ",e.consumed]})," · ",n.jsxs("span",{children:["Backlog ",e.backlog]}),typeof e.snapshotRows=="number"&&n.jsxs(n.Fragment,{children:[" · ",n.jsxs("span",{children:["Snapshot rows ",e.snapshotRows]})]})]})]}),n.jsxs("div",{className:"cdc-event-log__actions",children:[n.jsxs("span",{children:[t.length," events"]}),n.jsx("button",{type:"button",onClick:v,disabled:!v||t.length===0,children:"Download NDJSON"}),n.jsx("button",{type:"button",onClick:E,disabled:!E||je===0,children:"Clear"})]})]}),n.jsxs("div",{className:"cdc-event-log__filters",role:"group","aria-label":"Event log filters",children:[n.jsxs("label",{children:[n.jsx("span",{children:"Method"}),n.jsxs("select",{value:r.methodId??"",onChange:w=>J({methodId:w.target.value||void 0}),disabled:!m||l.methods.length===0,children:[n.jsx("option",{value:"",children:"All methods"}),l.methods.map(w=>n.jsx("option",{value:w.id,children:w.label},w.id))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Operation"}),n.jsxs("select",{value:r.op??"",onChange:w=>J({op:w.target.value||void 0}),disabled:!m||l.ops.length===0,children:[n.jsx("option",{value:"",children:"All ops"}),l.ops.map(w=>n.jsx("option",{value:w,children:w.toUpperCase()},w))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Table"}),n.jsxs("select",{value:r.table??"",onChange:w=>J({table:w.target.value||void 0}),disabled:!m||l.tables.length===0,children:[n.jsx("option",{value:"",children:"All tables"}),l.tables.map(w=>n.jsx("option",{value:w,children:w},w))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Txn"}),n.jsxs("select",{value:r.txnId??"",onChange:w=>J({txnId:w.target.value||void 0}),disabled:!m||l.txns.length===0,children:[n.jsx("option",{value:"",children:"All txns"}),l.txns.map(w=>n.jsx("option",{value:w,children:w},w))]})]})]}),t.length===0?n.jsx("p",{className:"cdc-event-log__empty",children:je>0||Ce?Ve.noMatch:Ve.empty}):n.jsxs("ul",{className:"cdc-event-log__list",children:[t.length>j.length&&n.jsxs("li",{className:"cdc-event-log__notice",children:[n.jsxs("span",{children:["Showing latest ",j.length," of ",t.length," events."]}),n.jsxs("div",{className:"cdc-event-log__notice-actions",children:[n.jsx("button",{type:"button",onClick:q,disabled:!k,children:"Load more"}),N&&n.jsx("button",{type:"button",onClick:Q,children:"Show latest"})]})]}),j.map(w=>{const G=na(w.op),W=typeof w.offset=="number"?w.offset:w.offset==null?"—":w.offset,_t=w.topic??"—",z=w.table??"—",Ye=w.pk??"—",ge=w.txnId??"",Le=typeof w.tsMs=="number"?w.tsMs:"—",Y=typeof w.op=="string"?w.op.trim().toLowerCase():"",wt=Y==="c"||Y==="u"||Y==="d";return n.jsxs("li",{className:"cdc-event-log__item",children:[n.jsx("span",{className:"cdc-event-log__method",children:w.methodLabel??w.methodId??"—"}),n.jsx("span",{className:"cdc-event-log__op","data-op":G,children:G}),n.jsxs("span",{className:"cdc-event-log__offset",children:["offset ",W]}),n.jsx("span",{className:"cdc-event-log__topic",children:_t}),n.jsxs("span",{className:"cdc-event-log__table",children:["table ",z]}),n.jsxs("span",{className:"cdc-event-log__meta",children:["ts=",Le,"ms · pk=",Ye,ge?` · txn=${ge}`:""]}),w.meta?n.jsx("span",{className:"cdc-event-log__extra",children:w.meta}):null,I?n.jsx("button",{type:"button",className:"cdc-event-log__replay",onClick:()=>I?.(w),disabled:!wt,children:"Replay"}):null,n.jsx("button",{type:"button",className:"cdc-event-log__copy",onClick:()=>M?.(w),disabled:!M,children:"Copy"}),qe(w)]},w.id)})]})]})};function ia(t){const e=t.op?.toUpperCase?.()??"?",a=t.pk??"∅",r=t.expectedIndex!=null?`#${t.expectedIndex}`:void 0,u=t.actualIndex!=null?`#${t.actualIndex}`:void 0;return t.type==="missing"?`Missing ${e} for pk=${a} (${r??"expected"} @ ${t.expectedTime??"?"}ms)`:t.type==="extra"?`Unexpected ${e} for pk=${a} (${u??"emitted"} @ ${t.actualTime??"?"}ms)`:`Out-of-order ${e} pk=${a} (expected ${r??"?"} before actual ${u??"?"})`}const ra=({diff:t,scenarioName:e,laneId:a,schemaStatus:r,onDiffDetailsOpened:u})=>{if(!t)return null;const{totals:m,issues:v,lag:E}=t,M=m.missing>0||m.extra>0||m.ordering>0,I=v.slice(0,6);let D=null;return r&&(r.hasColumn?r.version<r.expectedVersion&&(D=`Schema behind: v${r.version} (expected v${r.expectedVersion})`):D=`${r.columnName} column missing in destination`),!M&&E.max<=0&&!D?null:n.jsxs("div",{className:"sim-shell__lane-diff","data-has-issues":M?"true":"false",role:"note",children:[n.jsxs("div",{className:"sim-shell__lane-diff-summary",children:[M?n.jsxs(n.Fragment,{children:[m.missing>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--missing",children:[m.missing," missing"]}),m.extra>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--extra",children:[m.extra," extra"]}),m.ordering>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--ordering",children:[m.ordering," ordering"]})]}):n.jsx("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--ok",children:"Operations aligned"}),E.max>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--lag",children:["Max lag ",Math.round(E.max),"ms"]})]}),D&&n.jsx("p",{className:"sim-shell__lane-diff-schema",children:D}),(I.length>0||E.samples.length>0)&&n.jsxs("details",{id:a?`lane-diff-${a}`:void 0,className:"sim-shell__lane-diff-details",onToggle:_=>{_.target.open&&u?.({method:t.method,issueCount:t.issues.length,maxLag:t.lag.max,scenario:e})},children:[n.jsx("summary",{children:"Diff details"}),I.length>0&&n.jsx("ul",{className:"sim-shell__lane-diff-list",children:I.map((_,g)=>n.jsx("li",{children:ia(_)},`${_.type}-${_.op}-${_.pk??"∅"}-${g}`))}),v.length>I.length&&n.jsxs("p",{className:"sim-shell__lane-diff-more",children:["+",v.length-I.length," additional difference(s)"]}),E.samples.length>0&&n.jsxs("div",{className:"sim-shell__lane-diff-lag",children:[n.jsx("h4",{children:"Lag hotspots"}),n.jsx("ul",{children:E.samples.map(_=>n.jsxs("li",{children:[Math.round(_.lagMs),"ms on ",_.op.toUpperCase()," pk=",_.pk??"∅"]},`${_.op}-${_.pk??"∅"}-${_.actualTime??"?"}`))})]})]})]})},Fe=Fs,Z=t=>Number.isFinite(t)?t.toLocaleString():"—",Ts=t=>Number.isFinite(t)?`${Math.round(t)}ms`:"—",oa=({lanes:t,renderSchemaWalkthrough:e})=>{const a=t.reduce((r,u)=>(r.produced+=u.produced,r.consumed+=u.consumed,r.backlog+=u.backlog,r),{produced:0,consumed:0,backlog:0});return n.jsxs("section",{className:"sim-shell__metrics-dashboard","aria-label":"Runtime metrics",children:[n.jsx("header",{className:"sim-shell__metrics-dashboard-header",children:n.jsxs("div",{children:[n.jsx("h3",{children:"Runtime metrics"}),n.jsxs("p",{children:["Produced ",Z(a.produced)," · Consumed ",Z(a.consumed)," · Backlog ",Z(a.backlog)]})]})}),n.jsx("div",{className:"sim-shell__metrics-dashboard-grid",children:t.map(r=>n.jsxs("article",{className:"sim-shell__metrics-dashboard-card",children:[n.jsx("header",{children:n.jsx("h4",{"data-tooltip":r.tooltip||void 0,children:r.label})}),e&&n.jsx("div",{className:"sim-shell__schema-demo-inline",children:e(r.id)}),n.jsxs("dl",{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Produced"}),n.jsx("dd",{children:Z(r.produced)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Consumed"}),n.jsx("dd",{children:Z(r.consumed)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Backlog"}),n.jsx("dd",{"data-tooltip":Fe.backlog,children:Z(r.backlog)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Lag p50"}),n.jsx("dd",{"data-tooltip":Fe.lagPercentile,children:Ts(r.lagP50)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Lag p95"}),n.jsx("dd",{"data-tooltip":Fe.lagPercentile,children:Ts(r.lagP95)})]}),typeof r.snapshotRows=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Snapshot rows"}),n.jsx("dd",{"data-tooltip":Fe.snapshot,children:Z(r.snapshotRows)})]}),(typeof r.inserts=="number"||typeof r.updates=="number"||typeof r.deletes=="number")&&n.jsxs("div",{children:[n.jsx("dt",{children:"Change mix"}),n.jsxs("dd",{children:["C ",Z(r.inserts??0)," · U ",Z(r.updates??0)," · D ",Z(r.deletes??0),typeof r.schemaChanges=="number"&&r.schemaChanges>0?` · Schema ${Z(r.schemaChanges)}`:""]})]}),typeof r.missedDeletes=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Missed deletes"}),n.jsx("dd",{"data-tooltip":Fe.deleteCapture,children:Z(r.missedDeletes)})]}),typeof r.writeAmplification=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Write amplification"}),n.jsxs("dd",{"data-tooltip":Fe.triggerWriteAmplification,children:[r.writeAmplification.toFixed(1),"x"]})]})]})]},r.id))})]})},la=({lagMs:t,throughput:e,deletesPct:a,orderingOk:r,consistent:u,writeAmplification:m,insertCount:v,updateCount:E,deleteCount:M,schemaChangeCount:I})=>n.jsxs("div",{role:"status","aria-live":"polite",children:[n.jsxs("span",{children:["Lag: ",t,"ms"]})," ·",n.jsxs("span",{children:["TPS: ",e.toFixed(1)]})," ·",n.jsxs("span",{children:["Deletes: ",Math.round(a),"%"]})," ·",n.jsxs("span",{children:["Ordering: ",r?"OK":"KO"]})," ·",n.jsxs("span",{children:["Consistency: ",u?"OK":"Drift"]})," ","·",n.jsxs("span",{children:["Ops C/U/D: ",v,"/",E,"/",M]}),I>0&&n.jsxs(n.Fragment,{children:[" ","·",n.jsxs("span",{children:["Schema: ",I]})]}),typeof m=="number"&&n.jsxs(n.Fragment,{children:[" ","·",n.jsxs("span",{children:["Trigger WA: ",m.toFixed(1),"x"]})]})]}),ca=({onAdd:t,onDrop:e,columnName:a,disabled:r,disableAdd:u,disableDrop:m,status:v})=>n.jsxs("section",{className:"sim-shell__schema-demo","aria-label":"Schema walkthrough",children:[n.jsxs("header",{children:[n.jsx("h4",{children:"Schema walkthrough"}),n.jsxs("p",{children:["Add or drop ",n.jsx("code",{children:a})," while events stream to compare capture behaviour."]})]}),v?n.jsx("p",{className:"sim-shell__schema-demo-status",children:v}):null,n.jsxs("div",{className:"sim-shell__schema-demo-buttons",children:[n.jsxs("button",{type:"button",onClick:t,disabled:r||u,"data-tour-target":"schema-add",children:["Add ",a]}),n.jsxs("button",{type:"button",onClick:e,disabled:r||m,"data-tour-target":"schema-drop",children:["Drop ",a]})]})]});class da{constructor(){this.scenario=null,this.engines=[],this.idx=0,this.now=0,this.playing=!1}attach(e){this.engines=e}load(e){this.scenario=e,this.idx=0,this.now=0,this.playing=!1}reset(e){this.engines.forEach(a=>a.reset(e)),this.idx=0,this.now=0}onTick(e){this.onTickCb=e}start(){this.playing=!0}pause(){this.playing=!1}tick(e){if(!this.playing||!this.scenario)return;this.now+=e;const{ops:a}=this.scenario;for(;this.idx<a.length&&a[this.idx].t<=this.now;){const r=a[this.idx++];this.engines.forEach(u=>u.applySourceOp(r))}this.engines.forEach(r=>r.tick(this.now)),this.onTickCb?.(this.now)}}const ua=new Set(["c","u","d"]);function ha(t){switch(t.op){case"insert":return"c";case"update":return"u";case"delete":return"d";default:return null}}function pa(t){return t.map((e,a)=>{const r=ha(e);if(!r)return null;const u=e.pk?.id!=null?String(e.pk.id):"";return{key:`${r}::${u}`,op:r,pk:u,index:a,time:e.t}}).filter(e=>!!e)}function ma(t){return t.map((e,a)=>{if(!ua.has(e.op))return null;const r=e.pk?.id!=null?String(e.pk.id):"",u=e.op;return{key:`${u}::${r}`,op:u,pk:r,index:a,time:e.ts_ms}}).filter(e=>!!e)}function Is(t){const e=new Map;for(const a of t){const r=e.get(a.key);r?r.push(a):e.set(a.key,[a])}return e}function ga(t,e){const a=[],r=[],u=[],m=Is(t),v=Is(e),E=new Set([...m.keys(),...v.keys()]);for(const M of E){const I=m.get(M)??[],D=v.get(M)??[],_=Math.min(I.length,D.length);for(let g=0;g<_;g++){const T=I[g],l=D[g];a.push({expected:T,actual:l,lagMs:Math.max(0,l.time-T.time)})}for(let g=_;g<I.length;g++)r.push(I[g]);for(let g=_;g<D.length;g++)u.push(D[g])}return{matched:a,missing:r,extra:u}}function fa(t){const e=[],a=[...t].sort((u,m)=>u.actual.index-m.actual.index);let r=-1/0;for(const u of a)u.expected.index<r?e.push({type:"ordering",op:u.expected.op,pk:u.expected.pk,expectedIndex:u.expected.index,actualIndex:u.actual.index,expectedTime:u.expected.time,actualTime:u.actual.time}):r=u.expected.index;return e}function ba(t){return t.filter(e=>e.lagMs>0).sort((e,a)=>a.lagMs-e.lagMs).slice(0,5).map(e=>({op:e.expected.op,pk:e.expected.pk,expectedTime:e.expected.time,actualTime:e.actual.time,lagMs:e.lagMs}))}function xa(t,e,a){const r=pa(e),u=ma(a),{matched:m,missing:v,extra:E}=ga(r,u),M=[];for(const _ of v)M.push({type:"missing",op:_.op,pk:_.pk,expectedIndex:_.index,expectedTime:_.time});for(const _ of E)M.push({type:"extra",op:_.op,pk:_.pk,actualIndex:_.index,actualTime:_.time});M.push(...fa(m));const I=ba(m),D=I.reduce((_,g)=>Math.max(_,g.lagMs),0);return{method:t,totals:{missing:M.filter(_=>_.type==="missing").length,extra:M.filter(_=>_.type==="extra").length,ordering:M.filter(_=>_.type==="ordering").length},issues:M,lag:{max:D,samples:I}}}const va=`# Harness Nightly History

Run \`GITHUB_TOKEN=... npm run harness:history\` to refresh this summary. The script aggregates the latest Harness Nightly artifacts and records table-level parity results here so the app can surface them inline.

| Run | Date | Conclusion | Events | Missing | Extra | Max Lag (ms) | Tables | Mismatches |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| _No runs captured yet._ |   |   |   |   |   |   |   |   |

`;function V(t,e={},a={}){if(typeof window>"u")return;const r=window.telemetry;!r||typeof r.track!="function"||r.track(t,e,a)}function Je(t,e={}){V("comparator.clock.control",{action:t,...e})}function ya({onDiffDetailsOpened:t,...e}){const a=r=>{t?.(r),V("comparator.diff.opened",{method:r.method,issues:r.issueCount,maxLag:r.maxLag,scenario:r.scenario})};return n.jsx(ra,{...e,onDiffDetailsOpened:a})}function _a(t){const e={...t};return t.pk&&(e.pk={...t.pk}),t.after&&(e.after={...t.after}),t.txn&&(e.txn={...t.txn}),e}function wa(t){return{id:t.id,name:t.id||t.name,label:t.label,description:t.description,highlight:t.highlight,stats:{rows:t.rows.length,ops:t.ops.length},table:t.table,tags:[...t.tags],schema:t.schema.length?t.schema.map(e=>({...e})):void 0,rows:t.rows.length?t.rows.map(e=>({...e})):void 0,events:t.events.length?t.events.map(e=>({...e})):void 0,schemaVersion:t.schemaVersion,seed:t.seed,ops:t.ops.map(_a)}}const Vs=In;Vs.length===0&&typeof console<"u"&&console.warn("No scenario templates were loaded from assets/shared-scenarios.js; the comparator scenario gallery will be empty.");const ht=Vs.map(wa),qs={polling:{label:"Polling (Query)",laneDescription:"Simple, but lossy. Periodic scans read current state only; hard deletes and mid-poll updates can disappear.",callout:"Polling reads current state only. Hard deletes and intermediate updates are not captured.",whenToUse:"Simple, but lossy. Periodic scans read current state only. Hard deletes and intermediate updates between polls are not observable. Good for small, non-critical syncs where some lag and loss is acceptable."},trigger:{label:"Trigger (Audit)",laneDescription:"Complete, but intrusive. Database triggers write to an audit table and add synchronous source overhead.",callout:"Triggers add write overhead to source transactions.",whenToUse:"Complete, but intrusive. Triggers capture every change into an audit table, but add write latency and operational overhead on the source. Use when log access isn’t available."},log:{label:"Log (WAL)",laneDescription:"Default choice. Streams the transaction log post-commit for ordered, low-latency change events.",callout:"Log-based CDC is the preferred default when available.",whenToUse:"Default choice. Reads the database’s transaction log post-commit. Lowest source impact, complete and ordered changes, near-real-time. Requires connector setup and ops discipline."}};typeof window<"u"&&(window.CDC_METHOD_COPY=qs);const Ue="workspace-live",Gs="cdc_comparator_prefs_v1",we={name:"priority_flag",type:"bool"};function Sa(t,e,a,r){if(a.length===0)return 0;const u=t[e]?.metrics.writeAmplification;if(typeof u=="number"&&u>=0)return u;const m=r.ops.filter(v=>v.table===a[0]?.table);return m.length?a.length/m.length:a.length}const ue=["polling","trigger","log"],Ws=2,Se=100,Hs=10,zs=300,qt=120,Ea=10,Ee=["c","u","d","s"],As="MYSQL_DEBEZIUM";function vt(t){return typeof t=="string"&&Object.prototype.hasOwnProperty.call(gt,t)}const ja=qs,H=Fs,Ut=200,Ca=2e3,La=6;function ka(){if(typeof window>"u")return new Set;const e=window.cdcFeatureFlags?.all?.();if(Array.isArray(e)&&e.length)return new Set(e.map(String));const a=window.APPWRITE_CFG?.featureFlags;return Array.isArray(a)&&a.length?new Set(a.map(String)):new Set}const Ma={polling:{pollIntervalMs:500,includeSoftDeletes:!1},trigger:{extractIntervalMs:250,triggerOverheadMs:8},log:{fetchIntervalMs:50}},Ta={polling:"QUERY_BASED",trigger:"TRIGGER_BASED",log:"LOG_BASED"},Ia={polling:"polling",trigger:"trigger",log:"log"},Ds=t=>{switch(t){case"polling":return Un();case"trigger":return qn();case"log":default:return Pn()}},Os=t=>{if(!t)return null;const e={...t};return delete e.__ts,e},Aa=t=>{if(t==null)return"—";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="number")return Number.isFinite(t)?t.toString():"—";if(t instanceof Date)return t.toISOString();if(typeof t=="object")try{return JSON.stringify(t)}catch{return"[object]"}return String(t)},Qs=(t,e,a)=>{const r=e.kind==="INSERT"?"c":e.kind==="UPDATE"?"u":e.kind==="DELETE"?"d":"s",u=e.schemaChange?{action:e.schemaChange.action,column:{name:e.schemaChange.column.name,type:e.schemaChange.column.type,nullable:e.schemaChange.column.nullable},previousVersion:e.schemaChange.previousVersion,nextVersion:e.schemaChange.nextVersion}:null,m=e.after?.id??e.before?.id??u?.column?.name??null,v=m!=null?String(m):"";return{source:"demo-db",table:e.table,op:r,pk:{id:v},before:Os(e.before),after:Os(e.after),ts_ms:e.commitTs,tx:{id:e.txnId??`tx-${e.commitTs}`,lsn:typeof e.offset=="number"?e.offset:null,index:typeof e.txnIndex=="number"?e.txnIndex:void 0,total:typeof e.txnTotal=="number"?e.txnTotal:void 0,last:typeof e.txnLast=="boolean"?e.txnLast:typeof e.txnTotal=="number"&&typeof e.txnIndex=="number"?e.txnIndex>=e.txnTotal-1:!0},seq:a,meta:{method:Ia[t]},schemaChange:u}};function Da(t,e){const a=new Dn,r=new On,u=new Nn,m=`cdc.${t}`;let v=Ds(t),E,M={bus:a,metrics:r,scheduler:u,topic:m},I={},D=0;const _=new Set,g=o=>{const b=o.__seq,j=typeof b=="number"&&b>0?b:++D;return o.__seq=j,{...Qs(t,o,j),offset:o.offset,topic:o.topic??m}},T=o=>b=>{const j=o(b);if(j.length){const k=j.map(N=>g(N));e(k),k.forEach(N=>_.forEach(q=>q(N)))}return j},l=()=>{v.initialise?.(M),v.configure?.(I),E=new Rn(Ta[t],a,u,r,m,{startSnapshot:(o,b)=>v.startSnapshot?.(o,j=>T(b)(j)),startTailing:o=>v.startTailing?.(b=>T(o)(b)),stop:()=>v.stop?.()}),E.startSnapshot([]),E.startTailing()};return l(),{name:t,configure(o){I={...o},v.configure?.(o)},reset(o){E.stop(),u.clear(),r.reset(),a.reset(m),D=0,v=Ds(t),M={bus:a,metrics:r,scheduler:u,topic:m},l()},applySourceOp(o){v.applySource?.(o)},applySchemaChange(o,b,j,k){const N=b==="add"?"ADD_COLUMN":"DROP_COLUMN";v.applySchemaChange?.(o,N,j,k)},tick(o){v.tick?.(o)},onEvent(o){return _.add(o),()=>_.delete(o)},bus:a,metrics:r,topic:m}}function Oa(t,e){return Da(t,e)}function Be(t){return t.reduce((e,a)=>(e[a]=[],e),{})}function Na(t){return{polling:{...t.polling},trigger:{...t.trigger},log:{...t.log}}}function pt(t,e,a){let r=typeof t=="number"?t:Number(t);return Number.isFinite(r)?(typeof a=="number"&&(r=Math.max(a,r)),r):e}function mt(t,e=qt){if(typeof t!="number"||!Number.isFinite(t))return e;const a=Math.round(t);return Number.isFinite(a)?Math.min(zs,Math.max(Hs,a)):e}function Ns(t){if(!Array.isArray(t))return[...ue];const e=[];return ue.forEach(a=>{t.includes(a)&&!e.includes(a)&&e.push(a)}),e.length>=Ws?e:[...ue]}function Ra(t){const e=Array.from(Ee);if(!Array.isArray(t)||t.length===0)return new Set(e);const a=[];return t.forEach(r=>{if(Ee.includes(r)){const u=r;a.includes(u)||a.push(u)}}),a.length?new Set(a):new Set(e)}function Rs(t){return typeof t=="string"&&ue.includes(t)}function $s(t){const e=Na(Ma);return t&&(t.polling&&(t.polling.pollIntervalMs!=null&&(e.polling.pollIntervalMs=pt(t.polling.pollIntervalMs,e.polling.pollIntervalMs,50)),t.polling.includeSoftDeletes!=null&&(e.polling.includeSoftDeletes=!!t.polling.includeSoftDeletes)),t.trigger&&(t.trigger.extractIntervalMs!=null&&(e.trigger.extractIntervalMs=pt(t.trigger.extractIntervalMs,e.trigger.extractIntervalMs,50)),t.trigger.triggerOverheadMs!=null&&(e.trigger.triggerOverheadMs=pt(t.trigger.triggerOverheadMs,e.trigger.triggerOverheadMs,0))),t.log&&t.log.fetchIntervalMs!=null&&(e.log.fetchIntervalMs=pt(t.log.fetchIntervalMs,e.log.fetchIntervalMs,10))),e}function $a(){if(typeof window>"u")return null;try{const t=window.localStorage.getItem(Gs);if(!t)return null;const e=JSON.parse(t);return{scenarioId:typeof e.scenarioId=="string"?e.scenarioId:void 0,presetId:vt(e.presetId)?e.presetId:void 0,activeMethods:Array.isArray(e.activeMethods)?e.activeMethods:void 0,methodConfig:e.methodConfig??void 0,userPinnedScenario:typeof e.userPinnedScenario=="boolean"?e.userPinnedScenario:void 0,showEventList:typeof e.showEventList=="boolean"?e.showEventList:void 0,eventOps:Array.isArray(e.eventOps)?e.eventOps:void 0,eventSearch:typeof e.eventSearch=="string"?e.eventSearch:void 0,eventLogTable:typeof e.eventLogTable=="string"?e.eventLogTable:void 0,eventLogTxn:typeof e.eventLogTxn=="string"?e.eventLogTxn:void 0,eventLogMethod:typeof e.eventLogMethod=="string"?e.eventLogMethod:void 0,eventLogOp:typeof e.eventLogOp=="string"?e.eventLogOp:void 0,applyOnCommit:typeof e.applyOnCommit=="boolean"?e.applyOnCommit:void 0,consumerRateEnabled:typeof e.consumerRateEnabled=="boolean"?e.consumerRateEnabled:void 0,consumerRateLimit:typeof e.consumerRateLimit=="number"?e.consumerRateLimit:void 0}}catch(t){return console.warn("Comparator prefs load failed",t),null}}function Pa(t){if(!(typeof window>"u"))try{window.localStorage.setItem(Gs,JSON.stringify(t))}catch(e){console.warn("Comparator prefs save failed",e)}}function Fa(t,e,a,r,u){const m=t.length?t[t.length-1]:null,v=m?Math.max(e-m.ts_ms,0):e,E=e>0?t.length/(e/1e3):0;let M=0,I=0,D=0,_=0;t.forEach(o=>{o.op==="c"?M+=1:o.op==="u"?I+=1:o.op==="d"&&(D+=1),o.schemaChange&&(_+=1)});const g=a.ops.filter(o=>o.op==="delete").length,T=g===0?100:D/g*100,l=t.every((o,b)=>{if(b===0)return!0;const j=t[b-1];return o.ts_ms>=j.ts_ms});return{lagMs:v,throughput:E,deletesPct:T,orderingOk:l,consistent:l&&(r==="polling"?D===g:!0),writeAmplification:r==="trigger"?Sa(u,r,t,a)??0:void 0,insertCount:M,updateCount:I,deleteCount:D,schemaChangeCount:_}}function Ua(t){if(t.length===0)return null;const e=[...t].sort((_,g)=>_.metrics.lagMs-g.metrics.lagMs),a=e[0],r=e[e.length-1],u=r.metrics.lagMs-a.metrics.lagMs,m=[...t].sort((_,g)=>_.metrics.deletesPct-g.metrics.deletesPct),v=m[0],E=m[m.length-1],M=t.filter(_=>!_.metrics.orderingOk).map(_=>_.method),I=t.filter(_=>_.method==="trigger"&&typeof _.metrics.writeAmplification=="number"),D=I.length?I.reduce((_,g)=>_.metrics.writeAmplification?g.metrics.writeAmplification&&g.metrics.writeAmplification>_.metrics.writeAmplification?g:_:g):null;return{bestLag:a,worstLag:r,lagSpread:u,lowestDeletes:v,highestDeletes:E,orderingIssues:M,triggerWriteAmplification:D}}function Ba(){const t=d.useRef(null);t.current===null&&(t.current=$a());const e=t.current||void 0,a=Ns(e?.activeMethods),r=$s(e?.methodConfig),u=e?.presetId&&vt(e.presetId)?e.presetId:As,m=Rs(e?.eventLogMethod)?e?.eventLogMethod:null,v=typeof e?.eventLogOp=="string"&&e.eventLogOp.trim()?e.eventLogOp.trim().toLowerCase():null,E=d.useMemo(()=>typeof window>"u"?{...yt}:Qn(window.localStorage),[]),[M,I]=d.useState(null),[D,_]=d.useState(()=>e?.scenarioId??ht[0].name),[g,T]=d.useState(()=>E.query),[l,p]=d.useState(()=>E.tags),[o,b]=d.useState(()=>a),[j,k]=d.useState(()=>Be(a)),[N,q]=d.useState(()=>Be(a)),[Q,je]=d.useState(()=>({})),[Ce,Ve]=d.useState(u),[J,qe]=d.useState(0),[w,G]=d.useState(!1),[W,_t]=d.useState(!1),[z,Ye]=d.useState(()=>r),[ge,Le]=d.useState(!1),[Y,wt]=d.useState(()=>e?.eventSearch??""),[Gt,Ks]=d.useState(()=>Ra(e?.eventOps)),[ke,Js]=d.useState(e?.showEventList??!0),[ne,St]=d.useState(e?.eventLogTable??null),[ee,Et]=d.useState(e?.eventLogTxn??""),[ae,Xe]=d.useState(m),[ie,jt]=d.useState(v),[xe,Wt]=d.useState(e?.applyOnCommit??!1),[re,Ht]=d.useState(e?.consumerRateEnabled??!1),[he,zt]=d.useState(()=>mt(e?.consumerRateLimit,qt)),[Ct,Ys]=d.useState(()=>ka()),fe=d.useRef({}),oe=d.useRef({}),Me=d.useRef({}),Qt=d.useRef(e?.consumerRateEnabled??!1?mt(e?.consumerRateLimit,qt):null),Ge=d.useRef(0),F=gt[Ce]??gt[As],Xs=d.useMemo(()=>Object.values(gt).map(s=>({id:s.id,label:s.label})),[]),O=d.useMemo(()=>{const s=F.methodCopyOverrides??{};return ue.reduce((i,c)=>{const h=ja[c],y=s[c];return i[c]={label:y?.label??h.label,laneDescription:y?.laneDescription??h.laneDescription,callout:y?.callout??h.callout,whenToUse:y?.whenToUse??h.whenToUse,tooltip:y?.tooltip??h.tooltip},i},{})},[F]),Kt=d.useMemo(()=>new Set(l),[l]),Jt=d.useMemo(()=>Zn(ht,{liveScenario:M??void 0,additionalTags:[l]}),[M,l]);d.useEffect(()=>{typeof window>"u"||Kn({query:g,tags:l},window.localStorage)},[g,l]),d.useEffect(()=>{if(typeof window>"u")return;const s=()=>{be(g,l)};return window.addEventListener("cdc:scenario-filter-request",s),()=>{window.removeEventListener("cdc:scenario-filter-request",s)}},[be,g,l]);const be=d.useCallback((s,i)=>{if(typeof window>"u")return;const c=Bt({query:s,tags:i});window.dispatchEvent(new CustomEvent("cdc:scenario-filter",{detail:c}))},[]),Yt=d.useMemo(()=>va.trim(),[]),Ze=d.useCallback(s=>{let i=Me.current[s];return i||(i=new Ft,Me.current[s]=i),i},[]),le=d.useCallback((s,i)=>{const c=fe.current[s];if(!c)return;const h=c.metrics.snapshot(),y=c.bus.size(c.topic);je(C=>({...C,[s]:{metrics:h,backlog:y,lastOffset:i?.lastOffset??C[s]?.lastOffset??-1}}))},[]),Xt=d.useCallback((s,i)=>{i.length&&(q(c=>{const h={...c},y=h[s]??[];return h[s]=[...y,...i],h}),le(s,{lastOffset:i[i.length-1]?.offset??-1}))},[le]);d.useEffect(()=>{if(typeof window>"u")return;const s=i=>{if(!(i instanceof CustomEvent))return;const c=i.detail,h=Array.isArray(c)?c:[];Ys(new Set(h.map(String)))};return window.addEventListener("cdc:feature-flags",s),()=>{window.removeEventListener("cdc:feature-flags",s)}},[]);const et=d.useCallback(s=>Ct.size===0?!0:Ct.has(s),[Ct]),tt=et("ff_event_bus"),Lt=et("ff_pause_resume"),Zs=et("ff_query_slider"),en=et("ff_event_log"),Te=d.useMemo(()=>Array.from(Gt).sort(),[Gt]),Zt=d.useMemo(()=>new Set(Te),[Te]),Ie=d.useMemo(()=>Y.trim().toLowerCase().split(/\s+/).filter(Boolean),[Y]),es=d.useMemo(()=>Ie.join("|"),[Ie]),ts=d.useRef(new WeakMap),st=d.useCallback(s=>{const i=new Set(Te),c=i.size<Ee.length,h=Ie.length>0,y=ts.current,C=new Map,L=x=>{const S=y.get(x);if(S)return S;const R=[String(x.seq??""),x.op,x.pk?.id??"",x.table??""];x.after&&R.push(...Object.values(x.after).map(P=>String(P??""))),x.before&&R.push(...Object.values(x.before).map(P=>String(P??"")));const $=R.join(" ").toLowerCase();return y.set(x,$),$};return o.forEach(x=>{const S=s[x]??[];if(!c&&!h){C.set(x,S);return}const R=S.filter($=>{if(!i.has($.op))return!1;if(!h)return!0;const P=L($);return Ie.every(B=>P.includes(B))});C.set(x,R)}),C},[o,Te,Ie]),tn=d.useMemo(()=>st(j),[st,j,es]),ss=d.useMemo(()=>st(N),[st,N,es]),We=d.useMemo(()=>{const s=[],i=new Set,c=new Set,h=new Set;return o.forEach(y=>{(ss.get(y)??[]).forEach(L=>{const x=L.table??"";x&&i.add(x);const S=L.tx?.id??null;S&&c.add(S);const R=typeof L.op=="string"?L.op.trim().toLowerCase():"";R&&h.add(R),s.push({method:y,event:L})})}),s.sort((y,C)=>{const L=y.event.offset??y.event.seq??0,x=C.event.offset??C.event.seq??0;return L!==x?L-x:(y.event.ts_ms??0)-(C.event.ts_ms??0)}),{events:s,tables:Array.from(i).sort(),txns:Array.from(c).sort(),ops:Array.from(h)}},[o,ss]),kt=We.events,nt=We.tables,at=We.txns,Mt=d.useMemo(()=>{const s=new Set(We.ops),i=Ee.filter(h=>s.has(h)),c=Array.from(s).filter(h=>!Ee.includes(h));return c.sort(),[...i,...c]},[We.ops]),Ae=d.useMemo(()=>kt.filter(({method:s,event:i})=>{if(ae&&s!==ae||ne&&(i.table??"")!==ne||ee&&(i.tx?.id??"")!==ee)return!1;const c=typeof i.op=="string"?i.op.trim().toLowerCase():"";return!(ie&&c!==ie)}),[kt,ae,ie,ne,ee]),sn=d.useMemo(()=>Ae.map(({method:s,event:i},c)=>{const h=typeof i.offset=="number"?i.offset:null,y=typeof i.seq=="number"?i.seq:null,C=typeof i.ts_ms=="number"?i.ts_ms:null,L=[s,h!=null?`offset-${h}`:null,y!=null?`seq-${y}`:null,C!=null?`ts-${C}`:null,c].filter(Boolean),x=i.pk?.id!=null?String(i.pk.id):null,S=i.schemaChange?n.jsxs("span",{className:"sim-shell__event-log-schema",children:[i.schemaChange.action==="ADD_COLUMN"?"Added":"Dropped"," column ",i.schemaChange.column.name,` · v${i.schemaChange.previousVersion}→v${i.schemaChange.nextVersion}`]}):void 0;return{id:L.length?L.join("|"):`${s}-${c}`,methodId:s,methodLabel:O[s].label,op:i.op??"",offset:h,topic:i.topic??null,table:i.table??null,tsMs:C,pk:x,txnId:i.tx?.id??null,before:i.before??null,after:i.after??null,meta:S}}),[Ae,O]),nn=d.useMemo(()=>({methodId:ae??void 0,op:ie??void 0,table:ne??void 0,txnId:ee||void 0}),[ae,ie,ne,ee]),an=d.useMemo(()=>({methods:ue.map(s=>({id:s,label:O[s].label})),ops:Mt,tables:nt,txns:at}),[nt,at,O]),He=d.useMemo(()=>{const s=new Map;return o.forEach(i=>{const h=Ze(i).snapshot(),y=["table","id"],C=new Set(y);let L=1;h.forEach(R=>{L=Math.max(L,R.schema?.version??1),R.schema?.columns.forEach($=>{if(!$)return;const P=$.name;!P||P==="id"||P.startsWith("__")||C.has(P)||(C.add(P),y.push(P))})}),h.forEach(R=>{R.rows.forEach($=>{Object.keys($).forEach(P=>{P==="id"||P.startsWith("__")||C.has(P)||(C.add(P),y.push(P))})})});const x=h.flatMap(R=>R.rows.map($=>{const P=String($.id),B={};return y.forEach(K=>{if(K==="table"||K==="id"||K.startsWith("__"))return;const ce=$[K];B[K]=ce??null}),{id:`${R.name}::${P}`,displayId:P,table:R.name,values:B}})).sort((R,$)=>R.id.localeCompare($.id,void 0,{numeric:!0,sensitivity:"base"})),S=C.has(we.name);s.set(i,{columns:y,rows:x,schemaVersion:L,hasSchemaColumn:S})}),s},[o,Ze,j]),ns=d.useRef(w),it=d.useRef(0);d.useEffect(()=>{ae&&!o.includes(ae)&&Xe(null)},[o,ae]),d.useEffect(()=>{ne&&!nt.includes(ne)&&St(null)},[nt,ne]),d.useEffect(()=>{ie&&!Mt.includes(ie)&&jt(null)},[Mt,ie]),d.useEffect(()=>{ee&&!at.includes(ee)&&Et("")},[at,ee]);const De=d.useRef(e?.userPinnedScenario??!1),pe=d.useMemo(()=>Xn(ht,{liveScenario:M??void 0,liveScenarioName:Ue,query:g,tags:l}),[M,g,l]),f=d.useMemo(()=>pe.length?pe.find(s=>s.name===D)??pe[0]:ht[0],[D,pe]),rt=d.useMemo(()=>{const s=new Map;return o.forEach(i=>{const c=He.get(i);s.set(i,{present:c?.hasSchemaColumn??!1,version:c?.schemaVersion??1})}),s},[o,He]),ze=d.useMemo(()=>o.length>0?o.every(s=>rt.get(s)?.present??!1):!1,[o,rt]),ve=d.useMemo(()=>{let s=1;return o.forEach(i=>{const c=rt.get(i);c&&c.version>s&&(s=c.version)}),s},[o,rt]),Oe=d.useMemo(()=>!!f.tags?.includes("schema"),[f.tags]),as=d.useMemo(()=>{if(!Oe)return null;const s=`v${ve}`;return ze?`${s} · column present`:`${s} · column absent`},[ze,ve,Oe]);d.useEffect(()=>{it.current=0},[f.name]);const Tt=d.useMemo(()=>f.table?f.table:f.ops.find(i=>i.table)?.table??"table",[f.ops,f.table]);d.useEffect(()=>{if(!ge)return;const s=window.setTimeout(()=>Le(!1),2e3);return()=>window.clearTimeout(s)},[ge]),d.useEffect(()=>{if(typeof window>"u")return;const s=window.setTimeout(()=>{V("comparator.event.search",{scenario:f.name,query:Y,hasQuery:!!Y.trim()})},400);return()=>window.clearTimeout(s)},[Y,f.name]),d.useEffect(()=>{ns.current=w},[w]),d.useEffect(()=>{pe.length&&(pe.some(s=>s.name===D)||(De.current=!1,_(pe[0].name)))},[D,pe]),d.useEffect(()=>{if(!ge)return;const s=window.setTimeout(()=>Le(!1),2e3);return()=>window.clearTimeout(s)},[ge]),d.useEffect(()=>{if(typeof window>"u")return;const s=i=>{if(!(i instanceof CustomEvent))return;const c=Bt(i.detail);T(h=>h===c.query?h:c.query),p(h=>Wn(h,c.tags)?h:c.tags)};return window.addEventListener("cdc:scenario-filter",s),window.dispatchEvent(new CustomEvent("cdc:scenario-filter-request")),()=>{window.removeEventListener("cdc:scenario-filter",s)}},[]),d.useEffect(()=>{if(typeof window>"u")return;const s=i=>{if(!(i instanceof CustomEvent))return;const c=i.detail;if(!c||!c.scenario){I(null);return}const h=Array.isArray(c.scenario.ops)?c.scenario.ops:[],y=c.scenario.label??"Workspace (live)",C=c.scenario.description??`${h.length} operations`,L=c.scenario.seed??1;I({name:Ue,label:y,description:C,seed:L,ops:h})};return window.addEventListener("cdc:workspace-update",s),window.dispatchEvent(new CustomEvent("cdc:workspace-request")),()=>{window.removeEventListener("cdc:workspace-update",s)}},[]),d.useEffect(()=>{M&&M.ops.length&&(De.current||_(Ue))},[M]),d.useEffect(()=>{if(typeof window>"u")return;const s=i=>{if(!(i instanceof CustomEvent))return;const c=i.detail;if(!c){De.current=!1;return}c.userPinnedScenario!=null&&(De.current=!!c.userPinnedScenario),c.activeMethods&&b(Ns(c.activeMethods)),c.methodConfig&&Ye($s(c.methodConfig)),c.scenarioId&&_(c.scenarioId),c.presetId&&vt(c.presetId)&&Ve(c.presetId),typeof c.applyOnCommit=="boolean"&&Wt(c.applyOnCommit),typeof c.consumerRateEnabled=="boolean"&&Ht(c.consumerRateEnabled),typeof c.consumerRateLimit=="number"&&zt(mt(c.consumerRateLimit))};return window.addEventListener("cdc:comparator-preferences-set",s),()=>{window.removeEventListener("cdc:comparator-preferences-set",s)}},[]),d.useEffect(()=>{Pa({scenarioId:D,presetId:Ce,activeMethods:o,methodConfig:z,userPinnedScenario:De.current,showEventList:ke,eventOps:Te,eventSearch:Y,eventLogTable:ne,eventLogTxn:ee,eventLogMethod:ae,eventLogOp:ie,applyOnCommit:xe,consumerRateEnabled:re,consumerRateLimit:he})},[D,Ce,o,z,ke,Te,Y,ne,ee,ae,ie,xe,re,he]);const ye=d.useRef(null),ot=d.useRef(null),te=d.useCallback(()=>{ot.current!=null&&(window.clearInterval(ot.current),ot.current=null)},[]),Ne=d.useCallback(()=>{if(W)return;const s={},i=Qt.current;if(i!=null){const L=i*Se/1e3,x=Ge.current+L;Ge.current=Math.min(x,i*5)}let c=i==null?Number.POSITIVE_INFINITY:Ge.current;const h=L=>L.txnId??`tx-${L.commitTs}`,y=L=>{if(!L.length)return!1;const x=L[L.length-1];return typeof x.txnLast=="boolean"?x.txnLast:typeof x.txnIndex=="number"&&typeof x.txnTotal=="number"?x.txnIndex>=x.txnTotal-1:!0},C=(L,x)=>{const S=oe.current[L]??[];let R=S.length?[...S]:[];if(R.length&&(oe.current[L]=[]),!R.length){const P=x.bus.consume(x.topic,1);if(!P.length)return[];R=P}const $=h(R[0]);for(;!y(R);){const P=x.bus.consume(x.topic,1);if(!P.length)return oe.current[L]=R,[];const B=P[0];if(h(B)!==$){const ce=oe.current[L]??[];oe.current[L]=[B,...ce];break}R.push(B)}return R};for(const L of o){const x=fe.current[L];if(!x)continue;let S=[],R=0;if(xe){const B=C(L,x);if(!B.length)continue;if(i!=null&&B.length>c){oe.current[L]=B;continue}S=B,R=B.length}else{const B=oe.current[L]??[];if(B.length){if(i!=null&&B.length>c){oe.current[L]=B;continue}S=[...B],R+=B.length,oe.current[L]=[]}const K=i==null?Number.POSITIVE_INFINITY:c-R;if(i==null?!0:K>=1){const de=i==null?50:Math.min(Math.floor(K),50),Ke=i==null?50:Math.max(de,0);if(Ke>0){const se=x.bus.consume(x.topic,Ke);se.length&&(S=S.length?S.concat(se):se,R+=se.length)}}if(!S.length)continue}i!=null&&(c=Math.max(c-R,0)),Ze(L).applyEvents(S),x.metrics.onConsumed(S);const P=S.map(B=>{const K=B.__seq??0;return Qs(L,B,K)});le(L),s[L]=P}i!=null&&(Ge.current=c),Object.keys(s).length!==0&&k(L=>{const x={...L};for(const[S,R]of Object.entries(s)){const $=x[S]??[];x[S]=[...$,...R]}return x})},[o,xe,Ze,W,le]),is=d.useCallback(()=>{te(),ot.current=window.setInterval(()=>{ye.current?.tick(Se),Ne()},Se)},[te,Ne]);d.useEffect(()=>{const s=re?he:null;Qt.current=s,s==null&&(Ge.current=0)},[re,he]),d.useEffect(()=>{W||Ne()},[W,Ne]),d.useEffect(()=>{k(Be(o)),q(Be(o)),fe.current={},oe.current={},Me.current={},o.forEach(y=>{Me.current[y]=new Ft}),qe(0),G(!1),te();const s=new da,i=[],c={},h=o.map(y=>{const C=Oa(y,S=>Xt(y,S));if(y==="polling"){const S=z.polling;C.configure({poll_interval_ms:S.pollIntervalMs,include_soft_deletes:S.includeSoftDeletes})}else if(y==="trigger"){const S=z.trigger;C.configure({extract_interval_ms:S.extractIntervalMs,trigger_overhead_ms:S.triggerOverheadMs})}else{const S=z.log;C.configure({fetch_interval_ms:S.fetchIntervalMs})}const L={bus:C.bus,metrics:C.metrics,topic:C.topic,applySchemaChange:C.applySchemaChange};c[y]=L;const x=C.onEvent(S=>{k(R=>{const $={...R},P=$[y]??[];return $[y]=[...P,S],$})});return i.push(x),C});return fe.current=c,o.forEach(y=>le(y,{lastOffset:-1})),s.attach(h),s.load(f),s.reset(f.seed),s.onTick(y=>qe(y)),ye.current=s,()=>{s.pause(),te(),i.forEach(y=>y())}},[o,f,te,z,le,Xt]);const rn=d.useCallback(s=>{b(i=>{if(i.includes(s))return i.length<=Ws?i:i.filter(h=>h!==s);const c=[...i,s];return ue.filter(h=>c.includes(h))})},[]),on=d.useCallback(s=>{Ks(i=>{const c=new Set(i);let h=!1;return c.has(s)?c.size>1&&(c.delete(s),h=!0):(c.add(s),h=!0),h&&V("comparator.event.filter",{scenario:f.name,op:s,active:c.has(s)}),h?c:i})},[f.name]),ln=d.useCallback(s=>{wt(s)},[]),cn=d.useCallback(()=>{Js(s=>{const i=!s;return V("comparator.panel.layout",{scenario:f.name,showEvents:i}),i})},[f.name]),dn=d.useCallback(()=>{Ht(s=>{const i=!s;return V("comparator.consumer.rate_toggle",{scenario:f.name,enabled:i}),i}),re&&V("comparator.consumer.rate_reset",{scenario:f.name})},[re,f.name]),un=d.useCallback(s=>{const i=mt(s,he);i!==he&&(zt(i),V("comparator.consumer.rate_adjust",{scenario:f.name,rate:i}))},[he,f.name]),hn=d.useCallback(s=>{s.methodId&&Rs(s.methodId)?Xe(s.methodId):Xe(null),St(s.table??null),Et(s.txnId??""),jt(s.op?s.op.toLowerCase():null)},[Xe,jt,St,Et]),pn=d.useCallback(()=>{if(Ae.length===0)return;const s=Ae.map(({method:y,event:C})=>JSON.stringify({method:y,offset:C.offset??null,seq:C.seq,ts_ms:C.ts_ms,op:C.op,pk:C.pk,table:C.table,before:C.before,after:C.after,topic:C.topic})),i=new Blob([s.join(`
`)],{type:"application/json"}),c=URL.createObjectURL(i),h=document.createElement("a");h.href=c,h.download=`${f.name}-event-log.ndjson`,h.click(),URL.revokeObjectURL(c),V("comparator.event.download",{scenario:f.name,events:Ae.length})},[Ae,f.name]),mn=d.useCallback(s=>{const i=Me.current[s];if(!i)return;const c=i.snapshot(),h=(f.name||"scenario").replace(/[^a-z0-9-_]+/gi,"-"),y={scenario:f.name,method:s,tables:c},C=new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),L=URL.createObjectURL(C),x=document.createElement("a");x.href=L,x.download=`${h}-${s}-destination.json`,x.click(),URL.revokeObjectURL(L);const S=c.reduce((R,$)=>R+($.rows?.length??0),0);V("comparator.destination.download",{scenario:f.name,method:s,tables:c.length,rows:S})},[f.name]),gn=d.useCallback(()=>{q(s=>{const i={...s};return o.forEach(c=>{i[c]=[]}),i}),ts.current=new WeakMap,V("comparator.event.clear",{scenario:f.name})},[o,f.name]),fn=d.useCallback(s=>{const i=JSON.stringify({method:s.methodId??null,methodLabel:s.methodLabel??null,op:s.op,offset:s.offset??null,topic:s.topic??null,table:s.table??null,ts_ms:s.tsMs??null,pk:s.pk??null,txnId:s.txnId??null,before:s.before??null,after:s.after??null},null,2);navigator.clipboard.writeText(i).then(()=>V("comparator.event.copy",{scenario:f.name,method:s.methodId??null,op:s.op,offset:s.offset??null})).catch(()=>{V("comparator.event.copy.error",{scenario:f.name,method:s.methodId??null})})},[f.name]),bn=d.useCallback(s=>{if(typeof window>"u")return;const i=typeof s.op=="string"?s.op.trim().toLowerCase():"";if(i!=="c"&&i!=="u"&&i!=="d")return;const c={op:i,before:s.before??null,after:s.after??null,ts_ms:typeof s.tsMs=="number"?s.tsMs:void 0,table:s.table??void 0,key:s.pk?{id:s.pk}:void 0};window.dispatchEvent(new CustomEvent("cdc:workspace-replay-event",{detail:c})),V("comparator.event.replay",{scenario:f.name,method:s.methodId??null,table:s.table??null,op:i})},[f.name]),xn=d.useCallback(s=>{vt(s)&&(Ve(s),V("comparator.preset.select",{presetId:s}))},[]),vn=d.useCallback(s=>{T(s),be(s,l),V("comparator.scenario.filter",{query:s})},[be,l]),yn=d.useCallback(s=>{const i=l.includes(s),c=i?l.filter(h=>h!==s):[...l,s];p(c),be(g,c),V("comparator.scenario.tag_toggle",{tag:s,active:!i})},[be,g,l]),_n=d.useCallback(()=>{l.length&&(p([]),be(g,[]),V("comparator.scenario.tag_clear"))},[be,g,l]),wn=d.useCallback(s=>{De.current=!0,_(s),V("comparator.scenario.select",{scenario:s})},[]),Sn=d.useCallback(s=>{const i={id:s.id,name:s.name,label:s.label,description:s.description,highlight:s.highlight,tags:s.tags,table:s.table,schemaVersion:s.schemaVersion,seed:s.seed,schema:s.schema??[],rows:s.rows??[],events:s.events??[],ops:s.ops},c=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),h=document.createElement("a");h.href=URL.createObjectURL(c),h.download=`${s.name}.json`,h.click(),URL.revokeObjectURL(h.href)},[]),En=d.useCallback(s=>{V("comparator.scenario.preview",{scenario:s.name,tags:s.tags??[]}),window.dispatchEvent(new CustomEvent("cdc:preview-scenario",{detail:s}))},[]),X=d.useMemo(()=>o.map(s=>{const i=j[s]??[];return{method:s,events:i,metrics:Fa(i,J,f,s,Q)}}),[o,J,j,f,Q]),me=d.useMemo(()=>o.reduce((s,i)=>{const c=Q[i],h=c?.metrics,y={backlog:c?.backlog??0,lastOffset:c?.lastOffset??-1,produced:h?.produced??0,consumed:h?.consumed??0,lagMsP50:h?.lagMsP50??0,lagMsP95:h?.lagMsP95??0,missedDeletes:h?.missedDeletes??0,writeAmplification:h?.writeAmplification??0,snapshotRows:h?.snapshotRows??0,errors:h?.errors??0};return s.set(i,y),s},new Map),[o,Q]),It=d.useMemo(()=>o.reduce((s,i)=>s+(me.get(i)?.backlog??0),0),[o,me]),jn=d.useMemo(()=>tt?o.reduce((s,i)=>{const c=me.get(i);return c&&(s.produced+=c.produced,s.consumed+=c.consumed,s.backlog+=c.backlog,s.snapshotRows+=c.snapshotRows),s},{produced:0,consumed:0,backlog:0,snapshotRows:0}):{produced:0,consumed:0,backlog:0,snapshotRows:0},[o,me,tt]),A=Ua(X),rs=d.useMemo(()=>X.reduce((s,i)=>s+i.events.length,0),[X]),lt=d.useMemo(()=>X.map(({method:s,events:i,metrics:c})=>({method:s,label:O[s].label,total:i.length,inserts:c.insertCount,updates:c.updateCount,deletes:c.deleteCount,schemaChanges:c.schemaChangeCount})),[X,O]),os=d.useMemo(()=>lt.reduce((s,i)=>s.set(i.method,i),new Map),[lt]),Re=d.useMemo(()=>{const s=new Map;return X.forEach(({method:i,events:c})=>{s.set(i,xa(i,f.ops,c))}),s},[X,f.ops]),ls=d.useMemo(()=>o.map(s=>{const i=me.get(s),c=os.get(s);return{id:s,label:O[s].label,tooltip:O[s].tooltip,produced:i?.produced??0,consumed:i?.consumed??0,backlog:i?.backlog??0,lagP50:i?.lagMsP50??0,lagP95:i?.lagMsP95??0,missedDeletes:i?.missedDeletes,writeAmplification:i?.writeAmplification,snapshotRows:i?.snapshotRows,inserts:c?.inserts??0,updates:c?.updates??0,deletes:c?.deletes??0,schemaChanges:c?.schemaChanges??0}}),[o,os,me,O]),Qe=d.useMemo(()=>o.map(s=>{const i=me.get(s),c=O[s].label,h=i?.snapshotRows??0;return`${c} ${h}`}).join(", "),[o,me,O]),cs=d.useMemo(()=>o.map(s=>{const i=Re.get(s),c=O[s].label,h=i?.totals??{missing:0,extra:0,ordering:0},y=i?.lag?.max??0,C=[];if(h.missing>0&&C.push({key:"missing",text:`${h.missing} missing`,tone:"missing"}),h.extra>0&&C.push({key:"extra",text:`${h.extra} extra`,tone:"extra"}),h.ordering>0&&C.push({key:"ordering",text:`${h.ordering} ordering`,tone:"ordering"}),y>0&&C.push({key:"lag",text:`${Math.round(y)}ms lag`,tone:"lag"}),Oe){const x=He.get(s),S=x?.schemaVersion??1;x&&!x.hasSchemaColumn?C.push({key:"schema-missing",text:`${we.name} missing`,tone:"schema"}):S<ve&&C.push({key:"schema-behind",text:`Schema v${S}/${ve}`,tone:"schema"})}C.length===0&&C.push({key:"ok",text:"Aligned",tone:"ok"});const L=!!i?.issues.length||(i?.lag?.samples?.length??0)>0||(i?.lag?.max??0)>0;return{method:s,label:c,chips:C,hasDetails:L}}),[o,He,Re,O,ve,Oe]);d.useEffect(()=>{typeof window>"u"||window.dispatchEvent(new CustomEvent("cdc:consumer-paused",{detail:{paused:W,backlog:It}}))},[W,It]);const Cn=d.useCallback(()=>{if(!A)return;const s=[];s.push(`${f.label}: ${f.description}`),s.push(`Methods: ${o.map(i=>O[i].label).join(", ")}`),A.bestLag&&s.push(`Fastest ${O[A.bestLag.method].label} at ${Math.round(A.bestLag.metrics.lagMs)}ms`),A.lagSpread>0&&s.push(`${O[A.worstLag.method].label} trails by ${Math.round(A.lagSpread)}ms`),s.push(`Lowest delete capture: ${O[A.lowestDeletes.method].label} (${Math.round(A.lowestDeletes.metrics.deletesPct)}%)`),A.triggerWriteAmplification&&s.push(`Trigger write amplification: ${O[A.triggerWriteAmplification.method].label} ${(A.triggerWriteAmplification.metrics.writeAmplification??0).toFixed(1)}x`),Qe&&s.push(`Snapshot rows: ${Qe}`),s.push(`Ordering: ${A.orderingIssues.length?A.orderingIssues.map(i=>O[i].label).join(", "):"All lanes aligned"}`),f.tags?.length&&s.push(`Tags: ${f.tags.join(", ")}`),navigator.clipboard.writeText(s.join(`
`)).then(()=>Le(!0)).catch(()=>Le(!1)),V("comparator.summary.copied",{scenario:f.name,tags:f.tags??[],methods:o})},[A,f,o,O,Qe]),Ln=d.useCallback(s=>{V("comparator.overlay.inspect",{method:s,scenario:f.name});const i=document.getElementById(`lane-diff-${s}`);i instanceof HTMLDetailsElement?(i.open=!0,i.scrollIntoView({behavior:"smooth",block:"center"})):i&&i.scrollIntoView({behavior:"smooth",block:"center"})},[f.name]),At=d.useCallback(s=>{if(!f.tags?.includes("schema"))return;const i=Math.max(J,it.current+Se);it.current=i,o.forEach(c=>{fe.current[c]?.applySchemaChange?.(Tt,s,we,i),le(c)}),V("comparator.schema.change",{action:s,table:Tt,scenario:f.name,commitTs:i,methods:o})},[o,J,fe,Tt,f.name,f.tags,le]),kn=d.useMemo(()=>{if(!f.tags?.includes("schema"))return;const s=o[0];if(s)return i=>i!==s?null:n.jsx(ca,{columnName:we.name,onAdd:()=>At("add"),onDrop:()=>At("drop"),disableAdd:ze,disableDrop:!ze,status:as})},[o,At,ze,as,f.tags]),$e=d.useCallback((s,i,c)=>{Ye(h=>({...h,[s]:{...h[s],[i]:c}}))},[]),Pe=d.useCallback(s=>{const i=ye.current;if(i){i.reset(f.seed),k(Be(o)),q(Be(o));for(const c of o){Me.current[c]=new Ft;const h=fe.current[c];h&&(h.bus.reset(h.topic),h.metrics.reset(),le(c,{lastOffset:-1}))}qe(0),it.current=0,s?.keepLoop||(i.pause(),G(!1),te())}},[o,f.seed,te,le]),Dt=d.useCallback(()=>{const s=ye.current;s&&(Pe({keepLoop:!0}),s.start(),G(!0),is(),Je("play",{scenario:f.name}))},[Pe,is,f.name]),Ot=d.useCallback(()=>{ye.current?.pause(),G(!1),te(),Je("pause",{scenario:f.name})},[te,f.name]),Mn=d.useCallback(()=>{Lt&&_t(s=>{const i=!s;return V("comparator.consumer.toggle",{scenario:f.name,paused:i}),i||Ne(),i})},[Ne,Lt,f.name]),Nt=d.useCallback((s=Se)=>{const i=ye.current;if(!i)return;const c=ns.current;c||i.start(),i.tick(s),c||i.pause(),Je("step",{deltaMs:s,scenario:f.name})},[f.name]),ds=d.useCallback((s,i)=>{const c=ye.current;if(!c)return;const h=Math.max(10,i??Se);Pe({keepLoop:!1});const y=Math.max(s,0);c.start();let C=0,L=0;for(;C<y&&L<1e4;){const x=Math.min(h,y-C);c.tick(x),C+=x,L+=1}c.pause(),G(!1),Je("seek",{targetMs:s,stepMs:i,scenario:f.name})},[Pe,f.name]),us=d.useCallback(()=>{Pe(),Je("reset",{scenario:f.name})},[Pe,f.name]);return d.useEffect(()=>{if(typeof window>"u")return;const s={play:()=>Dt(),pause:()=>Ot(),step:c=>Nt(c),seek:(c,h)=>ds(c,h),reset:()=>us()};window.cdcComparatorClock=s;const i=c=>{if(!(c instanceof CustomEvent))return;const h=c.detail;if(h)switch(h.type){case"play":s.play();break;case"pause":s.pause();break;case"step":s.step(h.deltaMs);break;case"seek":s.seek(h.timeMs,h.stepMs);break;case"reset":s.reset();break}};return window.addEventListener("cdc:comparator-clock",i),()=>{window.removeEventListener("cdc:comparator-clock",i),window.cdcComparatorClock===s&&delete window.cdcComparatorClock}},[Ot,us,ds,Dt,Nt]),d.useEffect(()=>{typeof window>"u"||window.dispatchEvent(new CustomEvent("cdc:comparator-clock-tick",{detail:{clock:J}}))},[J]),d.useEffect(()=>()=>te(),[te]),d.useEffect(()=>{if(typeof window>"u")return;const s=A?{lagSpread:A.lagSpread,bestLag:{method:A.bestLag.method,label:O[A.bestLag.method].label,metrics:A.bestLag.metrics},worstLag:{method:A.worstLag.method,label:O[A.worstLag.method].label,metrics:A.worstLag.metrics},lowestDeletes:{method:A.lowestDeletes.method,label:O[A.lowestDeletes.method].label,metrics:A.lowestDeletes.metrics},highestDeletes:{method:A.highestDeletes.method,label:O[A.highestDeletes.method].label,metrics:A.highestDeletes.metrics},orderingIssues:A.orderingIssues.map(x=>({method:x,label:O[x].label})),triggerWriteAmplification:A.triggerWriteAmplification?{method:A.triggerWriteAmplification.method,label:O[A.triggerWriteAmplification.method].label,value:A.triggerWriteAmplification.metrics.writeAmplification??0}:null}:null,i=X.map(({method:x,metrics:S})=>({method:x,label:O[x].label,tooltip:O[x].tooltip,metrics:S})),c=f.table??f.ops.find(x=>x.table)?.table??"table";let h=c;try{h=F.topicFormat(c)}catch{h=c}const y={id:F.id,label:F.label,description:F.description,docsHint:F.docsHint,source:{label:F.sourceLabel,tooltip:F.sourceTooltip},log:{label:F.logLabel,tooltip:F.logTooltip},bus:{label:F.busLabel,tooltip:F.busTooltip,exampleTopic:h},destination:{label:F.destinationLabel,tooltip:F.destinationTooltip},methods:ue.map(x=>({id:x,label:O[x].label,tooltip:O[x].tooltip??null}))},C=X.map(({method:x})=>{const S=Re.get(x);return S?{method:x,totals:S.totals,issues:S.issues.slice(0,25),lag:S.lag}:{method:x,totals:{missing:0,extra:0,ordering:0},issues:[],lag:{max:0,samples:[]}}}),L=o.map(x=>{const S=Re.get(x);return S?{method:x,label:O[x].label,totals:S.totals,issues:S.issues.slice(0,10),lag:{max:S.lag.max,samples:S.lag.samples.slice(0,10)}}:{method:x,label:O[x].label,totals:{missing:0,extra:0,ordering:0},issues:[],lag:{max:0,samples:[]}}});window.dispatchEvent(new CustomEvent("cdc:comparator-summary",{detail:{scenarioName:f.name,scenarioLabel:f.label,scenarioDescription:f.description,isLive:f.name===Ue,totalEvents:rs,summary:s,lanes:i,analytics:lt,tags:l,preset:y,diffs:C,overlay:L}}))},[X,f,A,rs,lt,l,Re,O,F,o]),n.jsxs("section",{className:"sim-shell","aria-label":"Simulator preview",children:[n.jsxs("header",{className:"sim-shell__header",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"sim-shell__title",children:"CDC Method Comparator"}),n.jsx("p",{className:"sim-shell__description",children:F.description}),n.jsxs("div",{className:"sim-shell__preset-row",role:"list","aria-label":"Selected vendor pipeline",children:[n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":F.sourceTooltip,role:"listitem",children:["Source · ",F.sourceLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":F.logTooltip,role:"listitem",children:["Capture · ",F.logLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":F.busTooltip,role:"listitem",children:["Transport · ",F.busLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":F.destinationTooltip,role:"listitem",children:["Sink · ",F.destinationLabel]})]}),n.jsxs("p",{className:"sim-shell__description sim-shell__description--meta",children:[F.label,F.docsHint?n.jsxs(n.Fragment,{children:[" · ",n.jsx("a",{href:F.docsHint,target:"_blank",rel:"noopener noreferrer",children:"Reference"})]}):null]})]}),n.jsxs("div",{className:"sim-shell__scenario-filter-row",role:"group","aria-label":"Filter scenarios",children:[n.jsxs("label",{className:"sim-shell__scenario-search",children:[n.jsx("span",{children:"Search scenarios"}),n.jsx("input",{type:"search",value:g,onChange:s=>vn(s.target.value),placeholder:"Find by label, description, or tag"})]}),Jt.length>0?n.jsxs("div",{className:"sim-shell__scenario-tags",role:"group","aria-label":"Scenario tags",children:[Jt.map(s=>n.jsxs("button",{type:"button",className:"sim-shell__scenario-tag","data-active":Kt.has(s)?"true":"false","aria-pressed":Kt.has(s),onClick:()=>yn(s),children:["#",s]},s)),l.length?n.jsx("button",{type:"button",className:"sim-shell__scenario-tag sim-shell__scenario-tag--clear",onClick:_n,children:"Clear"}):null]}):null]}),n.jsxs("div",{className:"sim-shell__actions sim-shell__actions--scenario",role:"group","aria-label":"Scenario controls",children:[n.jsx("select",{"aria-label":"Vendor preset",value:Ce,onChange:s=>xn(s.target.value),children:Xs.map(s=>n.jsx("option",{value:s.id,children:s.label},s.id))}),n.jsx("select",{"aria-label":"Scenario",value:D,onChange:s=>wn(s.target.value),children:pe.map(s=>n.jsx("option",{value:s.name,children:s.label},s.name))}),n.jsxs("div",{className:"sim-shell__scenario-actions",children:[n.jsx("button",{type:"button",className:"sim-shell__scenario-sync",onClick:()=>{f.name!==Ue&&window.dispatchEvent(new CustomEvent("cdc:apply-scenario-template",{detail:{id:f.name}}))},disabled:f.name===Ue,children:"Load in workspace"}),n.jsx("button",{type:"button",className:"sim-shell__scenario-download",onClick:()=>Sn(f),children:"Download JSON"}),n.jsx("button",{type:"button",className:"sim-shell__scenario-preview",onClick:()=>En(f),children:"Preview"})]}),n.jsx("div",{className:"sim-shell__method-toggle",role:"group","aria-label":"Methods to display",children:ue.map(s=>n.jsx("button",{type:"button",className:"sim-shell__method-chip","aria-pressed":o.includes(s),onClick:()=>rn(s),"data-tooltip":O[s].tooltip||void 0,children:O[s].label},s))})]})]}),n.jsxs("p",{className:"sim-shell__description","aria-live":"polite",children:[n.jsxs("strong",{children:[f.label,":"]})," ",f.description]}),f.highlight&&n.jsx("p",{className:"sim-shell__description sim-shell__description--highlight","aria-live":"polite",children:f.highlight}),f.tags?.length?n.jsx("div",{className:"sim-shell__tag-row","aria-label":"Scenario tags",children:f.tags.map(s=>n.jsxs("span",{className:"sim-shell__tag-chip",children:["#",s]},s))}):null,f.stats&&n.jsxs("p",{className:"sim-shell__description sim-shell__description--meta","aria-live":"polite",children:[f.stats.rows," rows · ",f.stats.ops," ops"]}),n.jsxs("div",{className:"sim-shell__event-filters",role:"group","aria-label":"Event filters",children:[W&&n.jsx("div",{className:"sim-shell__pause-banner",role:"status","aria-live":"polite",children:"Apply paused. Resume to drain the event bus."}),n.jsxs("label",{className:"sim-shell__event-search",children:[n.jsx("span",{children:"Search events"}),n.jsx("input",{type:"search",value:Y,onChange:s=>ln(s.target.value),placeholder:"Filter by pk, seq, or payload"})]}),n.jsx("div",{className:"sim-shell__event-ops",role:"group","aria-label":"Change operations",children:Ee.map(s=>n.jsx("button",{type:"button",className:"sim-shell__event-op","data-active":Zt.has(s)?"true":"false",onClick:()=>on(s),children:s.toUpperCase()},s))}),n.jsx("button",{type:"button",className:"sim-shell__event-toggle",onClick:cn,children:ke?"Hide timeline":"Show timeline"})]}),en&&n.jsx(aa,{className:"sim-shell__event-log",events:sn,stats:jn,totalCount:kt.length,filters:nn,filterOptions:an,onFiltersChange:hn,onDownload:pn,onClear:gn,onCopyEvent:fn,onReplayEvent:bn,maxVisibleEvents:Ca}),Yt&&n.jsx("section",{className:"sim-shell__harness-history","aria-label":"Harness nightly history",children:n.jsxs("details",{children:[n.jsx("summary",{children:"Harness nightly history"}),n.jsx("pre",{children:Yt})]})}),n.jsxs("div",{className:"sim-shell__actions",role:"group","aria-label":"Playback controls","data-tour-target":"comparator-actions",children:[n.jsx("button",{type:"button",onClick:Dt,disabled:w,children:"Start"}),n.jsx("button",{type:"button",onClick:Ot,disabled:!w,children:"Pause"}),n.jsxs("button",{type:"button",onClick:()=>Nt(),children:["Step +",Se,"ms"]}),Lt&&n.jsxs("button",{type:"button",onClick:Mn,className:"sim-shell__consumer-toggle","data-tooltip":H.backlog,children:[W?"Resume apply":"Pause apply",tt?` (${It} queued)`:""]}),n.jsxs("label",{className:"sim-shell__apply-toggle","data-tooltip":H.txnAtomic||void 0,children:[n.jsx("input",{type:"checkbox",checked:xe,onChange:s=>Wt(s.target.checked)}),n.jsx("span",{children:"Apply on commit"})]}),n.jsxs("div",{className:"sim-shell__consumer-rate",role:"group","aria-label":"Apply rate limit","data-enabled":re?"true":"false",children:[n.jsx("button",{type:"button",onClick:dn,children:re?"Disable throttle":"Throttle apply"}),n.jsxs("label",{children:[n.jsx("span",{children:re?`${he} events/s`:"Unlimited"}),n.jsx("input",{type:"range",min:Hs,max:zs,step:Ea,value:he,onChange:s=>un(Number(s.target.value)),disabled:!re})]})]})]}),n.jsx("div",{className:"sim-shell__controls","aria-label":"Method tuning controls",children:ue.map(s=>{const i=o.includes(s);if(s==="polling"){const h=z.polling;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":i?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:O[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Adjust poll cadence and whether soft deletes are surfaced."}),Zs?n.jsxs(n.Fragment,{children:[n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsxs("span",{children:["Poll interval (",(h.pollIntervalMs/1e3).toFixed(1),"s)"]}),n.jsx("input",{type:"range",min:500,max:1e4,step:100,value:h.pollIntervalMs,onChange:y=>$e("polling","pollIntervalMs",Math.min(1e4,Math.max(500,Number(y.target.value)||500)))})]}),n.jsxs("p",{className:"sim-shell__control-hint",children:["⏱️ Polling every ",(h.pollIntervalMs/1e3).toFixed(1),"s"]})]}):n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Poll interval (ms)"}),n.jsx("input",{type:"number",min:100,step:100,value:h.pollIntervalMs,onChange:y=>$e("polling","pollIntervalMs",Math.min(1e4,Math.max(100,Number(y.target.value)||500)))})]}),n.jsxs("label",{className:"sim-shell__control-checkbox",children:[n.jsx("input",{type:"checkbox",checked:h.includeSoftDeletes,onChange:y=>$e("polling","includeSoftDeletes",y.target.checked)}),n.jsx("span",{children:"Include soft delete marker column"})]})]},s)}if(s==="trigger"){const h=z.trigger;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":i?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:O[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Tune audit extractor cadence and per-write trigger overhead."}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Extractor interval (ms)"}),n.jsx("input",{type:"number",min:100,step:50,value:h.extractIntervalMs,onChange:y=>$e("trigger","extractIntervalMs",Math.max(50,Number(y.target.value)||0))})]}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Trigger overhead (ms)"}),n.jsx("input",{type:"number",min:0,step:1,value:h.triggerOverheadMs,onChange:y=>$e("trigger","triggerOverheadMs",Math.max(0,Number(y.target.value)||0))})]})]},s)}const c=z.log;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":i?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:O[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Control how frequently the WAL/Binlog fetcher polls for new records."}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Fetch interval (ms)"}),n.jsx("input",{type:"number",min:10,step:10,value:c.fetchIntervalMs,onChange:h=>$e("log","fetchIntervalMs",Math.max(10,Number(h.target.value)||0))})]})]},s)})}),A&&n.jsxs("div",{className:"sim-shell__summary","aria-live":"polite",children:[n.jsxs("ul",{children:[n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":H.lagSpread,children:"Lag spread:"})," ",O[A.bestLag.method].label," is leading at",` ${A.bestLag.metrics.lagMs.toFixed(0)}ms`,A.lagSpread>0?` — ${O[A.worstLag.method].label} trails by ${A.lagSpread.toFixed(0)}ms`:" (no spread)"]}),n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":H.deleteCapture,children:"Delete capture:"})," ",O[A.lowestDeletes.method].label," is lowest at",` ${A.lowestDeletes.metrics.deletesPct.toFixed(0)}%`," · best is ",O[A.highestDeletes.method].label,` (${A.highestDeletes.metrics.deletesPct.toFixed(0)}%)`]}),Qe&&n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":H.snapshot,children:"Snapshot rows:"})," ",Qe]}),A.triggerWriteAmplification&&n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":H.triggerOverhead,children:"Trigger overhead:"})," ",O[A.triggerWriteAmplification.method].label," is at"," ",`${(A.triggerWriteAmplification.metrics.writeAmplification??0).toFixed(1)}x`," write amplification"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Ordering:"}),A.orderingIssues.length===0?" All methods preserved ordering":` Issues: ${A.orderingIssues.map(s=>O[s].label).join(", ")}`]})]}),n.jsx("button",{type:"button",className:"sim-shell__summary-copy",onClick:Cn,children:ge?"Copied":"Copy summary"})]}),cs.length>0&&n.jsxs("section",{className:"sim-shell__overlay-summary","aria-label":"Lane checks",children:[n.jsxs("header",{children:[n.jsx("h3",{children:"Lane checks"}),n.jsx("p",{children:"Quick glance at diff findings and lag hotspots across active capture methods."})]}),n.jsx("ul",{children:cs.map(s=>n.jsxs("li",{className:"sim-shell__overlay-row",children:[n.jsx("div",{className:"sim-shell__overlay-label",children:s.label}),n.jsx("div",{className:"sim-shell__overlay-chips",children:s.chips.map(i=>n.jsx("span",{className:`sim-shell__overlay-chip sim-shell__overlay-chip--${i.tone}`,children:i.text},`${s.method}-${i.key}`))}),s.hasDetails&&n.jsx("button",{type:"button",className:"sim-shell__overlay-action",onClick:()=>Ln(s.method),children:"Inspect"})]},s.method))})]}),ls.length>0&&n.jsx(oa,{lanes:ls,renderSchemaWalkthrough:kn}),n.jsx("div",{className:"sim-shell__lane-grid","data-tour-target":"comparator-lanes",children:X.map(({method:s,metrics:i,events:c},h)=>{const y=O[s],C=y.laneDescription,L=Re.get(s)??null,x=h===0,S=me.get(s),R=fe.current[s],$=He.get(s),P=$?.rows.slice(0,La)??[],B=($?.rows.length??0)>P.length,K=Oe&&$?{version:$.schemaVersion,expectedVersion:ve,hasColumn:$.hasSchemaColumn,columnName:we.name}:Oe?{version:0,expectedVersion:ve,hasColumn:!1,columnName:we.name}:void 0,ce=s==="trigger"?S?.writeAmplification??i.writeAmplification??0:void 0,de=[],Ke=s==="polling"?"warning":"info";y.callout&&(s==="polling"&&i.deletesPct<100?de.push({text:`${y.callout} (${i.deletesPct.toFixed(0)}% of deletes captured in this scenario)`,tone:Ke}):de.push({text:y.callout,tone:Ke})),f.tags?.includes("schema")&&(s==="trigger"&&typeof ce=="number"&&ce>0&&de.push({text:`Write amplification ${ce.toFixed(1)}x (extra audit writes per change)`,tone:"info"}),s==="log"&&de.push({text:"Log capture streams schema changes in-order, keeping downstream versions aligned.",tone:"info"}),s==="polling"&&de.push({text:"Polling picks up new columns once refreshed rows include them; expect interim nulls.",tone:"warning"})),f.tags?.includes("transactions")&&de.push({text:xe?"Apply-on-commit groups transaction events before updating destinations so tables stay in sync.":"Apply-on-commit is off: events apply individually, so pausing mid-transaction shows partial state.",tone:xe?"info":"warning"});const se=tn.get(s)??c,hs=se.length!==c.length||Ie.length>0||Zt.size<Ee.length,Tn=ke&&se.length>Ut,ps=ke?se.slice(Math.max(se.length-Ut,0)):[];return n.jsxs("article",{className:"sim-shell__lane-card",children:[n.jsxs("header",{className:"sim-shell__lane-header",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"sim-shell__lane-title","data-tooltip":y.tooltip||void 0,children:y.label}),n.jsx("p",{className:"sim-shell__lane-copy",children:C})]}),n.jsxs("span",{className:"sim-shell__lane-count",children:[se.length,hs?` / ${c.length}`:""," events"]})]}),n.jsx("div",{className:"sim-shell__metrics","data-tour-target":x?"comparator-metrics":void 0,children:n.jsx(la,{...i})}),n.jsx(ya,{diff:L,scenarioName:f.name,laneId:s,schemaStatus:K}),tt&&n.jsxs("section",{className:"sim-shell__lane-bus","aria-label":`${y.label} event bus`,"data-paused":W?"true":"false",children:[n.jsxs("header",{children:[n.jsx("h4",{children:"Event Bus"}),n.jsx("span",{children:R?.topic??`cdc.${s}`})]}),n.jsxs("p",{children:[n.jsxs("span",{"data-tooltip":H.backlog,children:["Backlog ",n.jsx("strong",{children:S?.backlog??0}),W?" (apply paused)":""]})," · ",n.jsxs("span",{"data-tooltip":H.offset,children:["Last offset ",S?.lastOffset??-1]})]}),n.jsxs("p",{children:["Produced ",S?.produced??0," · Consumed ",S?.consumed??0]}),n.jsxs("p",{"data-tooltip":H.snapshot,children:["Snapshot rows ",S?.snapshotRows??0]}),n.jsxs("p",{"data-tooltip":H.lagPercentile,children:["Lag p50 ",Math.round(S?.lagMsP50??0),"ms · p95 ",Math.round(S?.lagMsP95??0),"ms"]}),s==="trigger"&&n.jsxs("p",{"data-tooltip":H.triggerWriteAmplification,children:["Write amplification: ",ce?.toFixed(1)??"0.0","x"]}),s==="polling"&&n.jsxs("p",{className:"sim-shell__lane-bus-warning","data-tooltip":H.deleteCapture,children:["Missed deletes: ",S?.missedDeletes??0]}),S&&S.errors>0&&n.jsxs("p",{className:"sim-shell__lane-bus-warning",children:["Errors: ",S.errors]})]}),$&&n.jsxs("section",{className:"sim-shell__destination","aria-label":`${y.label} destination snapshot`,children:[n.jsxs("header",{children:[n.jsxs("div",{className:"sim-shell__destination-title",children:[n.jsx("h4",{children:"Destination snapshot"}),n.jsxs("span",{children:["schema v",$.schemaVersion]})]}),n.jsx("div",{className:"sim-shell__destination-actions",children:n.jsx("button",{type:"button",className:"sim-shell__destination-download",onClick:()=>mn(s),disabled:$.rows.length===0,children:"Download JSON"})})]}),P.length>0?n.jsx("div",{className:"sim-shell__destination-table",role:"table",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsx("tr",{children:$.columns.map(U=>n.jsx("th",{"data-highlight":U===we.name?"true":void 0,children:U},U))})}),n.jsx("tbody",{children:P.map(U=>n.jsx("tr",{children:$.columns.map(_e=>n.jsx("td",{children:Aa(_e==="id"?U.displayId:_e==="table"?U.table:U.values[_e])},`${U.id}-${_e}`))},U.id))})]})}):n.jsx("p",{className:"sim-shell__destination-empty",children:"No rows applied yet."}),B&&n.jsxs("p",{className:"sim-shell__destination-note",children:["Showing ",P.length," of ",$.rows.length," rows."]})]}),n.jsxs("dl",{className:"sim-shell__lane-config",children:[s==="polling"&&(()=>{const U=z.polling;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Poll interval"}),n.jsxs("dd",{"data-tooltip":H.pollingInterval,children:[U.pollIntervalMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Soft deletes"}),n.jsx("dd",{"data-tooltip":H.pollingSoftDeletes,children:U.includeSoftDeletes?"included":"ignored"})]})]})})(),s==="trigger"&&(()=>{const U=z.trigger;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Extractor interval"}),n.jsxs("dd",{"data-tooltip":H.triggerExtractorInterval,children:[U.extractIntervalMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Trigger overhead"}),n.jsxs("dd",{"data-tooltip":H.triggerOverhead,children:[U.triggerOverheadMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Write amplification"}),n.jsxs("dd",{"data-tooltip":H.triggerWriteAmplification,children:[ce?.toFixed(1)??"0.0","x"]})]})]})})(),s==="log"&&(()=>{const U=z.log;return n.jsxs("div",{children:[n.jsx("dt",{children:"Fetch interval"}),n.jsxs("dd",{"data-tooltip":H.logFetchInterval,children:[U.fetchIntervalMs," ms"]})]})})()]}),de.length>0&&n.jsx("div",{className:"sim-shell__callouts",children:de.map((U,_e)=>n.jsx("p",{className:`sim-shell__callout${U.tone==="warning"?" sim-shell__callout--warning":""}`,"data-tour-target":x&&_e===0?"comparator-callouts":void 0,children:U.text},`${s}-callout-${_e}`))}),n.jsxs("section",{className:"sim-shell__lane-why","aria-label":`When to use ${y.label}`,children:[n.jsx("h4",{children:"When to use"}),n.jsx("p",{children:y.whenToUse})]}),ke?n.jsxs("ul",{className:"sim-shell__event-list","aria-live":"polite",children:[Tn&&n.jsx("li",{className:"sim-shell__event sim-shell__event--notice",children:n.jsxs("span",{children:["Showing latest ",Ut," of ",se.length," matching events."]})}),ps.length===0?n.jsx("li",{className:"sim-shell__empty",children:hs?"No events match the current filters.":"No events yet."}):ps.map(U=>n.jsxs("li",{className:`sim-shell__event${U.op==="d"?" sim-shell__event--delete":""}`,children:[n.jsx("span",{className:"sim-shell__event-op","data-op":U.op,children:U.op}),n.jsxs("span",{children:["#",U.seq," · pk=",U.pk.id]}),n.jsxs("span",{className:"sim-shell__event-target",children:["ts=",U.ts_ms,"ms"]})]},`${s}-${U.seq}`))]}):n.jsx("p",{className:"sim-shell__lane-hidden",children:"Timeline hidden. Use “Show timeline” to view recent events."})]},s)})}),n.jsxs("footer",{className:"sim-shell__footer",children:["Scenario clock: ",J,"ms · ",X.reduce((s,i)=>s+i.events.length,0)," total events emitted"]})]})}function Ps(){const t=document.getElementById("simShellRoot");if(!t){console.warn("Simulator UI shell mount point not found (simShellRoot).");return}An.createRoot(t).render(n.jsx(Ba,{}))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ps,{once:!0}):Ps();
