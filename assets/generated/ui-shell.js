import{r as d,j as n,T as Cn,S as Er,R as Cr}from"./event-log-widget.js";class jr{constructor(){this.topics=new Map}publish(t,r){if(r.length===0)return[];const o=this.ensure(t);return r.map(l=>{const h=++o.offset,b={...l,offset:h};return o.queue.push(b),b})}consume(t,r=1){const o=this.ensure(t);return r<=0?[]:o.queue.splice(0,r)}size(t){return this.ensure(t).queue.length}reset(t){if(t){this.topics.delete(t);return}this.topics.clear()}ensure(t){let r=this.topics.get(t);return r||(r={offset:-1,queue:[]},this.topics.set(t,r)),r}}class Lr{constructor(){this.produced=0,this.consumed=0,this.backlog=0,this.lagSamples=[],this.missedDeletes=0,this.writeAmplification=0,this.snapshotRows=0,this.errors=0,this.lagAggregators=new Set}onProduced(t){this.produced+=t.length,this.backlog+=t.length}onConsumed(t){this.consumed+=t.length,this.backlog=Math.max(this.backlog-t.length,0);const r=Date.now();t.forEach(o=>{const l=typeof o.commitTs=="number"?o.commitTs:typeof o.ts_ms=="number"?o.ts_ms:r,h=Math.max(r-l,0);this.lagSamples.push(h)}),this.lagSamples.length>2e3&&this.lagSamples.splice(0,this.lagSamples.length-2e3),this.notifyLagAggregators()}registerLagAggregator(t){return this.lagAggregators.add(t),this.safeInvokeAggregator(t),()=>{this.lagAggregators.delete(t)}}recordMissedDelete(t=1){this.missedDeletes+=t}recordWriteAmplification(t=1){this.writeAmplification+=t}recordSnapshotRows(t){this.snapshotRows=t}recordError(){this.errors+=1}reset(){this.produced=0,this.consumed=0,this.backlog=0,this.lagSamples=[],this.missedDeletes=0,this.writeAmplification=0,this.snapshotRows=0,this.errors=0,this.notifyLagAggregators()}snapshot(){const t=[...this.lagSamples].sort((l,h)=>l-h),r=this.percentile(t,.5),o=this.percentile(t,.95);return{produced:this.produced,consumed:this.consumed,backlog:this.backlog,lagMsP50:r,lagMsP95:o,missedDeletes:this.missedDeletes,writeAmplification:this.writeAmplification,snapshotRows:this.snapshotRows,errors:this.errors}}safeInvokeAggregator(t,r){try{const o=r?[...r]:[...this.lagSamples];t(o)}catch{}}notifyLagAggregators(){if(this.lagAggregators.size===0)return;const t=[...this.lagSamples];this.lagAggregators.forEach(r=>{this.safeInvokeAggregator(r,t)})}percentile(t,r){if(!t.length)return 0;const o=Math.max(t.length-1,0)*r,l=Math.floor(o),h=Math.min(l+1,t.length-1);if(l===h)return t[l];const b=o-l;return t[l]+(t[h]-t[l])*b}}class kr{constructor(){this.tasks=new Map,this.nextId=1}every(t,r){const o=this.nextId++,l={id:o,interval:t,handler:r};this.tasks.set(o,l);const h=setInterval(()=>r(),t);return l.timerId=h,o}clear(t){if(t!=null){const r=this.tasks.get(t);r&&r.timerId&&clearInterval(r.timerId),this.tasks.delete(t);return}this.tasks.forEach(r=>{const o=r.timerId;o&&clearInterval(o)}),this.tasks.clear()}}class Tr{constructor(t,r,o,l,h,b={}){this.mode=t,this.bus=r,this.scheduler=o,this.metrics=l,this.handlers=b,this.state="IDLE",this.topic=h??`cdc.${t.toLowerCase()}`}get currentState(){return this.state}get topicName(){return this.topic}startSnapshot(t){this.state==="IDLE"&&(this.state="SNAPSHOTTING",this.handlers.startSnapshot?.(t,r=>this.emit(r)))}startTailing(){this.state!=="TAILING"&&(this.state="TAILING",this.handlers.startTailing?.(t=>this.emit(t)))}pause(){this.state==="TAILING"&&(this.state="PAUSED")}resume(){this.state==="PAUSED"&&(this.state="TAILING")}stop(){this.state="IDLE",this.scheduler.clear(),this.handlers.stop?.(),this.bus.reset(this.topic),this.metrics.reset()}emit(t){if(t.length===0)return[];const r=this.bus.publish(this.topic,t);return this.metrics.onProduced(r),r}}let Mr=0;const ms=()=>`evt-${Date.now()}-${++Mr}`,It=e=>e?JSON.parse(JSON.stringify(e)):null,zs=(e,t)=>`${e}::${t}`,Qs=(e,t)=>({id:e.name,type:e.type,nullable:e.nullable??!1,__ts:t}),Ks=(e,t,r=`tx-${t}`)=>{const o=e?.id??r,l=typeof e?.index=="number",h=l?e.index:void 0,b=typeof e?.total=="number"?e.total:void 0;let y;return typeof e?.last=="boolean"?y=e.last:l&&typeof b=="number"?y=h>=b-1:y=!e,{id:o,index:h,total:b,last:y}};function Ar(){let e=null,t=null,r=100,o=0;const l=new Map,h=[];let b=0;const y=new Map,L=m=>{const w=y.get(m);return typeof w=="number"&&w>=1?w:(y.set(m,1),1)},A=m=>{const w=L(m),i=w+1;return y.set(m,i),{previous:w,next:i}},E=(m,w,i,p,c)=>{const v=Ks(m.txn,c);return{id:ms(),kind:w,table:m.table,before:i?{id:m.pk.id,...i,__ts:c}:void 0,after:p?{id:m.pk.id,...p,__ts:c}:void 0,txnId:v.id,txnIndex:v.index,txnTotal:v.total,txnLast:v.last,commitTs:c,schemaVersion:L(m.table),topic:e?.topic??`cdc.${m.table}`,partition:0}},x=(m,w,i,p)=>{if(!t||!e)return;const{previous:c,next:v}=A(m),T=Ks(void 0,p,`schema-${p}`),k={id:ms(),kind:w==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:m,before:w==="DROP_COLUMN"?Qs(i,p):void 0,after:w==="ADD_COLUMN"?Qs(i,p):void 0,txnId:T.id,txnIndex:T.index,txnTotal:T.total,txnLast:T.last,commitTs:p,schemaVersion:v,topic:e.topic??`cdc.${m}`,partition:0,schemaChange:{action:w,column:i,previousVersion:c,nextVersion:v}};t([k])};return{id:"LOG_BASED",initialise(m){e=m},configure(m){const w=Number(m.fetch_interval_ms??m.fetchIntervalMs);Number.isFinite(w)&&w>0&&(r=w)},startSnapshot(m=[],w){if(t=w,!m.length||(m.forEach(p=>{const c=p.schema?.version??1;y.set(p.name,c),p.rows.forEach(v=>{const T=zs(p.name,v.id);l.set(T,{id:v.id,table:p.name,data:{...v},version:1,updatedAt:v.__ts??0,deleted:!1})})}),e?.metrics.recordSnapshotRows(l.size),!l.size))return;const i=[];l.forEach(p=>{i.push({id:ms(),kind:"INSERT",table:p.table,before:void 0,after:{id:p.id,...p.data,__ts:p.updatedAt},txnId:`snapshot-${p.updatedAt}`,txnIndex:0,txnTotal:1,txnLast:!0,commitTs:p.updatedAt,schemaVersion:L(p.table),topic:e?.topic??`cdc.${p.table}`,partition:0})}),t(i),b=h.length},startTailing(m){t=m},applySource(m){if(!e)return;const w=m.t,i=zs(m.table,m.pk.id);if(L(m.table),m.op==="insert")l.set(i,{id:m.pk.id,table:m.table,data:{...m.after},version:1,updatedAt:w,deleted:!1}),h.push(E(m,"INSERT",null,It(m.after),w));else if(m.op==="update"){const p=l.get(i),c=p?It(p.data):null,v=p?{...p.data,...m.after}:{...m.after};l.set(i,{id:m.pk.id,table:m.table,data:v,version:(p?.version??0)+1,updatedAt:w,deleted:!1}),h.push(E(m,"UPDATE",c,It(v),w))}else if(m.op==="delete"){const p=l.get(i);l.set(i,{id:m.pk.id,table:m.table,data:p?{...p.data}:{},version:(p?.version??0)+1,updatedAt:w,deleted:!0}),h.push(E(m,"DELETE",p?It(p.data):null,null,w))}},applySchemaChange(m,w,i,p){e&&(L(m),w==="ADD_COLUMN"?l.forEach((c,v)=>{c.table===m&&(i.name in c.data||(c.data[i.name]=null,l.set(v,{...c,data:{...c.data}})))}):w==="DROP_COLUMN"&&l.forEach((c,v)=>{if(c.table===m&&i.name in c.data){const T={...c.data};delete T[i.name],l.set(v,{...c,data:T})}}),x(m,w,i,p))},tick(m){if(!t||m-o<r)return;const w=h.slice(b);w.length&&(t(w),b=h.length),o=m},pause(){},resume(){},stop(){l.clear(),h.length=0,b=0,t=null,e=null,y.clear(),o=0}}}let Ir=0;const gs=()=>`evt-${Date.now()}-${++Ir}`,Js=e=>e?JSON.parse(JSON.stringify(e)):null,Ys=(e,t)=>`${e}::${t}`,Xs=(e,t)=>({id:e.name,type:e.type,nullable:e.nullable??!1,__ts:t}),Zs=(e,t,r=`tx-${t}`)=>{const o=e?.id??r,h=!1?e.index:void 0,b=void 0;let y;return y=!0,{id:o,index:h,total:b,last:y}};function Or(){let e=null,t=null,r=1e3,o=!1,l=0;const h=new Map,b=new Map,y=new Map,L=[],A=i=>{const p=y.get(i);return typeof p=="number"&&p>=1?p:(y.set(i,1),1)},E=i=>{const p=A(i),c=p+1;return y.set(i,c),{previous:p,next:c}},x=(i,p,c,v,T,k,D,V)=>{const Z=Zs(V,k,D);return{id:gs(),kind:c,table:i,before:v?{id:p,...v,__ts:k}:void 0,after:T?{id:p,...T,__ts:k}:void 0,txnId:Z.id,txnIndex:Z.index,txnTotal:Z.total,txnLast:Z.last,commitTs:k,schemaVersion:A(i),topic:e?.topic??`cdc.${i}`,partition:0}},m=(i,p,c,v)=>{const{previous:T,next:k}=E(i),D=Zs(void 0,v,`schema-${v}`);L.push({id:gs(),kind:p==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:i,before:p==="DROP_COLUMN"?Xs(c,v):void 0,after:p==="ADD_COLUMN"?Xs(c,v):void 0,txnId:D.id,txnIndex:D.index,txnTotal:D.total,txnLast:D.last,commitTs:v,schemaVersion:k,topic:e?.topic??`cdc.${i}`,partition:0,schemaChange:{action:p,column:c,previousVersion:T,nextVersion:k}})},w=i=>{!i.length||!t||t(i)};return{id:"QUERY_BASED",initialise(i){e=i},configure(i){const p=Number(i.poll_interval_ms??i.pollIntervalMs);Number.isFinite(p)&&p>0&&(r=p),i.include_soft_deletes!=null&&(o=!!i.include_soft_deletes),i.includeSoftDeletes!=null&&(o=!!i.includeSoftDeletes)},startSnapshot(i=[],p){t=p;const c=[];i.forEach(v=>{const T=v.schema?.version??1;y.set(v.name,T),v.rows.forEach(k=>{const D=Ys(v.name,k.id);h.set(D,{id:k.id,table:v.name,data:{...k},version:1,updatedAt:k.__ts??0,deleted:!1}),b.set(D,1);const{id:V,__ts:Z,...Ge}=k;c.push({id:gs(),kind:"INSERT",table:v.name,before:void 0,after:{id:V,...Ge,__ts:Z??0},txnId:`snapshot-${k.__ts??0}`,txnIndex:0,txnTotal:1,txnLast:!0,commitTs:k.__ts??0,schemaVersion:A(v.name),topic:e?.topic??`cdc.${v.name}`,partition:0})})}),e?.metrics.recordSnapshotRows(c.length),w(c)},startTailing(i){t=i},applySource(i){const p=Ys(i.table,i.pk.id),c=i.t;if(A(i.table),i.op==="insert")h.set(p,{id:i.pk.id,table:i.table,data:{...i.after},version:1,updatedAt:c,deleted:!1});else if(i.op==="update"){const v=h.get(p),T=v?{...v.data,...i.after}:{...i.after};h.set(p,{id:i.pk.id,table:i.table,data:T,version:(v?.version??0)+1,updatedAt:c,deleted:!1})}else if(i.op==="delete"){const v=h.get(p);h.set(p,{id:i.pk.id,table:i.table,data:v?{...v.data}:{},version:(v?.version??0)+1,updatedAt:c,deleted:!0})}},applySchemaChange(i,p,c,v){A(i),p==="ADD_COLUMN"?h.forEach((T,k)=>{if(T.table!==i||Object.prototype.hasOwnProperty.call(T.data,c.name))return;const D={...T.data,[c.name]:null};h.set(k,{...T,data:D})}):p==="DROP_COLUMN"&&h.forEach((T,k)=>{if(T.table===i&&c.name in T.data){const D={...T.data};delete D[c.name],h.set(k,{...T,data:D})}}),m(i,p,c,v)},tick(i){if(!t||i-l<r)return;const p=[];L.length&&p.push(...L.splice(0,L.length)),h.forEach((c,v)=>{if(c.updatedAt<=l)return;const T=b.get(v)??0;if(c.deleted){o?(p.push(x(c.table,c.id,"DELETE",Js(c.data),null,c.updatedAt,`tx-${c.updatedAt}`)),b.set(v,c.version)):(e?.metrics.recordMissedDelete(),b.set(v,c.version));return}if(c.version<=T)return;const k=T===0?"INSERT":"UPDATE";p.push(x(c.table,c.id,k,null,Js(c.data),c.updatedAt,`tx-${c.updatedAt}`)),b.set(v,c.version)}),w(p),l=i},stop(){h.clear(),b.clear(),y.clear(),L.length=0,t=null,e=null,l=0}}}let Nr=0;const en=()=>`evt-${Date.now()}-${++Nr}`,Ot=e=>e?JSON.parse(JSON.stringify(e)):null,Dr=(e,t)=>`${e}::${t}`,tn=(e,t)=>({id:e.name,type:e.type,nullable:e.nullable??!1,__ts:t}),sn=(e,t,r=`tx-${t}`)=>{const o=e?.id??r,l=typeof e?.index=="number",h=l?e.index:void 0,b=typeof e?.total=="number"?e.total:void 0;let y;return typeof e?.last=="boolean"?y=e.last:l&&typeof b=="number"?y=h>=b-1:y=!e,{id:o,index:h,total:b,last:y}};function Rr(){let e=null,t=null,r=250,o=8,l=0,h=0;const b=new Map,y=[],L=new Map,A=i=>{const p=L.get(i);return typeof p=="number"&&p>=1?p:(L.set(i,1),1)},E=i=>{const p=A(i),c=p+1;return L.set(i,c),{previous:p,next:c}},x=(i,p,c,v,T)=>{const k=sn(i.txn,T);return{id:en(),kind:p,table:i.table,before:c?{id:i.pk.id,...c,__ts:T}:void 0,after:v?{id:i.pk.id,...v,__ts:T}:void 0,txnId:k.id,txnIndex:k.index,txnTotal:k.total,txnLast:k.last,commitTs:T,schemaVersion:A(i.table),topic:e?.topic??`cdc.${i.table}`,partition:0}},m=(i,p,c,v)=>{const{previous:T,next:k}=E(i),D=sn(void 0,v,`schema-${v}`),V={id:en(),kind:p==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:i,before:p==="DROP_COLUMN"?tn(c,v):void 0,after:p==="ADD_COLUMN"?tn(c,v):void 0,txnId:D.id,txnIndex:D.index,txnTotal:D.total,txnLast:D.last,commitTs:v,schemaVersion:k,topic:e?.topic??`cdc.${i}`,partition:0,schemaChange:{action:p,column:c,previousVersion:T,nextVersion:k}};y.push({event:V})},w=i=>{!i.length||!t||t(i)};return{id:"TRIGGER_BASED",initialise(i){e=i},configure(i){const p=Number(i.extract_interval_ms??i.extractIntervalMs);Number.isFinite(p)&&p>0&&(r=p);const c=Number(i.trigger_overhead_ms??i.triggerOverheadMs);Number.isFinite(c)&&c>=0&&(o=c)},startSnapshot(i=[],p){t=p,e?.metrics.recordSnapshotRows(0)},startTailing(i){t=i},applySource(i){if(!e)return;const p=Dr(i.table,i.pk.id),c=i.t+o;let v=null,T=null,k;if(A(i.table),i.op==="insert")k="INSERT",T=Ot(i.after),b.set(p,{id:i.pk.id,table:i.table,data:{...i.after},version:1,updatedAt:c,deleted:!1});else if(i.op==="update"){const D=b.get(p);v=D?Ot(D.data):null;const V=D?{...D.data,...i.after}:{...i.after};T=Ot(V),k="UPDATE",b.set(p,{id:i.pk.id,table:i.table,data:V,version:(D?.version??0)+1,updatedAt:c,deleted:!1})}else if(i.op==="delete"){const D=b.get(p);v=D?Ot(D.data):null,T=null,k="DELETE",b.set(p,{id:i.pk.id,table:i.table,data:D?{...D.data}:{},version:(D?.version??0)+1,updatedAt:c,deleted:!0})}else return;y.push({event:x(i,k,v,T,c)}),e.metrics.recordWriteAmplification(1)},applySchemaChange(i,p,c,v){if(!e)return;const T=v+o;A(i),p==="ADD_COLUMN"?b.forEach((k,D)=>{if(k.table===i&&!(c.name in k.data)){const V={...k.data,[c.name]:null};b.set(D,{...k,data:V,version:k.version+1,updatedAt:T})}}):p==="DROP_COLUMN"&&b.forEach((k,D)=>{if(k.table===i&&c.name in k.data){const V={...k.data};delete V[c.name],b.set(D,{...k,data:V,version:k.version+1,updatedAt:T})}}),m(i,p,c,T)},tick(i){if(!t||i-l<r)return;const p=y.slice(h).map(c=>c.event);w(p),h=y.length,l=i},stop(){y.length=0,b.clear(),t=null,e=null,h=0,l=0,L.clear()}}}const Ft={MYSQL_DEBEZIUM:{id:"MYSQL_DEBEZIUM",label:"MySQL · Debezium · Kafka",description:"Debezium tails the MySQL binlog and pushes commits to Kafka for downstream consumers.",docsHint:"https://debezium.io/documentation/reference/stable/connectors/mysql.html",sourceLabel:"MySQL primary",sourceTooltip:"InnoDB workload emitting row-level changes for capture.",logLabel:"MySQL binlog (Debezium)",logTooltip:"Debezium connector streams row-format binlog entries in commit order.",busLabel:"Kafka topic",busTooltip:"Kafka transports Debezium change events (e.g. db.orders) to consumers.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Analytics warehouse, service, or cache subscribing to the Kafka topic.",topicFormat:e=>`db.${e}`,methodCopyOverrides:{polling:{label:"Polling (scheduled SQL)",laneDescription:"Batch jobs diff the MySQL table on an interval to detect divergence.",callout:"Misses hard deletes and rapid updates without custom tracking tables.",whenToUse:"Fallback when binlog access is blocked. Accepts lag and data loss for small tables only.",tooltip:"ETL-style SELECT polling against the MySQL primary."},trigger:{label:"Triggers (audit table)",laneDescription:"AFTER triggers write every mutation into an audit table for downstream extract.",callout:"Adds synchronous latency on the write path and increases operational overhead.",whenToUse:"When connectors are unavailable but you still need complete change history.",tooltip:"MySQL triggers populate audit tables that an extractor drains."},log:{label:"Debezium binlog tail",laneDescription:"Debezium streams row-based binlog events into Kafka with schema evolution support.",callout:"Preferred default: low-impact, ordered, near real-time change capture.",whenToUse:"Standard choice for production MySQL workloads when Kafka + Debezium are available.",tooltip:"Debezium connector tailing the MySQL binlog."}}},POSTGRES_LOGICAL:{id:"POSTGRES_LOGICAL",label:"Postgres · Logical decoding · Kafka",description:"Logical decoding streams Postgres WAL changes (pgoutput/wal2json) into Kafka.",docsHint:"https://www.postgresql.org/docs/current/logicaldecoding.html",sourceLabel:"Postgres primary",sourceTooltip:"OLTP Postgres emitting WAL entries for publications.",logLabel:"Logical replication slot",logTooltip:"Logical decoding slot materialises committed WAL changes via pgoutput or wal2json.",busLabel:"Kafka topic",busTooltip:"Kafka topics per publication (e.g. public.orders) fan out change events.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Consumers applying logical changes into warehouses or services.",topicFormat:e=>`public.${e}`,methodCopyOverrides:{polling:{label:"Polling (snapshot queries)",laneDescription:"Incremental SELECT queries compare current rows to previous snapshots.",callout:"Can't observe deletes or mid-transaction updates without tombstone columns.",whenToUse:"Stopgap for small tables when logical replication isn't permitted.",tooltip:"Periodic comparison queries against Postgres source tables."},trigger:{label:"Triggers (audit schema)",laneDescription:"Triggers populate audit tables that an extractor tails outside the WAL.",callout:"Higher write amplification and maintenance across replicas.",whenToUse:"When WAL access is off-limits yet complete history is required.",tooltip:"AFTER triggers write into audit tables for downstream capture."},log:{label:"Logical decoding stream",laneDescription:"Slot-based logical decoding streams ordered WAL changes through Kafka.",callout:"Best balance: ordered, low-impact capture with schema evolution support.",whenToUse:"Primary choice when you can run wal2json/pgoutput connectors.",tooltip:"Logical replication slot feeding Kafka via connectors."}}},SQLSERVER_CDC:{id:"SQLSERVER_CDC",label:"SQL Server · CDC tables · ETL",description:"SQL Server CDC populates change tables that ETL tools ship downstream.",docsHint:"https://learn.microsoft.com/sql/relational-databases/track-changes/about-change-data-capture-sql-server",sourceLabel:"SQL Server OLTP",sourceTooltip:"Source database with CDC enabled on tracked tables.",logLabel:"CDC change tables",logTooltip:"Log reader agent populates [cdc].[schema_table_CT] from the transaction log.",busLabel:"ETL pipeline",busTooltip:"ADF/SSIS or similar ETL pipelines move captured rows to consumers.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Lakehouse, staging DB, or microservice applying captured rows.",topicFormat:e=>`cdc.${e}_ct`,methodCopyOverrides:{polling:{label:"Polling (T-SQL jobs)",laneDescription:"Scheduled queries compare source tables against a shadow copy.",callout:"Hard deletes vanish and rapid updates collapse to last-write wins.",whenToUse:"Only when CDC can't be enabled. Expect drift and operational overhead.",tooltip:"Agent jobs issuing SELECT deltas against the primary."},trigger:{label:"DB triggers (audit tables)",laneDescription:"DDL-driven triggers write into audit tables that ETL picks up.",callout:"Adds synchronous writes and complicates deployments.",whenToUse:"Fallback for editions without CDC but needing full fidelity.",tooltip:"FOR INSERT/UPDATE/DELETE triggers persisting rows into audit tables."},log:{label:"CDC change table stream",laneDescription:"Native CDC surfaces ordered change rows ready for downstream ETL.",callout:"Balanced approach: leverages log reader agent with minimal code.",whenToUse:"Default when SQL Server Enterprise/Standard CDC is available.",tooltip:"Change Data Capture tables populated by the log reader agent."}}},ORACLE_GG:{id:"ORACLE_GG",label:"Oracle · GoldenGate",description:"GoldenGate extracts Oracle redo into trails that replicat apply downstream.",docsHint:"https://docs.oracle.com/en/middleware/goldengate/",sourceLabel:"Oracle primary",sourceTooltip:"Oracle Database generating redo entries for tracked schemas.",logLabel:"Redo / GoldenGate trail",logTooltip:"Extract captures redo logs into GoldenGate trail files.",busLabel:"GoldenGate distribution",busTooltip:"GoldenGate distribution path replicates changes to targets or Kafka.",destinationLabel:"Replica / downstream sink",destinationTooltip:"Target database, cache, or Kafka topic consuming GoldenGate trails.",topicFormat:e=>`ogg.${e}`,methodCopyOverrides:{polling:{label:"Polling (custom jobs)",laneDescription:"Scripts query Oracle tables for deltas outside of GoldenGate.",callout:"Expensive and incomplete without change tracking columns.",whenToUse:"Rare stopgap for small tables when GoldenGate access is unavailable.",tooltip:"Ad-hoc jobs diffing source tables over DB links or snapshots."},trigger:{label:"Triggers (shadow tables)",laneDescription:"Row-level triggers populate shadow tables for downstream capture.",callout:"Adds redo volume and requires meticulous deployment management.",whenToUse:"Fallback when GoldenGate licensing or access is restricted.",tooltip:"Oracle triggers mirroring mutations into custom staging tables."},log:{label:"GoldenGate redo tail",laneDescription:"GoldenGate Extract/Replicat stream redo into ordered trail files.",callout:"Enterprise-grade: minimal source impact with robust replication semantics.",whenToUse:"Primary approach for Oracle sources requiring guaranteed replication.",tooltip:"GoldenGate Extract reading redo logs into trail files."}}},MONGODB_STREAMS:{id:"MONGODB_STREAMS",label:"MongoDB · Change Streams",description:"Change Streams tail the MongoDB oplog and push updates to subscribers.",docsHint:"https://www.mongodb.com/docs/manual/changeStreams/",sourceLabel:"MongoDB replica set",sourceTooltip:"Replica set primary emitting operations into the oplog.",logLabel:"Change stream (oplog)",logTooltip:"Change Stream cursor streams oplog events filtered per namespace.",busLabel:"Driver subscriber",busTooltip:"Driver / connector pushes stream events to downstream sinks (Kafka/Atlas).",destinationLabel:"Streaming sink",destinationTooltip:"Analytical store or service consuming the stream.",topicFormat:e=>`mongo.${e}`,methodCopyOverrides:{polling:{label:"Polling (find queries)",laneDescription:"Scheduled queries diff collections by last-updated timestamps.",callout:"No delete visibility and heavy load for high-churn collections.",whenToUse:"Only for prototypes without Change Stream or oplog access.",tooltip:"find() queries scanning for updated documents on an interval."},trigger:{label:"Hooks (side-write)",laneDescription:"Application-layer hooks write audit documents alongside originals.",callout:"Requires app changes and doubles write throughput.",whenToUse:"When database triggers/log access is unavailable and app control exists.",tooltip:"Custom middleware duplicating writes into audit collections."},log:{label:"Change Stream tail",laneDescription:"Native Change Stream cursor fans out oplog events in order.",callout:"Recommended: low-latency stream with resume tokens and schema support.",whenToUse:"Default for MongoDB replicas when you can open a Change Stream cursor.",tooltip:"MongoDB Change Stream subscription on the oplog."}}}},Ut="cdc_playground_template_filter_v1",Bt="cdc_playground_template_filter_tags_v1",Gt={query:"",tags:[]},$r=e=>typeof e=="string"?e:"",jn=e=>{if(!Array.isArray(e))return[];const t=new Set,r=[];return e.forEach(o=>{if(o==null)return;const l=String(o).trim();!l||t.has(l)||(t.add(l),r.push(l))}),r},_s=e=>{if(!e||typeof e!="object")return{...Gt};const t=$r(typeof e.query=="string"?e.query:""),r=e.tags;if(Array.isArray(r))return{query:t,tags:jn(r)};if(typeof r=="string"){const o=r.trim();return{query:t,tags:o?[o]:[]}}return{query:t,tags:[]}},Pr=(e,t)=>{if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(e[r]!==t[r])return!1;return!0},Fr=e=>typeof e!="string"?"":e,Ur=e=>{if(typeof e!="string"||e.trim().length===0)return[];try{const t=JSON.parse(e);if(Array.isArray(t))return jn(t)}catch{}return[]},Br=e=>{if(!e)return{...Gt};try{const t=Fr(e.getItem(Ut)),r=Ur(e.getItem(Bt));return{query:t,tags:r}}catch{return{...Gt}}},qr=(e,t)=>{if(!t)return;const r=_s(e);try{r.query?t.setItem(Ut,r.query):typeof t.removeItem=="function"?t.removeItem(Ut):t.setItem(Ut,"")}catch{}try{r.tags.length>0?t.setItem(Bt,JSON.stringify(r.tags)):typeof t.removeItem=="function"?t.removeItem(Bt):t.setItem(Bt,"")}catch{}},Vr=e=>typeof e=="string"?e.trim().toLowerCase():"",nn=e=>Array.isArray(e)?e.map(t=>typeof t=="string"?t.trim():"").filter(t=>t.length>0):[],Gr=e=>{const t=[];return e.label&&t.push(e.label),e.description&&t.push(e.description),e.highlight&&t.push(e.highlight),e.name&&t.push(e.name),Array.isArray(e.tags)&&e.tags.length>0&&t.push(e.tags.join(" ")),t.join(" ").toLowerCase()};function Wr(e,t={}){const r=Array.from(e),{liveScenario:o,liveScenarioName:l,tags:h,query:b}=t;if(o){const E=r.findIndex(x=>x.name===o.name);E>=0?r.splice(E,1,o):r.unshift(o)}const y=nn(h),A=Vr(b).split(/\s+/).map(E=>E.trim()).filter(E=>E.length>0);return r.filter(E=>{if(l&&E.name===l)return!0;if(y.length>0){const m=nn(E.tags??[]);if(!y.every(i=>m.includes(i)))return!1}if(A.length===0)return!0;const x=Gr(E);return x?A.every(m=>x.includes(m)):!1})}const fs=(e,t)=>{Array.isArray(t)&&t.forEach(r=>{if(typeof r!="string")return;const o=r.trim();o.length>0&&e.add(o)})};function Hr(e,t={}){const r=new Set;return e.forEach(o=>fs(r,o.tags)),t.liveScenario&&fs(r,t.liveScenario.tags),t.additionalTags?.forEach(o=>fs(r,o)),Array.from(r).sort((o,l)=>o.localeCompare(l))}const ws=e=>{if(Array.isArray(e))return e.map(t=>ws(t));if(e&&typeof e=="object"){const t={};return Object.entries(e).forEach(([r,o])=>{t[r]=ws(o)}),t}return e},qt=e=>ws(e),Ln=e=>({...e}),rn=e=>({name:e.name,version:e.version,columns:e.columns.map(Ln)}),zr=(e,t)=>typeof t=="boolean"?"bool":typeof t=="number"?/_ts$|timestamp$/i.test(e)?"timestamp":"number":t instanceof Date?"timestamp":"string",Qr=(e,t=1)=>({name:e,version:t,columns:[{name:"id",type:"string",nullable:!1}]}),on=e=>{e.columns.some(r=>r.name==="id")||e.columns.unshift({name:"id",type:"string",nullable:!1})},an=e=>{const t=qt(e);return t.id=String(t.id),t};class bs{constructor(t=[]){this.tables=new Map,t.forEach(r=>this.upsertTable(r))}upsertTable(t){const r=rn(t.schema);on(r);const o=new Map;t.rows.forEach(l=>{const h=an(qt(l));o.set(h.id,h)}),this.tables.set(t.name,{schema:r,rows:o})}replaceAll(t){this.tables.clear(),t.forEach(r=>this.upsertTable(r))}getTable(t){const r=this.tables.get(t);if(r)return{name:t,schema:rn(r.schema),rows:Array.from(r.rows.values()).map(o=>qt(o))}}listTables(){return Array.from(this.tables.keys()).map(t=>this.getTable(t)).filter(t=>!!t)}clear(){this.tables.clear()}applyEvents(t){t.forEach(r=>this.applyEvent(r))}applyEvent(t){if(!t?.table)return;if(t.kind==="SCHEMA_ADD_COL"||t.kind==="SCHEMA_DROP_COL"){this.applySchemaChange(t);return}const r=this.ensureTableState(t.table,t.schemaVersion);if(t.schemaVersion&&t.schemaVersion>r.schema.version&&(r.schema.version=t.schemaVersion),t.kind==="DELETE"){const L=t.before?.id??t.after?.id;L!=null&&r.rows.delete(String(L));return}const o=t.after??void 0;if(!o)return;const l=an(o),h=r.rows.get(l.id),b=h?{...h,...l}:l,y=qt(b);this.syncSchemaColumns(r,y),r.rows.set(y.id,y)}snapshot(){return this.listTables()}ensureTableState(t,r){let o=this.tables.get(t);return o||(o={schema:Qr(t,r??1),rows:new Map},this.tables.set(t,o)),r&&r>o.schema.version&&(o.schema.version=r),on(o.schema),o}applySchemaChange(t){const r=t.schemaChange;if(!r)return;const o=this.ensureTableState(t.table,r.nextVersion??t.schemaVersion);o.schema.version=Math.max(o.schema.version,r.nextVersion??t.schemaVersion??o.schema.version),t.kind==="SCHEMA_ADD_COL"?this.addColumn(o,r.column):t.kind==="SCHEMA_DROP_COL"&&this.dropColumn(o,r.column.name)}addColumn(t,r){const o=t.schema.columns.find(l=>l.name===r.name);o?(o.type=r.type,r.nullable&&(o.nullable=!0)):t.schema.columns.push(Ln(r)),t.rows.forEach(l=>{r.name in l||(l[r.name]=null)})}dropColumn(t,r){r!=="id"&&(t.schema.columns=t.schema.columns.filter(o=>o.name!==r),t.rows.forEach(o=>{r in o&&delete o[r]}))}syncSchemaColumns(t,r){const o=t.schema.columns;Object.entries(r).forEach(([l,h])=>{if(l==="id"||l.startsWith("__"))return;let b=o.find(y=>y.name===l);b||(b={name:l,type:zr(l,h)},o.push(b)),h==null&&(b.nullable=!0)})}}const Kr=2e3,Nt={methods:[],ops:[],tables:[],txns:[]},ln={empty:"No events yet.",noMatch:"No events match the current filters."},cn=e=>{if(!e)return"";try{const t=JSON.stringify(e);return t?t.length>160?`${t.slice(0,160)}…`:t:""}catch{return""}},kn=e=>{if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const r=t.toLowerCase();return["c","create","insert","i"].includes(r)?"insert":["u","update"].includes(r)?"update":["d","delete"].includes(r)?"delete":r},Jr=e=>{const t=kn(e);if(t==="insert"||t==="update"||t==="delete")return t.toUpperCase();if(typeof e!="string")return"—";const r=e.trim();return r?r.toUpperCase():"—"},Yr=({events:e,stats:t,totalCount:r,filters:o={},filterOptions:l,onFiltersChange:h,onDownload:b,onClear:y,onCopyEvent:L,onReplayEvent:A,maxVisibleEvents:E=Kr,emptyMessage:x,noMatchMessage:m,className:w})=>{const i={methods:l?.methods??Nt.methods,ops:l?.ops??Nt.ops,tables:l?.tables??Nt.tables,txns:l?.txns??Nt.txns},p=d.useMemo(()=>typeof E!="number"||E<=0?e.length:Math.min(E,e.length),[e.length,E]),[c,v]=d.useState(p);d.useEffect(()=>{v(M=>M<p?p:M>e.length?e.length:M)},[p,e.length]);const T=d.useMemo(()=>{const M=Math.max(c,0),H=Math.max(e.length-M,0);return e.slice(H)},[e,c]),k=T.length<e.length,D=c>p,V=()=>{if(!k)return;const M=p>0?p:e.length;v(H=>Math.min(H+M,e.length))},Z=()=>{v(p)},Ge=typeof r=="number"?r:e.length,ye=!!o.methodId||!!o.op||!!o.table||!!o.txnId,We={empty:x??ln.empty,noMatch:m??ln.noMatch},X=M=>{if(!h)return;const H={methodId:M.methodId===void 0?o.methodId:M.methodId,op:M.op===void 0?o.op:M.op,table:M.table===void 0?o.table:M.table,txnId:M.txnId===void 0?o.txnId:M.txnId},z={methodId:H.methodId||void 0,op:H.op||void 0,table:H.table||void 0,txnId:H.txnId||void 0};h(z)},nt=M=>{const H=cn(M.before),z=cn(M.after);return!H&&!z?null:n.jsxs("details",{className:"cdc-event-log__details",children:[n.jsx("summary",{children:"Row image"}),H&&n.jsxs("div",{className:"cdc-event-log__details-row",children:[n.jsx("span",{children:"before"}),n.jsx("code",{children:H})]}),z&&n.jsxs("div",{className:"cdc-event-log__details-row",children:[n.jsx("span",{children:"after"}),n.jsx("code",{children:z})]})]})};return n.jsxs("section",{className:`cdc-event-log${w?` ${w}`:""}`,"aria-label":"Event log",role:"region",children:[n.jsxs("header",{className:"cdc-event-log__header",children:[n.jsxs("div",{className:"cdc-event-log__headline",children:[n.jsx("h3",{children:"Event Log"}),t&&n.jsxs("p",{className:"cdc-event-log__stats",children:[n.jsxs("span",{children:["Produced ",t.produced]})," · ",n.jsxs("span",{children:["Consumed ",t.consumed]})," · ",n.jsxs("span",{children:["Backlog ",t.backlog]}),typeof t.snapshotRows=="number"&&n.jsxs(n.Fragment,{children:[" · ",n.jsxs("span",{children:["Snapshot rows ",t.snapshotRows]})]})]})]}),n.jsxs("div",{className:"cdc-event-log__actions",children:[n.jsxs("span",{children:[e.length," events"]}),n.jsx("button",{type:"button",onClick:b,disabled:!b||e.length===0,children:"Download NDJSON"}),n.jsx("button",{type:"button",onClick:y,disabled:!y||Ge===0,children:"Clear"})]})]}),n.jsxs("div",{className:"cdc-event-log__filters",role:"group","aria-label":"Event log filters",children:[n.jsxs("label",{children:[n.jsx("span",{children:"Method"}),n.jsxs("select",{value:o.methodId??"",onChange:M=>X({methodId:M.target.value||void 0}),disabled:!h||i.methods.length===0,children:[n.jsx("option",{value:"",children:"All methods"}),i.methods.map(M=>n.jsx("option",{value:M.id,children:M.label},M.id))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Operation"}),n.jsxs("select",{value:o.op??"",onChange:M=>X({op:M.target.value||void 0}),disabled:!h||i.ops.length===0,children:[n.jsx("option",{value:"",children:"All ops"}),i.ops.map(M=>n.jsx("option",{value:M,children:M.toUpperCase()},M))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Table"}),n.jsxs("select",{value:o.table??"",onChange:M=>X({table:M.target.value||void 0}),disabled:!h||i.tables.length===0,children:[n.jsx("option",{value:"",children:"All tables"}),i.tables.map(M=>n.jsx("option",{value:M,children:M},M))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Txn"}),n.jsxs("select",{value:o.txnId??"",onChange:M=>X({txnId:M.target.value||void 0}),disabled:!h||i.txns.length===0,children:[n.jsx("option",{value:"",children:"All txns"}),i.txns.map(M=>n.jsx("option",{value:M,children:M},M))]})]})]}),e.length===0?n.jsx("p",{className:"cdc-event-log__empty",children:Ge>0||ye?We.noMatch:We.empty}):n.jsxs("ul",{className:"cdc-event-log__list",children:[e.length>T.length&&n.jsxs("li",{className:"cdc-event-log__notice",children:[n.jsxs("span",{children:["Showing latest ",T.length," of ",e.length," events."]}),n.jsxs("div",{className:"cdc-event-log__notice-actions",children:[n.jsx("button",{type:"button",onClick:V,disabled:!k,children:"Load more"}),D&&n.jsx("button",{type:"button",onClick:Z,children:"Show latest"})]})]}),T.map(M=>{const H=Jr(M.op),z=kn(M.op),Ht=typeof M.offset=="number"?M.offset:M.offset==null?"—":M.offset,J=M.topic??"—",rt=M.table??"—",Te=M.pk??"—",Me=M.txnId??"",ne=typeof M.tsMs=="number"?M.tsMs:"—",Ae=z==="insert"||z==="update"||z==="delete";return n.jsxs("li",{className:"cdc-event-log__item",children:[n.jsx("span",{className:"cdc-event-log__method",children:M.methodLabel??M.methodId??"—"}),n.jsx("span",{className:"cdc-event-log__op","data-op":H,children:H}),n.jsxs("span",{className:"cdc-event-log__offset",children:["offset ",Ht]}),n.jsx("span",{className:"cdc-event-log__topic",children:J}),n.jsxs("span",{className:"cdc-event-log__table",children:["table ",rt]}),n.jsxs("span",{className:"cdc-event-log__meta",children:["ts=",ne,"ms · pk=",Te,Me?` · txn=${Me}`:""]}),M.meta?n.jsx("span",{className:"cdc-event-log__extra",children:M.meta}):null,A?n.jsx("button",{type:"button",className:"cdc-event-log__replay",onClick:()=>A?.(M),disabled:!Ae,children:"Replay"}):null,n.jsx("button",{type:"button",className:"cdc-event-log__copy",onClick:()=>L?.(M),disabled:!L,children:"Copy"}),nt(M)]},M.id)})]})]})};function Xr(e){const t=e.op?.toUpperCase?.()??"?",r=e.pk??"∅",o=e.expectedIndex!=null?`#${e.expectedIndex}`:void 0,l=e.actualIndex!=null?`#${e.actualIndex}`:void 0;return e.type==="missing"?`Missing ${t} for pk=${r} (${o??"expected"} @ ${e.expectedTime??"?"}ms)`:e.type==="extra"?`Unexpected ${t} for pk=${r} (${l??"emitted"} @ ${e.actualTime??"?"}ms)`:`Out-of-order ${t} pk=${r} (expected ${o??"?"} before actual ${l??"?"})`}const Zr=({diff:e,scenarioName:t,laneId:r,schemaStatus:o,onDiffDetailsOpened:l})=>{if(!e)return null;const{totals:h,issues:b,lag:y}=e,L=h.missing>0||h.extra>0||h.ordering>0,A=b.slice(0,6);let E=null;return o&&(o.hasColumn?o.version<o.expectedVersion&&(E=`Schema behind: v${o.version} (expected v${o.expectedVersion})`):E=`${o.columnName} column missing in destination`),!L&&y.max<=0&&!E?null:n.jsxs("div",{className:"sim-shell__lane-diff","data-has-issues":L?"true":"false",role:"note",children:[n.jsxs("div",{className:"sim-shell__lane-diff-summary",children:[L?n.jsxs(n.Fragment,{children:[h.missing>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--missing",children:[h.missing," missing"]}),h.extra>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--extra",children:[h.extra," extra"]}),h.ordering>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--ordering",children:[h.ordering," ordering"]})]}):n.jsx("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--ok",children:"Operations aligned"}),y.max>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--lag",children:["Max lag ",Math.round(y.max),"ms"]})]}),E&&n.jsx("p",{className:"sim-shell__lane-diff-schema",children:E}),(A.length>0||y.samples.length>0)&&n.jsxs("details",{id:r?`lane-diff-${r}`:void 0,className:"sim-shell__lane-diff-details",onToggle:x=>{x.target.open&&l?.({method:e.method,issueCount:e.issues.length,maxLag:e.lag.max,scenario:t})},children:[n.jsx("summary",{children:"Diff details"}),A.length>0&&n.jsx("ul",{className:"sim-shell__lane-diff-list",children:A.map((x,m)=>n.jsx("li",{children:Xr(x)},`${x.type}-${x.op}-${x.pk??"∅"}-${m}`))}),b.length>A.length&&n.jsxs("p",{className:"sim-shell__lane-diff-more",children:["+",b.length-A.length," additional difference(s)"]}),y.samples.length>0&&n.jsxs("div",{className:"sim-shell__lane-diff-lag",children:[n.jsx("h4",{children:"Lag hotspots"}),n.jsx("ul",{children:y.samples.map(x=>n.jsxs("li",{children:[Math.round(x.lagMs),"ms on ",x.op.toUpperCase()," pk=",x.pk??"∅"]},`${x.op}-${x.pk??"∅"}-${x.actualTime??"?"}`))})]})]})]})},tt=Cn,ce=e=>Number.isFinite(e)?e.toLocaleString():"—",dn=e=>Number.isFinite(e)?`${Math.round(e)}ms`:"—",eo=({lanes:e,renderSchemaWalkthrough:t})=>{const r=e.reduce((o,l)=>(o.produced+=l.produced,o.consumed+=l.consumed,o.backlog+=l.backlog,o),{produced:0,consumed:0,backlog:0});return n.jsxs("section",{className:"sim-shell__metrics-dashboard","aria-label":"Runtime metrics",children:[n.jsx("header",{className:"sim-shell__metrics-dashboard-header",children:n.jsxs("div",{children:[n.jsx("h3",{children:"Runtime metrics"}),n.jsxs("p",{children:["Produced ",ce(r.produced)," · Consumed ",ce(r.consumed)," · Backlog ",ce(r.backlog)]})]})}),n.jsx("div",{className:"sim-shell__metrics-dashboard-grid",children:e.map(o=>n.jsxs("article",{className:"sim-shell__metrics-dashboard-card",children:[n.jsx("header",{children:n.jsx("h4",{"data-tooltip":o.tooltip||void 0,children:o.label})}),t&&n.jsx("div",{className:"sim-shell__schema-demo-inline",children:t(o.id)}),n.jsxs("dl",{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Produced"}),n.jsx("dd",{children:ce(o.produced)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Consumed"}),n.jsx("dd",{children:ce(o.consumed)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Backlog"}),n.jsx("dd",{"data-tooltip":tt.backlog,children:ce(o.backlog)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Lag p50"}),n.jsx("dd",{"data-tooltip":tt.lagPercentile,children:dn(o.lagP50)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Lag p95"}),n.jsx("dd",{"data-tooltip":tt.lagPercentile,children:dn(o.lagP95)})]}),typeof o.snapshotRows=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Snapshot rows"}),n.jsx("dd",{"data-tooltip":tt.snapshot,children:ce(o.snapshotRows)})]}),(typeof o.inserts=="number"||typeof o.updates=="number"||typeof o.deletes=="number")&&n.jsxs("div",{children:[n.jsx("dt",{children:"Change mix"}),n.jsxs("dd",{children:["C ",ce(o.inserts??0)," · U ",ce(o.updates??0)," · D ",ce(o.deletes??0),typeof o.schemaChanges=="number"&&o.schemaChanges>0?` · Schema ${ce(o.schemaChanges)}`:""]})]}),typeof o.missedDeletes=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Missed deletes"}),n.jsx("dd",{"data-tooltip":tt.deleteCapture,children:ce(o.missedDeletes)})]}),typeof o.writeAmplification=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Write amplification"}),n.jsxs("dd",{"data-tooltip":tt.triggerWriteAmplification,children:[o.writeAmplification.toFixed(1),"x"]})]})]})]},o.id))})]})},to=({lagMs:e,throughput:t,deletesPct:r,orderingOk:o,consistent:l,writeAmplification:h,insertCount:b,updateCount:y,deleteCount:L,schemaChangeCount:A})=>n.jsxs("div",{role:"status","aria-live":"polite",children:[n.jsxs("span",{children:["Lag: ",e,"ms"]})," ·",n.jsxs("span",{children:["TPS: ",t.toFixed(1)]})," ·",n.jsxs("span",{children:["Deletes: ",Math.round(r),"%"]})," ·",n.jsxs("span",{children:["Ordering: ",o?"OK":"KO"]})," ·",n.jsxs("span",{children:["Consistency: ",l?"OK":"Drift"]})," ","·",n.jsxs("span",{children:["Ops C/U/D: ",b,"/",y,"/",L]}),A>0&&n.jsxs(n.Fragment,{children:[" ","·",n.jsxs("span",{children:["Schema: ",A]})]}),typeof h=="number"&&n.jsxs(n.Fragment,{children:[" ","·",n.jsxs("span",{children:["Trigger WA: ",h.toFixed(1),"x"]})]})]}),so=({onAdd:e,onDrop:t,columnName:r,disabled:o,disableAdd:l,disableDrop:h,status:b})=>n.jsxs("section",{className:"sim-shell__schema-demo","aria-label":"Schema walkthrough",children:[n.jsxs("header",{children:[n.jsx("h4",{children:"Schema walkthrough"}),n.jsxs("p",{children:["Add or drop ",n.jsx("code",{children:r})," while events stream to compare capture behaviour."]})]}),b?n.jsx("p",{className:"sim-shell__schema-demo-status",children:b}):null,n.jsxs("div",{className:"sim-shell__schema-demo-buttons",children:[n.jsxs("button",{type:"button",onClick:e,disabled:o||l,"data-tour-target":"schema-add",children:["Add ",r]}),n.jsxs("button",{type:"button",onClick:t,disabled:o||h,"data-tour-target":"schema-drop",children:["Drop ",r]})]})]}),gt=e=>{if(Array.isArray(e))return e.map(t=>gt(t));if(e&&typeof e=="object"){const t={};return Object.entries(e).forEach(([r,o])=>{t[r]=gt(o)}),t}return e},Fe=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"&&e.trim().length>0){const t=Number(e);return Number.isFinite(t)?t:null}return null},no=e=>{if(typeof e=="boolean")return e;if(typeof e=="string"){const t=e.trim().toLowerCase();if(t==="true")return!0;if(t==="false")return!1}return null},qe=e=>{if(e==null)return null;if(typeof e=="string"){const t=e.trim();return t.length>0?t:null}return typeof e=="number"&&Number.isFinite(e)?String(e):typeof e=="boolean"?e?"true":"false":null},ro=e=>{if(!e)return null;if(typeof e=="object"){const r=e;if(r&&Object.prototype.hasOwnProperty.call(r,"id")){const o=qe(r.id);return o?{id:o}:null}}const t=qe(e);return t?{id:t}:null},oo=e=>{const t=e.event??{},r=qe(e.method),o=Fe(t.offset),l=Fe(t.seq),h=Fe(t.ts_ms)??Fe(t.tsMs)??Fe(t.ts),b=qe(t.op),y=qe(t.table),L=ro(t.pk),A=t.before==null?null:gt(t.before),E=t.after==null?null:gt(t.after),x=qe(t.topic),m=t.tx??null,w=qe(m?.id??t.txnId),i=Fe(m?.index??t.txnIndex),p=Fe(m?.total??t.txnTotal),c=no(m?.last??t.txnLast),v=t.schemaChange==null?null:gt(t.schemaChange);return{method:r??null,offset:o,seq:l,ts_ms:h,op:b,table:y,pk:L,before:A,after:E,topic:x,txn_id:w,txn_index:i,txn_total:p,txn_last:c,schema_change:v}},ao=(e,t={})=>{const r=t.newline??`
`,o=[];for(const l of e){if(!l||typeof l!="object")continue;const h=oo(l);o.push(JSON.stringify(h))}return o.join(r)},io="cdc_telemetry_buffer_v1",lo=200,Tn={activation:{key:"activation",label:"Activation",description:"Do new users reach their first comparator insight?"},funnel_drop:{key:"funnel_drop",label:"Funnel drop",description:"Where do users abandon the guided comparator walkthrough?"},adoption:{key:"adoption",label:"Adoption",description:"Which comparator features become part of regular usage?"},quality_gate:{key:"quality_gate",label:"Quality gate",description:"Do reliability issues or errors block comparator adoption?"},scenario_completeness:{key:"scenario_completeness",label:"Scenario completeness",description:"Which templates lead to full replay, export, and comparator review?"},collaboration:{key:"collaboration",label:"Collaboration",description:"How often do teams share scenarios or comparator snapshots?"}},un={"comparator.scenario.select":"activation","comparator.scenario.preview":"activation","comparator.preset.select":"activation","comparator.scenario.filter":"activation","comparator.scenario.tag_toggle":"funnel_drop","comparator.scenario.tag_clear":"funnel_drop","comparator.summary.copied":"activation","comparator.diff.opened":"funnel_drop","comparator.overlay.inspect":"activation","comparator.schema.change":"activation","comparator.clock.control":"funnel_drop","comparator.consumer.toggle":"funnel_drop","comparator.consumer.rate_toggle":"funnel_drop","comparator.consumer.rate_adjust":"activation","comparator.consumer.rate_reset":"activation","comparator.event.search":"activation","comparator.event.filter":"activation","comparator.panel.layout":"adoption","comparator.event.download":"adoption","comparator.event.clear":"adoption","comparator.event.copy":"activation","comparator.event.copy.error":"quality_gate","comparator.event.replay":"activation","comparator.destination.download":"adoption","comparator.generator.toggle":"adoption","comparator.generator.rate_adjust":"adoption","comparator.generator.burst":"activation","tour.started":"funnel_drop","tour.completed":"activation","tour.dismissed":"funnel_drop","workspace.share.generated":"collaboration","workspace.scenario.imported":"scenario_completeness","workspace.scenario.template_loaded":"activation","workspace.scenario.exported":"scenario_completeness","telemetry.flush":"activation"},Mn=e=>!!e&&typeof e=="object"&&!Array.isArray(e),Wt=e=>{if(!Mn(e))return{};const t={};return Object.keys(e).forEach(r=>{t[r]=e[r]}),t},co=()=>({getItem:()=>null,setItem:()=>{}}),uo=e=>{try{return e.toISOString()}catch{return new Date().toISOString()}},ho=e=>{if(!Mn(e))return null;const t=typeof e.event=="string"?e.event:null;if(!t)return null;const r=Wt(e.payload),o=Wt(e.context),l=typeof e.recordedAt=="string"?e.recordedAt:typeof e.recorded_at=="string"?e.recorded_at:null,h=l&&!Number.isNaN(Date.parse(l))?l:new Date().toISOString(),b=e.question,y=typeof b=="string"&&b in Tn?b:null;return{event:t,payload:r,context:o,question:y,recordedAt:h}},po=e=>({event:e.event,payload:e.payload,context:e.context,question:e.question,recordedAt:e.recordedAt}),mo=(e={})=>{const t=e.storage??(typeof window<"u"&&window.localStorage?window.localStorage:co()),r=e.storageKey??io,o=Math.max(1,e.maxEntries??lo),l=e.now??(()=>new Date),h=e.console??(typeof console<"u"?{warn:console.warn.bind(console),debug:console.debug.bind(console)}:{warn:()=>{},debug:()=>{}}),y=(()=>{try{const w=t.getItem(r);if(!w)return[];const i=JSON.parse(w);return Array.isArray(i)?i.map(ho).filter(c=>!!c).slice(-o):[]}catch(w){return h.warn("Telemetry buffer load failed",w),[]}})(),L=()=>{try{const w=y.slice(-o).map(po);t.setItem(r,JSON.stringify(w))}catch(w){h.warn("Telemetry buffer save failed",w)}};return{buffer:y,track:(w,i={},p={})=>{if(typeof w!="string"||!w.trim())return;const c=w.trim(),v={event:c,payload:Wt(i),context:Wt(p),question:un[c]??null,recordedAt:uo(l())};y.push(v),y.length>o&&y.splice(0,y.length-o),L(),v.context.debug&&h.debug("[telemetry]",v)},flush:()=>{if(y.length===0)return[];const w=y.slice();return y.length=0,L(),w},questions:()=>Object.values(Tn).map(w=>({...w})),taxonomy:()=>({...un})}},hn=e=>{const t=e.trim();if(!t.startsWith("|")||t==="|")return[];const r=t.split("|");return r.shift(),r.length>0&&r[r.length-1].trim()===""&&r.pop(),r.map(o=>o.trim())},An=e=>{let t=e.trim(),r=!1;const o=["*","_"];let l=!0;for(;l&&t.length>=2;)l=!1,o.forEach(h=>{if(t.startsWith(h)&&t.endsWith(h)){const b=t.slice(h.length,t.length-h.length).trim();b.length>=0&&(t=b,r=!0,l=!0)}});return{text:t,emphasis:r}},go=e=>{const t=e.match(/^\[([^\]]+)\]\(([^)]+)\)$/);if(!t)return{text:e};const[,r,o]=t;return{text:r.trim(),href:o.trim()}},In=e=>e.replace(/&nbsp;/gi," ").replace(/&#160;/g," "),fo=e=>{if(!e)return{text:""};const t=In(e),{text:r,emphasis:o}=An(t),l=go(r);return{text:l.text.trim(),href:l.href,emphasis:o}},bo=e=>e.length>0&&e.every(t=>/^:?[-=]+:?$/u.test(t.replace(/\s+/g,""))),xo=e=>{if(!e.length)return!1;const t=e[0].text.trim().toLowerCase();return t.length>0&&t.includes("no runs")&&t.includes("captured")},yo=e=>{const t=e.split(/\r?\n/).map(y=>y.trim()).filter(y=>y.startsWith("|"));if(t.length<2)return null;const r=hn(t[0]);if(!r.length)return null;const o=r.map(y=>An(In(y)).text),l=t.slice(1),h=[];let b=null;return l.forEach(y=>{const L=hn(y);if(!L.length||bo(L))return;const A=L.map(fo);if(xo(A)){b=A[0].text.trim();return}A.every(E=>E.text==="")||h.push(A)}),{headers:o,rows:h,placeholder:b}};class vo{constructor(){this.scenario=null,this.engines=[],this.idx=0,this.now=0,this.playing=!1}attach(t){this.engines=t}load(t){this.scenario=t,this.idx=0,this.now=0,this.playing=!1}reset(t){this.engines.forEach(r=>r.reset(t)),this.idx=0,this.now=0}onTick(t){this.onTickCb=t}start(){this.playing=!0}pause(){this.playing=!1}tick(t){if(!this.playing||!this.scenario)return;this.now+=t;const{ops:r}=this.scenario;for(;this.idx<r.length&&r[this.idx].t<=this.now;){const o=r[this.idx++];this.engines.forEach(l=>l.applySourceOp(o))}this.engines.forEach(o=>o.tick(this.now)),this.onTickCb?.(this.now)}}const _o=new Set(["c","u","d"]);function wo(e){switch(e.op){case"insert":return"c";case"update":return"u";case"delete":return"d";default:return null}}function So(e){return e.map((t,r)=>{const o=wo(t);if(!o)return null;const l=t.pk?.id!=null?String(t.pk.id):"";return{key:`${o}::${l}`,op:o,pk:l,index:r,time:t.t}}).filter(t=>!!t)}function Eo(e){return e.map((t,r)=>{if(!_o.has(t.op))return null;const o=t.pk?.id!=null?String(t.pk.id):"",l=t.op;return{key:`${l}::${o}`,op:l,pk:o,index:r,time:t.ts_ms}}).filter(t=>!!t)}function pn(e){const t=new Map;for(const r of e){const o=t.get(r.key);o?o.push(r):t.set(r.key,[r])}return t}function Co(e,t){const r=[],o=[],l=[],h=pn(e),b=pn(t),y=new Set([...h.keys(),...b.keys()]);for(const L of y){const A=h.get(L)??[],E=b.get(L)??[],x=Math.min(A.length,E.length);for(let m=0;m<x;m++){const w=A[m],i=E[m];r.push({expected:w,actual:i,lagMs:Math.max(0,i.time-w.time)})}for(let m=x;m<A.length;m++)o.push(A[m]);for(let m=x;m<E.length;m++)l.push(E[m])}return{matched:r,missing:o,extra:l}}function jo(e){const t=[],r=[...e].sort((l,h)=>l.actual.index-h.actual.index);let o=-1/0;for(const l of r)l.expected.index<o?t.push({type:"ordering",op:l.expected.op,pk:l.expected.pk,expectedIndex:l.expected.index,actualIndex:l.actual.index,expectedTime:l.expected.time,actualTime:l.actual.time}):o=l.expected.index;return t}function Lo(e){return e.filter(t=>t.lagMs>0).sort((t,r)=>r.lagMs-t.lagMs).slice(0,5).map(t=>({op:t.expected.op,pk:t.expected.pk,expectedTime:t.expected.time,actualTime:t.actual.time,lagMs:t.lagMs}))}function ko(e,t,r){const o=So(t),l=Eo(r),{matched:h,missing:b,extra:y}=Co(o,l),L=[];for(const x of b)L.push({type:"missing",op:x.op,pk:x.pk,expectedIndex:x.index,expectedTime:x.time});for(const x of y)L.push({type:"extra",op:x.op,pk:x.pk,actualIndex:x.index,actualTime:x.time});L.push(...jo(h));const A=Lo(h),E=A.reduce((x,m)=>Math.max(x,m.lagMs),0);return{method:e,totals:{missing:L.filter(x=>x.type==="missing").length,extra:L.filter(x=>x.type==="extra").length,ordering:L.filter(x=>x.type==="ordering").length},issues:L,lag:{max:E,samples:A}}}const To=`# Harness Nightly History

Run \`GITHUB_TOKEN=... npm run harness:history\` to refresh this summary. The script aggregates the latest Harness Nightly artifacts and records table-level parity results here so the app can surface them inline.

| Run | Date | Conclusion | Events | Missing | Extra | Max Lag (ms) | Tables | Mismatches |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| _No runs captured yet._ |   |   |   |   |   |   |   |   |

`,Mo="workspace",Ao=e=>({...e}),Io=e=>!Array.isArray(e)||e.length===0?[{name:"id",type:"string",pk:!0}]:e.filter(t=>t&&typeof t.name=="string").map(t=>{const r={name:t.name,type:"string",pk:!!t.pk},o=t.type;if(typeof o=="string"){const l=o.toLowerCase();l==="number"||l==="bool"||l==="timestamp"?r.type=l:l==="string"&&(r.type="string")}return typeof t.nullable=="boolean"&&(r.nullable=t.nullable),r}),Oo=e=>e.type?String(e.type).toLowerCase():"string",No=e=>{const t=e.find(r=>r.pk);return t?.name?t.name:"id"},mn=(e,t,r)=>Array.isArray(r)&&r.length>0?r.reduce((o,l)=>(l===t||Object.prototype.hasOwnProperty.call(e,l)&&(o[l]=e[l]),o),{}):Object.entries(e).reduce((o,[l,h])=>(l===t||(o[l]=h),o),{}),gn=(e,t,r,o)=>{const l=Oo(e);if(l==="number"){const b=t.seq*10+r;return typeof o=="number"?o+1:b}if(l==="bool"||l==="boolean")return typeof o=="boolean"?!o:r%2===0;if(l==="timestamp")return t.logicalTime+r+1;const h=`${t.seq}_${r}_${t.opCounter}`;return`${e.name}_${h}`},Do=(e,t={})=>{const r=Io(e.schema),o=No(r),l=new Map;(Array.isArray(e.rows)?e.rows:[]).forEach(L=>{if(!L||typeof L!="object")return;const A=L,E=A[o]??A.id;if(E==null)return;const x=String(E),m={};Object.entries(A).forEach(([w,i])=>{if(w===o){m[w]=String(i);return}w==="id"&&o!=="id"||(m[w]=i)}),Object.prototype.hasOwnProperty.call(m,o)||(m[o]=x),l.set(x,m)});const b=Array.isArray(e.ops)?e.ops.reduce((L,A)=>Math.max(L,A?.t??0),0):0;return{table:typeof e.table=="string"&&e.table.trim().length?e.table:t.fallbackTable??Mo,columns:r,pkField:o,rows:l,logicalTime:b,seq:l.size+1,opCounter:0}},Ro=(e,t,r)=>{const o=Math.max(1,Math.floor(t)||1),l=Array.from(e.rows.keys()),h=e.columns.filter(E=>E.name!==e.pkField);let b="insert";if(l.length>0&&h.length>0){const E=e.opCounter%6;(E===0||E===4)&&l.length>1?b="delete":E===1||E===2||E===3?b="update":b="insert"}else l.length>1&&h.length===0&&(b=e.opCounter%3===0?"delete":"insert");const y=e.opCounter;e.opCounter+=1;const L=Math.max(e.logicalTime,r);e.logicalTime=L+o;const A=e.logicalTime;if(b==="insert"){const E=`gen-${e.seq++}`,x={[e.pkField]:E};h.forEach((i,p)=>{x[i.name]=gn(i,e,p)}),e.rows.set(E,x);const m=mn(x,e.pkField);return{op:{t:A,op:"insert",table:e.table,pk:{id:E},after:m},kind:b}}if(b==="update"&&l.length>0&&h.length>0){const E=y%l.length,x=l[E],m=e.rows.get(x);if(!m)return null;const w=h[y%h.length],i=gn(w,e,y,m[w.name]),p=Ao(m);p[w.name]=i,e.rows.set(x,p);const c=mn(p,e.pkField,[w.name]);return{op:{t:A,op:"update",table:e.table,pk:{id:x},after:c},kind:b}}if(b==="delete"&&l.length>0){const E=y%l.length,x=l[E];return e.rows.delete(x),{op:{t:A,op:"delete",table:e.table,pk:{id:x}},kind:b}}return null};function B(e,t={},r={}){if(typeof window>"u")return;const o=window.telemetry;!o||typeof o.track!="function"||o.track(e,t,r)}function mt(e,t={}){B("comparator.clock.control",{action:e,...t})}function $o({onDiffDetailsOpened:e,...t}){const r=o=>{e?.(o),B("comparator.diff.opened",{method:o.method,issues:o.issueCount,maxLag:o.maxLag,scenario:o.scenario})};return n.jsx(Zr,{...t,onDiffDetailsOpened:r})}function Po(e){const t={...e};return e.pk&&(t.pk={...e.pk}),e.after&&(t.after={...e.after}),e.txn&&(t.txn={...e.txn}),t}function Fo(e){if(e==null)return e;try{return JSON.parse(JSON.stringify(e))}catch{return e}}function Uo(e){return{id:e.id,name:e.id||e.name,label:e.label,description:e.description,highlight:e.highlight,stats:{rows:e.rows.length,ops:e.ops.length},table:e.table,tags:[...e.tags],schema:e.schema.length?e.schema.map(t=>({...t})):void 0,rows:e.rows.length?e.rows.map(t=>({...t})):void 0,events:e.events.length?e.events.map(t=>({...t})):void 0,schemaVersion:e.schemaVersion,seed:e.seed,ops:e.ops.map(Po),comparator:e.comparator?Fo(e.comparator):null}}const On=Er;On.length===0&&typeof console<"u"&&console.warn("No scenario templates were loaded from assets/shared-scenarios.js; the comparator scenario gallery will be empty.");const Dt=On.map(Uo),Nn={polling:{label:"Polling (Query)",laneDescription:"Simple, but lossy. Periodic scans read current state only; hard deletes and mid-poll updates can disappear.",callout:"Polling reads current state only. Hard deletes and intermediate updates are not captured.",whenToUse:"Simple, but lossy. Periodic scans read current state only. Hard deletes and intermediate updates between polls are not observable. Good for small, non-critical syncs where some lag and loss is acceptable."},trigger:{label:"Trigger (Audit)",laneDescription:"Complete, but intrusive. Database triggers write to an audit table and add synchronous source overhead.",callout:"Triggers add write overhead to source transactions.",whenToUse:"Complete, but intrusive. Triggers capture every change into an audit table, but add write latency and operational overhead on the source. Use when log access isn’t available."},log:{label:"Log (WAL)",laneDescription:"Default choice. Streams the transaction log post-commit for ordered, low-latency change events.",callout:"Log-based CDC is the preferred default when available.",whenToUse:"Default choice. Reads the database’s transaction log post-commit. Lowest source impact, complete and ordered changes, near-real-time. Requires connector setup and ops discipline."}};typeof window<"u"&&(window.CDC_METHOD_COPY=Nn);const Ue="workspace-live",Dn="cdc_comparator_prefs_v1",Be={name:"priority_flag",type:"bool"};function Bo(e,t,r,o){if(r.length===0)return 0;const l=e[t]?.metrics.writeAmplification;if(typeof l=="number"&&l>=0)return l;const h=o.ops.filter(b=>b.table===r[0]?.table);return h.length?r.length/h.length:r.length}const ge=["polling","trigger","log"],Rn=2,ke=100,$n=10,Pn=300,Ss=120,qo=10,Fn=10,Un=600,Bn=120,Es=10,xs=40,Vo=5,Ve=["c","u","d","s"],fn="MYSQL_DEBEZIUM";function Vt(e){return typeof e=="string"&&Object.prototype.hasOwnProperty.call(Ft,e)}const de=e=>{if(e==null)return e;try{return JSON.parse(JSON.stringify(e))}catch{return null}},Go=e=>{if(!e)return null;const t=e.methodCopyOverrides?de(e.methodCopyOverrides)??void 0:void 0;return{id:e.id,label:e.label,description:e.description,docsHint:e.docsHint,sourceLabel:e.sourceLabel,sourceTooltip:e.sourceTooltip,logLabel:e.logLabel,logTooltip:e.logTooltip,busLabel:e.busLabel,busTooltip:e.busTooltip,destinationLabel:e.destinationLabel,destinationTooltip:e.destinationTooltip,methodCopyOverrides:t}};function Wo(e,t,r,o,l,h,b,y){const L=de(e),A=t?de(t):null,E=de(r)??[],x=b?de(b):null,m=Array.from(o.values()).map(i=>de(i)).filter(i=>!!i),w=y.map(i=>{const p=de(i.metrics);return p?{method:i.method,eventCount:i.events.length,metrics:p}:null}).filter(i=>!!i);return{preferences:L,summary:A,analytics:E,diffs:m,tags:[...l],preset:Go(h),overlay:x,lanes:w}}function bn(e){return e?!!(e.preferences&&Object.keys(e.preferences).length>0)||!!e.summary||(e.analytics?.length??0)>0||(e.diffs?.length??0)>0||(e.tags?.length??0)>0||!!e.preset||(e.overlay?.length??0)>0||(e.lanes?.length??0)>0:!1}const Ho=Nn,K=Cn,ys=200,zo=2e3,Qo=6;function Ko(){if(typeof window>"u")return new Set;const t=window.cdcFeatureFlags?.all?.();if(Array.isArray(t)&&t.length)return new Set(t.map(String));const r=window.APPWRITE_CFG?.featureFlags;return Array.isArray(r)&&r.length?new Set(r.map(String)):new Set}const Jo={polling:{pollIntervalMs:500,includeSoftDeletes:!1},trigger:{extractIntervalMs:250,triggerOverheadMs:8},log:{fetchIntervalMs:50}},Yo={polling:"QUERY_BASED",trigger:"TRIGGER_BASED",log:"LOG_BASED"},Xo={polling:"polling",trigger:"trigger",log:"log"},xn=e=>{switch(e){case"polling":return Or();case"trigger":return Rr();case"log":default:return Ar()}},yn=e=>{if(!e)return null;const t={...e};return delete t.__ts,t},Zo=e=>{if(e==null)return"—";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="number")return Number.isFinite(e)?e.toString():"—";if(e instanceof Date)return e.toISOString();if(typeof e=="object")try{return JSON.stringify(e)}catch{return"[object]"}return String(e)},qn=(e,t,r)=>{const o=t.kind==="INSERT"?"c":t.kind==="UPDATE"?"u":t.kind==="DELETE"?"d":"s",l=t.schemaChange?{action:t.schemaChange.action,column:{name:t.schemaChange.column.name,type:t.schemaChange.column.type,nullable:t.schemaChange.column.nullable},previousVersion:t.schemaChange.previousVersion,nextVersion:t.schemaChange.nextVersion}:null,h=t.after?.id??t.before?.id??l?.column?.name??null,b=h!=null?String(h):"";return{source:"demo-db",table:t.table,op:o,pk:{id:b},before:yn(t.before),after:yn(t.after),ts_ms:t.commitTs,tx:{id:t.txnId??`tx-${t.commitTs}`,lsn:typeof t.offset=="number"?t.offset:null,index:typeof t.txnIndex=="number"?t.txnIndex:void 0,total:typeof t.txnTotal=="number"?t.txnTotal:void 0,last:typeof t.txnLast=="boolean"?t.txnLast:typeof t.txnTotal=="number"&&typeof t.txnIndex=="number"?t.txnIndex>=t.txnTotal-1:!0},seq:r,meta:{method:Xo[e]},schemaChange:l}};function ea(e,t){const r=new jr,o=new Lr,l=new kr,h=`cdc.${e}`;let b=xn(e),y,L={bus:r,metrics:o,scheduler:l,topic:h},A={},E=0;const x=new Set,m=c=>{const v=c.__seq,T=typeof v=="number"&&v>0?v:++E;return c.__seq=T,{...qn(e,c,T),offset:c.offset,topic:c.topic??h}},w=c=>v=>{const T=c(v);if(T.length){const k=T.map(D=>m(D));t(k),k.forEach(D=>x.forEach(V=>V(D)))}return T},i=()=>{b.initialise?.(L),b.configure?.(A),y=new Tr(Yo[e],r,l,o,h,{startSnapshot:(c,v)=>b.startSnapshot?.(c,T=>w(v)(T)),startTailing:c=>b.startTailing?.(v=>w(c)(v)),stop:()=>b.stop?.()}),y.startSnapshot([]),y.startTailing()};return i(),{name:e,configure(c){A={...c},b.configure?.(c)},reset(c){y.stop(),l.clear(),o.reset(),r.reset(h),E=0,b=xn(e),L={bus:r,metrics:o,scheduler:l,topic:h},i()},applySourceOp(c){b.applySource?.(c)},applySchemaChange(c,v,T,k){const D=v==="add"?"ADD_COLUMN":"DROP_COLUMN";b.applySchemaChange?.(c,D,T,k)},tick(c){b.tick?.(c)},onEvent(c){return x.add(c),()=>x.delete(c)},bus:r,metrics:o,topic:h}}function ta(e,t){return ea(e,t)}function st(e){return e.reduce((t,r)=>(t[r]=[],t),{})}function sa(e){return{polling:{...e.polling},trigger:{...e.trigger},log:{...e.log}}}function Rt(e,t,r){let o=typeof e=="number"?e:Number(e);return Number.isFinite(o)?(typeof r=="number"&&(o=Math.max(r,o)),o):t}function $t(e,t=Ss){if(typeof e!="number"||!Number.isFinite(e))return t;const r=Math.round(e);return Number.isFinite(r)?Math.min(Pn,Math.max($n,r)):t}function vs(e,t=Bn){if(typeof e!="number"||!Number.isFinite(e))return t;const r=Math.round(e/Es)*Es;return Number.isFinite(r)?Math.min(Un,Math.max(Fn,r)):t}function vn(e){if(!Array.isArray(e))return[...ge];const t=[];return ge.forEach(r=>{e.includes(r)&&!t.includes(r)&&t.push(r)}),t.length>=Rn?t:[...ge]}function _n(e){const t=Array.from(Ve);if(!Array.isArray(e)||e.length===0)return new Set(t);const r=[];return e.forEach(o=>{if(Ve.includes(o)){const l=o;r.includes(l)||r.push(l)}}),r.length?new Set(r):new Set(t)}function Pt(e){return typeof e=="string"&&ge.includes(e)}function wn(e){const t=sa(Jo);return e&&(e.polling&&(e.polling.pollIntervalMs!=null&&(t.polling.pollIntervalMs=Rt(e.polling.pollIntervalMs,t.polling.pollIntervalMs,50)),e.polling.includeSoftDeletes!=null&&(t.polling.includeSoftDeletes=!!e.polling.includeSoftDeletes)),e.trigger&&(e.trigger.extractIntervalMs!=null&&(t.trigger.extractIntervalMs=Rt(e.trigger.extractIntervalMs,t.trigger.extractIntervalMs,50)),e.trigger.triggerOverheadMs!=null&&(t.trigger.triggerOverheadMs=Rt(e.trigger.triggerOverheadMs,t.trigger.triggerOverheadMs,0))),e.log&&e.log.fetchIntervalMs!=null&&(t.log.fetchIntervalMs=Rt(e.log.fetchIntervalMs,t.log.fetchIntervalMs,10))),t}function na(){if(typeof window>"u")return null;try{const e=window.localStorage.getItem(Dn);if(!e)return null;const t=JSON.parse(e);return{scenarioId:typeof t.scenarioId=="string"?t.scenarioId:void 0,presetId:Vt(t.presetId)?t.presetId:void 0,activeMethods:Array.isArray(t.activeMethods)?t.activeMethods:void 0,methodConfig:t.methodConfig??void 0,userPinnedScenario:typeof t.userPinnedScenario=="boolean"?t.userPinnedScenario:void 0,showEventList:typeof t.showEventList=="boolean"?t.showEventList:void 0,eventOps:Array.isArray(t.eventOps)?t.eventOps:void 0,eventSearch:typeof t.eventSearch=="string"?t.eventSearch:void 0,eventLogTable:typeof t.eventLogTable=="string"?t.eventLogTable:void 0,eventLogTxn:typeof t.eventLogTxn=="string"?t.eventLogTxn:void 0,eventLogMethod:typeof t.eventLogMethod=="string"?t.eventLogMethod:void 0,eventLogOp:typeof t.eventLogOp=="string"?t.eventLogOp:void 0,applyOnCommit:typeof t.applyOnCommit=="boolean"?t.applyOnCommit:void 0,consumerRateEnabled:typeof t.consumerRateEnabled=="boolean"?t.consumerRateEnabled:void 0,consumerRateLimit:typeof t.consumerRateLimit=="number"?t.consumerRateLimit:void 0,generatorEnabled:typeof t.generatorEnabled=="boolean"?t.generatorEnabled:void 0,generatorRate:typeof t.generatorRate=="number"?t.generatorRate:void 0}}catch(e){return console.warn("Comparator prefs load failed",e),null}}function ra(e){if(!(typeof window>"u"))try{window.localStorage.setItem(Dn,JSON.stringify(e))}catch(t){console.warn("Comparator prefs save failed",t)}}function oa(e,t,r,o,l,h){const b=e.length?e[e.length-1]:null,y=b?Math.max(t-b.ts_ms,0):t,L=t>0?e.length/(t/1e3):0;let A=0,E=0,x=0,m=0;e.forEach(k=>{k.op==="c"?A+=1:k.op==="u"?E+=1:k.op==="d"&&(x+=1),k.schemaChange&&(m+=1)});const w=r.ops.filter(k=>k.op==="delete").length,i=h?.deletes??0,p=w+i,c=p===0?100:x/p*100,v=e.every((k,D)=>{if(D===0)return!0;const V=e[D-1];return k.ts_ms>=V.ts_ms});return{lagMs:y,throughput:L,deletesPct:c,orderingOk:v,consistent:v&&(o==="polling"?x===p:!0),writeAmplification:o==="trigger"?Bo(l,o,e,r)??0:void 0,insertCount:A,updateCount:E,deleteCount:x,schemaChangeCount:m}}function aa(e){if(e.length===0)return null;const t=[...e].sort((x,m)=>x.metrics.lagMs-m.metrics.lagMs),r=t[0],o=t[t.length-1],l=o.metrics.lagMs-r.metrics.lagMs,h=[...e].sort((x,m)=>x.metrics.deletesPct-m.metrics.deletesPct),b=h[0],y=h[h.length-1],L=e.filter(x=>!x.metrics.orderingOk).map(x=>x.method),A=e.filter(x=>x.method==="trigger"&&typeof x.metrics.writeAmplification=="number"),E=A.length?A.reduce((x,m)=>x.metrics.writeAmplification?m.metrics.writeAmplification&&m.metrics.writeAmplification>x.metrics.writeAmplification?m:x:m):null;return{bestLag:r,worstLag:o,lagSpread:l,lowestDeletes:b,highestDeletes:y,orderingIssues:L,triggerWriteAmplification:E}}function ia(){const e=d.useRef(null);e.current===null&&(e.current=na());const t=e.current||void 0,r=vn(t?.activeMethods),o=wn(t?.methodConfig),l=t?.presetId&&Vt(t.presetId)?t.presetId:fn,h=Pt(t?.eventLogMethod)?t?.eventLogMethod:null,b=typeof t?.eventLogOp=="string"&&t.eventLogOp.trim()?t.eventLogOp.trim().toLowerCase():null,y=d.useMemo(()=>typeof window>"u"?{...Gt}:Br(window.localStorage),[]),[L,A]=d.useState(null),[E,x]=d.useState(()=>t?.scenarioId??Dt[0].name),[m,w]=d.useState(()=>y.query),[i,p]=d.useState(()=>y.tags),[c,v]=d.useState(()=>r),[T,k]=d.useState(()=>st(r)),[D,V]=d.useState(()=>st(r)),[Z,Ge]=d.useState(()=>({})),[ye,We]=d.useState(l),[X,nt]=d.useState(0),[M,H]=d.useState(!1),[z,Ht]=d.useState(!1),[J,rt]=d.useState(()=>o),[Te,Me]=d.useState(!1),[ne,Ae]=d.useState(()=>t?.eventSearch??""),[Cs,zt]=d.useState(()=>_n(t?.eventOps)),[ve,Qt]=d.useState(t?.showEventList??!0),[re,Ie]=d.useState(t?.eventLogTable??null),[ee,Oe]=d.useState(t?.eventLogTxn??""),[oe,_e]=d.useState(h),[ae,we]=d.useState(b),[fe,Kt]=d.useState(t?.applyOnCommit??!1),[ie,Jt]=d.useState(t?.consumerRateEnabled??!1),[ue,Yt]=d.useState(()=>$t(t?.consumerRateLimit,Ss)),[le,Xt]=d.useState(t?.generatorEnabled??!1),[te,Zt]=d.useState(()=>vs(t?.generatorRate,Bn)),[es,Vn]=d.useState(()=>Ko()),Se=d.useRef({}),pe=d.useRef({}),He=d.useRef({}),js=d.useRef(t?.consumerRateEnabled??!1?$t(t?.consumerRateLimit,Ss):null),ot=d.useRef(0),ts=d.useRef(null),at=d.useRef(0),Ls=d.useRef(te),ks=d.useRef(le),it=d.useRef({inserts:0,updates:0,deletes:0}),ss=d.useRef({}),Ts=d.useRef(c),Ms=d.useRef(X),U=Ft[ye]??Ft[fn],Gn=d.useMemo(()=>Object.values(Ft).map(s=>({id:s.id,label:s.label})),[]),R=d.useMemo(()=>{const s=U.methodCopyOverrides??{};return ge.reduce((a,u)=>{const g=Ho[u],C=s[u];return a[u]={label:C?.label??g.label,laneDescription:C?.laneDescription??g.laneDescription,callout:C?.callout??g.callout,whenToUse:C?.whenToUse??g.whenToUse,tooltip:C?.tooltip??g.tooltip},a},{})},[U]),As=d.useMemo(()=>new Set(i),[i]),Is=d.useMemo(()=>Hr(Dt,{liveScenario:L??void 0,additionalTags:[i]}),[L,i]);d.useEffect(()=>{typeof window>"u"||qr({query:m,tags:i},window.localStorage)},[m,i]);const Ee=d.useCallback((s,a)=>{if(typeof window>"u")return;const u=_s({query:s,tags:a});window.dispatchEvent(new CustomEvent("cdc:scenario-filter",{detail:u}))},[]),ft=d.useCallback(s=>{if(!s){De.current=!1;return}if("userPinnedScenario"in s&&(De.current=!!s.userPinnedScenario),s.activeMethods&&v(vn(s.activeMethods)),s.methodConfig&&rt(wn(s.methodConfig)),s.scenarioId&&x(s.scenarioId),s.presetId&&Vt(s.presetId)&&We(s.presetId),"showEventList"in s&&typeof s.showEventList=="boolean"&&Qt(s.showEventList),"eventOps"in s&&zt(_n(s.eventOps)),"eventSearch"in s&&typeof s.eventSearch=="string"&&Ae(s.eventSearch),"eventLogTable"in s){const a=typeof s.eventLogTable=="string"&&s.eventLogTable.trim().length>0?s.eventLogTable:null;Ie(a)}if("eventLogTxn"in s&&Oe(typeof s.eventLogTxn=="string"?s.eventLogTxn:""),"eventLogMethod"in s){const a=Pt(s.eventLogMethod)?s.eventLogMethod:null;_e(a)}if("eventLogOp"in s)if(typeof s.eventLogOp=="string"){const a=s.eventLogOp.trim().toLowerCase();we(a||null)}else we(null);"applyOnCommit"in s&&typeof s.applyOnCommit=="boolean"&&Kt(s.applyOnCommit),"consumerRateEnabled"in s&&typeof s.consumerRateEnabled=="boolean"&&Jt(s.consumerRateEnabled),"consumerRateLimit"in s&&typeof s.consumerRateLimit=="number"&&Yt($t(s.consumerRateLimit)),"generatorEnabled"in s&&typeof s.generatorEnabled=="boolean"&&Xt(s.generatorEnabled),"generatorRate"in s&&typeof s.generatorRate=="number"&&Zt(vs(s.generatorRate))},[v,rt,x,We,Qt,zt,Ae,Ie,Oe,_e,we,Kt,Jt,Yt,Xt,Zt]);d.useEffect(()=>{if(typeof window>"u")return;const s=()=>{Ee(m,i)};return window.addEventListener("cdc:scenario-filter-request",s),()=>{window.removeEventListener("cdc:scenario-filter-request",s)}},[Ee,m,i]);const Ne=d.useMemo(()=>yo(To),[]),bt=d.useCallback(s=>{let a=He.current[s];return a||(a=new bs,He.current[s]=a),a},[]),ze=d.useCallback(s=>{ts.current=Do(s),at.current=0,it.current={inserts:0,updates:0,deletes:0}},[]),xt=d.useCallback((s,a)=>{const u=ts.current;if(!u||s<=0)return;const g=Ts.current;if(!g.length)return;const C=ss.current;for(let j=0;j<s;j+=1){const S=Ro(u,a,Ms.current);S&&(g.forEach(_=>{C[_]?.applySourceOp(S.op)}),S.kind==="insert"?it.current.inserts+=1:S.kind==="update"?it.current.updates+=1:S.kind==="delete"&&(it.current.deletes+=1))}},[]),yt=d.useCallback(s=>{if(!ks.current||!ts.current)return;const a=Ls.current;if(!Number.isFinite(a)||a<=0)return;at.current+=a*s/1e3;const u=Math.floor(at.current);if(u<=0)return;at.current-=u;const g=u>0?s/u:s;xt(u,g)},[xt]),me=d.useCallback((s,a)=>{const u=Se.current[s];if(!u)return;const g=u.metrics.snapshot(),C=u.bus.size(u.topic);Ge(j=>({...j,[s]:{metrics:g,backlog:C,lastOffset:a?.lastOffset??j[s]?.lastOffset??-1}}))},[]),Os=d.useCallback((s,a)=>{a.length&&(V(u=>{const g={...u},C=g[s]??[];return g[s]=[...C,...a],g}),me(s,{lastOffset:a[a.length-1]?.offset??-1}))},[me]);d.useEffect(()=>{if(typeof window>"u")return;const s=a=>{if(!(a instanceof CustomEvent))return;const u=a.detail,g=Array.isArray(u)?u:[];Vn(new Set(g.map(String)))};return window.addEventListener("cdc:feature-flags",s),()=>{window.removeEventListener("cdc:feature-flags",s)}},[]);const vt=d.useCallback(s=>es.size===0?!0:es.has(s),[es]),_t=vt("ff_event_bus"),ns=vt("ff_pause_resume"),Wn=vt("ff_query_slider"),Hn=vt("ff_event_log"),Ce=d.useMemo(()=>Array.from(Cs).sort(),[Cs]),Ns=d.useMemo(()=>new Set(Ce),[Ce]),Qe=d.useMemo(()=>ne.trim().toLowerCase().split(/\s+/).filter(Boolean),[ne]),Ds=d.useMemo(()=>Qe.join("|"),[Qe]),Rs=d.useRef(new WeakMap),wt=d.useCallback(s=>{const a=new Set(Ce),u=a.size<Ve.length,g=Qe.length>0,C=Rs.current,j=new Map,S=_=>{const I=C.get(_);if(I)return I;const O=[String(_.seq??""),_.op,_.pk?.id??"",_.table??""];_.after&&O.push(...Object.values(_.after).map(P=>String(P??""))),_.before&&O.push(...Object.values(_.before).map(P=>String(P??"")));const F=O.join(" ").toLowerCase();return C.set(_,F),F};return c.forEach(_=>{const I=s[_]??[];if(!u&&!g){j.set(_,I);return}const O=I.filter(F=>{if(!a.has(F.op))return!1;if(!g)return!0;const P=S(F);return Qe.every($=>P.includes($))});j.set(_,O)}),j},[c,Ce,Qe]),zn=d.useMemo(()=>wt(T),[wt,T,Ds]),$s=d.useMemo(()=>wt(D),[wt,D,Ds]),lt=d.useMemo(()=>{const s=[],a=new Set,u=new Set,g=new Set;return c.forEach(C=>{($s.get(C)??[]).forEach(S=>{const _=S.table??"";_&&a.add(_);const I=S.tx?.id??null;I&&u.add(I);const O=typeof S.op=="string"?S.op.trim().toLowerCase():"";O&&g.add(O),s.push({method:C,event:S})})}),s.sort((C,j)=>{const S=C.event.offset??C.event.seq??0,_=j.event.offset??j.event.seq??0;return S!==_?S-_:(C.event.ts_ms??0)-(j.event.ts_ms??0)}),{events:s,tables:Array.from(a).sort(),txns:Array.from(u).sort(),ops:Array.from(g)}},[c,$s]),rs=lt.events,St=lt.tables,Et=lt.txns,os=d.useMemo(()=>{const s=new Set(lt.ops),a=Ve.filter(g=>s.has(g)),u=Array.from(s).filter(g=>!Ve.includes(g));return u.sort(),[...a,...u]},[lt.ops]),Ke=d.useMemo(()=>rs.filter(({method:s,event:a})=>{if(oe&&s!==oe||re&&(a.table??"")!==re||ee&&(a.tx?.id??"")!==ee)return!1;const u=typeof a.op=="string"?a.op.trim().toLowerCase():"";return!(ae&&u!==ae)}),[rs,oe,ae,re,ee]),Qn=d.useMemo(()=>Ke.map(({method:s,event:a},u)=>{const g=typeof a.offset=="number"?a.offset:null,C=typeof a.seq=="number"?a.seq:null,j=typeof a.ts_ms=="number"?a.ts_ms:null,S=[s,g!=null?`offset-${g}`:null,C!=null?`seq-${C}`:null,j!=null?`ts-${j}`:null,u].filter(Boolean),_=a.pk?.id!=null?String(a.pk.id):null,I=a.schemaChange?n.jsxs("span",{className:"sim-shell__event-log-schema",children:[a.schemaChange.action==="ADD_COLUMN"?"Added":"Dropped"," column ",a.schemaChange.column.name,` · v${a.schemaChange.previousVersion}→v${a.schemaChange.nextVersion}`]}):void 0;return{id:S.length?S.join("|"):`${s}-${u}`,methodId:s,methodLabel:R[s].label,op:a.op??"",offset:g,topic:a.topic??null,table:a.table??null,tsMs:j,pk:_,txnId:a.tx?.id??null,before:a.before??null,after:a.after??null,meta:I}}),[Ke,R]),Kn=d.useMemo(()=>({methodId:oe??void 0,op:ae??void 0,table:re??void 0,txnId:ee||void 0}),[oe,ae,re,ee]),Jn=d.useMemo(()=>({methods:ge.map(s=>({id:s,label:R[s].label})),ops:os,tables:St,txns:Et}),[St,Et,R]),ct=d.useMemo(()=>{const s=new Map;return c.forEach(a=>{const g=bt(a).snapshot(),C=["table","id"],j=new Set(C);let S=1;g.forEach(O=>{S=Math.max(S,O.schema?.version??1),O.schema?.columns.forEach(F=>{if(!F)return;const P=F.name;!P||P==="id"||P.startsWith("__")||j.has(P)||(j.add(P),C.push(P))})}),g.forEach(O=>{O.rows.forEach(F=>{Object.keys(F).forEach(P=>{P==="id"||P.startsWith("__")||j.has(P)||(j.add(P),C.push(P))})})});const _=g.flatMap(O=>O.rows.map(F=>{const P=String(F.id),$={};return C.forEach(G=>{if(G==="table"||G==="id"||G.startsWith("__"))return;const Q=F[G];$[G]=Q??null}),{id:`${O.name}::${P}`,displayId:P,table:O.name,values:$}})).sort((O,F)=>O.id.localeCompare(F.id,void 0,{numeric:!0,sensitivity:"base"})),I=j.has(Be.name);s.set(a,{columns:C,rows:_,schemaVersion:S,hasSchemaColumn:I})}),s},[c,bt,T]),Ps=d.useRef(M),Ct=d.useRef(0);d.useEffect(()=>{oe&&!c.includes(oe)&&_e(null)},[c,oe]),d.useEffect(()=>{re&&!St.includes(re)&&Ie(null)},[St,re]),d.useEffect(()=>{ae&&!os.includes(ae)&&we(null)},[os,ae]),d.useEffect(()=>{ee&&!Et.includes(ee)&&Oe("")},[Et,ee]),d.useEffect(()=>{Ts.current=c},[c]),d.useEffect(()=>{Ms.current=X},[X]),d.useEffect(()=>{ks.current=le,le||(at.current=0)},[le]),d.useEffect(()=>{Ls.current=te},[te]);const De=d.useRef(t?.userPinnedScenario??!1),as=d.useRef(null),be=d.useMemo(()=>Wr(Dt,{liveScenario:L??void 0,liveScenarioName:Ue,query:m,tags:i}),[L,m,i]),f=d.useMemo(()=>be.length?be.find(s=>s.name===E)??be[0]:Dt[0],[E,be]);d.useEffect(()=>{ze(f)},[f,ze]),d.useEffect(()=>{const s=f.comparator?.preferences;if(!s||typeof s!="object"){as.current=null;return}as.current!==f.name&&(ft(s),as.current=f.name)},[ft,f]);const jt=d.useMemo(()=>{const s=new Map;return c.forEach(a=>{const u=ct.get(a);s.set(a,{present:u?.hasSchemaColumn??!1,version:u?.schemaVersion??1})}),s},[c,ct]),dt=d.useMemo(()=>c.length>0?c.every(s=>jt.get(s)?.present??!1):!1,[c,jt]),Re=d.useMemo(()=>{let s=1;return c.forEach(a=>{const u=jt.get(a);u&&u.version>s&&(s=u.version)}),s},[c,jt]),Je=d.useMemo(()=>!!f.tags?.includes("schema"),[f.tags]),Fs=d.useMemo(()=>{if(!Je)return null;const s=`v${Re}`;return dt?`${s} · column present`:`${s} · column absent`},[dt,Re,Je]);d.useEffect(()=>{Ct.current=0},[f.name]);const is=d.useMemo(()=>f.table?f.table:f.ops.find(a=>a.table)?.table??"table",[f.ops,f.table]);d.useEffect(()=>{if(!Te)return;const s=window.setTimeout(()=>Me(!1),2e3);return()=>window.clearTimeout(s)},[Te]),d.useEffect(()=>{if(typeof window>"u")return;const s=window.setTimeout(()=>{B("comparator.event.search",{scenario:f.name,query:ne,hasQuery:!!ne.trim()})},400);return()=>window.clearTimeout(s)},[ne,f.name]),d.useEffect(()=>{Ps.current=M},[M]),d.useEffect(()=>{be.length&&(be.some(s=>s.name===E)||(De.current=!1,x(be[0].name)))},[E,be]),d.useEffect(()=>{if(!Te)return;const s=window.setTimeout(()=>Me(!1),2e3);return()=>window.clearTimeout(s)},[Te]),d.useEffect(()=>{if(typeof window>"u")return;const s=a=>{if(!(a instanceof CustomEvent))return;const u=_s(a.detail);w(g=>g===u.query?g:u.query),p(g=>Pr(g,u.tags)?g:u.tags)};return window.addEventListener("cdc:scenario-filter",s),window.dispatchEvent(new CustomEvent("cdc:scenario-filter-request")),()=>{window.removeEventListener("cdc:scenario-filter",s)}},[]),d.useEffect(()=>{if(typeof window>"u")return;const s=a=>{if(!(a instanceof CustomEvent))return;const u=a.detail;if(!u||!u.scenario){A(null);return}const g=Array.isArray(u.scenario.ops)?u.scenario.ops:[],C=u.scenario.label??"Workspace (live)",j=u.scenario.description??`${g.length} operations`,S=u.scenario.seed??1;A({name:Ue,label:C,description:j,seed:S,ops:g})};return window.addEventListener("cdc:workspace-update",s),window.dispatchEvent(new CustomEvent("cdc:workspace-request")),()=>{window.removeEventListener("cdc:workspace-update",s)}},[]),d.useEffect(()=>{L&&L.ops.length&&(De.current||x(Ue))},[L]),d.useEffect(()=>{if(typeof window>"u")return;const s=a=>{if(!(a instanceof CustomEvent))return;const u=a.detail;ft(u)};return window.addEventListener("cdc:comparator-preferences-set",s),()=>{window.removeEventListener("cdc:comparator-preferences-set",s)}},[ft]),d.useEffect(()=>{ra({scenarioId:E,presetId:ye,activeMethods:c,methodConfig:J,userPinnedScenario:De.current,showEventList:ve,eventOps:Ce,eventSearch:ne,eventLogTable:re,eventLogTxn:ee,eventLogMethod:oe,eventLogOp:ae,applyOnCommit:fe,consumerRateEnabled:ie,consumerRateLimit:ue,generatorEnabled:le,generatorRate:te})},[E,ye,c,J,ve,Ce,ne,re,ee,oe,ae,fe,ie,ue,le,te]);const $e=d.useRef(null),Lt=d.useRef(null),he=d.useCallback(()=>{Lt.current!=null&&(window.clearInterval(Lt.current),Lt.current=null)},[]),Ye=d.useCallback(()=>{if(z)return;const s={},a=js.current;if(a!=null){const S=a*ke/1e3,_=ot.current+S;ot.current=Math.min(_,a*5)}let u=a==null?Number.POSITIVE_INFINITY:ot.current;const g=S=>S.txnId??`tx-${S.commitTs}`,C=S=>{if(!S.length)return!1;const _=S[S.length-1];return typeof _.txnLast=="boolean"?_.txnLast:typeof _.txnIndex=="number"&&typeof _.txnTotal=="number"?_.txnIndex>=_.txnTotal-1:!0},j=(S,_)=>{const I=pe.current[S]??[];let O=I.length?[...I]:[];if(O.length&&(pe.current[S]=[]),!O.length){const P=_.bus.consume(_.topic,1);if(!P.length)return[];O=P}const F=g(O[0]);for(;!C(O);){const P=_.bus.consume(_.topic,1);if(!P.length)return pe.current[S]=O,[];const $=P[0];if(g($)!==F){const Q=pe.current[S]??[];pe.current[S]=[$,...Q];break}O.push($)}return O};for(const S of c){const _=Se.current[S];if(!_)continue;let I=[],O=0;if(fe){const $=j(S,_);if(!$.length)continue;if(a!=null&&$.length>u){pe.current[S]=$;continue}I=$,O=$.length}else{const $=pe.current[S]??[];if($.length){if(a!=null&&$.length>u){pe.current[S]=$;continue}I=[...$],O+=$.length,pe.current[S]=[]}const G=a==null?Number.POSITIVE_INFINITY:u-O;if(a==null?!0:G>=1){const W=a==null?50:Math.min(Math.floor(G),50),Le=a==null?50:Math.max(W,0);if(Le>0){const se=_.bus.consume(_.topic,Le);se.length&&(I=I.length?I.concat(se):se,O+=se.length)}}if(!I.length)continue}a!=null&&(u=Math.max(u-O,0)),bt(S).applyEvents(I),_.metrics.onConsumed(I);const P=I.map($=>{const G=$.__seq??0;return qn(S,$,G)});me(S),s[S]=P}a!=null&&(ot.current=u),Object.keys(s).length!==0&&k(S=>{const _={...S};for(const[I,O]of Object.entries(s)){const F=_[I]??[];_[I]=[...F,...O]}return _})},[c,fe,bt,z,me]),Us=d.useCallback(()=>{he(),Lt.current=window.setInterval(()=>{$e.current?.tick(ke),yt(ke),Ye()},ke)},[he,Ye,yt]);d.useEffect(()=>{const s=ie?ue:null;js.current=s,s==null&&(ot.current=0)},[ie,ue]),d.useEffect(()=>{z||Ye()},[z,Ye]),d.useEffect(()=>{k(st(c)),V(st(c)),Se.current={},pe.current={},He.current={},c.forEach(j=>{He.current[j]=new bs}),nt(0),H(!1),he(),ze(f);const s=new vo,a=[],u={},g={},C=c.map(j=>{const S=ta(j,O=>Os(j,O));if(g[j]=S,j==="polling"){const O=J.polling;S.configure({poll_interval_ms:O.pollIntervalMs,include_soft_deletes:O.includeSoftDeletes})}else if(j==="trigger"){const O=J.trigger;S.configure({extract_interval_ms:O.extractIntervalMs,trigger_overhead_ms:O.triggerOverheadMs})}else{const O=J.log;S.configure({fetch_interval_ms:O.fetchIntervalMs})}const _={bus:S.bus,metrics:S.metrics,topic:S.topic,applySchemaChange:S.applySchemaChange};u[j]=_;const I=S.onEvent(O=>{k(F=>{const P={...F},$=P[j]??[];return P[j]=[...$,O],P})});return a.push(I),S});return Se.current=u,ss.current=g,c.forEach(j=>me(j,{lastOffset:-1})),s.attach(C),s.load(f),s.reset(f.seed),s.onTick(j=>nt(j)),$e.current=s,()=>{s.pause(),he(),a.forEach(j=>j()),ss.current={}}},[c,f,he,J,me,Os,ze]);const Yn=d.useCallback(s=>{v(a=>{if(a.includes(s))return a.length<=Rn?a:a.filter(g=>g!==s);const u=[...a,s];return ge.filter(g=>u.includes(g))})},[]),Xn=d.useCallback(s=>{zt(a=>{const u=new Set(a);let g=!1;return u.has(s)?u.size>1&&(u.delete(s),g=!0):(u.add(s),g=!0),g&&B("comparator.event.filter",{scenario:f.name,op:s,active:u.has(s)}),g?u:a})},[f.name]),Zn=d.useCallback(s=>{Ae(s)},[]),er=d.useCallback(()=>{Qt(s=>{const a=!s;return B("comparator.panel.layout",{scenario:f.name,showEvents:a}),a})},[f.name]),tr=d.useCallback(()=>{Jt(s=>{const a=!s;return B("comparator.consumer.rate_toggle",{scenario:f.name,enabled:a}),a}),ie&&B("comparator.consumer.rate_reset",{scenario:f.name})},[ie,f.name]),sr=d.useCallback(s=>{const a=$t(s,ue);a!==ue&&(Yt(a),B("comparator.consumer.rate_adjust",{scenario:f.name,rate:a}))},[ue,f.name]),nr=d.useCallback(()=>{Xt(s=>{const a=!s;return B("comparator.generator.toggle",{scenario:f.name,enabled:a}),a})},[f.name]),rr=d.useCallback(s=>{const a=vs(s,te);a!==te&&(Zt(a),B("comparator.generator.rate_adjust",{scenario:f.name,rate:a}))},[te,f.name]),or=d.useCallback(()=>{xt(xs,Vo),B("comparator.generator.burst",{scenario:f.name,count:xs})},[xt,f.name]),ar=d.useCallback(s=>{s.methodId&&Pt(s.methodId)?_e(s.methodId):_e(null),Ie(s.table??null),Oe(s.txnId??""),we(s.op?s.op.toLowerCase():null)},[_e,we,Ie,Oe]),ir=d.useCallback(()=>{if(Ke.length===0)return;const s=ao(Ke);if(!s)return;const a=new Blob([s],{type:"application/x-ndjson"}),u=URL.createObjectURL(a),g=document.createElement("a");g.href=u,g.download=`${f.name}-event-log.ndjson`,g.click(),URL.revokeObjectURL(u),B("comparator.event.download",{scenario:f.name,events:Ke.length})},[Ke,f.name]),lr=d.useCallback(s=>{const a=He.current[s];if(!a)return;const u=a.snapshot(),g=(f.name||"scenario").replace(/[^a-z0-9-_]+/gi,"-"),C={scenario:f.name,method:s,tables:u},j=new Blob([JSON.stringify(C,null,2)],{type:"application/json"}),S=URL.createObjectURL(j),_=document.createElement("a");_.href=S,_.download=`${g}-${s}-destination.json`,_.click(),URL.revokeObjectURL(S);const I=u.reduce((O,F)=>O+(F.rows?.length??0),0);B("comparator.destination.download",{scenario:f.name,method:s,tables:u.length,rows:I})},[f.name]),cr=d.useCallback(()=>{V(s=>{const a={...s};return c.forEach(u=>{a[u]=[]}),a}),Rs.current=new WeakMap,B("comparator.event.clear",{scenario:f.name})},[c,f.name]),dr=d.useCallback(s=>{const a=JSON.stringify({method:s.methodId??null,methodLabel:s.methodLabel??null,op:s.op,offset:s.offset??null,topic:s.topic??null,table:s.table??null,ts_ms:s.tsMs??null,pk:s.pk??null,txnId:s.txnId??null,before:s.before??null,after:s.after??null},null,2);navigator.clipboard.writeText(a).then(()=>B("comparator.event.copy",{scenario:f.name,method:s.methodId??null,op:s.op,offset:s.offset??null})).catch(()=>{B("comparator.event.copy.error",{scenario:f.name,method:s.methodId??null})})},[f.name]),ur=d.useCallback(s=>{if(typeof window>"u")return;const a=typeof s.op=="string"?s.op.trim().toLowerCase():"";if(a!=="c"&&a!=="u"&&a!=="d")return;const u={op:a,before:s.before??null,after:s.after??null,ts_ms:typeof s.tsMs=="number"?s.tsMs:void 0,table:s.table??void 0,key:s.pk?{id:s.pk}:void 0};window.dispatchEvent(new CustomEvent("cdc:workspace-replay-event",{detail:u})),B("comparator.event.replay",{scenario:f.name,method:s.methodId??null,table:s.table??null,op:a})},[f.name]),hr=d.useCallback(s=>{Vt(s)&&(We(s),B("comparator.preset.select",{presetId:s}))},[]),pr=d.useCallback(s=>{w(s),Ee(s,i),B("comparator.scenario.filter",{query:s})},[Ee,i]),mr=d.useCallback(s=>{const a=i.includes(s),u=a?i.filter(g=>g!==s):[...i,s];p(u),Ee(m,u),B("comparator.scenario.tag_toggle",{tag:s,active:!a})},[Ee,m,i]),gr=d.useCallback(()=>{i.length&&(p([]),Ee(m,[]),B("comparator.scenario.tag_clear"))},[Ee,m,i]),fr=d.useCallback(s=>{De.current=!0,x(s),B("comparator.scenario.select",{scenario:s})},[]),br=d.useCallback(s=>{B("comparator.scenario.preview",{scenario:s.name,tags:s.tags??[]}),window.dispatchEvent(new CustomEvent("cdc:preview-scenario",{detail:s}))},[]),Y=d.useMemo(()=>c.map(s=>{const a=T[s]??[];return{method:s,events:a,metrics:oa(a,X,f,s,Z,it.current)}}),[c,X,T,f,Z]),kt=d.useMemo(()=>Y.some(s=>s.events.length>0),[Y]),ut=d.useMemo(()=>{const s=f.comparator;if(!s||!s.summary)return null;const a=s.summary?de(s.summary)??s.summary:null;if(!a)return null;const u=de(s.analytics)??[],g=de(s.diffs)??[],C=de(s.overlay)??[],j=s.preset?de(s.preset)??s.preset:null,S=s.tags.length?[...s.tags]:Array.isArray(f.tags)?[...f.tags]:[],_=u.reduce(($,G)=>{const Q=Number(G.total);return Number.isFinite(Q)?$+Q:$},0),I=Array.isArray(s.lanes)?s.lanes.reduce(($,G)=>{const Q=Number(G.eventCount);return Number.isFinite(Q)?$+Q:$},0):0,O=typeof f.stats?.ops=="number"&&Number.isFinite(f.stats.ops)?f.stats.ops:f.ops.length,F=_||I||O;if(!(F>0))return null;const P=Array.isArray(s.lanes)?s.lanes.map($=>{const G=typeof $.method=="string"?$.method:void 0;if(!G||!Pt(G))return null;const Q=$.metrics&&typeof $.metrics=="object"&&!Array.isArray($.metrics)?$.metrics:{},W=(...se)=>{for(const At of se){const pt=Q[At];if(typeof pt=="number"&&Number.isFinite(pt))return pt}},Le=R[G];return{id:G,label:Le?.label??G,tooltip:Le?.tooltip,produced:W("produced")??0,consumed:W("consumed")??0,backlog:W("backlog")??0,lagP50:W("lagMsP50","lagP50")??0,lagP95:W("lagMsP95","lagP95")??0,missedDeletes:W("missedDeletes"),writeAmplification:W("writeAmplification"),snapshotRows:W("snapshotRows"),inserts:W("insertCount","inserts")??0,updates:W("updateCount","updates")??0,deletes:W("deleteCount","deletes")??0,schemaChanges:W("schemaChangeCount","schemaChanges")??0}}).filter($=>!!$):[];return{scenarioName:f.name,scenarioLabel:f.label,scenarioDescription:f.description,isLive:f.name===Ue,totalEvents:F,summary:a,lanes:P,analytics:u,tags:S,preset:j,diffs:g,overlay:C}},[R,f]),xe=d.useMemo(()=>c.reduce((s,a)=>{const u=Z[a],g=u?.metrics,C={backlog:u?.backlog??0,lastOffset:u?.lastOffset??-1,produced:g?.produced??0,consumed:g?.consumed??0,lagMsP50:g?.lagMsP50??0,lagMsP95:g?.lagMsP95??0,missedDeletes:g?.missedDeletes??0,writeAmplification:g?.writeAmplification??0,snapshotRows:g?.snapshotRows??0,errors:g?.errors??0};return s.set(a,C),s},new Map),[c,Z]);d.useEffect(()=>{typeof window>"u"||ut&&(kt||window.dispatchEvent(new CustomEvent("cdc:comparator-summary",{detail:ut})))},[kt,ut]);const ls=d.useMemo(()=>c.reduce((s,a)=>s+(xe.get(a)?.backlog??0),0),[c,xe]),xr=d.useMemo(()=>_t?c.reduce((s,a)=>{const u=xe.get(a);return u&&(s.produced+=u.produced,s.consumed+=u.consumed,s.backlog+=u.backlog,s.snapshotRows+=u.snapshotRows),s},{produced:0,consumed:0,backlog:0,snapshotRows:0}):{produced:0,consumed:0,backlog:0,snapshotRows:0},[c,xe,_t]),N=aa(Y),Bs=d.useMemo(()=>Y.reduce((s,a)=>s+a.events.length,0),[Y]),Xe=d.useMemo(()=>Y.map(({method:s,events:a,metrics:u})=>({method:s,label:R[s].label,total:a.length,inserts:u.insertCount,updates:u.updateCount,deletes:u.deleteCount,schemaChanges:u.schemaChangeCount})),[Y,R]),qs=d.useMemo(()=>Xe.reduce((s,a)=>s.set(a.method,a),new Map),[Xe]),je=d.useMemo(()=>{const s=new Map;return Y.forEach(({method:a,events:u})=>{s.set(a,ko(a,f.ops,u))}),s},[Y,f.ops]),Vs=d.useMemo(()=>c.map(s=>{const a=xe.get(s),u=qs.get(s);return{id:s,label:R[s].label,tooltip:R[s].tooltip,produced:a?.produced??0,consumed:a?.consumed??0,backlog:a?.backlog??0,lagP50:a?.lagMsP50??0,lagP95:a?.lagMsP95??0,missedDeletes:a?.missedDeletes,writeAmplification:a?.writeAmplification,snapshotRows:a?.snapshotRows,inserts:u?.inserts??0,updates:u?.updates??0,deletes:u?.deletes??0,schemaChanges:u?.schemaChanges??0}}),[c,qs,xe,R]),ht=d.useMemo(()=>c.map(s=>{const a=xe.get(s),u=R[s].label,g=a?.snapshotRows??0;return`${u} ${g}`}).join(", "),[c,xe,R]),Tt=d.useMemo(()=>c.map(s=>{const a=je.get(s),u=R[s].label,g=a?.totals??{missing:0,extra:0,ordering:0},C=a?.lag?.max??0,j=[];if(g.missing>0&&j.push({key:"missing",text:`${g.missing} missing`,tone:"missing"}),g.extra>0&&j.push({key:"extra",text:`${g.extra} extra`,tone:"extra"}),g.ordering>0&&j.push({key:"ordering",text:`${g.ordering} ordering`,tone:"ordering"}),C>0&&j.push({key:"lag",text:`${Math.round(C)}ms lag`,tone:"lag"}),Je){const _=ct.get(s),I=_?.schemaVersion??1;_&&!_.hasSchemaColumn?j.push({key:"schema-missing",text:`${Be.name} missing`,tone:"schema"}):I<Re&&j.push({key:"schema-behind",text:`Schema v${I}/${Re}`,tone:"schema"})}j.length===0&&j.push({key:"ok",text:"Aligned",tone:"ok"});const S=!!a?.issues.length||(a?.lag?.samples?.length??0)>0||(a?.lag?.max??0)>0;return{method:s,label:u,chips:j,hasDetails:S}}),[c,ct,je,R,Re,Je]),Gs=De.current,Mt=d.useMemo(()=>{const s={scenarioId:E,presetId:ye,activeMethods:[...c],methodConfig:J,userPinnedScenario:Gs,showEventList:ve,eventOps:Ce,eventSearch:ne,eventLogTable:re,eventLogTxn:ee,eventLogMethod:oe,eventLogOp:ae,applyOnCommit:fe,consumerRateEnabled:ie,consumerRateLimit:ue,generatorEnabled:le,generatorRate:te};return Wo(s,N??null,Xe,je,Array.isArray(f.tags)?f.tags:[],U,Tt,Y)},[c,Xe,fe,ie,ue,oe,ae,re,ee,Ce,ne,le,te,je,Y,Tt,J,U,ye,f,E,ve,N,Gs]),yr=d.useCallback(s=>{const a=new Date().toISOString(),u=bn(Mt)?Mt:s.comparator??Mt,g={id:s.id,name:s.name,label:s.label,description:s.description,highlight:s.highlight,tags:s.tags,table:s.table,schemaVersion:s.schemaVersion,seed:s.seed,schema:s.schema??[],rows:s.rows??[],events:s.events??[],ops:s.ops,version:2,exportedAt:a,comparator:u},C=new Blob([JSON.stringify(g,null,2)],{type:"application/json"}),j=document.createElement("a");j.href=URL.createObjectURL(C),j.download=`${s.name}.json`,j.click(),URL.revokeObjectURL(j.href);const S=Array.isArray(s.rows)?s.rows.length:0,_=Array.isArray(s.events)?s.events.length:0;B("workspace.scenario.exported",{scenario:s.name,rows:S,events:_,hasComparator:bn(u),methods:c})},[c,Mt,B]);d.useEffect(()=>{typeof window>"u"||window.dispatchEvent(new CustomEvent("cdc:consumer-paused",{detail:{paused:z,backlog:ls}}))},[z,ls]);const vr=d.useCallback(()=>{if(!N)return;const s=[];s.push(`${f.label}: ${f.description}`),s.push(`Methods: ${c.map(a=>R[a].label).join(", ")}`),N.bestLag&&s.push(`Fastest ${R[N.bestLag.method].label} at ${Math.round(N.bestLag.metrics.lagMs)}ms`),N.lagSpread>0&&s.push(`${R[N.worstLag.method].label} trails by ${Math.round(N.lagSpread)}ms`),s.push(`Lowest delete capture: ${R[N.lowestDeletes.method].label} (${Math.round(N.lowestDeletes.metrics.deletesPct)}%)`),N.triggerWriteAmplification&&s.push(`Trigger write amplification: ${R[N.triggerWriteAmplification.method].label} ${(N.triggerWriteAmplification.metrics.writeAmplification??0).toFixed(1)}x`),ht&&s.push(`Snapshot rows: ${ht}`),s.push(`Ordering: ${N.orderingIssues.length?N.orderingIssues.map(a=>R[a].label).join(", "):"All lanes aligned"}`),f.tags?.length&&s.push(`Tags: ${f.tags.join(", ")}`),navigator.clipboard.writeText(s.join(`
`)).then(()=>Me(!0)).catch(()=>Me(!1)),B("comparator.summary.copied",{scenario:f.name,tags:f.tags??[],methods:c})},[N,f,c,R,ht]),_r=d.useCallback(s=>{B("comparator.overlay.inspect",{method:s,scenario:f.name});const a=document.getElementById(`lane-diff-${s}`);a instanceof HTMLDetailsElement?(a.open=!0,a.scrollIntoView({behavior:"smooth",block:"center"})):a&&a.scrollIntoView({behavior:"smooth",block:"center"})},[f.name]),cs=d.useCallback(s=>{if(!f.tags?.includes("schema"))return;const a=Math.max(X,Ct.current+ke);Ct.current=a,c.forEach(u=>{Se.current[u]?.applySchemaChange?.(is,s,Be,a),me(u)}),B("comparator.schema.change",{action:s,table:is,scenario:f.name,commitTs:a,methods:c})},[c,X,Se,is,f.name,f.tags,me]),wr=d.useMemo(()=>{if(!f.tags?.includes("schema"))return;const s=c[0];if(s)return a=>a!==s?null:n.jsx(so,{columnName:Be.name,onAdd:()=>cs("add"),onDrop:()=>cs("drop"),disableAdd:dt,disableDrop:!dt,status:Fs})},[c,cs,dt,Fs,f.tags]),Ze=d.useCallback((s,a,u)=>{rt(g=>({...g,[s]:{...g[s],[a]:u}}))},[]),et=d.useCallback(s=>{const a=$e.current;if(a){ze(f),a.reset(f.seed),k(st(c)),V(st(c));for(const u of c){He.current[u]=new bs;const g=Se.current[u];g&&(g.bus.reset(g.topic),g.metrics.reset(),me(u,{lastOffset:-1}))}nt(0),Ct.current=0,s?.keepLoop||(a.pause(),H(!1),he())}},[c,ze,f,f.seed,he,me]),ds=d.useCallback(()=>{const s=$e.current;s&&(et({keepLoop:!0}),s.start(),H(!0),Us(),mt("play",{scenario:f.name}))},[et,Us,f.name]),us=d.useCallback(()=>{$e.current?.pause(),H(!1),he(),mt("pause",{scenario:f.name})},[he,f.name]),Sr=d.useCallback(()=>{ns&&Ht(s=>{const a=!s;return B("comparator.consumer.toggle",{scenario:f.name,paused:a}),a||Ye(),a})},[Ye,ns,f.name]),hs=d.useCallback((s=ke)=>{const a=$e.current;if(!a)return;const u=Ps.current;u||a.start(),a.tick(s),yt(s),u||a.pause(),mt("step",{deltaMs:s,scenario:f.name})},[yt,f.name]),Ws=d.useCallback((s,a)=>{const u=$e.current;if(!u)return;const g=Math.max(10,a??ke);et({keepLoop:!1});const C=Math.max(s,0);u.start();let j=0,S=0;for(;j<C&&S<1e4;){const _=Math.min(g,C-j);u.tick(_),j+=_,S+=1}u.pause(),H(!1),mt("seek",{targetMs:s,stepMs:a,scenario:f.name})},[et,f.name]),ps=d.useCallback(()=>{Ae(""),_e(null),Ie(null),we(null),Oe(""),et(),mt("reset",{scenario:f.name})},[et,f.name,_e,we,Ie,Oe,Ae]);return d.useEffect(()=>{if(typeof window>"u")return;const s={play:()=>ds(),pause:()=>us(),step:u=>hs(u),seek:(u,g)=>Ws(u,g),reset:()=>ps()};window.cdcComparatorClock=s;const a=u=>{if(!(u instanceof CustomEvent))return;const g=u.detail;if(g)switch(g.type){case"play":s.play();break;case"pause":s.pause();break;case"step":s.step(g.deltaMs);break;case"seek":s.seek(g.timeMs,g.stepMs);break;case"reset":s.reset();break}};return window.addEventListener("cdc:comparator-clock",a),()=>{window.removeEventListener("cdc:comparator-clock",a),window.cdcComparatorClock===s&&delete window.cdcComparatorClock}},[us,ps,Ws,ds,hs]),d.useEffect(()=>{typeof window>"u"||window.dispatchEvent(new CustomEvent("cdc:comparator-clock-tick",{detail:{clock:X}}))},[X]),d.useEffect(()=>()=>he(),[he]),d.useEffect(()=>{if(typeof window>"u"||!kt&&ut)return;const s=N?{lagSpread:N.lagSpread,bestLag:{method:N.bestLag.method,label:R[N.bestLag.method].label,metrics:N.bestLag.metrics},worstLag:{method:N.worstLag.method,label:R[N.worstLag.method].label,metrics:N.worstLag.metrics},lowestDeletes:{method:N.lowestDeletes.method,label:R[N.lowestDeletes.method].label,metrics:N.lowestDeletes.metrics},highestDeletes:{method:N.highestDeletes.method,label:R[N.highestDeletes.method].label,metrics:N.highestDeletes.metrics},orderingIssues:N.orderingIssues.map(_=>({method:_,label:R[_].label})),triggerWriteAmplification:N.triggerWriteAmplification?{method:N.triggerWriteAmplification.method,label:R[N.triggerWriteAmplification.method].label,value:N.triggerWriteAmplification.metrics.writeAmplification??0}:null}:null,a=Y.map(({method:_,metrics:I})=>({method:_,label:R[_].label,tooltip:R[_].tooltip,metrics:I})),u=f.table??f.ops.find(_=>_.table)?.table??"table";let g=u;try{g=U.topicFormat(u)}catch{g=u}const C={id:U.id,label:U.label,description:U.description,docsHint:U.docsHint,source:{label:U.sourceLabel,tooltip:U.sourceTooltip},log:{label:U.logLabel,tooltip:U.logTooltip},bus:{label:U.busLabel,tooltip:U.busTooltip,exampleTopic:g},destination:{label:U.destinationLabel,tooltip:U.destinationTooltip},methods:ge.map(_=>({id:_,label:R[_].label,tooltip:R[_].tooltip??null}))},j=Y.map(({method:_})=>{const I=je.get(_);return I?{method:_,totals:I.totals,issues:I.issues.slice(0,25),lag:I.lag}:{method:_,totals:{missing:0,extra:0,ordering:0},issues:[],lag:{max:0,samples:[]}}}),S=c.map(_=>{const I=je.get(_);return I?{method:_,label:R[_].label,totals:I.totals,issues:I.issues.slice(0,10),lag:{max:I.lag.max,samples:I.lag.samples.slice(0,10)}}:{method:_,label:R[_].label,totals:{missing:0,extra:0,ordering:0},issues:[],lag:{max:0,samples:[]}}});window.dispatchEvent(new CustomEvent("cdc:comparator-summary",{detail:{scenarioName:f.name,scenarioLabel:f.label,scenarioDescription:f.description,isLive:f.name===Ue,totalEvents:Bs,summary:s,lanes:a,analytics:Xe,tags:i,preset:C,diffs:j,overlay:S}}))},[c,Xe,kt,je,Y,R,U,f,ut,i,N,Bs]),n.jsxs("section",{className:"sim-shell","aria-label":"Simulator preview",children:[n.jsxs("header",{className:"sim-shell__header",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"sim-shell__title",children:"CDC Method Comparator"}),n.jsx("p",{className:"sim-shell__description",children:U.description}),n.jsxs("div",{className:"sim-shell__preset-row",role:"list","aria-label":"Selected vendor pipeline",children:[n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":U.sourceTooltip,role:"listitem",children:["Source · ",U.sourceLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":U.logTooltip,role:"listitem",children:["Capture · ",U.logLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":U.busTooltip,role:"listitem",children:["Transport · ",U.busLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":U.destinationTooltip,role:"listitem",children:["Sink · ",U.destinationLabel]})]}),n.jsxs("p",{className:"sim-shell__description sim-shell__description--meta",children:[U.label,U.docsHint?n.jsxs(n.Fragment,{children:[" · ",n.jsx("a",{href:U.docsHint,target:"_blank",rel:"noopener noreferrer",children:"Reference"})]}):null]})]}),n.jsxs("div",{className:"sim-shell__scenario-filter-row",role:"group","aria-label":"Filter scenarios",children:[n.jsxs("label",{className:"sim-shell__scenario-search",children:[n.jsx("span",{children:"Search scenarios"}),n.jsx("input",{type:"search",value:m,onChange:s=>pr(s.target.value),placeholder:"Find by label, description, or tag"})]}),Is.length>0?n.jsxs("div",{className:"sim-shell__scenario-tags",role:"group","aria-label":"Scenario tags",children:[Is.map(s=>n.jsxs("button",{type:"button",className:"sim-shell__scenario-tag","data-active":As.has(s)?"true":"false","aria-pressed":As.has(s),onClick:()=>mr(s),children:["#",s]},s)),i.length?n.jsx("button",{type:"button",className:"sim-shell__scenario-tag sim-shell__scenario-tag--clear",onClick:gr,children:"Clear"}):null]}):null]}),n.jsxs("div",{className:"sim-shell__actions sim-shell__actions--scenario",role:"group","aria-label":"Scenario controls",children:[n.jsx("select",{"aria-label":"Vendor preset",value:ye,onChange:s=>hr(s.target.value),children:Gn.map(s=>n.jsx("option",{value:s.id,children:s.label},s.id))}),n.jsx("select",{"aria-label":"Scenario",value:E,onChange:s=>fr(s.target.value),children:be.map(s=>n.jsx("option",{value:s.name,children:s.label},s.name))}),n.jsxs("div",{className:"sim-shell__scenario-actions",children:[n.jsx("button",{type:"button",className:"sim-shell__scenario-sync",onClick:()=>{f.name!==Ue&&window.dispatchEvent(new CustomEvent("cdc:apply-scenario-template",{detail:{id:f.name}}))},disabled:f.name===Ue,children:"Load in workspace"}),n.jsx("button",{type:"button",className:"sim-shell__scenario-download",onClick:()=>yr(f),children:"Download JSON"}),n.jsx("button",{type:"button",className:"sim-shell__scenario-preview",onClick:()=>br(f),children:"Preview"})]}),n.jsx("div",{className:"sim-shell__method-toggle",role:"group","aria-label":"Methods to display",children:ge.map(s=>n.jsx("button",{type:"button",className:"sim-shell__method-chip","aria-pressed":c.includes(s),onClick:()=>Yn(s),"data-tooltip":R[s].tooltip||void 0,children:R[s].label},s))})]})]}),n.jsxs("p",{className:"sim-shell__description","aria-live":"polite",children:[n.jsxs("strong",{children:[f.label,":"]})," ",f.description]}),f.highlight&&n.jsx("p",{className:"sim-shell__description sim-shell__description--highlight","aria-live":"polite",children:f.highlight}),f.tags?.length?n.jsx("div",{className:"sim-shell__tag-row","aria-label":"Scenario tags",children:f.tags.map(s=>n.jsxs("span",{className:"sim-shell__tag-chip",children:["#",s]},s))}):null,f.stats&&n.jsxs("p",{className:"sim-shell__description sim-shell__description--meta","aria-live":"polite",children:[f.stats.rows," rows · ",f.stats.ops," ops"]}),n.jsxs("div",{className:"sim-shell__event-filters",role:"group","aria-label":"Event filters",children:[z&&n.jsx("div",{className:"sim-shell__pause-banner",role:"status","aria-live":"polite",children:"Apply paused. Resume to drain the event bus."}),n.jsxs("label",{className:"sim-shell__event-search",children:[n.jsx("span",{children:"Search events"}),n.jsx("input",{type:"search",value:ne,onChange:s=>Zn(s.target.value),placeholder:"Filter by pk, seq, or payload"})]}),n.jsx("div",{className:"sim-shell__event-ops",role:"group","aria-label":"Change operations",children:Ve.map(s=>n.jsx("button",{type:"button",className:"sim-shell__event-op","data-active":Ns.has(s)?"true":"false",onClick:()=>Xn(s),children:s.toUpperCase()},s))}),n.jsx("button",{type:"button",className:"sim-shell__event-toggle",onClick:er,children:ve?"Hide timeline":"Show timeline"})]}),Hn&&n.jsx(Yr,{className:"sim-shell__event-log",events:Qn,stats:xr,totalCount:rs.length,filters:Kn,filterOptions:Jn,onFiltersChange:ar,onDownload:ir,onClear:cr,onCopyEvent:dr,onReplayEvent:ur,maxVisibleEvents:zo}),Ne&&(Ne.rows.length>0||Ne.placeholder)&&n.jsx("section",{className:"sim-shell__harness-history","aria-label":"Harness nightly history",children:n.jsxs("details",{children:[n.jsx("summary",{children:"Harness nightly history"}),Ne.rows.length>0?n.jsx("div",{className:"sim-shell__harness-history-table-wrapper",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsx("tr",{children:Ne.headers.map(s=>n.jsx("th",{children:s},s))})}),n.jsx("tbody",{children:Ne.rows.map((s,a)=>n.jsx("tr",{children:s.map((u,g)=>{const C=u.text||"—",j=u.href?n.jsx("a",{href:u.href,target:"_blank",rel:"noreferrer noopener",children:C}):C,S=u.emphasis?n.jsx("em",{children:j}):j;return n.jsx("td",{children:S},`harness-cell-${a}-${g}`)})},`harness-row-${a}`))})]})}):n.jsx("p",{className:"sim-shell__harness-history-empty",children:Ne.placeholder??"No harness runs captured yet."})]})}),n.jsxs("div",{className:"sim-shell__actions",role:"group","aria-label":"Playback controls","data-tour-target":"comparator-actions",children:[n.jsx("button",{type:"button",onClick:ds,disabled:M,children:"Start"}),n.jsx("button",{type:"button",onClick:us,disabled:!M,children:"Pause"}),n.jsxs("button",{type:"button",onClick:()=>hs(),children:["Step +",ke,"ms"]}),n.jsx("button",{type:"button",onClick:ps,children:"Reset"}),ns&&n.jsxs("button",{type:"button",onClick:Sr,className:"sim-shell__consumer-toggle","data-tooltip":K.backlog,children:[z?"Resume apply":"Pause apply",_t?` (${ls} queued)`:""]}),n.jsxs("label",{className:"sim-shell__apply-toggle","data-tooltip":K.txnAtomic||void 0,children:[n.jsx("input",{type:"checkbox",checked:fe,onChange:s=>Kt(s.target.checked)}),n.jsx("span",{children:"Apply on commit"})]}),n.jsxs("div",{className:"sim-shell__consumer-rate",role:"group","aria-label":"Apply rate limit","data-enabled":ie?"true":"false",children:[n.jsx("button",{type:"button",onClick:tr,children:ie?"Disable throttle":"Throttle apply"}),n.jsxs("label",{children:[n.jsx("span",{children:ie?`${ue} events/s`:"Unlimited"}),n.jsx("input",{type:"range",min:$n,max:Pn,step:qo,value:ue,onChange:s=>sr(Number(s.target.value)),disabled:!ie})]})]}),n.jsxs("div",{className:"sim-shell__generator",role:"group","aria-label":"Event generator","data-enabled":le?"true":"false",children:[n.jsx("button",{type:"button",onClick:nr,children:le?"Stop generator":"Start generator"}),n.jsxs("label",{children:[n.jsx("span",{children:le?`${te} events/s`:`Set ${te} events/s`}),n.jsx("input",{type:"range",min:Fn,max:Un,step:Es,value:te,onChange:s=>rr(Number(s.target.value)),disabled:!le})]}),n.jsxs("button",{type:"button",onClick:or,children:["Burst +",xs]})]})]}),n.jsx("div",{className:"sim-shell__controls","aria-label":"Method tuning controls",children:ge.map(s=>{const a=c.includes(s);if(s==="polling"){const g=J.polling;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":a?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:R[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Adjust poll cadence and whether soft deletes are surfaced."}),Wn?n.jsxs(n.Fragment,{children:[n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsxs("span",{children:["Poll interval (",(g.pollIntervalMs/1e3).toFixed(1),"s)"]}),n.jsx("input",{type:"range",min:500,max:1e4,step:100,value:g.pollIntervalMs,onChange:C=>Ze("polling","pollIntervalMs",Math.min(1e4,Math.max(500,Number(C.target.value)||500)))})]}),n.jsxs("p",{className:"sim-shell__control-hint",children:["⏱️ Polling every ",(g.pollIntervalMs/1e3).toFixed(1),"s"]})]}):n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Poll interval (ms)"}),n.jsx("input",{type:"number",min:100,step:100,value:g.pollIntervalMs,onChange:C=>Ze("polling","pollIntervalMs",Math.min(1e4,Math.max(100,Number(C.target.value)||500)))})]}),n.jsxs("label",{className:"sim-shell__control-checkbox",children:[n.jsx("input",{type:"checkbox",checked:g.includeSoftDeletes,onChange:C=>Ze("polling","includeSoftDeletes",C.target.checked)}),n.jsx("span",{children:"Include soft delete marker column"})]})]},s)}if(s==="trigger"){const g=J.trigger;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":a?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:R[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Tune audit extractor cadence and per-write trigger overhead."}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Extractor interval (ms)"}),n.jsx("input",{type:"number",min:100,step:50,value:g.extractIntervalMs,onChange:C=>Ze("trigger","extractIntervalMs",Math.max(50,Number(C.target.value)||0))})]}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Trigger overhead (ms)"}),n.jsx("input",{type:"number",min:0,step:1,value:g.triggerOverheadMs,onChange:C=>Ze("trigger","triggerOverheadMs",Math.max(0,Number(C.target.value)||0))})]})]},s)}const u=J.log;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":a?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:R[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Control how frequently the WAL/Binlog fetcher polls for new records."}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Fetch interval (ms)"}),n.jsx("input",{type:"number",min:10,step:10,value:u.fetchIntervalMs,onChange:g=>Ze("log","fetchIntervalMs",Math.max(10,Number(g.target.value)||0))})]})]},s)})}),N&&n.jsxs("div",{className:"sim-shell__summary","aria-live":"polite",children:[n.jsxs("ul",{children:[n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":K.lagSpread,children:"Lag spread:"})," ",R[N.bestLag.method].label," is leading at",` ${N.bestLag.metrics.lagMs.toFixed(0)}ms`,N.lagSpread>0?` — ${R[N.worstLag.method].label} trails by ${N.lagSpread.toFixed(0)}ms`:" (no spread)"]}),n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":K.deleteCapture,children:"Delete capture:"})," ",R[N.lowestDeletes.method].label," is lowest at",` ${N.lowestDeletes.metrics.deletesPct.toFixed(0)}%`," · best is ",R[N.highestDeletes.method].label,` (${N.highestDeletes.metrics.deletesPct.toFixed(0)}%)`]}),ht&&n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":K.snapshot,children:"Snapshot rows:"})," ",ht]}),N.triggerWriteAmplification&&n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":K.triggerOverhead,children:"Trigger overhead:"})," ",R[N.triggerWriteAmplification.method].label," is at"," ",`${(N.triggerWriteAmplification.metrics.writeAmplification??0).toFixed(1)}x`," write amplification"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Ordering:"}),N.orderingIssues.length===0?" All methods preserved ordering":` Issues: ${N.orderingIssues.map(s=>R[s].label).join(", ")}`]})]}),n.jsx("button",{type:"button",className:"sim-shell__summary-copy",onClick:vr,children:Te?"Copied":"Copy summary"})]}),Tt.length>0&&n.jsxs("section",{className:"sim-shell__overlay-summary","aria-label":"Lane checks",children:[n.jsxs("header",{children:[n.jsx("h3",{children:"Lane checks"}),n.jsx("p",{children:"Quick glance at diff findings and lag hotspots across active capture methods."})]}),n.jsx("ul",{children:Tt.map(s=>n.jsxs("li",{className:"sim-shell__overlay-row",children:[n.jsx("div",{className:"sim-shell__overlay-label",children:s.label}),n.jsx("div",{className:"sim-shell__overlay-chips",children:s.chips.map(a=>n.jsx("span",{className:`sim-shell__overlay-chip sim-shell__overlay-chip--${a.tone}`,children:a.text},`${s.method}-${a.key}`))}),s.hasDetails&&n.jsx("button",{type:"button",className:"sim-shell__overlay-action",onClick:()=>_r(s.method),children:"Inspect"})]},s.method))})]}),Vs.length>0&&n.jsx(eo,{lanes:Vs,renderSchemaWalkthrough:wr}),n.jsx("div",{className:"sim-shell__lane-grid","data-tour-target":"comparator-lanes",children:Y.map(({method:s,metrics:a,events:u},g)=>{const C=R[s],j=C.laneDescription,S=je.get(s)??null,_=g===0,I=xe.get(s),O=Se.current[s],F=ct.get(s),P=F?.rows.slice(0,Qo)??[],$=(F?.rows.length??0)>P.length,G=Je&&F?{version:F.schemaVersion,expectedVersion:Re,hasColumn:F.hasSchemaColumn,columnName:Be.name}:Je?{version:0,expectedVersion:Re,hasColumn:!1,columnName:Be.name}:void 0,Q=s==="trigger"?I?.writeAmplification??a.writeAmplification??0:void 0,W=[],Le=s==="polling"?"warning":"info";C.callout&&(s==="polling"&&a.deletesPct<100?W.push({text:`${C.callout} (${a.deletesPct.toFixed(0)}% of deletes captured in this scenario)`,tone:Le}):W.push({text:C.callout,tone:Le})),f.tags?.includes("schema")&&(s==="trigger"&&typeof Q=="number"&&Q>0&&W.push({text:`Write amplification ${Q.toFixed(1)}x (extra audit writes per change)`,tone:"info"}),s==="log"&&W.push({text:"Log capture streams schema changes in-order, keeping downstream versions aligned.",tone:"info"}),s==="polling"&&W.push({text:"Polling picks up new columns once refreshed rows include them; expect interim nulls.",tone:"warning"})),f.tags?.includes("transactions")&&W.push({text:fe?"Apply-on-commit groups transaction events before updating destinations so tables stay in sync.":"Apply-on-commit is off: events apply individually, so pausing mid-transaction shows partial state.",tone:fe?"info":"warning"});const se=zn.get(s)??u,At=se.length!==u.length||Qe.length>0||Ns.size<Ve.length,pt=ve&&se.length>ys,Hs=ve?se.slice(Math.max(se.length-ys,0)):[];return n.jsxs("article",{className:"sim-shell__lane-card",children:[n.jsxs("header",{className:"sim-shell__lane-header",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"sim-shell__lane-title","data-tooltip":C.tooltip||void 0,children:C.label}),n.jsx("p",{className:"sim-shell__lane-copy",children:j})]}),n.jsxs("span",{className:"sim-shell__lane-count",children:[se.length,At?` / ${u.length}`:""," events"]})]}),n.jsx("div",{className:"sim-shell__metrics","data-tour-target":_?"comparator-metrics":void 0,children:n.jsx(to,{...a})}),n.jsx($o,{diff:S,scenarioName:f.name,laneId:s,schemaStatus:G}),_t&&n.jsxs("section",{className:"sim-shell__lane-bus","aria-label":`${C.label} event bus`,"data-paused":z?"true":"false",children:[n.jsxs("header",{children:[n.jsx("h4",{children:"Event Bus"}),n.jsx("span",{children:O?.topic??`cdc.${s}`})]}),n.jsxs("p",{children:[n.jsxs("span",{"data-tooltip":K.backlog,children:["Backlog ",n.jsx("strong",{children:I?.backlog??0}),z?" (apply paused)":""]})," · ",n.jsxs("span",{"data-tooltip":K.offset,children:["Last offset ",I?.lastOffset??-1]})]}),n.jsxs("p",{children:["Produced ",I?.produced??0," · Consumed ",I?.consumed??0]}),n.jsxs("p",{"data-tooltip":K.snapshot,children:["Snapshot rows ",I?.snapshotRows??0]}),n.jsxs("p",{"data-tooltip":K.lagPercentile,children:["Lag p50 ",Math.round(I?.lagMsP50??0),"ms · p95 ",Math.round(I?.lagMsP95??0),"ms"]}),s==="trigger"&&n.jsxs("p",{"data-tooltip":K.triggerWriteAmplification,children:["Write amplification: ",Q?.toFixed(1)??"0.0","x"]}),s==="polling"&&n.jsxs("p",{className:"sim-shell__lane-bus-warning","data-tooltip":K.deleteCapture,children:["Missed deletes: ",I?.missedDeletes??0]}),I&&I.errors>0&&n.jsxs("p",{className:"sim-shell__lane-bus-warning",children:["Errors: ",I.errors]})]}),F&&n.jsxs("section",{className:"sim-shell__destination","aria-label":`${C.label} destination snapshot`,children:[n.jsxs("header",{children:[n.jsxs("div",{className:"sim-shell__destination-title",children:[n.jsx("h4",{children:"Destination snapshot"}),n.jsxs("span",{children:["schema v",F.schemaVersion]})]}),n.jsx("div",{className:"sim-shell__destination-actions",children:n.jsx("button",{type:"button",className:"sim-shell__destination-download",onClick:()=>lr(s),disabled:F.rows.length===0,children:"Download JSON"})})]}),P.length>0?n.jsx("div",{className:"sim-shell__destination-table",role:"table",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsx("tr",{children:F.columns.map(q=>n.jsx("th",{"data-highlight":q===Be.name?"true":void 0,children:q},q))})}),n.jsx("tbody",{children:P.map(q=>n.jsx("tr",{children:F.columns.map(Pe=>n.jsx("td",{children:Zo(Pe==="id"?q.displayId:Pe==="table"?q.table:q.values[Pe])},`${q.id}-${Pe}`))},q.id))})]})}):n.jsx("p",{className:"sim-shell__destination-empty",children:"No rows applied yet."}),$&&n.jsxs("p",{className:"sim-shell__destination-note",children:["Showing ",P.length," of ",F.rows.length," rows."]})]}),n.jsxs("dl",{className:"sim-shell__lane-config",children:[s==="polling"&&(()=>{const q=J.polling;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Poll interval"}),n.jsxs("dd",{"data-tooltip":K.pollingInterval,children:[q.pollIntervalMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Soft deletes"}),n.jsx("dd",{"data-tooltip":K.pollingSoftDeletes,children:q.includeSoftDeletes?"included":"ignored"})]})]})})(),s==="trigger"&&(()=>{const q=J.trigger;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Extractor interval"}),n.jsxs("dd",{"data-tooltip":K.triggerExtractorInterval,children:[q.extractIntervalMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Trigger overhead"}),n.jsxs("dd",{"data-tooltip":K.triggerOverhead,children:[q.triggerOverheadMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Write amplification"}),n.jsxs("dd",{"data-tooltip":K.triggerWriteAmplification,children:[Q?.toFixed(1)??"0.0","x"]})]})]})})(),s==="log"&&(()=>{const q=J.log;return n.jsxs("div",{children:[n.jsx("dt",{children:"Fetch interval"}),n.jsxs("dd",{"data-tooltip":K.logFetchInterval,children:[q.fetchIntervalMs," ms"]})]})})()]}),W.length>0&&n.jsx("div",{className:"sim-shell__callouts",children:W.map((q,Pe)=>n.jsx("p",{className:`sim-shell__callout${q.tone==="warning"?" sim-shell__callout--warning":""}`,"data-tour-target":_&&Pe===0?"comparator-callouts":void 0,children:q.text},`${s}-callout-${Pe}`))}),n.jsxs("section",{className:"sim-shell__lane-why","aria-label":`When to use ${C.label}`,children:[n.jsx("h4",{children:"When to use"}),n.jsx("p",{children:C.whenToUse})]}),ve?n.jsxs("ul",{className:"sim-shell__event-list","aria-live":"polite",children:[pt&&n.jsx("li",{className:"sim-shell__event sim-shell__event--notice",children:n.jsxs("span",{children:["Showing latest ",ys," of ",se.length," matching events."]})}),Hs.length===0?n.jsx("li",{className:"sim-shell__empty",children:At?"No events match the current filters.":"No events yet."}):Hs.map(q=>n.jsxs("li",{className:`sim-shell__event${q.op==="d"?" sim-shell__event--delete":""}`,children:[n.jsx("span",{className:"sim-shell__event-op","data-op":q.op,children:q.op}),n.jsxs("span",{children:["#",q.seq," · pk=",q.pk.id]}),n.jsxs("span",{className:"sim-shell__event-target",children:["ts=",q.ts_ms,"ms"]})]},`${s}-${q.seq}`))]}):n.jsx("p",{className:"sim-shell__lane-hidden",children:"Timeline hidden. Use “Show timeline” to view recent events."})]},s)})}),n.jsxs("footer",{className:"sim-shell__footer",children:["Scenario clock: ",X,"ms · ",Y.reduce((s,a)=>s+a.events.length,0)," total events emitted"]})]})}function Sn(){if(typeof window>"u")return;const e=window.telemetry;if(e&&typeof e.track=="function"&&typeof e.flush=="function")return e;let t;try{t=window.localStorage}catch{t=void 0}const r=mo({storage:t,console:typeof console<"u"?{warn:console.warn.bind(console),debug:console.debug.bind(console)}:void 0});return window.telemetry=r,r}function En(){const e=document.getElementById("simShellRoot");if(!e){console.warn("Simulator UI shell mount point not found (simShellRoot).");return}Cr.createRoot(e).render(n.jsx(ia,{}))}document.readyState==="loading"?(Sn(),document.addEventListener("DOMContentLoaded",En,{once:!0})):(Sn(),En());
