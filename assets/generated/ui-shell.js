import{r as l,j as n,T as Yn,S as zr,R as Kr}from"./event-log-widget.js";let Qr=class{constructor(){this.topics=new Map}publish(e,r){if(r.length===0)return[];const a=this.ensure(e);return r.map(o=>{const u=++a.offset,h={...o,offset:u};return a.queue.push(h),h})}consume(e,r=1){const a=this.ensure(e);return r<=0?[]:a.queue.splice(0,r)}size(e){return this.ensure(e).queue.length}reset(e){if(e){this.topics.delete(e);return}this.topics.clear()}ensure(e){let r=this.topics.get(e);return r||(r={offset:-1,queue:[]},this.topics.set(e,r)),r}};class Jr{constructor(){this.produced=0,this.consumed=0,this.backlog=0,this.lagSamples=[],this.missedDeletes=0,this.writeAmplification=0,this.triggerWrites=0,this.sourceWrites=0,this.snapshotRows=0,this.errors=0,this.lagAggregators=new Set}onProduced(e){this.produced+=e.length,this.backlog+=e.length}onConsumed(e){this.consumed+=e.length,this.backlog=Math.max(this.backlog-e.length,0);const r=Date.now();e.forEach(a=>{const o=typeof a.commitTs=="number"?a.commitTs:typeof a.ts_ms=="number"?a.ts_ms:r,u=Math.max(r-o,0);this.lagSamples.push(u)}),this.lagSamples.length>2e3&&this.lagSamples.splice(0,this.lagSamples.length-2e3),this.notifyLagAggregators()}registerLagAggregator(e){return this.lagAggregators.add(e),this.safeInvokeAggregator(e),()=>{this.lagAggregators.delete(e)}}recordMissedDelete(e=1){this.missedDeletes+=e}recordWriteAmplification(e=1,r=1){Number.isFinite(e)&&e>0&&(this.triggerWrites+=e),Number.isFinite(r)&&r>0&&(this.sourceWrites+=r),this.sourceWrites>0?this.writeAmplification=(this.sourceWrites+this.triggerWrites)/this.sourceWrites:this.writeAmplification=0}recordSnapshotRows(e){this.snapshotRows=e}recordError(){this.errors+=1}reset(){this.produced=0,this.consumed=0,this.backlog=0,this.lagSamples=[],this.missedDeletes=0,this.writeAmplification=0,this.triggerWrites=0,this.sourceWrites=0,this.snapshotRows=0,this.errors=0,this.notifyLagAggregators()}snapshot(){const e=[...this.lagSamples].sort((o,u)=>o-u),r=this.percentile(e,.5),a=this.percentile(e,.95);return{produced:this.produced,consumed:this.consumed,backlog:this.backlog,lagMsP50:r,lagMsP95:a,missedDeletes:this.missedDeletes,writeAmplification:this.writeAmplification,snapshotRows:this.snapshotRows,errors:this.errors}}safeInvokeAggregator(e,r){try{const a=r?[...r]:[...this.lagSamples];e(a)}catch{}}notifyLagAggregators(){if(this.lagAggregators.size===0)return;const e=[...this.lagSamples];this.lagAggregators.forEach(r=>{this.safeInvokeAggregator(r,e)})}percentile(e,r){if(!e.length)return 0;const a=Math.max(e.length-1,0)*r,o=Math.floor(a),u=Math.min(o+1,e.length-1);if(o===u)return e[o];const h=a-o;return e[o]+(e[u]-e[o])*h}}class Yr{constructor(){this.tasks=new Map,this.nextId=1}every(e,r){const a=this.nextId++,o={id:a,interval:e,handler:r};this.tasks.set(a,o);const u=setInterval(()=>r(),e);return o.timerId=u,a}clear(e){if(e!=null){const r=this.tasks.get(e);r&&r.timerId&&clearInterval(r.timerId),this.tasks.delete(e);return}this.tasks.forEach(r=>{const a=r.timerId;a&&clearInterval(a)}),this.tasks.clear()}}class Xr{constructor(e,r,a,o,u,h={}){this.mode=e,this.bus=r,this.scheduler=a,this.metrics=o,this.handlers=h,this.state="IDLE",this.topic=u??`cdc.${e.toLowerCase()}`}get currentState(){return this.state}get topicName(){return this.topic}startSnapshot(e){this.state==="IDLE"&&(this.state="SNAPSHOTTING",this.handlers.startSnapshot?.(e,r=>this.emit(r)))}startTailing(){this.state!=="TAILING"&&(this.state="TAILING",this.handlers.startTailing?.(e=>this.emit(e)))}pause(){this.state==="TAILING"&&(this.state="PAUSED")}resume(){this.state==="PAUSED"&&(this.state="TAILING")}stop(){this.state="IDLE",this.scheduler.clear(),this.handlers.stop?.(),this.bus.reset(this.topic),this.metrics.reset()}emit(e){if(e.length===0)return[];const r=this.bus.publish(this.topic,e);return this.metrics.onProduced(r),r}}let Zr=0;const As=()=>`evt-${Date.now()}-${++Zr}`,Kt=t=>t?JSON.parse(JSON.stringify(t)):null,_n=(t,e)=>`${t}::${e}`,yn=(t,e)=>({id:t.name,type:t.type,nullable:t.nullable??!1,__ts:e}),vn=(t,e,r=`tx-${e}`)=>{const a=t?.id??r,o=typeof t?.index=="number",u=o?t.index:void 0,h=typeof t?.total=="number"?t.total:void 0;let p;return typeof t?.last=="boolean"?p=t.last:o&&typeof h=="number"?p=u>=h-1:p=!t,{id:a,index:u,total:h,last:p}};function ea(){let t=null,e=null,r=100,a=0;const o=new Map,u=[];let h=0;const p=new Map,E=x=>{const C=p.get(x);return typeof C=="number"&&C>=1?C:(p.set(x,1),1)},L=x=>{const C=E(x),d=C+1;return p.set(x,d),{previous:C,next:d}},j=(x,C,d,m,b)=>{const y=vn(x.txn,b);return{id:As(),kind:C,table:x.table,before:d?{id:x.pk.id,...d,__ts:b}:void 0,after:m?{id:x.pk.id,...m,__ts:b}:void 0,txnId:y.id,txnIndex:y.index,txnTotal:y.total,txnLast:y.last,commitTs:b,schemaVersion:E(x.table),topic:t?.topic??`cdc.${x.table}`,partition:0}},v=(x,C,d,m)=>{if(!e||!t)return;const{previous:b,next:y}=L(x),M=vn(void 0,m,`schema-${m}`),T={id:As(),kind:C==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:x,before:C==="DROP_COLUMN"?yn(d,m):void 0,after:C==="ADD_COLUMN"?yn(d,m):void 0,txnId:M.id,txnIndex:M.index,txnTotal:M.total,txnLast:M.last,commitTs:m,schemaVersion:y,topic:t.topic??`cdc.${x}`,partition:0,schemaChange:{action:C,column:d,previousVersion:b,nextVersion:y}};e([T])};return{id:"LOG_BASED",initialise(x){t=x},configure(x){const C=Number(x.fetch_interval_ms??x.fetchIntervalMs);Number.isFinite(C)&&C>0&&(r=C)},startSnapshot(x=[],C){if(e=C,!x.length||(x.forEach(m=>{const b=m.schema?.version??1;p.set(m.name,b),m.rows.forEach(y=>{const M=_n(m.name,y.id);o.set(M,{id:y.id,table:m.name,data:{...y},version:1,updatedAt:y.__ts??0,deleted:!1})})}),t?.metrics.recordSnapshotRows(o.size),!o.size))return;const d=[];o.forEach(m=>{d.push({id:As(),kind:"INSERT",table:m.table,before:void 0,after:{id:m.id,...m.data,__ts:m.updatedAt},txnId:`snapshot-${m.updatedAt}`,txnIndex:0,txnTotal:1,txnLast:!0,commitTs:m.updatedAt,schemaVersion:E(m.table),topic:t?.topic??`cdc.${m.table}`,partition:0})}),e(d),h=u.length},startTailing(x){e=x},applySource(x){if(!t)return;const C=x.t,d=_n(x.table,x.pk.id);if(E(x.table),x.op==="insert")o.set(d,{id:x.pk.id,table:x.table,data:{...x.after},version:1,updatedAt:C,deleted:!1}),u.push(j(x,"INSERT",null,Kt(x.after),C));else if(x.op==="update"){const m=o.get(d),b=m?Kt(m.data):null,y=m?{...m.data,...x.after}:{...x.after};o.set(d,{id:x.pk.id,table:x.table,data:y,version:(m?.version??0)+1,updatedAt:C,deleted:!1}),u.push(j(x,"UPDATE",b,Kt(y),C))}else if(x.op==="delete"){const m=o.get(d);o.set(d,{id:x.pk.id,table:x.table,data:m?{...m.data}:{},version:(m?.version??0)+1,updatedAt:C,deleted:!0}),u.push(j(x,"DELETE",m?Kt(m.data):null,null,C))}},applySchemaChange(x,C,d,m){t&&(E(x),C==="ADD_COLUMN"?o.forEach((b,y)=>{b.table===x&&(d.name in b.data||(b.data[d.name]=null,o.set(y,{...b,data:{...b.data}})))}):C==="DROP_COLUMN"&&o.forEach((b,y)=>{if(b.table===x&&d.name in b.data){const M={...b.data};delete M[d.name],o.set(y,{...b,data:M})}}),v(x,C,d,m))},tick(x){if(!e||x-a<r)return;const C=u.slice(h);C.length&&(e(C),h=u.length),a=x},pause(){},resume(){},stop(){o.clear(),u.length=0,h=0,e=null,t=null,p.clear(),a=0}}}let ta=0;const Is=()=>`evt-${Date.now()}-${++ta}`,wn=t=>t?JSON.parse(JSON.stringify(t)):null,Sn=(t,e)=>`${t}::${e}`,jn=(t,e)=>({id:t.name,type:t.type,nullable:t.nullable??!1,__ts:e}),En=(t,e,r=`tx-${e}`)=>{const a=t?.id??r,o=typeof t?.index=="number",u=o?t.index:void 0,h=typeof t?.total=="number"?t.total:void 0;let p;return typeof t?.last=="boolean"?p=t.last:o&&typeof h=="number"?p=u>=h-1:p=!t,{id:a,index:u,total:h,last:p}};function sa(){let t=null,e=null,r=1e3,a=!1,o=0;const u=new Map,h=new Map,p=new Map,E=[],L=d=>{const m=p.get(d);return typeof m=="number"&&m>=1?m:(p.set(d,1),1)},j=d=>{const m=L(d),b=m+1;return p.set(d,b),{previous:m,next:b}},v=(d,m,b,y,M,T,O,F)=>{const Z=En(F,T,O);return{id:Is(),kind:b,table:d,before:y?{id:m,...y,__ts:T}:void 0,after:M?{id:m,...M,__ts:T}:void 0,txnId:Z.id,txnIndex:Z.index,txnTotal:Z.total,txnLast:Z.last,commitTs:T,schemaVersion:L(d),topic:t?.topic??`cdc.${d}`,partition:0}},x=(d,m,b,y)=>{const{previous:M,next:T}=j(d),O=En(void 0,y,`schema-${y}`);E.push({id:Is(),kind:m==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:d,before:m==="DROP_COLUMN"?jn(b,y):void 0,after:m==="ADD_COLUMN"?jn(b,y):void 0,txnId:O.id,txnIndex:O.index,txnTotal:O.total,txnLast:O.last,commitTs:y,schemaVersion:T,topic:t?.topic??`cdc.${d}`,partition:0,schemaChange:{action:m,column:b,previousVersion:M,nextVersion:T}})},C=d=>{!d.length||!e||e(d)};return{id:"QUERY_BASED",initialise(d){t=d},configure(d){const m=Number(d.poll_interval_ms??d.pollIntervalMs);Number.isFinite(m)&&m>0&&(r=m),d.include_soft_deletes!=null&&(a=!!d.include_soft_deletes),d.includeSoftDeletes!=null&&(a=!!d.includeSoftDeletes)},startSnapshot(d=[],m){e=m;const b=[];d.forEach(y=>{const M=y.schema?.version??1;p.set(y.name,M),y.rows.forEach(T=>{const O=Sn(y.name,T.id);u.set(O,{id:T.id,table:y.name,data:{...T},version:1,updatedAt:T.__ts??0,deleted:!1,txn:void 0}),h.set(O,1);const{id:F,__ts:Z,...V}=T;b.push({id:Is(),kind:"INSERT",table:y.name,before:void 0,after:{id:F,...V,__ts:Z??0},txnId:`snapshot-${T.__ts??0}`,txnIndex:0,txnTotal:1,txnLast:!0,commitTs:T.__ts??0,schemaVersion:L(y.name),topic:t?.topic??`cdc.${y.name}`,partition:0})})}),t?.metrics.recordSnapshotRows(b.length),C(b)},startTailing(d){e=d},applySource(d){const m=Sn(d.table,d.pk.id),b=d.t;if(L(d.table),d.op==="insert")u.set(m,{id:d.pk.id,table:d.table,data:{...d.after},version:1,updatedAt:b,deleted:!1,txn:d.txn});else if(d.op==="update"){const y=u.get(m),M=y?{...y.data,...d.after}:{...d.after};u.set(m,{id:d.pk.id,table:d.table,data:M,version:(y?.version??0)+1,updatedAt:b,deleted:!1,txn:d.txn})}else if(d.op==="delete"){const y=u.get(m);u.set(m,{id:d.pk.id,table:d.table,data:y?{...y.data}:{},version:(y?.version??0)+1,updatedAt:b,deleted:!0,txn:d.txn})}},applySchemaChange(d,m,b,y){L(d),m==="ADD_COLUMN"?u.forEach((M,T)=>{if(M.table!==d||Object.prototype.hasOwnProperty.call(M.data,b.name))return;const O={...M.data,[b.name]:null};u.set(T,{...M,data:O})}):m==="DROP_COLUMN"&&u.forEach((M,T)=>{if(M.table===d&&b.name in M.data){const O={...M.data};delete O[b.name],u.set(T,{...M,data:O})}}),x(d,m,b,y)},tick(d){if(!e||d-o<r)return;const m=[];E.length&&m.push(...E.splice(0,E.length)),u.forEach((b,y)=>{if(b.updatedAt<=o)return;const M=h.get(y)??0;if(b.deleted){a?(m.push(v(b.table,b.id,"DELETE",wn(b.data),null,b.updatedAt,`tx-${b.updatedAt}`,b.txn)),h.set(y,b.version)):(t?.metrics.recordMissedDelete(),h.set(y,b.version));return}if(b.version<=M)return;const T=M===0?"INSERT":"UPDATE";m.push(v(b.table,b.id,T,null,wn(b.data),b.updatedAt,`tx-${b.updatedAt}`,b.txn)),h.set(y,b.version)}),C(m),o=d},stop(){u.clear(),h.clear(),p.clear(),E.length=0,e=null,t=null,o=0}}}let na=0;const Cn=()=>`evt-${Date.now()}-${++na}`,Qt=t=>t?JSON.parse(JSON.stringify(t)):null,ra=(t,e)=>`${t}::${e}`,kn=(t,e)=>({id:t.name,type:t.type,nullable:t.nullable??!1,__ts:e}),Ln=(t,e,r=`tx-${e}`)=>{const a=t?.id??r,o=typeof t?.index=="number",u=o?t.index:void 0,h=typeof t?.total=="number"?t.total:void 0;let p;return typeof t?.last=="boolean"?p=t.last:o&&typeof h=="number"?p=u>=h-1:p=!t,{id:a,index:u,total:h,last:p}};function aa(){let t=null,e=null,r=250,a=8,o=0,u=0;const h=new Map,p=[],E=new Map,L=d=>{const m=E.get(d);return typeof m=="number"&&m>=1?m:(E.set(d,1),1)},j=d=>{const m=L(d),b=m+1;return E.set(d,b),{previous:m,next:b}},v=(d,m,b,y,M)=>{const T=Ln(d.txn,M);return{id:Cn(),kind:m,table:d.table,before:b?{id:d.pk.id,...b,__ts:M}:void 0,after:y?{id:d.pk.id,...y,__ts:M}:void 0,txnId:T.id,txnIndex:T.index,txnTotal:T.total,txnLast:T.last,commitTs:M,schemaVersion:L(d.table),topic:t?.topic??`cdc.${d.table}`,partition:0}},x=(d,m,b,y)=>{const{previous:M,next:T}=j(d),O=Ln(void 0,y,`schema-${y}`),F={id:Cn(),kind:m==="ADD_COLUMN"?"SCHEMA_ADD_COL":"SCHEMA_DROP_COL",table:d,before:m==="DROP_COLUMN"?kn(b,y):void 0,after:m==="ADD_COLUMN"?kn(b,y):void 0,txnId:O.id,txnIndex:O.index,txnTotal:O.total,txnLast:O.last,commitTs:y,schemaVersion:T,topic:t?.topic??`cdc.${d}`,partition:0,schemaChange:{action:m,column:b,previousVersion:M,nextVersion:T}};p.push({event:F})},C=d=>{!d.length||!e||e(d)};return{id:"TRIGGER_BASED",initialise(d){t=d},configure(d){const m=Number(d.extract_interval_ms??d.extractIntervalMs);Number.isFinite(m)&&m>0&&(r=m);const b=Number(d.trigger_overhead_ms??d.triggerOverheadMs);Number.isFinite(b)&&b>=0&&(a=b)},startSnapshot(d=[],m){e=m,t?.metrics.recordSnapshotRows(0)},startTailing(d){e=d},applySource(d){if(!t)return;const m=ra(d.table,d.pk.id),b=d.t+a;let y=null,M=null,T;if(L(d.table),d.op==="insert")T="INSERT",M=Qt(d.after),h.set(m,{id:d.pk.id,table:d.table,data:{...d.after},version:1,updatedAt:b,deleted:!1});else if(d.op==="update"){const O=h.get(m);y=O?Qt(O.data):null;const F=O?{...O.data,...d.after}:{...d.after};M=Qt(F),T="UPDATE",h.set(m,{id:d.pk.id,table:d.table,data:F,version:(O?.version??0)+1,updatedAt:b,deleted:!1})}else if(d.op==="delete"){const O=h.get(m);y=O?Qt(O.data):null,M=null,T="DELETE",h.set(m,{id:d.pk.id,table:d.table,data:O?{...O.data}:{},version:(O?.version??0)+1,updatedAt:b,deleted:!0})}else return;p.push({event:v(d,T,y,M,b)}),t.metrics.recordWriteAmplification(1)},applySchemaChange(d,m,b,y){if(!t)return;const M=y+a;L(d),m==="ADD_COLUMN"?h.forEach((T,O)=>{if(T.table===d&&!(b.name in T.data)){const F={...T.data,[b.name]:null};h.set(O,{...T,data:F,version:T.version+1,updatedAt:M})}}):m==="DROP_COLUMN"&&h.forEach((T,O)=>{if(T.table===d&&b.name in T.data){const F={...T.data};delete F[b.name],h.set(O,{...T,data:F,version:T.version+1,updatedAt:M})}}),x(d,m,b,M)},tick(d){if(!e||d-o<r)return;const m=p.slice(u).map(b=>b.event);C(m),u=p.length,o=d},stop(){p.length=0,h.clear(),e=null,t=null,u=0,o=0,E.clear()}}}const ts={MYSQL_DEBEZIUM:{id:"MYSQL_DEBEZIUM",label:"MySQL · Debezium · Kafka",description:"Debezium tails the MySQL binlog and pushes commits to Kafka for downstream consumers.",docsHint:"https://debezium.io/documentation/reference/stable/connectors/mysql.html",sourceLabel:"MySQL primary",sourceTooltip:"InnoDB workload emitting row-level changes for capture.",logLabel:"MySQL binlog (Debezium)",logTooltip:"Debezium connector streams row-format binlog entries in commit order.",busLabel:"Kafka topic",busTooltip:"Kafka transports Debezium change events (e.g. db.orders) to consumers.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Analytics warehouse, service, or cache subscribing to the Kafka topic.",topicFormat:t=>`db.${t}`,methodCopyOverrides:{polling:{label:"Polling (scheduled SQL)",laneDescription:"Batch jobs diff the MySQL table on an interval to detect divergence.",callout:"Misses hard deletes and rapid updates without custom tracking tables.",whenToUse:"Fallback when binlog access is blocked. Accepts lag and data loss for small tables only.",tooltip:"ETL-style SELECT polling against the MySQL primary."},trigger:{label:"Triggers (audit table)",laneDescription:"AFTER triggers write every mutation into an audit table for downstream extract.",callout:"Adds synchronous latency on the write path and increases operational overhead.",whenToUse:"When connectors are unavailable but you still need complete change history.",tooltip:"MySQL triggers populate audit tables that an extractor drains."},log:{label:"Debezium binlog tail",laneDescription:"Debezium streams row-based binlog events into Kafka with schema evolution support.",callout:"Preferred default: low-impact, ordered, near real-time change capture.",whenToUse:"Standard choice for production MySQL workloads when Kafka + Debezium are available.",tooltip:"Debezium connector tailing the MySQL binlog."}}},POSTGRES_LOGICAL:{id:"POSTGRES_LOGICAL",label:"Postgres · Logical decoding · Kafka",description:"Logical decoding streams Postgres WAL changes (pgoutput/wal2json) into Kafka.",docsHint:"https://www.postgresql.org/docs/current/logicaldecoding.html",sourceLabel:"Postgres primary",sourceTooltip:"OLTP Postgres emitting WAL entries for publications.",logLabel:"Logical replication slot",logTooltip:"Logical decoding slot materialises committed WAL changes via pgoutput or wal2json.",busLabel:"Kafka topic",busTooltip:"Kafka topics per publication (e.g. public.orders) fan out change events.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Consumers applying logical changes into warehouses or services.",topicFormat:t=>`public.${t}`,methodCopyOverrides:{polling:{label:"Polling (snapshot queries)",laneDescription:"Incremental SELECT queries compare current rows to previous snapshots.",callout:"Can't observe deletes or mid-transaction updates without tombstone columns.",whenToUse:"Stopgap for small tables when logical replication isn't permitted.",tooltip:"Periodic comparison queries against Postgres source tables."},trigger:{label:"Triggers (audit schema)",laneDescription:"Triggers populate audit tables that an extractor tails outside the WAL.",callout:"Higher write amplification and maintenance across replicas.",whenToUse:"When WAL access is off-limits yet complete history is required.",tooltip:"AFTER triggers write into audit tables for downstream capture."},log:{label:"Logical decoding stream",laneDescription:"Slot-based logical decoding streams ordered WAL changes through Kafka.",callout:"Best balance: ordered, low-impact capture with schema evolution support.",whenToUse:"Primary choice when you can run wal2json/pgoutput connectors.",tooltip:"Logical replication slot feeding Kafka via connectors."}}},SQLSERVER_CDC:{id:"SQLSERVER_CDC",label:"SQL Server · CDC tables · ETL",description:"SQL Server CDC populates change tables that ETL tools ship downstream.",docsHint:"https://learn.microsoft.com/sql/relational-databases/track-changes/about-change-data-capture-sql-server",sourceLabel:"SQL Server OLTP",sourceTooltip:"Source database with CDC enabled on tracked tables.",logLabel:"CDC change tables",logTooltip:"Log reader agent populates [cdc].[schema_table_CT] from the transaction log.",busLabel:"ETL pipeline",busTooltip:"ADF/SSIS or similar ETL pipelines move captured rows to consumers.",destinationLabel:"Warehouse / downstream sink",destinationTooltip:"Lakehouse, staging DB, or microservice applying captured rows.",topicFormat:t=>`cdc.${t}_ct`,methodCopyOverrides:{polling:{label:"Polling (T-SQL jobs)",laneDescription:"Scheduled queries compare source tables against a shadow copy.",callout:"Hard deletes vanish and rapid updates collapse to last-write wins.",whenToUse:"Only when CDC can't be enabled. Expect drift and operational overhead.",tooltip:"Agent jobs issuing SELECT deltas against the primary."},trigger:{label:"DB triggers (audit tables)",laneDescription:"DDL-driven triggers write into audit tables that ETL picks up.",callout:"Adds synchronous writes and complicates deployments.",whenToUse:"Fallback for editions without CDC but needing full fidelity.",tooltip:"FOR INSERT/UPDATE/DELETE triggers persisting rows into audit tables."},log:{label:"CDC change table stream",laneDescription:"Native CDC surfaces ordered change rows ready for downstream ETL.",callout:"Balanced approach: leverages log reader agent with minimal code.",whenToUse:"Default when SQL Server Enterprise/Standard CDC is available.",tooltip:"Change Data Capture tables populated by the log reader agent."}}},ORACLE_GG:{id:"ORACLE_GG",label:"Oracle · GoldenGate",description:"GoldenGate extracts Oracle redo into trails that replicat apply downstream.",docsHint:"https://docs.oracle.com/en/middleware/goldengate/",sourceLabel:"Oracle primary",sourceTooltip:"Oracle Database generating redo entries for tracked schemas.",logLabel:"Redo / GoldenGate trail",logTooltip:"Extract captures redo logs into GoldenGate trail files.",busLabel:"GoldenGate distribution",busTooltip:"GoldenGate distribution path replicates changes to targets or Kafka.",destinationLabel:"Replica / downstream sink",destinationTooltip:"Target database, cache, or Kafka topic consuming GoldenGate trails.",topicFormat:t=>`ogg.${t}`,methodCopyOverrides:{polling:{label:"Polling (custom jobs)",laneDescription:"Scripts query Oracle tables for deltas outside of GoldenGate.",callout:"Expensive and incomplete without change tracking columns.",whenToUse:"Rare stopgap for small tables when GoldenGate access is unavailable.",tooltip:"Ad-hoc jobs diffing source tables over DB links or snapshots."},trigger:{label:"Triggers (shadow tables)",laneDescription:"Row-level triggers populate shadow tables for downstream capture.",callout:"Adds redo volume and requires meticulous deployment management.",whenToUse:"Fallback when GoldenGate licensing or access is restricted.",tooltip:"Oracle triggers mirroring mutations into custom staging tables."},log:{label:"GoldenGate redo tail",laneDescription:"GoldenGate Extract/Replicat stream redo into ordered trail files.",callout:"Enterprise-grade: minimal source impact with robust replication semantics.",whenToUse:"Primary approach for Oracle sources requiring guaranteed replication.",tooltip:"GoldenGate Extract reading redo logs into trail files."}}},MONGODB_STREAMS:{id:"MONGODB_STREAMS",label:"MongoDB · Change Streams",description:"Change Streams tail the MongoDB oplog and push updates to subscribers.",docsHint:"https://www.mongodb.com/docs/manual/changeStreams/",sourceLabel:"MongoDB replica set",sourceTooltip:"Replica set primary emitting operations into the oplog.",logLabel:"Change stream (oplog)",logTooltip:"Change Stream cursor streams oplog events filtered per namespace.",busLabel:"Driver subscriber",busTooltip:"Driver / connector pushes stream events to downstream sinks (Kafka/Atlas).",destinationLabel:"Streaming sink",destinationTooltip:"Analytical store or service consuming the stream.",topicFormat:t=>`mongo.${t}`,methodCopyOverrides:{polling:{label:"Polling (find queries)",laneDescription:"Scheduled queries diff collections by last-updated timestamps.",callout:"No delete visibility and heavy load for high-churn collections.",whenToUse:"Only for prototypes without Change Stream or oplog access.",tooltip:"find() queries scanning for updated documents on an interval."},trigger:{label:"Hooks (side-write)",laneDescription:"Application-layer hooks write audit documents alongside originals.",callout:"Requires app changes and doubles write throughput.",whenToUse:"When database triggers/log access is unavailable and app control exists.",tooltip:"Custom middleware duplicating writes into audit collections."},log:{label:"Change Stream tail",laneDescription:"Native Change Stream cursor fans out oplog events in order.",callout:"Recommended: low-latency stream with resume tokens and schema support.",whenToUse:"Default for MongoDB replicas when you can open a Change Stream cursor.",tooltip:"MongoDB Change Stream subscription on the oplog."}}}},ss="cdc_playground_template_filter_v1",ns="cdc_playground_template_filter_tags_v1",is={query:"",tags:[]},ia=t=>typeof t=="string"?t:"",Xn=t=>{if(!Array.isArray(t))return[];const e=new Set,r=[];return t.forEach(a=>{if(a==null)return;const o=String(a).trim();!o||e.has(o)||(e.add(o),r.push(o))}),r},Bs=t=>{if(!t||typeof t!="object")return{...is};const e=ia(typeof t.query=="string"?t.query:""),r=t.tags;if(Array.isArray(r))return{query:e,tags:Xn(r)};if(typeof r=="string"){const a=r.trim();return{query:e,tags:a?[a]:[]}}return{query:e,tags:[]}},oa=(t,e)=>{if(t===e)return!0;if(t.length!==e.length)return!1;for(let r=0;r<t.length;r+=1)if(t[r]!==e[r])return!1;return!0},la=t=>typeof t!="string"?"":t,ca=t=>{if(typeof t!="string"||t.trim().length===0)return[];try{const e=JSON.parse(t);if(Array.isArray(e))return Xn(e)}catch{}return[]},da=t=>{if(!t)return{...is};try{const e=la(t.getItem(ss)),r=ca(t.getItem(ns));return{query:e,tags:r}}catch{return{...is}}},ua=(t,e)=>{if(!e)return;const r=Bs(t);try{r.query?e.setItem(ss,r.query):typeof e.removeItem=="function"?e.removeItem(ss):e.setItem(ss,"")}catch{}try{r.tags.length>0?e.setItem(ns,JSON.stringify(r.tags)):typeof e.removeItem=="function"?e.removeItem(ns):e.setItem(ns,"")}catch{}},ha=t=>typeof t=="string"?t.trim().toLowerCase():"",Mn=t=>Array.isArray(t)?t.map(e=>typeof e=="string"?e.trim():"").filter(e=>e.length>0):[],pa=t=>{const e=[];return t.label&&e.push(t.label),t.description&&e.push(t.description),t.highlight&&e.push(t.highlight),t.name&&e.push(t.name),Array.isArray(t.tags)&&t.tags.length>0&&e.push(t.tags.join(" ")),e.join(" ").toLowerCase()};function ma(t,e={}){const r=Array.from(t),{liveScenario:a,liveScenarioName:o,tags:u,query:h}=e;if(a){const j=r.findIndex(v=>v.name===a.name);j>=0?r.splice(j,1,a):r.unshift(a)}const p=Mn(u),L=ha(h).split(/\s+/).map(j=>j.trim()).filter(j=>j.length>0);return r.filter(j=>{if(o&&j.name===o)return!0;if(p.length>0){const x=Mn(j.tags??[]);if(!p.every(d=>x.includes(d)))return!1}if(L.length===0)return!0;const v=pa(j);return v?L.every(x=>v.includes(x)):!1})}const Os=(t,e)=>{Array.isArray(e)&&e.forEach(r=>{if(typeof r!="string")return;const a=r.trim();a.length>0&&t.add(a)})};function ga(t,e={}){const r=new Set;return t.forEach(a=>Os(r,a.tags)),e.liveScenario&&Os(r,e.liveScenario.tags),e.additionalTags?.forEach(a=>Os(r,a)),Array.from(r).sort((a,o)=>a.localeCompare(o))}const fa={"snapshot ➜ stream handoff":{summary:"Show how a snapshot catch-up hands control to the streaming tail while keeping tables consistent across methods.",controls:[{title:"Keep log + trigger enabled",detail:"Run both streaming lanes to compare how quickly they drain the backlog once the snapshot is done."},{title:"Apply on commit",detail:"Ensure atomic updates across tables once the stream takes over so item/order rows never drift during the handoff."},{title:"Throttle apply briefly",detail:"Enable the apply rate limiter to surface how much backlog accumulates during the snapshot phase versus live tailing."}],observations:[{title:"Mind duplicate delivery",detail:"Use the event log filters to confirm the first stream event after the snapshot resumes doesn't replay rows already applied."},{title:"Lag recovery",detail:"Track lag spread to show which capture method clears the handoff backlog fastest once throttling is removed."}]},"snapshot replay":{summary:"Rebuild state from a snapshot, then keep tails aligned while new mutations arrive mid-replay.",controls:[{title:"Leave polling disabled",detail:"Focus on trigger/log methods so the replay highlights ordered change events instead of bulk diffs."},{title:"Pause/resume apply",detail:"Pause apply mid-snapshot to show partially hydrated tables, then resume to watch the tail catch up."},{title:"Filter snapshot ops",detail:"Filter the event log to op=s to separate snapshot seeds from live updates when explaining offsets."}],observations:[{title:"Offset safety",detail:"Demonstrate that once the snapshot completes, resumed streams continue without reprocessing completed chunks."},{title:"Backlog pressure",detail:"Watch backlog counters while the replay runs; streaming methods should stay ahead of trigger overhead."}]},"orders + items transactions":{summary:"Highlight multi-table atomicity and why apply-on-commit matters for transactional feeds.",controls:[{title:"Enable apply-on-commit",detail:"Group transaction events so orders/items stay consistent even if a lane pauses mid-flight."},{title:"Toggle consumer pause",detail:"Pause apply during a multi-row commit to show how partial apply would drift if atomic grouping is off."},{title:"Keep log + trigger on",detail:"Contrast log ordering guarantees with trigger write amplification when commits include multiple tables."}],observations:[{title:"Out-of-order risk",detail:"Use the lane diff overlay to surface any sequence gaps when apply-on-commit is disabled."},{title:"Write amplification",detail:"Inspect trigger metrics to show the extra writes incurred versus log capture for the same transaction."}]},"outbox relay":{summary:"Compare an application-managed outbox with log capture and where each shines.",controls:[{title:"Disable polling",detail:"Keep focus on outbox vs. log/trigger capture; polling collapses the ordering story to diffs."},{title:"Filter to outbox table",detail:"Use the event log table filter to spotlight outbox_events entries and their ordering keys."},{title:"Keep apply-on-commit off",detail:"Allow partial apply to show how outbox can still preserve business ordering when consumers lag."}],observations:[{title:"Idempotent keys",detail:"Call out event_key usage and show how downstream sinks can dedupe on that key even if retries occur."},{title:"Replay behaviour",detail:"Reset and step through to prove outbox emits stable events even when upstream rows churn."}]},"retention & erasure":{summary:"Demonstrate privacy deletes, masking, and soft-delete visibility across methods.",controls:[{title:"Enable soft delete column",detail:"Turn on the polling soft-delete marker so diffs retain tombstones instead of dropping rows silently."},{title:"Keep polling slower",detail:"Use a longer poll interval (1–2s) to show how lag makes soft-delete visibility diverge from log capture."},{title:"Use event search",detail:"Filter for delete ops (d) to compare how each method surfaces erasure events and masking updates."}],observations:[{title:"Hard vs. soft delete",detail:"Point out that polling without the marker loses hard deletes, while log/trigger lanes emit explicit tombstones."},{title:"Compliance lag",detail:"Watch lag spread to discuss how quickly each method propagates erasure, especially under throttled apply."}]},"burst updates":{summary:"Stress test lag/ordering under rapid-fire updates to the same keys.",controls:[{title:"Throttle apply",detail:"Enable the apply rate limiter to build backlog and make ordering differences visible in the diff overlay."},{title:"Tighten log fetch interval",detail:"Drop the log fetch interval toward 50–100ms to show near-real-time log capture versus slower polling."},{title:"Disable generator",detail:"Keep the synthetic generator off so the scenario traffic stays focused on the curated burst pattern."}],observations:[{title:"Last-write wins",detail:"Use the event log search to show how polling collapses intermediate updates when bursts occur."},{title:"Lag hotspots",detail:"Check metrics dashboard to spot which lane accumulates the largest p95 lag under sustained bursts."}]}};function ba(t){if(!t)return null;const e=t.trim().toLowerCase();return fa[e]??null}const qs=t=>{if(Array.isArray(t))return t.map(e=>qs(e));if(t&&typeof t=="object"){const e={};return Object.entries(t).forEach(([r,a])=>{e[r]=qs(a)}),e}return t},rs=t=>qs(t),Zn=t=>({...t}),Tn=t=>({name:t.name,version:t.version,columns:t.columns.map(Zn)}),xa=(t,e)=>typeof e=="boolean"?"bool":typeof e=="number"?/_ts$|timestamp$/i.test(t)?"timestamp":"number":e instanceof Date?"timestamp":"string",_a=(t,e=1)=>({name:t,version:e,columns:[{name:"id",type:"string",nullable:!1}]}),Nn=t=>{t.columns.some(r=>r.name==="id")||t.columns.unshift({name:"id",type:"string",nullable:!1})},An=t=>{const e=rs(t);return e.id=String(e.id),e};class Rs{constructor(e=[]){this.tables=new Map,e.forEach(r=>this.upsertTable(r))}upsertTable(e){const r=Tn(e.schema);Nn(r);const a=new Map;e.rows.forEach(o=>{const u=An(rs(o));a.set(u.id,u)}),this.tables.set(e.name,{schema:r,rows:a})}replaceAll(e){this.tables.clear(),e.forEach(r=>this.upsertTable(r))}getTable(e){const r=this.tables.get(e);if(r)return{name:e,schema:Tn(r.schema),rows:Array.from(r.rows.values()).map(a=>rs(a))}}listTables(){return Array.from(this.tables.keys()).map(e=>this.getTable(e)).filter(e=>!!e)}clear(){this.tables.clear()}applyEvents(e){e.forEach(r=>this.applyEvent(r))}applyEvent(e){if(!e?.table)return;if(e.kind==="SCHEMA_ADD_COL"||e.kind==="SCHEMA_DROP_COL"){this.applySchemaChange(e);return}const r=this.ensureTableState(e.table,e.schemaVersion);if(e.schemaVersion&&e.schemaVersion>r.schema.version&&(r.schema.version=e.schemaVersion),e.kind==="DELETE"){const E=e.before?.id??e.after?.id;E!=null&&r.rows.delete(String(E));return}const a=e.after??void 0;if(!a)return;const o=An(a),u=r.rows.get(o.id),h=u?{...u,...o}:o,p=rs(h);this.syncSchemaColumns(r,p),r.rows.set(p.id,p)}snapshot(){return this.listTables()}ensureTableState(e,r){let a=this.tables.get(e);return a||(a={schema:_a(e,r??1),rows:new Map},this.tables.set(e,a)),r&&r>a.schema.version&&(a.schema.version=r),Nn(a.schema),a}applySchemaChange(e){const r=e.schemaChange;if(!r)return;const a=this.ensureTableState(e.table,r.nextVersion??e.schemaVersion);a.schema.version=Math.max(a.schema.version,r.nextVersion??e.schemaVersion??a.schema.version),e.kind==="SCHEMA_ADD_COL"?this.addColumn(a,r.column):e.kind==="SCHEMA_DROP_COL"&&this.dropColumn(a,r.column.name)}addColumn(e,r){const a=e.schema.columns.find(o=>o.name===r.name);a?(a.type=r.type,r.nullable&&(a.nullable=!0)):e.schema.columns.push(Zn(r)),e.rows.forEach(o=>{r.name in o||(o[r.name]=null)})}dropColumn(e,r){r!=="id"&&(e.schema.columns=e.schema.columns.filter(a=>a.name!==r),e.rows.forEach(a=>{r in a&&delete a[r]}))}syncSchemaColumns(e,r){const a=e.schema.columns;Object.entries(r).forEach(([o,u])=>{if(o==="id"||o.startsWith("__"))return;let h=a.find(p=>p.name===o);h||(h={name:o,type:xa(o,u)},a.push(h)),u==null&&(h.nullable=!0)})}}const ya=2e3,Jt={methods:[],ops:[],tables:[],txns:[]},In={empty:"No events yet.",noMatch:"No events match the current filters."},On=(t,e,r)=>{const a=new Map;t.forEach(h=>{const p=e(h);if(!p)return;const E=r(h);a.has(p)||a.set(p,{label:E,count:0}),a.get(p).count+=1});const o=t.length||1,u=Array.from(a.entries()).map(([h,p])=>({id:h,label:p.label,count:p.count,percent:Math.round(p.count/o*100)}));return u.sort((h,p)=>p.count!==h.count?p.count-h.count:h.label.localeCompare(p.label)),u},Rn=t=>{if(!t)return"";try{const e=JSON.stringify(t);return e?e.length>160?`${e.slice(0,160)}…`:e:""}catch{return""}},Ws=t=>{if(typeof t!="string")return"";const e=t.trim();if(!e)return"";const r=e.toLowerCase();return["c","create","insert","i"].includes(r)?"insert":["u","update"].includes(r)?"update":["d","delete"].includes(r)?"delete":r},Dn=t=>{const e=Ws(t);if(e==="insert"||e==="update"||e==="delete")return e.toUpperCase();if(typeof t!="string")return"—";const r=t.trim();return r?r.toUpperCase():"—"},va=({events:t,stats:e,totalCount:r,filters:a={},filterOptions:o,onFiltersChange:u,onDownload:h,onClear:p,onCopyEvent:E,onReplayEvent:L,maxVisibleEvents:j=ya,emptyMessage:v,noMatchMessage:x,className:C})=>{const d={methods:o?.methods??Jt.methods,ops:o?.ops??Jt.ops,tables:o?.tables??Jt.tables,txns:o?.txns??Jt.txns},m=l.useMemo(()=>typeof j!="number"||j<=0?t.length:Math.min(j,t.length),[t.length,j]),[b,y]=l.useState(m);l.useEffect(()=>{y(S=>S<m?m:S>t.length?t.length:S)},[m,t.length]);const M=l.useMemo(()=>{const S=Math.max(b,0),H=Math.max(t.length-S,0);return t.slice(H)},[t,b]),T=l.useMemo(()=>t.length?M.length===t.length?`${M.length} visible`:`Latest ${M.length} of ${t.length}`:"",[t.length,M.length]),O=l.useMemo(()=>On(M,S=>Ws(S.op),S=>Dn(S.op)),[M]),F=l.useMemo(()=>On(M,S=>S.methodId??S.methodLabel??"",S=>S.methodLabel||S.methodId||""),[M]),Z=M.length<t.length,V=b>m,de=()=>{if(!Z)return;const S=m>0?m:t.length;y(H=>Math.min(H+S,t.length))},N=()=>{y(m)},je=typeof r=="number"?r:t.length,Ee=!!a.methodId||!!a.op||!!a.table||!!a.txnId,Ce={empty:v??In.empty,noMatch:x??In.noMatch},ke=S=>{if(!u)return;const H={methodId:S.methodId===void 0?a.methodId:S.methodId,op:S.op===void 0?a.op:S.op,table:S.table===void 0?a.table:S.table,txnId:S.txnId===void 0?a.txnId:S.txnId},Q={methodId:H.methodId||void 0,op:H.op||void 0,table:H.table||void 0,txnId:H.txnId||void 0};u(Q)},U=S=>{const H=Rn(S.before),Q=Rn(S.after);return!H&&!Q?null:n.jsxs("details",{className:"cdc-event-log__details",children:[n.jsx("summary",{children:"Row image"}),H&&n.jsxs("div",{className:"cdc-event-log__details-row",children:[n.jsx("span",{children:"before"}),n.jsx("code",{children:H})]}),Q&&n.jsxs("div",{className:"cdc-event-log__details-row",children:[n.jsx("span",{children:"after"}),n.jsx("code",{children:Q})]})]})};return n.jsxs("section",{className:`cdc-event-log${C?` ${C}`:""}`,"aria-label":"Event log",role:"region",children:[n.jsxs("header",{className:"cdc-event-log__header",children:[n.jsxs("div",{className:"cdc-event-log__headline",children:[n.jsx("h3",{children:"Event Log"}),e&&n.jsxs("p",{className:"cdc-event-log__stats",children:[n.jsxs("span",{children:["Produced ",e.produced]})," · ",n.jsxs("span",{children:["Consumed ",e.consumed]})," · ",n.jsxs("span",{children:["Backlog ",e.backlog]}),typeof e.snapshotRows=="number"&&n.jsxs(n.Fragment,{children:[" · ",n.jsxs("span",{children:["Snapshot rows ",e.snapshotRows]})]})]})]}),n.jsxs("div",{className:"cdc-event-log__actions",children:[n.jsxs("span",{children:[t.length," events"]}),n.jsx("button",{type:"button",onClick:h,disabled:!h||t.length===0,children:"Download NDJSON"}),n.jsx("button",{type:"button",onClick:p,disabled:!p||je===0,children:"Clear"})]})]}),n.jsxs("div",{className:"cdc-event-log__filters",role:"group","aria-label":"Event log filters",children:[n.jsxs("label",{children:[n.jsx("span",{children:"Method"}),n.jsxs("select",{value:a.methodId??"",onChange:S=>ke({methodId:S.target.value||void 0}),disabled:!u||d.methods.length===0,children:[n.jsx("option",{value:"",children:"All methods"}),d.methods.map(S=>n.jsx("option",{value:S.id,children:S.label},S.id))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Operation"}),n.jsxs("select",{value:a.op??"",onChange:S=>ke({op:S.target.value||void 0}),disabled:!u||d.ops.length===0,children:[n.jsx("option",{value:"",children:"All ops"}),d.ops.map(S=>n.jsx("option",{value:S,children:S.toUpperCase()},S))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Table"}),n.jsxs("select",{value:a.table??"",onChange:S=>ke({table:S.target.value||void 0}),disabled:!u||d.tables.length===0,children:[n.jsx("option",{value:"",children:"All tables"}),d.tables.map(S=>n.jsx("option",{value:S,children:S},S))]})]}),n.jsxs("label",{children:[n.jsx("span",{children:"Txn"}),n.jsxs("select",{value:a.txnId??"",onChange:S=>ke({txnId:S.target.value||void 0}),disabled:!u||d.txns.length===0,children:[n.jsx("option",{value:"",children:"All txns"}),d.txns.map(S=>n.jsx("option",{value:S,children:S},S))]})]})]}),M.length>0&&n.jsxs("div",{className:"cdc-event-log__summary",role:"status","aria-live":"polite",children:[n.jsxs("div",{className:"cdc-event-log__summary-block",children:[n.jsxs("div",{className:"cdc-event-log__summary-heading",children:[n.jsx("h4",{children:"Change mix"}),T?n.jsx("span",{children:T}):null]}),n.jsx("div",{className:"cdc-event-log__summary-pills","aria-label":"Change operations distribution",children:O.length>0?O.map(S=>n.jsxs("span",{className:"cdc-event-log__pill",children:[n.jsx("strong",{children:S.label}),n.jsxs("span",{children:[S.count," · ",S.percent,"%"]})]},S.id)):n.jsx("span",{className:"cdc-event-log__pill cdc-event-log__pill--muted",children:"No op codes"})})]}),n.jsxs("div",{className:"cdc-event-log__summary-block",children:[n.jsxs("div",{className:"cdc-event-log__summary-heading",children:[n.jsx("h4",{children:"Method mix"}),T?n.jsx("span",{children:T}):null]}),n.jsx("div",{className:"cdc-event-log__summary-pills","aria-label":"Method distribution",children:F.length>0?F.map(S=>n.jsxs("span",{className:"cdc-event-log__pill",children:[n.jsx("strong",{children:S.label||"Unknown"}),n.jsxs("span",{children:[S.count," · ",S.percent,"%"]})]},S.id)):n.jsx("span",{className:"cdc-event-log__pill cdc-event-log__pill--muted",children:"No method labels"})})]})]}),t.length===0?n.jsx("p",{className:"cdc-event-log__empty",children:je>0||Ee?Ce.noMatch:Ce.empty}):n.jsxs("ul",{className:"cdc-event-log__list",children:[t.length>M.length&&n.jsxs("li",{className:"cdc-event-log__notice",children:[n.jsxs("span",{children:["Showing latest ",M.length," of ",t.length," events."]}),n.jsxs("div",{className:"cdc-event-log__notice-actions",children:[n.jsx("button",{type:"button",onClick:de,disabled:!Z,children:"Load more"}),V&&n.jsx("button",{type:"button",onClick:N,children:"Show latest"})]})]}),M.map(S=>{const H=Dn(S.op),Q=Ws(S.op),te=typeof S.offset=="number"?S.offset:S.offset==null?"—":S.offset,Y=S.topic??"—",bt=S.table??"—",Be=S.pk??"—",Ne=S.txnId??"",he=typeof S.tsMs=="number"?S.tsMs:"—",ls=Q==="insert"||Q==="update"||Q==="delete";return n.jsxs("li",{className:"cdc-event-log__item",children:[n.jsx("span",{className:"cdc-event-log__method",children:S.methodLabel??S.methodId??"—"}),n.jsx("span",{className:"cdc-event-log__op","data-op":H,children:H}),n.jsxs("span",{className:"cdc-event-log__offset",children:["offset ",te]}),n.jsx("span",{className:"cdc-event-log__topic",children:Y}),n.jsxs("span",{className:"cdc-event-log__table",children:["table ",bt]}),n.jsxs("span",{className:"cdc-event-log__meta",children:["ts=",he,"ms · pk=",Be,Ne?` · txn=${Ne}`:""]}),S.meta?n.jsx("span",{className:"cdc-event-log__extra",children:S.meta}):null,L?n.jsx("button",{type:"button",className:"cdc-event-log__replay",onClick:()=>L?.(S),disabled:!ls,children:"Replay"}):null,n.jsx("button",{type:"button",className:"cdc-event-log__copy",onClick:()=>E?.(S),disabled:!E,children:"Copy"}),U(S)]},S.id)})]})]})};function wa(t){const e=t.op?.toUpperCase?.()??"?",r=t.pk??"∅",a=t.expectedIndex!=null?`#${t.expectedIndex}`:void 0,o=t.actualIndex!=null?`#${t.actualIndex}`:void 0;return t.type==="missing"?`Missing ${e} for pk=${r} (${a??"expected"} @ ${t.expectedTime??"?"}ms)`:t.type==="extra"?`Unexpected ${e} for pk=${r} (${o??"emitted"} @ ${t.actualTime??"?"}ms)`:`Out-of-order ${e} pk=${r} (expected ${a??"?"} before actual ${o??"?"})`}const Sa=({diff:t,scenarioName:e,laneId:r,schemaStatus:a,onDiffDetailsOpened:o})=>{if(!t)return null;const{totals:u,issues:h,lag:p}=t,E=u.missing>0||u.extra>0||u.ordering>0,L=h.slice(0,6);let j=null;return a&&(a.hasColumn?a.version<a.expectedVersion&&(j=`Schema behind: v${a.version} (expected v${a.expectedVersion})`):j=`${a.columnName} column missing in destination`),!E&&p.max<=0&&!j?null:n.jsxs("div",{className:"sim-shell__lane-diff","data-has-issues":E?"true":"false",role:"note",children:[n.jsxs("div",{className:"sim-shell__lane-diff-summary",children:[E?n.jsxs(n.Fragment,{children:[u.missing>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--missing",children:[u.missing," missing"]}),u.extra>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--extra",children:[u.extra," extra"]}),u.ordering>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--ordering",children:[u.ordering," ordering"]})]}):n.jsx("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--ok",children:"Operations aligned"}),p.max>0&&n.jsxs("span",{className:"sim-shell__lane-diff-chip sim-shell__lane-diff-chip--lag",children:["Max lag ",Math.round(p.max),"ms"]})]}),j&&n.jsx("p",{className:"sim-shell__lane-diff-schema",children:j}),(L.length>0||p.samples.length>0)&&n.jsxs("details",{id:r?`lane-diff-${r}`:void 0,className:"sim-shell__lane-diff-details",onToggle:v=>{v.target.open&&o?.({method:t.method,issueCount:t.issues.length,maxLag:t.lag.max,scenario:e})},children:[n.jsx("summary",{children:"Diff details"}),L.length>0&&n.jsx("ul",{className:"sim-shell__lane-diff-list",children:L.map((v,x)=>n.jsx("li",{children:wa(v)},`${v.type}-${v.op}-${v.pk??"∅"}-${x}`))}),h.length>L.length&&n.jsxs("p",{className:"sim-shell__lane-diff-more",children:["+",h.length-L.length," additional difference(s)"]}),p.samples.length>0&&n.jsxs("div",{className:"sim-shell__lane-diff-lag",children:[n.jsx("h4",{children:"Lag hotspots"}),n.jsx("ul",{children:p.samples.map(v=>n.jsxs("li",{children:[Math.round(v.lagMs),"ms on ",v.op.toUpperCase()," pk=",v.pk??"∅"]},`${v.op}-${v.pk??"∅"}-${v.actualTime??"?"}`))})]})]})]})},et=Yn,er=.05,ja=1+er,Ea=t=>t.replace(/\.0$/,"");function Te(t){return typeof t=="number"&&Number.isFinite(t)&&t>=ja}function Ca(t){return`${(Number.isFinite(t)?Math.max(t,0):0).toFixed(1)}x`}function tt(t){const e=Ca(t),r=Number.isFinite(t)?Math.max(t-1,0):0;if(r<er)return e;const a=r>=10?0:r>=1?1:2,o=Ea(r.toFixed(a));return`${e} (~${o} extra writes/change)`}const fe=t=>Number.isFinite(t)?t.toLocaleString():"—",$n=t=>Number.isFinite(t)?`${Math.round(t)}ms`:"—",ka=({lanes:t,renderSchemaWalkthrough:e})=>{const r=t.reduce((a,o)=>(a.produced+=o.produced,a.consumed+=o.consumed,a.backlog+=o.backlog,a),{produced:0,consumed:0,backlog:0});return n.jsxs("section",{className:"sim-shell__metrics-dashboard","aria-label":"Runtime metrics",children:[n.jsx("header",{className:"sim-shell__metrics-dashboard-header",children:n.jsxs("div",{children:[n.jsx("h3",{children:"Runtime metrics"}),n.jsxs("p",{children:["Produced ",fe(r.produced)," · Consumed ",fe(r.consumed)," · Backlog ",fe(r.backlog)]})]})}),n.jsx("div",{className:"sim-shell__metrics-dashboard-grid",children:t.map(a=>n.jsxs("article",{className:"sim-shell__metrics-dashboard-card",children:[n.jsx("header",{children:n.jsx("h4",{"data-tooltip":a.tooltip||void 0,children:a.label})}),e&&n.jsx("div",{className:"sim-shell__schema-demo-inline",children:e(a.id)}),n.jsxs("dl",{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Produced"}),n.jsx("dd",{children:fe(a.produced)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Consumed"}),n.jsx("dd",{children:fe(a.consumed)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Backlog"}),n.jsx("dd",{"data-tooltip":et.backlog,children:fe(a.backlog)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Lag p50"}),n.jsx("dd",{"data-tooltip":et.lagPercentile,children:$n(a.lagP50)})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Lag p95"}),n.jsx("dd",{"data-tooltip":et.lagPercentile,children:$n(a.lagP95)})]}),typeof a.snapshotRows=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Snapshot rows"}),n.jsx("dd",{"data-tooltip":et.snapshot,children:fe(a.snapshotRows)})]}),(typeof a.inserts=="number"||typeof a.updates=="number"||typeof a.deletes=="number")&&n.jsxs("div",{children:[n.jsx("dt",{children:"Change mix"}),n.jsxs("dd",{children:["C ",fe(a.inserts??0)," · U ",fe(a.updates??0)," · D ",fe(a.deletes??0),typeof a.schemaChanges=="number"&&a.schemaChanges>0?` · Schema ${fe(a.schemaChanges)}`:""]})]}),typeof a.missedDeletes=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Missed deletes"}),n.jsx("dd",{"data-tooltip":et.deleteCapture,children:fe(a.missedDeletes)})]}),Te(a.writeAmplification)&&n.jsxs("div",{children:[n.jsx("dt",{children:"Write amplification"}),n.jsx("dd",{"data-tooltip":et.triggerWriteAmplification,children:tt(a.writeAmplification)})]})]})]},a.id))})]})},La=({lagMs:t,throughput:e,deletesPct:r,orderingOk:a,consistent:o,writeAmplification:u,insertCount:h,updateCount:p,deleteCount:E,schemaChangeCount:L})=>n.jsxs("div",{role:"status","aria-live":"polite",children:[n.jsxs("span",{children:["Lag: ",t,"ms"]})," ·",n.jsxs("span",{children:["TPS: ",e.toFixed(1)]})," ·",n.jsxs("span",{children:["Deletes: ",Math.round(r),"%"]})," ·",n.jsxs("span",{children:["Ordering: ",a?"OK":"KO"]})," ·",n.jsxs("span",{children:["Consistency: ",o?"OK":"Drift"]})," ","·",n.jsxs("span",{children:["Ops C/U/D: ",h,"/",p,"/",E]}),L>0&&n.jsxs(n.Fragment,{children:[" ","·",n.jsxs("span",{children:["Schema: ",L]})]}),Te(u)&&n.jsxs(n.Fragment,{children:[" ","·",n.jsxs("span",{"data-tooltip":et.triggerWriteAmplification,children:["Trigger WA: ",tt(u)]})]})]}),Ma=({onAdd:t,onDrop:e,columnName:r,disabled:a,disableAdd:o,disableDrop:u,status:h})=>n.jsxs("section",{className:"sim-shell__schema-demo","aria-label":"Schema walkthrough",children:[n.jsxs("header",{children:[n.jsx("h4",{children:"Schema walkthrough"}),n.jsxs("p",{children:["Add or drop ",n.jsx("code",{children:r})," while events stream to compare capture behaviour."]})]}),h?n.jsx("p",{className:"sim-shell__schema-demo-status",children:h}):null,n.jsxs("div",{className:"sim-shell__schema-demo-buttons",children:[n.jsxs("button",{type:"button",onClick:t,disabled:a||o,"data-tour-target":"schema-add",children:["Add ",r]}),n.jsxs("button",{type:"button",onClick:e,disabled:a||u,"data-tour-target":"schema-drop",children:["Drop ",r]})]})]}),Tt=t=>{if(Array.isArray(t))return t.map(e=>Tt(e));if(t&&typeof t=="object"){const e={};return Object.entries(t).forEach(([r,a])=>{e[r]=Tt(a)}),e}return t},Ye=t=>{if(typeof t=="number"&&Number.isFinite(t))return t;if(typeof t=="string"&&t.trim().length>0){const e=Number(t);return Number.isFinite(e)?e:null}return null},Ta=t=>{if(typeof t=="boolean")return t;if(typeof t=="string"){const e=t.trim().toLowerCase();if(e==="true")return!0;if(e==="false")return!1}return null},st=t=>{if(t==null)return null;if(typeof t=="string"){const e=t.trim();return e.length>0?e:null}return typeof t=="number"&&Number.isFinite(t)?String(t):typeof t=="boolean"?t?"true":"false":null},Na=t=>{if(!t)return null;if(typeof t=="object"){const r=t;if(r&&Object.prototype.hasOwnProperty.call(r,"id")){const a=st(r.id);return a?{id:a}:null}}const e=st(t);return e?{id:e}:null},Aa=t=>{const e=t.event??{},r=st(t.method),a=Ye(e.offset),o=Ye(e.seq),u=Ye(e.ts_ms)??Ye(e.tsMs)??Ye(e.ts),h=st(e.op),p=st(e.table),E=Na(e.pk),L=e.before==null?null:Tt(e.before),j=e.after==null?null:Tt(e.after),v=st(e.topic),x=e.tx??null,C=st(x?.id??e.txnId),d=Ye(x?.index??e.txnIndex),m=Ye(x?.total??e.txnTotal),b=Ta(x?.last??e.txnLast),y=e.schemaChange==null?null:Tt(e.schemaChange);return{method:r??null,offset:a,seq:o,ts_ms:u,op:h,table:p,pk:E,before:L,after:j,topic:v,txn_id:C,txn_index:d,txn_total:m,txn_last:b,schema_change:y}},Ia=(t,e={})=>{const r=e.newline??`
`,a=[];for(const o of t){if(!o||typeof o!="object")continue;const u=Aa(o);a.push(JSON.stringify(u))}return a.join(r)},Oa="cdc_telemetry_buffer_v1",Ra=200,tr={activation:{key:"activation",label:"Activation",description:"Do new users reach their first comparator insight?"},funnel_drop:{key:"funnel_drop",label:"Funnel drop",description:"Where do users abandon the guided comparator walkthrough?"},adoption:{key:"adoption",label:"Adoption",description:"Which comparator features become part of regular usage?"},quality_gate:{key:"quality_gate",label:"Quality gate",description:"Do reliability issues or errors block comparator adoption?"},scenario_completeness:{key:"scenario_completeness",label:"Scenario completeness",description:"Which templates lead to full replay, export, and comparator review?"},collaboration:{key:"collaboration",label:"Collaboration",description:"How often do teams share scenarios or comparator snapshots?"}},Pn={"comparator.scenario.select":"activation","comparator.scenario.preview":"activation","comparator.preset.select":"activation","comparator.scenario.filter":"activation","comparator.scenario.tag_toggle":"funnel_drop","comparator.scenario.tag_clear":"funnel_drop","comparator.summary.copied":"activation","comparator.diff.opened":"funnel_drop","comparator.overlay.inspect":"activation","comparator.schema.change":"activation","comparator.clock.control":"funnel_drop","comparator.consumer.toggle":"funnel_drop","comparator.consumer.rate_toggle":"funnel_drop","comparator.consumer.rate_adjust":"activation","comparator.consumer.rate_reset":"activation","comparator.event.search":"activation","comparator.event.filter":"activation","comparator.panel.layout":"adoption","comparator.event.download":"adoption","comparator.event.clear":"adoption","comparator.event.copy":"activation","comparator.event.copy.error":"quality_gate","comparator.event.replay":"activation","comparator.destination.download":"adoption","comparator.generator.toggle":"adoption","comparator.generator.rate_adjust":"adoption","comparator.generator.burst":"activation","tour.started":"funnel_drop","tour.completed":"activation","tour.dismissed":"funnel_drop","workspace.share.generated":"collaboration","workspace.scenario.imported":"scenario_completeness","workspace.scenario.template_loaded":"activation","workspace.scenario.exported":"scenario_completeness","telemetry.flush":"activation"},sr=t=>!!t&&typeof t=="object"&&!Array.isArray(t),os=t=>{if(!sr(t))return{};const e={};return Object.keys(t).forEach(r=>{e[r]=t[r]}),e},Da=()=>({getItem:()=>null,setItem:()=>{}}),$a=t=>{try{return t.toISOString()}catch{return new Date().toISOString()}},Pa=t=>{if(!sr(t))return null;const e=typeof t.event=="string"?t.event:null;if(!e)return null;const r=os(t.payload),a=os(t.context),o=typeof t.recordedAt=="string"?t.recordedAt:typeof t.recorded_at=="string"?t.recorded_at:null,u=o&&!Number.isNaN(Date.parse(o))?o:new Date().toISOString(),h=t.question,p=typeof h=="string"&&h in tr?h:null;return{event:e,payload:r,context:a,question:p,recordedAt:u}},Fa=t=>({event:t.event,payload:t.payload,context:t.context,question:t.question,recordedAt:t.recordedAt}),Ua=(t={})=>{const e=t.storage??(typeof window<"u"&&window.localStorage?window.localStorage:Da()),r=t.storageKey??Oa,a=Math.max(1,t.maxEntries??Ra),o=t.now??(()=>new Date),u=t.console??(typeof console<"u"?{warn:console.warn.bind(console),debug:console.debug.bind(console)}:{warn:()=>{},debug:()=>{}}),p=(()=>{try{const C=e.getItem(r);if(!C)return[];const d=JSON.parse(C);return Array.isArray(d)?d.map(Pa).filter(b=>!!b).slice(-a):[]}catch(C){return u.warn("Telemetry buffer load failed",C),[]}})(),E=()=>{try{const C=p.slice(-a).map(Fa);e.setItem(r,JSON.stringify(C))}catch(C){u.warn("Telemetry buffer save failed",C)}};return{buffer:p,track:(C,d={},m={})=>{if(typeof C!="string"||!C.trim())return;const b=C.trim(),y={event:b,payload:os(d),context:os(m),question:Pn[b]??null,recordedAt:$a(o())};p.push(y),p.length>a&&p.splice(0,p.length-a),E(),y.context.debug&&u.debug("[telemetry]",y)},flush:()=>{if(p.length===0)return[];const C=p.slice();return p.length=0,E(),C},questions:()=>Object.values(tr).map(C=>({...C})),taxonomy:()=>({...Pn})}},Ba=t=>{const e=new Map,r=o=>{if(!t)return e.get(o)??null;try{const u=t.getItem(o);return typeof u=="string"?u:u??null}catch{return e.get(o)??null}},a=o=>{if(!t)return!1;try{return typeof t.removeItem=="function"?t.removeItem(o):t.setItem(o,""),!0}catch{return!1}};return{getItem(o){return e.has(o)?e.get(o)??null:r(o)},setItem(o,u){if(t)try{t.setItem(o,u),e.delete(o);return}catch{}e.set(o,u)},removeItem(o){e.delete(o),a(o)||e.set(o,null)}}},Fn=t=>{const e=t.trim();if(!e.startsWith("|")||e==="|")return[];const r=e.split("|");return r.shift(),r.length>0&&r[r.length-1].trim()===""&&r.pop(),r.map(a=>a.trim())},nr=t=>{let e=t.trim(),r=!1;const a=["*","_"];let o=!0;for(;o&&e.length>=2;)o=!1,a.forEach(u=>{if(e.startsWith(u)&&e.endsWith(u)){const h=e.slice(u.length,e.length-u.length).trim();h.length>=0&&(e=h,r=!0,o=!0)}});return{text:e,emphasis:r}},qa=t=>{const e=t.match(/^\[([^\]]+)\]\(([^)]+)\)$/);if(!e)return{text:t};const[,r,a]=e;return{text:r.trim(),href:a.trim()}},rr=t=>t.replace(/&nbsp;/gi," ").replace(/&#160;/g," "),Wa=t=>{if(!t)return{text:""};const e=rr(t),{text:r,emphasis:a}=nr(e),o=qa(r);return{text:o.text.trim(),href:o.href,emphasis:a}},Va=t=>t.length>0&&t.every(e=>/^:?[-=]+:?$/u.test(e.replace(/\s+/g,""))),Ga=t=>{if(!t.length)return!1;const e=t[0].text.trim().toLowerCase();return e.length>0&&e.includes("no runs")&&e.includes("captured")},Ha=t=>{const e=t.split(/\r?\n/).map(p=>p.trim()).filter(p=>p.startsWith("|"));if(e.length<2)return null;const r=Fn(e[0]);if(!r.length)return null;const a=r.map(p=>nr(rr(p)).text),o=e.slice(1),u=[];let h=null;return o.forEach(p=>{const E=Fn(p);if(!E.length||Va(E))return;const L=E.map(Wa);if(Ga(L)){h=L[0].text.trim();return}L.every(j=>j.text==="")||u.push(L)}),{headers:a,rows:u,placeholder:h}};function za(t,e){const r=structuredClone(t??{}),a=(o,u,h)=>{if(!o)return;const p=o[u],E=typeof p=="string"?p:h,L=E?e[E]:void 0;p!=null&&typeof p=="object"&&"label"in p||(o[u]={label:L?.label??String(E??p??""),tooltip:L?.tooltip,value:typeof p=="number"?p:p?.value??p})};return a(r,"bestLag",r?.bestLagId),a(r,"triggerWriteAmplification",r?.triggerWriteAmplificationId),Array.isArray(r.lanes)&&(r.lanes=r.lanes.map(o=>{const u=typeof o?.method=="string"?o.method:void 0,h=u?e[u]:void 0;return{...o,id:u,label:h?.label??u,tooltip:h?.tooltip}}).filter(Boolean)),r}class Ka{constructor(){this.handlers=new Set}emit(e){this.handlers.forEach(r=>r(e))}on(e){return this.handlers.add(e),()=>this.handlers.delete(e)}}class zs{constructor(){this.bus=new Ka,this.seq=0,this.randomSeed=42}configure(e){}reset(e){this.seq=0,this.randomSeed=e}onEvent(e){return this.bus.on(e)}}class Qa extends zs{constructor(){super(...arguments),this.name="polling",this.table=new Map,this.lastSync=0,this.pollIntervalMs=1e3,this.includeSoftDeletes=!1}configure(e){e.poll_interval_ms!==void 0&&(this.pollIntervalMs=e.poll_interval_ms),e.include_soft_deletes!==void 0&&(this.includeSoftDeletes=e.include_soft_deletes)}reset(e){super.reset(e),this.table.clear(),this.lastSync=0}applySourceOp(e){if(e.op==="insert")this.table.set(e.pk.id,{id:e.pk.id,table:e.table,data:e.after,version:1,updated_at_ms:e.t,deleted:!1});else if(e.op==="update"){const r=this.table.get(e.pk.id);if(!r||r.deleted)return;this.table.set(e.pk.id,{...r,table:r.table??e.table,data:{...r.data,...e.after},version:r.version+1,updated_at_ms:e.t})}else if(e.op==="delete"){const r=this.table.get(e.pk.id);if(!r)return;this.table.set(e.pk.id,{...r,table:r.table??e.table,deleted:!0,updated_at_ms:e.t})}}shouldPoll(e){return e-this.lastSync>=this.pollIntervalMs}tick(e){if(!this.shouldPoll(e))return;const r=[...this.table.values()].filter(a=>a.updated_at_ms>this.lastSync);for(const a of r){if(a.deleted&&!this.includeSoftDeletes)continue;const o={source:"demo-db",table:a.table,op:a.deleted?"d":a.version>1?"u":"c",pk:{id:a.id},before:null,after:a.deleted?null:a.data,ts_ms:a.updated_at_ms,tx:{id:`tx-${a.updated_at_ms}`,lsn:null,index:0,total:1,last:!0},seq:++this.seq,meta:{method:"polling"}};this.bus.emit(o)}this.lastSync=e}}class Ja extends zs{constructor(){super(...arguments),this.name="trigger",this.table=new Map,this.audit=[],this.extractOffset=0,this.extractIntervalMs=500,this.lastExtract=0,this.triggerOverheadMs=5}configure(e){e.extract_interval_ms!==void 0&&(this.extractIntervalMs=e.extract_interval_ms),e.trigger_overhead_ms!==void 0&&(this.triggerOverheadMs=e.trigger_overhead_ms)}reset(e){super.reset(e),this.table.clear(),this.audit=[],this.extractOffset=0,this.lastExtract=0}applySourceOp(e){const r=e.t+this.triggerOverheadMs,a=e.txn??{id:`tx-${r}`,index:0,total:1,last:!0},o=a.id??`tx-${r}`,u=typeof a.index=="number"?a.index:0,h=typeof a.total=="number"?a.total:1,p=typeof a.last=="boolean"?a.last:u>=h-1;if(e.op==="insert")this.table.set(e.pk.id,{id:e.pk.id,table:e.table,data:e.after,version:1,updated_at_ms:r,deleted:!1}),this.audit.push({audit_id:Ds(),op:"c",pk:e.pk,before:null,after:e.after,tx_id:o,tx_index:u,tx_total:h,tx_last:p,table:e.table,commit_ts_ms:r});else if(e.op==="update"){const E=this.table.get(e.pk.id),L=E?{...E.data}:null,j=E?{...E.data,...e.after}:e.after;this.table.set(e.pk.id,{id:e.pk.id,table:E?.table??e.table,data:j,version:(E?.version??0)+1,updated_at_ms:r,deleted:!1}),this.audit.push({audit_id:Ds(),op:"u",pk:e.pk,before:L,after:j,tx_id:o,tx_index:u,tx_total:h,tx_last:p,table:e.table,commit_ts_ms:r})}else if(e.op==="delete"){const E=this.table.get(e.pk.id)||{id:e.pk.id,table:e.table,data:{},version:0,updated_at_ms:r,deleted:!0};this.table.set(e.pk.id,{...E,deleted:!0,updated_at_ms:r}),this.audit.push({audit_id:Ds(),op:"d",pk:e.pk,before:E?E.data:null,after:null,tx_id:o,tx_index:u,tx_total:h,tx_last:p,table:e.table,commit_ts_ms:r})}}tick(e){if(e-this.lastExtract<this.extractIntervalMs)return;const r=this.audit.slice(this.extractOffset);for(const a of r){const o={source:"demo-db",table:a.table,op:a.op,pk:a.pk,before:a.before,after:a.after,ts_ms:a.commit_ts_ms,tx:{id:a.tx_id,lsn:null,index:a.tx_index,total:a.tx_total,last:a.tx_last},seq:++this.seq,meta:{method:"trigger"}};this.bus.emit(o)}this.extractOffset=this.audit.length,this.lastExtract=e}}function Ds(){return Math.random().toString(36).slice(2)}class Ya extends zs{constructor(){super(...arguments),this.name="log",this.table=new Map,this.wal=[],this.lsn=0,this.fetchIntervalMs=100,this.lastFetch=0}configure(e){e.fetch_interval_ms!==void 0&&(this.fetchIntervalMs=e.fetch_interval_ms)}reset(e){super.reset(e),this.table.clear(),this.wal=[],this.lsn=0,this.lastFetch=0}applySourceOp(e){const r=e.txn??{id:`tx-${e.t}`,index:0,total:1,last:!0},a=r.id??`tx-${e.t}`,o=typeof r.index=="number"?r.index:0,u=typeof r.total=="number"?r.total:1,h=typeof r.last=="boolean"?r.last:o>=u-1;if(e.op==="insert")this.table.set(e.pk.id,{id:e.pk.id,table:e.table,data:e.after,version:1,updated_at_ms:e.t,deleted:!1}),this.wal.push({lsn:++this.lsn,tx_id:a,tx_index:o,tx_total:u,tx_last:h,table:e.table,op:"c",pk:e.pk,before:null,after:e.after,commit_ts_ms:e.t});else if(e.op==="update"){const p=this.table.get(e.pk.id),E=p?{...p.data}:null,L=p?{...p.data,...e.after}:e.after;this.table.set(e.pk.id,{id:e.pk.id,table:p?.table??e.table,data:L,version:(p?.version??0)+1,updated_at_ms:e.t,deleted:!1}),this.wal.push({lsn:++this.lsn,tx_id:a,tx_index:o,tx_total:u,tx_last:h,table:e.table,op:"u",pk:e.pk,before:E,after:L,commit_ts_ms:e.t})}else if(e.op==="delete"){const p=this.table.get(e.pk.id);this.table.delete(e.pk.id),this.wal.push({lsn:++this.lsn,tx_id:a,tx_index:o,tx_total:u,tx_last:h,table:e.table,op:"d",pk:e.pk,before:p?p.data:null,after:null,commit_ts_ms:e.t})}}tick(e){if(e-this.lastFetch<this.fetchIntervalMs)return;const r=this.wal.slice(this.seq);for(const a of r){const o={source:"demo-db",table:a.table,op:a.op,pk:a.pk,before:a.before,after:a.after,ts_ms:a.commit_ts_ms,tx:{id:a.tx_id,lsn:a.lsn,index:a.tx_index,total:a.tx_total,last:a.tx_last},seq:++this.seq,meta:{method:"log"}};this.bus.emit(o)}this.lastFetch=e}}class ar{constructor(){this.scenario=null,this.engines=[],this.idx=0,this.now=0,this.playing=!1}attach(e){this.engines=e}load(e){this.scenario=e,this.idx=0,this.now=0,this.playing=!1}reset(e){this.engines.forEach(r=>r.reset(e)),this.idx=0,this.now=0}onTick(e){this.onTickCb=e}start(){this.playing=!0}pause(){this.playing=!1}tick(e){if(!this.playing||!this.scenario)return;this.now+=e;const{ops:r}=this.scenario;for(;this.idx<r.length&&r[this.idx].t<=this.now;){const a=r[this.idx++];this.engines.forEach(o=>o.applySourceOp(a))}this.engines.forEach(a=>a.tick(this.now)),this.onTickCb?.(this.now)}}const Xa=new Set(["c","u","d"]);function Za(t){switch(t.op){case"insert":return"c";case"update":return"u";case"delete":return"d";default:return null}}function ei(t){return t.map((e,r)=>{const a=Za(e);if(!a)return null;const o=e.pk?.id!=null?String(e.pk.id):"";return{key:`${a}::${o}`,op:a,pk:o,index:r,time:e.t}}).filter(e=>!!e)}function ti(t){return t.map((e,r)=>{if(!Xa.has(e.op))return null;const a=e.pk?.id!=null?String(e.pk.id):"",o=e.op;return{key:`${o}::${a}`,op:o,pk:a,index:r,time:e.ts_ms}}).filter(e=>!!e)}function Un(t){const e=new Map;for(const r of t){const a=e.get(r.key);a?a.push(r):e.set(r.key,[r])}return e}function si(t,e){const r=[],a=[],o=[],u=Un(t),h=Un(e),p=new Set([...u.keys(),...h.keys()]);for(const E of p){const L=u.get(E)??[],j=h.get(E)??[],v=Math.min(L.length,j.length);for(let x=0;x<v;x++){const C=L[x],d=j[x];r.push({expected:C,actual:d,lagMs:Math.max(0,d.time-C.time)})}for(let x=v;x<L.length;x++)a.push(L[x]);for(let x=v;x<j.length;x++)o.push(j[x])}return{matched:r,missing:a,extra:o}}function ni(t){const e=[],r=[...t].sort((o,u)=>o.actual.index-u.actual.index);let a=-1/0;for(const o of r)o.expected.index<a?e.push({type:"ordering",op:o.expected.op,pk:o.expected.pk,expectedIndex:o.expected.index,actualIndex:o.actual.index,expectedTime:o.expected.time,actualTime:o.actual.time}):a=o.expected.index;return e}function ri(t){return t.filter(e=>e.lagMs>0).sort((e,r)=>r.lagMs-e.lagMs).slice(0,5).map(e=>({op:e.expected.op,pk:e.expected.pk,expectedTime:e.expected.time,actualTime:e.actual.time,lagMs:e.lagMs}))}function ai(t,e,r){const a=ei(e),o=ti(r),{matched:u,missing:h,extra:p}=si(a,o),E=[];for(const v of h)E.push({type:"missing",op:v.op,pk:v.pk,expectedIndex:v.index,expectedTime:v.time});for(const v of p)E.push({type:"extra",op:v.op,pk:v.pk,actualIndex:v.index,actualTime:v.time});E.push(...ni(u));const L=ri(u),j=L.reduce((v,x)=>Math.max(v,x.lagMs),0);return{method:t,totals:{missing:E.filter(v=>v.type==="missing").length,extra:E.filter(v=>v.type==="extra").length,ordering:E.filter(v=>v.type==="ordering").length},issues:E,lag:{max:j,samples:L}}}const ii=`# Harness Nightly History

Run \`GITHUB_TOKEN=... npm run harness:history\` to refresh this summary. The script aggregates the latest Harness Nightly artifacts and records table-level parity results here so the app can surface them inline.

| Run | Date | Conclusion | Events | Missing | Extra | Max Lag (ms) | Tables | Mismatches |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| _No runs captured yet._ |   |   |   |   |   |   |   |   |

`,oi="workspace",li=t=>({...t}),ci=t=>!Array.isArray(t)||t.length===0?[{name:"id",type:"string",pk:!0}]:t.filter(e=>e&&typeof e.name=="string").map(e=>{const r={name:e.name,type:"string",pk:!!e.pk},a=e.type;if(typeof a=="string"){const o=a.toLowerCase();o==="number"||o==="bool"||o==="timestamp"?r.type=o:o==="string"&&(r.type="string")}return typeof e.nullable=="boolean"&&(r.nullable=e.nullable),r}),di=t=>t.type?String(t.type).toLowerCase():"string",ui=t=>{const e=t.find(r=>r.pk);return e?.name?e.name:"id"},Bn=(t,e,r)=>Array.isArray(r)&&r.length>0?r.reduce((a,o)=>(o===e||Object.prototype.hasOwnProperty.call(t,o)&&(a[o]=t[o]),a),{}):Object.entries(t).reduce((a,[o,u])=>(o===e||(a[o]=u),a),{}),qn=(t,e,r,a)=>{const o=di(t);if(o==="number"){const h=e.seq*10+r;return typeof a=="number"?a+1:h}if(o==="bool"||o==="boolean")return typeof a=="boolean"?!a:r%2===0;if(o==="timestamp")return e.logicalTime+r+1;const u=`${e.seq}_${r}_${e.opCounter}`;return`${t.name}_${u}`},hi=(t,e={})=>{const r=ci(t.schema),a=ui(r),o=new Map;(Array.isArray(t.rows)?t.rows:[]).forEach(E=>{if(!E||typeof E!="object")return;const L=E,j=L[a]??L.id;if(j==null)return;const v=String(j),x={};Object.entries(L).forEach(([C,d])=>{if(C===a){x[C]=String(d);return}C==="id"&&a!=="id"||(x[C]=d)}),Object.prototype.hasOwnProperty.call(x,a)||(x[a]=v),o.set(v,x)});const h=Array.isArray(t.ops)?t.ops.reduce((E,L)=>Math.max(E,L?.t??0),0):0;return{table:typeof t.table=="string"&&t.table.trim().length?t.table:e.fallbackTable??oi,columns:r,pkField:a,rows:o,logicalTime:h,seq:o.size+1,opCounter:0}},pi=(t,e,r)=>{const a=Math.max(1,Math.floor(e)||1),o=Array.from(t.rows.keys()),u=t.columns.filter(j=>j.name!==t.pkField);let h="insert";if(o.length>0&&u.length>0){const j=t.opCounter%6;(j===0||j===4)&&o.length>1?h="delete":j===1||j===2||j===3?h="update":h="insert"}else o.length>1&&u.length===0&&(h=t.opCounter%3===0?"delete":"insert");const p=t.opCounter;t.opCounter+=1;const E=Math.max(t.logicalTime,r);t.logicalTime=E+a;const L=t.logicalTime;if(h==="insert"){const j=`gen-${t.seq++}`,v={[t.pkField]:j};u.forEach((d,m)=>{v[d.name]=qn(d,t,m)}),t.rows.set(j,v);const x=Bn(v,t.pkField);return{op:{t:L,op:"insert",table:t.table,pk:{id:j},after:x},kind:h}}if(h==="update"&&o.length>0&&u.length>0){const j=p%o.length,v=o[j],x=t.rows.get(v);if(!x)return null;const C=u[p%u.length],d=qn(C,t,p,x[C.name]),m=li(x);m[C.name]=d,t.rows.set(v,m);const b=Bn(m,t.pkField,[C.name]);return{op:{t:L,op:"update",table:t.table,pk:{id:v},after:b},kind:h}}if(h==="delete"&&o.length>0){const j=p%o.length,v=o[j];return t.rows.delete(v),{op:{t:L,op:"delete",table:t.table,pk:{id:v}},kind:h}}return null};function z(t,e={},r={}){if(typeof window>"u")return;const a=window.telemetry;!a||typeof a.track!="function"||a.track(t,e,r)}function Lt(t,e={}){z("comparator.clock.control",{action:t,...e})}function mi({onDiffDetailsOpened:t,...e}){const r=a=>{t?.(a),z("comparator.diff.opened",{method:a.method,issues:a.issueCount,maxLag:a.maxLag,scenario:a.scenario})};return n.jsx(Sa,{...e,onDiffDetailsOpened:r})}function gi({preset:t,topicExample:e,methods:r}){return n.jsxs("section",{className:"sim-shell__preset-guidance","aria-label":"Vendor preset guidance and quick tips",children:[n.jsxs("div",{className:"sim-shell__preset-guidance-header",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"sim-shell__subtitle",children:"Pipeline blueprint"}),n.jsx("p",{className:"sim-shell__description sim-shell__description--subtle",children:t.description}),n.jsxs("div",{className:"sim-shell__preset-row sim-shell__preset-row--compact",role:"list","aria-label":"Preset pipeline",children:[n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":t.sourceTooltip,role:"listitem",children:["Source · ",t.sourceLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":t.logTooltip,role:"listitem",children:["Capture · ",t.logLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":t.busTooltip,role:"listitem",children:["Transport · ",t.busLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":t.destinationTooltip,role:"listitem",children:["Sink · ",t.destinationLabel]})]})]}),n.jsxs("div",{className:"sim-shell__preset-meta-cards","aria-label":"Preset quick facts",children:[n.jsxs("div",{className:"sim-shell__preset-meta-card",children:[n.jsx("p",{className:"sim-shell__preset-meta-label",children:"Topic example"}),n.jsx("code",{className:"sim-shell__preset-topic","aria-label":"Example transport topic or namespace",children:e})]}),n.jsxs("div",{className:"sim-shell__preset-meta-card",children:[n.jsx("p",{className:"sim-shell__preset-meta-label",children:"Docs"}),t.docsHint?n.jsx("a",{className:"sim-shell__preset-docs",href:t.docsHint,target:"_blank",rel:"noopener noreferrer",children:"Open preset reference"}):n.jsx("span",{className:"sim-shell__preset-meta-placeholder",children:"No reference link provided"})]})]})]}),n.jsx("div",{className:"sim-shell__method-guidance",role:"list","aria-label":"Method-specific guidance",children:r.map(a=>n.jsxs("article",{className:"sim-shell__method-card","data-active":a.active?"true":"false",role:"listitem",children:[n.jsxs("header",{className:"sim-shell__method-card-header",children:[n.jsxs("div",{className:"sim-shell__method-card-titles",children:[n.jsx("p",{className:"sim-shell__method-name",children:a.label}),n.jsx("p",{className:"sim-shell__method-lane",children:a.laneDescription})]}),n.jsx("span",{className:"sim-shell__method-state","aria-live":"polite",children:a.active?"Active":"Off"})]}),n.jsxs("p",{className:"sim-shell__method-card-line",children:[n.jsx("strong",{children:"Use when:"})," ",a.whenToUse]}),n.jsxs("p",{className:"sim-shell__method-card-line sim-shell__method-card-line--callout",role:"note",children:[n.jsx("strong",{children:"Watch for:"})," ",a.callout]})]},a.id))})]})}function fi({guidance:t}){return!t.controls.length&&!t.observations.length?null:n.jsxs("section",{className:"sim-shell__scenario-guidance","aria-label":"Scenario guardrails and teaching tips",children:[n.jsx("header",{className:"sim-shell__scenario-guidance-header",children:n.jsxs("div",{children:[n.jsx("p",{className:"sim-shell__subtitle",children:"Scenario guardrails"}),t.summary?n.jsx("p",{className:"sim-shell__description sim-shell__description--meta",children:t.summary}):null]})}),n.jsxs("div",{className:"sim-shell__scenario-guidance-grid",role:"list",children:[t.controls.length?n.jsxs("article",{className:"sim-shell__scenario-guidance-card",role:"listitem",children:[n.jsx("h4",{children:"Recommended controls"}),n.jsx("ul",{children:t.controls.map(e=>n.jsxs("li",{children:[n.jsxs("strong",{children:[e.title,"."]})," ",e.detail]},e.title))})]}):null,t.observations.length?n.jsxs("article",{className:"sim-shell__scenario-guidance-card",role:"listitem",children:[n.jsx("h4",{children:"What to observe"}),n.jsx("ul",{children:t.observations.map(e=>n.jsxs("li",{children:[n.jsxs("strong",{children:[e.title,"."]})," ",e.detail]},e.title))})]}):null]})]})}const bi=[{id:"polling",label:"Polling"},{id:"trigger",label:"Trigger"},{id:"log",label:"Log"}],xi=400,_i=5,yi=500,vi=120,wi=120,Si=t=>t.map(e=>({...e,pk:e.pk?{...e.pk}:void 0,after:e.after?{...e.after}:void 0,txn:e.txn?{...e.txn}:void 0}));function ji({scenarios:t,autoStart:e=!1}){const[r,a]=l.useState(()=>t[0]?.id??""),o=l.useMemo(()=>t.find(U=>U.id===r)??t[0],[r,t]),[u,h]=l.useState(!1),[p,E]=l.useState(wi),[L,j]=l.useState(xi),[v,x]=l.useState(_i),[C,d]=l.useState(yi),[m,b]=l.useState(vi),[y,M]=l.useState(0),[T,O]=l.useState({polling:[],trigger:[],log:[]}),F=l.useRef(null),Z=l.useRef(null),V=l.useRef([]),de=l.useCallback(()=>{Z.current!=null&&(window.clearInterval(Z.current),Z.current=null)},[]),N=()=>{O({polling:[],trigger:[],log:[]})};l.useEffect(()=>{if(de(),h(!1),V.current.forEach(te=>te()),V.current=[],!o)return;const U=new Qa;U.configure({poll_interval_ms:L,include_soft_deletes:!0});const S=new Ja;S.configure({extract_interval_ms:C,trigger_overhead_ms:v});const H=new Ya;H.configure({fetch_interval_ms:m});const Q=new ar;return Q.attach([U,S,H]),Q.load({...o,ops:Si(o.ops)}),Q.reset(o.seed),Q.onTick(te=>M(te)),N(),M(0),V.current.push(U.onEvent(te=>O(Y=>({...Y,polling:[...Y.polling,te].slice(-40)})))),V.current.push(S.onEvent(te=>O(Y=>({...Y,trigger:[...Y.trigger,te].slice(-40)})))),V.current.push(H.onEvent(te=>O(Y=>({...Y,log:[...Y.log,te].slice(-40)})))),F.current=Q,e&&(de(),Q.start(),h(!0),Z.current=window.setInterval(()=>{Q.tick(p)},p)),()=>{de(),V.current.forEach(te=>te()),V.current=[]}},[o,L,C,v,m,e,p]);const je=()=>{F.current&&(de(),F.current.start(),h(!0),Z.current=window.setInterval(()=>{F.current?.tick(p)},p))},Ee=()=>{F.current?.pause(),h(!1),de()},Ce=()=>{F.current?.reset(o?.seed??0),N(),M(0)},ke=()=>{const U=F.current;if(!U)return;const S=u;U.start(),U.tick(p),S||U.pause()};return l.useEffect(()=>()=>de(),[de]),o?n.jsxs("section",{className:"sim-core","aria-label":"Playground core lanes",children:[n.jsxs("header",{className:"sim-core__toolbar","aria-label":"Core controls",children:[n.jsxs("div",{className:"sim-core__toolbar-row",children:[n.jsxs("div",{className:"sim-core__toolbar-group",children:[n.jsxs("label",{children:[n.jsx("span",{className:"sim-core__label",children:"Scenario"}),n.jsx("select",{value:r,onChange:U=>a(U.target.value),children:t.map(U=>n.jsx("option",{value:U.id,children:U.label},U.id))})]}),n.jsxs("label",{children:[n.jsx("span",{className:"sim-core__label",children:"Tick"}),n.jsx("input",{type:"range",min:50,max:500,step:10,value:p,onChange:U=>E(Number(U.target.value))}),n.jsxs("span",{className:"sim-core__value",children:[p,"ms"]})]})]}),n.jsxs("div",{className:"sim-core__toolbar-group",children:[n.jsx("button",{type:"button",onClick:u?Ee:je,children:u?"Pause":"Play"}),n.jsx("button",{type:"button",onClick:ke,"aria-label":"Step",children:"Step"}),n.jsx("button",{type:"button",onClick:Ce,"aria-label":"Reset",children:"Reset"})]})]}),n.jsxs("div",{className:"sim-core__toolbar-row",children:[n.jsxs("label",{children:[n.jsx("span",{className:"sim-core__label",children:"Polling interval"}),n.jsx("input",{type:"range",min:100,max:1500,step:50,value:L,onChange:U=>j(Number(U.target.value))}),n.jsxs("span",{className:"sim-core__value",children:[L,"ms"]})]}),n.jsxs("label",{children:[n.jsx("span",{className:"sim-core__label",children:"Trigger overhead"}),n.jsx("input",{type:"range",min:0,max:30,step:1,value:v,onChange:U=>x(Number(U.target.value))}),n.jsxs("span",{className:"sim-core__value",children:[v,"ms"]})]}),n.jsxs("label",{children:[n.jsx("span",{className:"sim-core__label",children:"Trigger extract"}),n.jsx("input",{type:"range",min:100,max:1500,step:50,value:C,onChange:U=>d(Number(U.target.value))}),n.jsxs("span",{className:"sim-core__value",children:[C,"ms"]})]}),n.jsxs("label",{children:[n.jsx("span",{className:"sim-core__label",children:"Log fetch"}),n.jsx("input",{type:"range",min:50,max:800,step:10,value:m,onChange:U=>b(Number(U.target.value))}),n.jsxs("span",{className:"sim-core__value",children:[m,"ms"]})]}),n.jsxs("div",{className:"sim-core__clock","aria-live":"polite",children:["Clock: ",y,"ms"]})]})]}),n.jsx("div",{className:"sim-core__lanes",role:"list","aria-label":"CDC lanes",children:bi.map(U=>{const S=T[U.id]??[];return n.jsxs("article",{className:"sim-core__lane",role:"listitem",children:[n.jsxs("header",{className:"sim-core__lane-header",children:[n.jsxs("div",{children:[n.jsx("p",{className:"sim-core__lane-title",children:U.label}),n.jsxs("p",{className:"sim-core__lane-subtitle",children:[U.id," lane"]})]}),n.jsxs("div",{className:"sim-core__lane-count","data-testid":`${U.id}-event-count`,children:[S.length," events"]})]}),n.jsxs("ol",{className:"sim-core__lane-events","aria-label":`${U.label} events`,children:[S.length===0?n.jsx("li",{className:"sim-core__empty",children:"Waiting for events…"}):null,S.map(H=>n.jsxs("li",{className:"sim-core__event",children:[n.jsx("span",{className:`sim-core__event-op sim-core__event-op--${H.op}`,children:H.op.toUpperCase()}),n.jsx("span",{className:"sim-core__event-table",children:H.table}),n.jsxs("span",{className:"sim-core__event-pk",children:["pk=",String(H.pk?.id??"unknown")]}),n.jsxs("span",{className:"sim-core__event-time",children:[H.ts_ms,"ms"]})]},`${H.seq}-${H.pk?.id??"unknown"}`))]})]},U.id)})})]}):null}function Ei(t){const e={...t};return t.pk&&(e.pk={...t.pk}),t.after&&(e.after={...t.after}),t.txn&&(e.txn={...t.txn}),e}function Ci(t){if(t==null)return t;try{return JSON.parse(JSON.stringify(t))}catch{return t}}function ki(t){return{id:t.id,name:t.name,label:t.label,description:t.description,highlight:t.highlight,stats:{rows:t.rows.length,ops:t.ops.length},table:t.table,tags:[...t.tags],schema:t.schema.length?t.schema.map(e=>({...e})):void 0,rows:t.rows.length?t.rows.map(e=>({...e})):void 0,events:t.events.length?t.events.map(e=>({...e})):void 0,schemaVersion:t.schemaVersion,seed:t.seed,ops:t.ops.map(Ei),comparator:t.comparator?Ci(t.comparator):null}}const ir=zr;ir.length===0&&typeof console<"u"&&console.warn("No scenario templates were loaded from assets/shared-scenarios.js; the comparator scenario gallery will be empty.");const Mt=ir.map(ki),or={polling:{label:"Polling (Query)",laneDescription:"Simple, but lossy. Periodic scans read current state only; hard deletes and mid-poll updates can disappear.",callout:"Polling reads current state only. Hard deletes and intermediate updates are not captured.",whenToUse:"Simple, but lossy. Periodic scans read current state only. Hard deletes and intermediate updates between polls are not observable. Good for small, non-critical syncs where some lag and loss is acceptable."},trigger:{label:"Trigger (Audit)",laneDescription:"Complete, but intrusive. Database triggers write to an audit table and add synchronous source overhead.",callout:"Triggers add write overhead to source transactions.",whenToUse:"Complete, but intrusive. Triggers capture every change into an audit table, but add write latency and operational overhead on the source. Use when log access isn’t available."},log:{label:"Log (WAL)",laneDescription:"Default choice. Streams the transaction log post-commit for ordered, low-latency change events.",callout:"Log-based CDC is the preferred default when available.",whenToUse:"Default choice. Reads the database’s transaction log post-commit. Lowest source impact, complete and ordered changes, near-real-time. Requires connector setup and ops discipline."}};typeof window<"u"&&(window.CDC_METHOD_COPY=or);const Xe="workspace-live",lr="cdc_comparator_prefs_v1",Ze={name:"priority_flag",type:"bool"},Li=()=>{if(typeof window>"u")return null;try{return window.localStorage}catch{return null}},Ks=(()=>{let t=null,e=null;return()=>{const r=Li();return(!t||r!==e)&&(t=Ba(r),e=r),t}})();function Mi(t,e,r,a){if(r.length===0)return 0;const o=t[e]?.metrics.writeAmplification;if(typeof o=="number"&&o>=0)return o;const u=a.ops.filter(h=>h.table===r[0]?.table);return u.length?r.length/u.length:r.length}function Ti(t){return!Number.isFinite(t)||t<=0?null:{key:"write-amplification",text:`${t.toFixed(1)}x write amplification`,tone:"amplification"}}const ft=["polling","trigger","log"],cr=2,Ue=100,dr=10,ur=300,Vs=120,Ni=10,hr=10,pr=600,mr=120,Gs=10,$s=40,Ai=5,Yt=32,nt=["c","u","d","s"],Wn="MYSQL_DEBEZIUM";function as(t){return typeof t=="string"&&Object.prototype.hasOwnProperty.call(ts,t)}const Ii=t=>t?{columns:[...t.columns],rows:t.rows.map(e=>({id:e.id,displayId:e.displayId,table:e.table,values:{...e.values}})),schemaVersion:t.schemaVersion,hasSchemaColumn:t.hasSchemaColumn}:null,be=t=>{if(t==null)return t;try{return JSON.parse(JSON.stringify(t))}catch{return null}},Oi=t=>{if(!t)return null;const e=t.methodCopyOverrides?be(t.methodCopyOverrides)??void 0:void 0;return{id:t.id,label:t.label,description:t.description,docsHint:t.docsHint,sourceLabel:t.sourceLabel,sourceTooltip:t.sourceTooltip,logLabel:t.logLabel,logTooltip:t.logTooltip,busLabel:t.busLabel,busTooltip:t.busTooltip,destinationLabel:t.destinationLabel,destinationTooltip:t.destinationTooltip,methodCopyOverrides:e}};function Ri(t,e,r,a,o,u,h,p){const E=be(t),L=e?be(e):null,j=be(r)??[],v=h?be(h):null,x=Array.from(a.values()).map(d=>be(d)).filter(d=>!!d),C=p.map(d=>{const m=be(d.metrics);return m?{method:d.method,eventCount:d.events.length,metrics:m}:null}).filter(d=>!!d);return{preferences:E,summary:L,analytics:j,diffs:x,tags:[...o],preset:Oi(u),overlay:v,lanes:C}}function Vn(t){return t?!!(t.preferences&&Object.keys(t.preferences).length>0)||!!t.summary||(t.analytics?.length??0)>0||(t.diffs?.length??0)>0||(t.tags?.length??0)>0||!!t.preset||(t.overlay?.length??0)>0||(t.lanes?.length??0)>0:!1}const Di=or,ee=Yn,Ps=200,$i=2e3,Pi=6;function Fi(){if(typeof window>"u")return new Set;const e=window.cdcFeatureFlags?.all?.();if(Array.isArray(e)&&e.length)return new Set(e.map(String));const r=window.APPWRITE_CFG?.featureFlags;return Array.isArray(r)&&r.length?new Set(r.map(String)):new Set}const Ui={polling:{pollIntervalMs:500,includeSoftDeletes:!1},trigger:{extractIntervalMs:250,triggerOverheadMs:8},log:{fetchIntervalMs:50}},Bi={polling:"QUERY_BASED",trigger:"TRIGGER_BASED",log:"LOG_BASED"},qi={polling:"polling",trigger:"trigger",log:"log"},Gn=t=>{switch(t){case"polling":return sa();case"trigger":return aa();case"log":default:return ea()}},Hn=t=>{if(!t)return null;const e={...t};return delete e.__ts,e},Wi=t=>{if(t==null)return"—";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="number")return Number.isFinite(t)?t.toString():"—";if(t instanceof Date)return t.toISOString();if(typeof t=="object")try{return JSON.stringify(t)}catch{return"[object]"}return String(t)},Hs=(t,e,r)=>{const a=e.kind==="INSERT"?"c":e.kind==="UPDATE"?"u":e.kind==="DELETE"?"d":"s",o=e.schemaChange?{action:e.schemaChange.action,column:{name:e.schemaChange.column.name,type:e.schemaChange.column.type,nullable:e.schemaChange.column.nullable},previousVersion:e.schemaChange.previousVersion,nextVersion:e.schemaChange.nextVersion}:null,u=e.after?.id??e.before?.id??o?.column?.name??null,h=u!=null?String(u):"";return{source:"demo-db",table:e.table,op:a,pk:{id:h},before:Hn(e.before),after:Hn(e.after),ts_ms:e.commitTs,tx:{id:e.txnId??`tx-${e.commitTs}`,lsn:typeof e.offset=="number"?e.offset:null,index:typeof e.txnIndex=="number"?e.txnIndex:void 0,total:typeof e.txnTotal=="number"?e.txnTotal:void 0,last:typeof e.txnLast=="boolean"?e.txnLast:typeof e.txnTotal=="number"&&typeof e.txnIndex=="number"?e.txnIndex>=e.txnTotal-1:!0},seq:r,meta:{method:qi[t]},schemaChange:o}};function Vi(t,e){const r=new Qr,a=new Jr,o=new Yr,u=`cdc.${t}`;let h=Gn(t),p,E={bus:r,metrics:a,scheduler:o,topic:u},L={},j=0;const v=new Set,x=b=>{const y=b.__seq,M=typeof y=="number"&&y>0?y:++j;return b.__seq=M,{...Hs(t,b,M),offset:b.offset,topic:b.topic??u}},C=b=>y=>{const M=b(y);if(M.length){const T=M.map(O=>x(O));e(T),T.forEach(O=>v.forEach(F=>F(O)))}return M},d=()=>{h.initialise?.(E),h.configure?.(L),p=new Xr(Bi[t],r,o,a,u,{startSnapshot:(b,y)=>h.startSnapshot?.(b,M=>C(y)(M)),startTailing:b=>h.startTailing?.(y=>C(b)(y)),stop:()=>h.stop?.()}),p.startSnapshot([]),p.startTailing()};return d(),{name:t,configure(b){L={...b},h.configure?.(b)},reset(b){p.stop(),o.clear(),a.reset(),r.reset(u),j=0,h=Gn(t),E={bus:r,metrics:a,scheduler:o,topic:u},d()},applySourceOp(b){h.applySource?.(b)},applySchemaChange(b,y,M,T){const O=y==="add"?"ADD_COLUMN":"DROP_COLUMN";h.applySchemaChange?.(b,O,M,T)},tick(b){h.tick?.(b)},onEvent(b){return v.add(b),()=>v.delete(b)},bus:r,metrics:a,topic:u}}function Gi(t,e){return Vi(t,e)}function gt(t){return t.reduce((e,r)=>(e[r]=[],e),{})}function Hi(t){return{polling:{...t.polling},trigger:{...t.trigger},log:{...t.log}}}function Xt(t,e,r){let a=typeof t=="number"?t:Number(t);return Number.isFinite(a)?(typeof r=="number"&&(a=Math.max(r,a)),a):e}function Zt(t,e=Vs){if(typeof t!="number"||!Number.isFinite(t))return e;const r=Math.round(t);return Number.isFinite(r)?Math.min(ur,Math.max(dr,r)):e}function Fs(t,e=mr){if(typeof t!="number"||!Number.isFinite(t))return e;const r=Math.round(t/Gs)*Gs;return Number.isFinite(r)?Math.min(pr,Math.max(hr,r)):e}function Us(t,e=ft){const r=[...e];if(!Array.isArray(t))return r;const a=[];e.forEach(u=>{t.includes(u)&&!a.includes(u)&&a.push(u)});const o=Math.min(cr,e.length);return a.length>=o?a:r}function zn(t){const e=Array.from(nt);if(!Array.isArray(t)||t.length===0)return new Set(e);const r=[];return t.forEach(a=>{if(nt.includes(a)){const o=a;r.includes(o)||r.push(o)}}),r.length?new Set(r):new Set(e)}function es(t,e=ft){return typeof t=="string"&&e.includes(t)}function Kn(t){const e=Hi(Ui);return t&&(t.polling&&(t.polling.pollIntervalMs!=null&&(e.polling.pollIntervalMs=Xt(t.polling.pollIntervalMs,e.polling.pollIntervalMs,50)),t.polling.includeSoftDeletes!=null&&(e.polling.includeSoftDeletes=!!t.polling.includeSoftDeletes)),t.trigger&&(t.trigger.extractIntervalMs!=null&&(e.trigger.extractIntervalMs=Xt(t.trigger.extractIntervalMs,e.trigger.extractIntervalMs,50)),t.trigger.triggerOverheadMs!=null&&(e.trigger.triggerOverheadMs=Xt(t.trigger.triggerOverheadMs,e.trigger.triggerOverheadMs,0))),t.log&&t.log.fetchIntervalMs!=null&&(e.log.fetchIntervalMs=Xt(t.log.fetchIntervalMs,e.log.fetchIntervalMs,10))),e}function zi(){if(typeof window>"u")return null;try{const e=Ks().getItem(lr);if(!e)return null;const r=JSON.parse(e);return{scenarioId:typeof r.scenarioId=="string"?r.scenarioId:void 0,presetId:as(r.presetId)?r.presetId:void 0,activeMethods:Array.isArray(r.activeMethods)?r.activeMethods:void 0,methodConfig:r.methodConfig??void 0,userPinnedScenario:typeof r.userPinnedScenario=="boolean"?r.userPinnedScenario:void 0,showEventList:typeof r.showEventList=="boolean"?r.showEventList:void 0,eventOps:Array.isArray(r.eventOps)?r.eventOps:void 0,eventSearch:typeof r.eventSearch=="string"?r.eventSearch:void 0,eventLogTable:typeof r.eventLogTable=="string"?r.eventLogTable:void 0,eventLogTxn:typeof r.eventLogTxn=="string"?r.eventLogTxn:void 0,eventLogMethod:typeof r.eventLogMethod=="string"?r.eventLogMethod:void 0,eventLogOp:typeof r.eventLogOp=="string"?r.eventLogOp:void 0,applyOnCommit:typeof r.applyOnCommit=="boolean"?r.applyOnCommit:void 0,consumerRateEnabled:typeof r.consumerRateEnabled=="boolean"?r.consumerRateEnabled:void 0,consumerRateLimit:typeof r.consumerRateLimit=="number"?r.consumerRateLimit:void 0,generatorEnabled:typeof r.generatorEnabled=="boolean"?r.generatorEnabled:void 0,generatorRate:typeof r.generatorRate=="number"?r.generatorRate:void 0}}catch(t){return console.warn("Comparator prefs load failed",t),null}}function Ki(t){if(!(typeof window>"u"))try{Ks().setItem(lr,JSON.stringify(t))}catch(e){console.warn("Comparator prefs save failed",e)}}function Qi(t,e,r,a,o,u){const h=t.length?t[t.length-1]:null,p=h?Math.max(e-h.ts_ms,0):e,E=e>0?t.length/(e/1e3):0;let L=0,j=0,v=0,x=0;t.forEach(T=>{T.op==="c"?L+=1:T.op==="u"?j+=1:T.op==="d"&&(v+=1),T.schemaChange&&(x+=1)});const C=r.ops.filter(T=>T.op==="delete").length,d=u?.deletes??0,m=C+d,b=m===0?100:v/m*100,y=t.every((T,O)=>{if(O===0)return!0;const F=t[O-1];return T.ts_ms>=F.ts_ms});return{lagMs:p,throughput:E,deletesPct:b,orderingOk:y,consistent:y&&(a==="polling"?v===m:!0),writeAmplification:a==="trigger"?Mi(o,a,t,r)??0:void 0,insertCount:L,updateCount:j,deleteCount:v,schemaChangeCount:x}}function Ji(t){if(t.length===0)return null;const e=[...t].sort((v,x)=>v.metrics.lagMs-x.metrics.lagMs),r=e[0],a=e[e.length-1],o=a.metrics.lagMs-r.metrics.lagMs,u=[...t].sort((v,x)=>v.metrics.deletesPct-x.metrics.deletesPct),h=u[0],p=u[u.length-1],E=t.filter(v=>!v.metrics.orderingOk).map(v=>v.method),L=t.filter(v=>v.method==="trigger"&&Te(v.metrics.writeAmplification)),j=L.length?L.reduce((v,x)=>Te(v.metrics.writeAmplification)?Te(x.metrics.writeAmplification)&&x.metrics.writeAmplification>v.metrics.writeAmplification?x:v:x):null;return{bestLag:r,worstLag:a,lagSpread:o,lowestDeletes:h,highestDeletes:p,orderingIssues:E,triggerWriteAmplification:j}}function Yi(){const t=l.useRef(null);t.current===null&&(t.current=zi());const e=t.current||void 0,r=l.useMemo(()=>Ks(),[]),[a,o]=l.useState(()=>Fi()),u=a.size===0||a.has("ff_trigger_mode"),h=a.size===0||a.has("ff_schema_demo"),p=a.size===0||a.has("ff_multitable"),E=a.size===0||a.has("ff_metrics"),L=a.size===0||a.has("ff_walkthrough"),j=l.useMemo(()=>u?[...ft]:ft.filter(s=>s!=="trigger"),[u]),v=l.useMemo(()=>Us(e?.activeMethods,j),[j,e?.activeMethods]),x=Kn(e?.methodConfig),C=e?.presetId&&as(e.presetId)?e.presetId:Wn,d=es(e?.eventLogMethod,j)?e?.eventLogMethod:null,m=typeof e?.eventLogOp=="string"&&e.eventLogOp.trim()?e.eventLogOp.trim().toLowerCase():null,b=l.useMemo(()=>typeof window>"u"?{...is}:da(r),[r]),[y,M]=l.useState(null),[T,O]=l.useState(()=>e?.scenarioId??Mt[0].name),[F,Z]=l.useState(()=>b.query),[V,de]=l.useState(()=>b.tags),[N,je]=l.useState(()=>v),[Ee,Ce]=l.useState(()=>gt(v)),[ke,U]=l.useState(()=>gt(v)),[S,H]=l.useState(()=>({})),[Q,te]=l.useState(C),[Y,bt]=l.useState(0),[Be,Ne]=l.useState(!1),[he,ls]=l.useState(!1),[X,cs]=l.useState(()=>x),[xt,Nt]=l.useState(!1),[ve,_t]=l.useState(()=>e?.eventSearch??""),[Qs,ds]=l.useState(()=>zn(e?.eventOps)),[Ae,us]=l.useState(e?.showEventList??!0),[pe,qe]=l.useState(e?.eventLogTable??null),[ue,We]=l.useState(e?.eventLogTxn??""),[me,Ie]=l.useState(d),[ge,Oe]=l.useState(m),[le,At]=l.useState(e?.applyOnCommit??!1),[ne,hs]=l.useState(e?.consumerRateEnabled??!1),[ie,ps]=l.useState(()=>Zt(e?.consumerRateLimit,Vs)),[ce,ms]=l.useState(e?.generatorEnabled??!1),[oe,gs]=l.useState(()=>Fs(e?.generatorRate,mr)),Re=l.useRef({}),xe=l.useRef({}),rt=l.useRef({}),It=l.useRef(e?.consumerRateEnabled??!1?Zt(e?.consumerRateLimit,Vs):null),Ve=l.useRef(0),fs=l.useRef(null),yt=l.useRef(0),Js=l.useRef(oe),Ys=l.useRef(ce),vt=l.useRef({inserts:0,updates:0,deletes:0}),bs=l.useRef({}),Xs=l.useRef(N),Zs=l.useRef(Y),q=ts[Q]??ts[Wn],gr=l.useMemo(()=>Object.values(ts).map(s=>({id:s.id,label:s.label})),[]),I=l.useMemo(()=>{const s=q.methodCopyOverrides??{};return ft.reduce((i,c)=>{const f=Di[c],k=s[c];return i[c]={label:k?.label??f.label,laneDescription:k?.laneDescription??f.laneDescription,callout:k?.callout??f.callout,whenToUse:k?.whenToUse??f.whenToUse,tooltip:k?.tooltip??f.tooltip},i},{})},[q]),en=l.useMemo(()=>ft.reduce((s,i)=>{const c=I[i];return s[i]={label:c.label,tooltip:c.tooltip},s},{}),[I]),tn=l.useMemo(()=>new Set(V),[V]),sn=l.useMemo(()=>ga(Mt,{liveScenario:y??void 0,additionalTags:[V]}),[y,V]);l.useEffect(()=>{typeof window>"u"||ua({query:F,tags:V},r)},[F,V,r]);const De=l.useCallback((s,i)=>{if(typeof window>"u")return;const c=Bs({query:s,tags:i});window.dispatchEvent(new CustomEvent("cdc:scenario-filter",{detail:c}))},[]),Ot=l.useCallback(s=>{if(!s){ze.current=!1;return}if("userPinnedScenario"in s&&(ze.current=!!s.userPinnedScenario),s.activeMethods&&je(Us(s.activeMethods,j)),s.methodConfig&&cs(Kn(s.methodConfig)),s.scenarioId&&O(s.scenarioId),s.presetId&&as(s.presetId)&&te(s.presetId),"showEventList"in s&&typeof s.showEventList=="boolean"&&us(s.showEventList),"eventOps"in s&&ds(zn(s.eventOps)),"eventSearch"in s&&typeof s.eventSearch=="string"&&_t(s.eventSearch),"eventLogTable"in s){const i=typeof s.eventLogTable=="string"&&s.eventLogTable.trim().length>0?s.eventLogTable:null;qe(i)}if("eventLogTxn"in s&&We(typeof s.eventLogTxn=="string"?s.eventLogTxn:""),"eventLogMethod"in s){const i=es(s.eventLogMethod,j)?s.eventLogMethod:null;Ie(i)}if("eventLogOp"in s)if(typeof s.eventLogOp=="string"){const i=s.eventLogOp.trim().toLowerCase();Oe(i||null)}else Oe(null);"applyOnCommit"in s&&typeof s.applyOnCommit=="boolean"&&At(s.applyOnCommit),"consumerRateEnabled"in s&&typeof s.consumerRateEnabled=="boolean"&&hs(s.consumerRateEnabled),"consumerRateLimit"in s&&typeof s.consumerRateLimit=="number"&&ps(Zt(s.consumerRateLimit)),"generatorEnabled"in s&&typeof s.generatorEnabled=="boolean"&&ms(s.generatorEnabled),"generatorRate"in s&&typeof s.generatorRate=="number"&&gs(Fs(s.generatorRate))},[j,je,cs,O,te,us,ds,_t,qe,We,Ie,Oe,At,hs,ps,ms,gs]);l.useEffect(()=>{if(typeof window>"u")return;const s=()=>{De(F,V)};return window.addEventListener("cdc:scenario-filter-request",s),()=>{window.removeEventListener("cdc:scenario-filter-request",s)}},[De,F,V]);const Ge=l.useMemo(()=>Ha(ii),[]),at=l.useCallback(s=>{let i=rt.current[s];return i||(i=new Rs,rt.current[s]=i),i},[]),it=l.useCallback(s=>{fs.current=hi(s),yt.current=0,vt.current={inserts:0,updates:0,deletes:0}},[]),Rt=l.useCallback((s,i)=>{const c=fs.current;if(!c||s<=0)return;const f=Xs.current;if(!f.length)return;const k=bs.current;for(let _=0;_<s;_+=1){const w=pi(c,i,Zs.current);w&&(f.forEach(A=>{k[A]?.applySourceOp(w.op)}),w.kind==="insert"?vt.current.inserts+=1:w.kind==="update"?vt.current.updates+=1:w.kind==="delete"&&(vt.current.deletes+=1))}},[]),Dt=l.useCallback(s=>{if(!Ys.current||!fs.current)return;const i=Js.current;if(!Number.isFinite(i)||i<=0)return;yt.current+=i*s/1e3;const c=Math.floor(yt.current);if(c<=0)return;yt.current-=c;const f=c>0?s/c:s;Rt(c,f)},[Rt]),we=l.useCallback((s,i)=>{const c=Re.current[s];if(!c)return;const f=c.metrics.snapshot(),k=c.bus.size(c.topic);H(_=>({..._,[s]:{metrics:f,backlog:k,lastOffset:i?.lastOffset??_[s]?.lastOffset??-1}}))},[]),nn=l.useCallback((s,i)=>{i.length&&(U(c=>{const f={...c},k=f[s]??[];return f[s]=[...k,...i],f}),we(s,{lastOffset:i[i.length-1]?.offset??-1}))},[we]);l.useEffect(()=>{if(typeof window>"u")return;const s=i=>{if(!(i instanceof CustomEvent))return;const c=i.detail,f=Array.isArray(c)?c:[];o(new Set(f.map(String)))};return window.addEventListener("cdc:feature-flags",s),()=>{window.removeEventListener("cdc:feature-flags",s)}},[]);const $t=l.useCallback(s=>a.size===0?!0:a.has(s),[a]),ot=$t("ff_event_bus"),wt=$t("ff_pause_resume"),xs=$t("ff_query_slider"),_s=$t("ff_event_log");l.useEffect(()=>{je(s=>{const i=Us(s,j);return i.length===s.length&&i.every((c,f)=>c===s[f])?s:i})},[j]),l.useEffect(()=>{!p&&le&&At(!1)},[le,p]);const $e=l.useMemo(()=>Array.from(Qs).sort(),[Qs]),rn=l.useMemo(()=>new Set($e),[$e]),lt=l.useMemo(()=>ve.trim().toLowerCase().split(/\s+/).filter(Boolean),[ve]),an=l.useMemo(()=>lt.join("|"),[lt]),on=l.useRef(new WeakMap),Pt=l.useCallback(s=>{const i=new Set($e),c=i.size<nt.length,f=lt.length>0,k=on.current,_=new Map,w=A=>{const D=k.get(A);if(D)return D;const $=[String(A.seq??""),A.op,A.pk?.id??"",A.table??""];A.after&&$.push(...Object.values(A.after).map(P=>String(P??""))),A.before&&$.push(...Object.values(A.before).map(P=>String(P??"")));const B=$.join(" ").toLowerCase();return k.set(A,B),B};return N.forEach(A=>{const D=s[A]??[];if(!c&&!f){_.set(A,D);return}const $=D.filter(B=>{if(!i.has(B.op))return!1;if(!f)return!0;const P=w(B);return lt.every(W=>P.includes(W))});_.set(A,$)}),_},[N,$e,lt]),fr=l.useMemo(()=>Pt(Ee),[Pt,Ee,an]),ln=l.useMemo(()=>Pt(ke),[Pt,ke,an]),St=l.useMemo(()=>{const s=[],i=new Set,c=new Set,f=new Set;return N.forEach(k=>{(ln.get(k)??[]).forEach(w=>{const A=w.table??"";A&&i.add(A);const D=w.tx?.id??null;D&&c.add(D);const $=typeof w.op=="string"?w.op.trim().toLowerCase():"";$&&f.add($),s.push({method:k,event:w})})}),s.sort((k,_)=>{const w=k.event.offset??k.event.seq??0,A=_.event.offset??_.event.seq??0;return w!==A?w-A:(k.event.ts_ms??0)-(_.event.ts_ms??0)}),{events:s,tables:Array.from(i).sort(),txns:Array.from(c).sort(),ops:Array.from(f)}},[N,ln]),ys=St.events,Ft=St.tables,Ut=St.txns,vs=l.useMemo(()=>{const s=new Set(St.ops),i=nt.filter(f=>s.has(f)),c=Array.from(s).filter(f=>!nt.includes(f));return c.sort(),[...i,...c]},[St.ops]),ct=l.useMemo(()=>ys.filter(({method:s,event:i})=>{if(me&&s!==me||pe&&(i.table??"")!==pe||ue&&(i.tx?.id??"")!==ue)return!1;const c=typeof i.op=="string"?i.op.trim().toLowerCase():"";return!(ge&&c!==ge)}),[ys,me,ge,pe,ue]),br=l.useMemo(()=>ct.map(({method:s,event:i},c)=>{const f=typeof i.offset=="number"?i.offset:null,k=typeof i.seq=="number"?i.seq:null,_=typeof i.ts_ms=="number"?i.ts_ms:null,w=[s,f!=null?`offset-${f}`:null,k!=null?`seq-${k}`:null,_!=null?`ts-${_}`:null,c].filter(Boolean),A=i.pk?.id!=null?String(i.pk.id):null,D=i.schemaChange?n.jsxs("span",{className:"sim-shell__event-log-schema",children:[i.schemaChange.action==="ADD_COLUMN"?"Added":"Dropped"," column ",i.schemaChange.column.name,` · v${i.schemaChange.previousVersion}→v${i.schemaChange.nextVersion}`]}):void 0;return{id:w.length?w.join("|"):`${s}-${c}`,methodId:s,methodLabel:I[s].label,op:i.op??"",offset:f,topic:i.topic??null,table:i.table??null,tsMs:_,pk:A,txnId:i.tx?.id??null,before:i.before??null,after:i.after??null,meta:D}}),[ct,I]),xr=l.useMemo(()=>({methodId:me??void 0,op:ge??void 0,table:pe??void 0,txnId:ue||void 0}),[me,ge,pe,ue]),_r=l.useMemo(()=>({methods:j.map(s=>({id:s,label:I[s].label})),ops:vs,tables:Ft,txns:Ut}),[Ft,Ut,j,I]),Le=l.useMemo(()=>{const s=new Map;return N.forEach(i=>{const f=at(i).snapshot(),k=["table","id"],_=new Set(k);let w=1;f.forEach($=>{w=Math.max(w,$.schema?.version??1),$.schema?.columns.forEach(B=>{if(!B)return;const P=B.name;!P||P==="id"||P.startsWith("__")||_.has(P)||(_.add(P),k.push(P))})}),f.forEach($=>{$.rows.forEach(B=>{Object.keys(B).forEach(P=>{P==="id"||P.startsWith("__")||_.has(P)||(_.add(P),k.push(P))})})});const A=f.flatMap($=>$.rows.map(B=>{const P=String(B.id),W={};return k.forEach(G=>{if(G==="table"||G==="id"||G.startsWith("__"))return;const se=B[G];W[G]=se??null}),{id:`${$.name}::${P}`,displayId:P,table:$.name,values:W}})).sort(($,B)=>$.id.localeCompare(B.id,void 0,{numeric:!0,sensitivity:"base"})),D=_.has(Ze.name);s.set(i,{columns:k,rows:A,schemaVersion:w,hasSchemaColumn:D})}),s},[N,at,Ee]),He=l.useRef(new Map),cn=l.useRef(Be),Bt=l.useRef(0),ws=l.useCallback(s=>{const i=He.current;i.has(s)||i.set(s,[]);const c=i.get(s),f=at(s).snapshot().reduce((_,w)=>_+w.rows.length,0),k=c[c.length-1];(c.length===0||k!==f)&&(c.push(f),c.length>Yt&&c.splice(0,c.length-Yt))},[at]);l.useEffect(()=>{const s=He.current,i=new Set(N);for(const c of Array.from(s.keys()))i.has(c)||s.delete(c);N.forEach(c=>{s.has(c)||s.set(c,[]);const k=Le.get(c)?.rows.length??0,_=s.get(c);if(!_)return;const w=_[_.length-1];(_.length===0||w!==k)&&(_.push(k),_.length>Yt&&_.splice(0,_.length-Yt))})},[N,Le]),l.useEffect(()=>{me&&!N.includes(me)&&Ie(null)},[N,me]),l.useEffect(()=>{pe&&!Ft.includes(pe)&&qe(null)},[Ft,pe]),l.useEffect(()=>{ge&&!vs.includes(ge)&&Oe(null)},[vs,ge]),l.useEffect(()=>{ue&&!Ut.includes(ue)&&We("")},[Ut,ue]),l.useEffect(()=>{Xs.current=N},[N]),l.useEffect(()=>{Zs.current=Y},[Y]),l.useEffect(()=>{Ys.current=ce,ce||(yt.current=0)},[ce]),l.useEffect(()=>{Js.current=oe},[oe]);const ze=l.useRef(e?.userPinnedScenario??!1),Ss=l.useRef(null),Me=l.useMemo(()=>ma(Mt,{liveScenario:y??void 0,liveScenarioName:Xe,query:F,tags:V}),[y,F,V]),g=l.useMemo(()=>Me.length?Me.find(s=>s.name===T)??Me[0]:Mt[0],[T,Me]),dn=l.useMemo(()=>ba(g.name),[g.name]),js=l.useMemo(()=>{const s=g.table??g.ops.find(i=>i.table)?.table??"table";try{return q.topicFormat(s)}catch{return s}},[q,g]);l.useEffect(()=>{it(g)},[g,it]),l.useEffect(()=>{const s=g.comparator?.preferences;if(!s||typeof s!="object"){Ss.current=null;return}Ss.current!==g.name&&(Ot(s),Ss.current=g.name)},[Ot,g]);const qt=l.useMemo(()=>{const s=new Map;return N.forEach(i=>{const c=Le.get(i);s.set(i,{present:c?.hasSchemaColumn??!1,version:c?.schemaVersion??1})}),s},[N,Le]),jt=l.useMemo(()=>N.length>0?N.every(s=>qt.get(s)?.present??!1):!1,[N,qt]),Ke=l.useMemo(()=>{let s=1;return N.forEach(i=>{const c=qt.get(i);c&&c.version>s&&(s=c.version)}),s},[N,qt]),dt=l.useMemo(()=>!!g.tags?.includes("schema"),[g.tags]),un=l.useMemo(()=>{if(!dt)return null;const s=`v${Ke}`;return jt?`${s} · column present`:`${s} · column absent`},[jt,Ke,dt]);l.useEffect(()=>{Bt.current=0},[g.name]);const Es=l.useMemo(()=>g.table?g.table:g.ops.find(i=>i.table)?.table??"table",[g.ops,g.table]);l.useMemo(()=>{const s=g.stats??{rows:g.rows?.length??0,ops:g.ops.length},i=j.map(c=>{const f=N.includes(c);if(c==="polling"){const _=X.polling;return{id:c,label:I[c].label,laneDescription:I[c].laneDescription,active:f,configSummary:`${_.pollIntervalMs}ms poll interval${_.includeSoftDeletes?" + soft deletes":""}`,configValues:{poll_interval_ms:_.pollIntervalMs,include_soft_deletes:_.includeSoftDeletes}}}if(c==="trigger"){const _=X.trigger;return{id:c,label:I[c].label,laneDescription:I[c].laneDescription,active:f,configSummary:`${_.extractIntervalMs}ms extract · +${_.triggerOverheadMs}ms overhead`,configValues:{extract_interval_ms:_.extractIntervalMs,trigger_overhead_ms:_.triggerOverheadMs}}}const k=X.log;return{id:c,label:I[c].label,laneDescription:I[c].laneDescription,active:f,configSummary:`${k.fetchIntervalMs}ms fetch cadence`,configValues:{fetch_interval_ms:k.fetchIntervalMs}}});return{scenario:{id:g.id,label:g.label,tags:g.tags??[],stats:s},preset:{id:q.id,label:q.label},featureFlags:Array.from(a).sort(),usesDefaultFlags:a.size===0,applyOnCommit:le,consumerRate:ne?ie:null,generatorRate:ce?oe:null,toggles:{eventBus:ot,eventLog:_s,pauseResume:wt,querySlider:xs,metrics:E,schemaWalkthrough:h,triggerMethod:u,multiTable:p},methods:i}},[N,le,ne,ie,j,ot,_s,a,ce,oe,X.log,X.polling,X.trigger,I,E,p,wt,q.id,q.label,xs,g.id,g.label,g.ops.length,g.rows?.length,g.stats,g.tags,h,u]),l.useEffect(()=>{if(!xt)return;const s=window.setTimeout(()=>Nt(!1),2e3);return()=>window.clearTimeout(s)},[xt]),l.useEffect(()=>{if(typeof window>"u")return;const s=window.setTimeout(()=>{z("comparator.event.search",{scenario:g.name,query:ve,hasQuery:!!ve.trim()})},400);return()=>window.clearTimeout(s)},[ve,g.name]),l.useEffect(()=>{cn.current=Be},[Be]),l.useEffect(()=>{Me.length&&(Me.some(s=>s.name===T)||(ze.current=!1,O(Me[0].name)))},[T,Me]),l.useEffect(()=>{if(!xt)return;const s=window.setTimeout(()=>Nt(!1),2e3);return()=>window.clearTimeout(s)},[xt]),l.useEffect(()=>{if(typeof window>"u")return;const s=i=>{if(!(i instanceof CustomEvent))return;const c=Bs(i.detail);Z(f=>f===c.query?f:c.query),de(f=>oa(f,c.tags)?f:c.tags)};return window.addEventListener("cdc:scenario-filter",s),window.dispatchEvent(new CustomEvent("cdc:scenario-filter-request")),()=>{window.removeEventListener("cdc:scenario-filter",s)}},[]),l.useEffect(()=>{if(typeof window>"u")return;const s=i=>{if(!(i instanceof CustomEvent))return;const c=i.detail;if(!c||!c.scenario){M(null);return}const f=Array.isArray(c.scenario.ops)?c.scenario.ops:[],k=c.scenario.label??"Workspace (live)",_=c.scenario.description??`${f.length} operations`,w=c.scenario.seed??1;M({name:Xe,label:k,description:_,seed:w,ops:f})};return window.addEventListener("cdc:workspace-update",s),window.dispatchEvent(new CustomEvent("cdc:workspace-request")),()=>{window.removeEventListener("cdc:workspace-update",s)}},[]),l.useEffect(()=>{y&&y.ops.length&&(ze.current||O(Xe))},[y]),l.useEffect(()=>{if(typeof window>"u")return;const s=i=>{if(!(i instanceof CustomEvent))return;const c=i.detail;Ot(c)};return window.addEventListener("cdc:comparator-preferences-set",s),()=>{window.removeEventListener("cdc:comparator-preferences-set",s)}},[Ot]),l.useEffect(()=>{Ki({scenarioId:T,presetId:Q,activeMethods:N,methodConfig:X,userPinnedScenario:ze.current,showEventList:Ae,eventOps:$e,eventSearch:ve,eventLogTable:pe,eventLogTxn:ue,eventLogMethod:me,eventLogOp:ge,applyOnCommit:le,consumerRateEnabled:ne,consumerRateLimit:ie,generatorEnabled:ce,generatorRate:oe})},[T,Q,N,X,Ae,$e,ve,pe,ue,me,ge,le,ne,ie,ce,oe]);const Qe=l.useRef(null),Wt=l.useRef(null),_e=l.useCallback(()=>{Wt.current!=null&&(window.clearInterval(Wt.current),Wt.current=null)},[]),ut=l.useCallback(()=>{if(he)return;const s={},i=It.current;if(i!=null){const w=i*Ue/1e3,A=Ve.current+w;Ve.current=Math.min(A,i*5)}let c=i==null?Number.POSITIVE_INFINITY:Ve.current;const f=w=>w.txnId??`tx-${w.commitTs}`,k=w=>{if(!w.length)return!1;const A=w[w.length-1];return typeof A.txnLast=="boolean"?A.txnLast:typeof A.txnIndex=="number"&&typeof A.txnTotal=="number"?A.txnIndex>=A.txnTotal-1:!0},_=(w,A)=>{const D=xe.current[w]??[];let $=D.length?[...D]:[];if($.length&&(xe.current[w]=[]),!$.length){const P=A.bus.consume(A.topic,1);if(!P.length)return[];$=P}const B=f($[0]);for(;!k($);){const P=A.bus.consume(A.topic,1);if(!P.length)return xe.current[w]=$,[];const W=P[0];if(f(W)!==B){const se=xe.current[w]??[];xe.current[w]=[W,...se];break}$.push(W)}return $};for(const w of N){const A=Re.current[w];if(!A)continue;let D=[],$=0;if(le){const W=_(w,A);if(!W.length)continue;if(i!=null&&W.length>c){xe.current[w]=W;continue}D=W,$=W.length}else{const W=xe.current[w]??[];if(W.length){if(i!=null&&W.length>c){xe.current[w]=W;continue}D=[...W],$+=W.length,xe.current[w]=[]}const G=i==null?Number.POSITIVE_INFINITY:c-$;if(i==null?!0:G>=1){const ae=i==null?50:Math.min(Math.floor(G),50),J=i==null?50:Math.max(ae,0);if(J>0){const Se=A.bus.consume(A.topic,J);Se.length&&(D=D.length?D.concat(Se):Se,$+=Se.length)}}if(!D.length)continue}i!=null&&(c=Math.max(c-$,0));const B=at(w),P=[];le?(B.applyEvents(D),A.metrics.onConsumed(D),ws(w),D.forEach(W=>{const G=W.__seq??0;P.push(Hs(w,W,G))})):D.forEach(W=>{B.applyEvents([W]),A.metrics.onConsumed([W]),ws(w);const G=W.__seq??0;P.push(Hs(w,W,G))}),we(w),s[w]=P}i!=null&&(Ve.current=c),Object.keys(s).length!==0&&Ce(w=>{const A={...w};for(const[D,$]of Object.entries(s)){const B=A[D]??[];A[D]=[...B,...$]}return A})},[N,le,at,he,ws,we]),hn=l.useCallback(()=>{_e(),Wt.current=window.setInterval(()=>{Qe.current?.tick(Ue),Dt(Ue),ut()},Ue)},[_e,ut,Dt]);l.useEffect(()=>{const s=ne?ie:null;It.current=s,s==null&&(Ve.current=0)},[ne,ie]),l.useEffect(()=>{he||ut()},[he,ut]),l.useEffect(()=>{Ce(gt(N)),U(gt(N)),Re.current={},xe.current={},rt.current={},N.forEach(_=>{rt.current[_]=new Rs}),He.current=new Map,N.forEach(_=>{He.current.set(_,[])}),bt(0),Ne(!1),_e(),it(g);const s=new ar,i=[],c={},f={},k=N.map(_=>{const w=Gi(_,$=>nn(_,$));if(f[_]=w,_==="polling"){const $=X.polling;w.configure({poll_interval_ms:$.pollIntervalMs,include_soft_deletes:$.includeSoftDeletes})}else if(_==="trigger"){const $=X.trigger;w.configure({extract_interval_ms:$.extractIntervalMs,trigger_overhead_ms:$.triggerOverheadMs})}else{const $=X.log;w.configure({fetch_interval_ms:$.fetchIntervalMs})}const A={bus:w.bus,metrics:w.metrics,topic:w.topic,applySchemaChange:w.applySchemaChange};c[_]=A;const D=w.onEvent($=>{Ce(B=>{const P={...B},W=P[_]??[];return P[_]=[...W,$],P})});return i.push(D),w});return Re.current=c,bs.current=f,N.forEach(_=>we(_,{lastOffset:-1})),s.attach(k),s.load(g),s.reset(g.seed),s.onTick(_=>bt(_)),Qe.current=s,()=>{s.pause(),_e(),i.forEach(_=>_()),bs.current={}}},[N,g,_e,X,we,nn,it]);const yr=l.useCallback(s=>{je(i=>{const c=Math.min(cr,j.length);if(i.includes(s))return i.length<=c?i:i.filter(k=>k!==s);if(!j.includes(s))return i;const f=[...i,s];return j.filter(k=>f.includes(k))})},[j]),vr=l.useCallback(s=>{ds(i=>{const c=new Set(i);let f=!1;return c.has(s)?c.size>1&&(c.delete(s),f=!0):(c.add(s),f=!0),f&&z("comparator.event.filter",{scenario:g.name,op:s,active:c.has(s)}),f?c:i})},[g.name]),wr=l.useCallback(s=>{_t(s)},[]),Sr=l.useCallback(()=>{us(s=>{const i=!s;return z("comparator.panel.layout",{scenario:g.name,showEvents:i}),i})},[g.name]),jr=l.useCallback(()=>{hs(s=>{const i=!s;return z("comparator.consumer.rate_toggle",{scenario:g.name,enabled:i}),It.current=i?ie:null,i||(Ve.current=0),i}),ne&&z("comparator.consumer.rate_reset",{scenario:g.name})},[ne,ie,g.name]),Er=l.useCallback(s=>{const i=Zt(s,ie);i!==ie&&(ps(i),ne&&(It.current=i),z("comparator.consumer.rate_adjust",{scenario:g.name,rate:i}))},[ne,ie,g.name]),Cr=l.useCallback(()=>{ms(s=>{const i=!s;return z("comparator.generator.toggle",{scenario:g.name,enabled:i}),i})},[g.name]),kr=l.useCallback(s=>{const i=Fs(s,oe);i!==oe&&(gs(i),z("comparator.generator.rate_adjust",{scenario:g.name,rate:i}))},[oe,g.name]),Lr=l.useCallback(()=>{Rt($s,Ai),z("comparator.generator.burst",{scenario:g.name,count:$s})},[Rt,g.name]),Mr=l.useCallback(s=>{s.methodId&&es(s.methodId)?Ie(s.methodId):Ie(null),qe(s.table??null),We(s.txnId??""),Oe(s.op?s.op.toLowerCase():null)},[Ie,Oe,qe,We]),Tr=l.useCallback(()=>{if(ct.length===0)return;const s=Ia(ct);if(!s)return;const i=new Blob([s],{type:"application/x-ndjson"}),c=URL.createObjectURL(i),f=document.createElement("a");f.href=c,f.download=`${g.name}-event-log.ndjson`,f.click(),URL.revokeObjectURL(c),z("comparator.event.download",{scenario:g.name,events:ct.length})},[ct,g.name]),Nr=l.useCallback(s=>{const i=rt.current[s];if(!i)return;const c=i.snapshot(),f=(g.name||"scenario").replace(/[^a-z0-9-_]+/gi,"-"),k={scenario:g.name,method:s,tables:c},_=new Blob([JSON.stringify(k,null,2)],{type:"application/json"}),w=URL.createObjectURL(_),A=document.createElement("a");A.href=w,A.download=`${f}-${s}-destination.json`,A.click(),URL.revokeObjectURL(w);const D=c.reduce(($,B)=>$+(B.rows?.length??0),0);z("comparator.destination.download",{scenario:g.name,method:s,tables:c.length,rows:D})},[g.name]),Ar=l.useCallback(()=>{U(s=>{const i={...s};return N.forEach(c=>{i[c]=[]}),i}),on.current=new WeakMap,z("comparator.event.clear",{scenario:g.name})},[N,g.name]),Ir=l.useCallback(s=>{const i=JSON.stringify({method:s.methodId??null,methodLabel:s.methodLabel??null,op:s.op,offset:s.offset??null,topic:s.topic??null,table:s.table??null,ts_ms:s.tsMs??null,pk:s.pk??null,txnId:s.txnId??null,before:s.before??null,after:s.after??null},null,2);navigator.clipboard.writeText(i).then(()=>z("comparator.event.copy",{scenario:g.name,method:s.methodId??null,op:s.op,offset:s.offset??null})).catch(()=>{z("comparator.event.copy.error",{scenario:g.name,method:s.methodId??null})})},[g.name]),Or=l.useCallback(s=>{if(typeof window>"u")return;const i=typeof s.op=="string"?s.op.trim().toLowerCase():"";if(i!=="c"&&i!=="u"&&i!=="d")return;const c={op:i,before:s.before??null,after:s.after??null,ts_ms:typeof s.tsMs=="number"?s.tsMs:void 0,table:s.table??void 0,key:s.pk?{id:s.pk}:void 0};window.dispatchEvent(new CustomEvent("cdc:workspace-replay-event",{detail:c})),z("comparator.event.replay",{scenario:g.name,method:s.methodId??null,table:s.table??null,op:i})},[g.name]),Rr=l.useCallback(s=>{as(s)&&(te(s),z("comparator.preset.select",{presetId:s}))},[]),Dr=l.useCallback(s=>{Z(s),De(s,V),z("comparator.scenario.filter",{query:s})},[De,V]),$r=l.useCallback(s=>{const i=V.includes(s),c=i?V.filter(f=>f!==s):[...V,s];de(c),De(F,c),z("comparator.scenario.tag_toggle",{tag:s,active:!i})},[De,F,V]),Pr=l.useCallback(()=>{V.length&&(de([]),De(F,[]),z("comparator.scenario.tag_clear"))},[De,F,V]),Fr=l.useCallback(s=>{ze.current=!0,O(s),z("comparator.scenario.select",{scenario:s})},[]),Ur=l.useCallback(s=>{z("comparator.scenario.preview",{scenario:s.name,tags:s.tags??[]}),window.dispatchEvent(new CustomEvent("cdc:preview-scenario",{detail:s}))},[]),re=l.useMemo(()=>N.map(s=>{const i=Ee[s]??[];return{method:s,events:i,metrics:Qi(i,Y,g,s,S,vt.current)}}),[N,Y,Ee,g,S]),Vt=l.useMemo(()=>re.some(s=>s.events.length>0),[re]),Et=l.useMemo(()=>{const s=g.comparator;if(!s||!s.summary)return null;const i=s.summary?be(s.summary)??s.summary:null;if(!i)return null;const c=za(i,en),f=be(s.analytics)??[],k=be(s.diffs)??[],_=be(s.overlay)??[],w=s.preset?be(s.preset)??s.preset:null,A=s.tags.length?[...s.tags]:Array.isArray(g.tags)?[...g.tags]:[],D=f.reduce((G,se)=>{const ae=Number(se.total);return Number.isFinite(ae)?G+ae:G},0),$=Array.isArray(s.lanes)?s.lanes.reduce((G,se)=>{const ae=Number(se.eventCount);return Number.isFinite(ae)?G+ae:G},0):0,B=typeof g.stats?.ops=="number"&&Number.isFinite(g.stats.ops)?g.stats.ops:g.ops.length,P=D||$||B;if(!(P>0))return null;const W=Array.isArray(s.lanes)?s.lanes.map(G=>{const se=typeof G.method=="string"?G.method:void 0;if(!se||!es(se))return null;const ae=G.metrics&&typeof G.metrics=="object"&&!Array.isArray(G.metrics)?G.metrics:{},J=(...Fe)=>{for(const zt of Fe){const kt=ae[zt];if(typeof kt=="number"&&Number.isFinite(kt))return kt}},Se=I[se];return{id:se,label:Se?.label??se,tooltip:Se?.tooltip,produced:J("produced")??0,consumed:J("consumed")??0,backlog:J("backlog")??0,lagP50:J("lagMsP50","lagP50")??0,lagP95:J("lagMsP95","lagP95")??0,missedDeletes:J("missedDeletes"),writeAmplification:J("writeAmplification"),snapshotRows:J("snapshotRows"),inserts:J("insertCount","inserts")??0,updates:J("updateCount","updates")??0,deletes:J("deleteCount","deletes")??0,schemaChanges:J("schemaChangeCount","schemaChanges")??0}}).filter(G=>!!G):[];return{scenarioName:g.name,scenarioLabel:g.label,scenarioDescription:g.description,isLive:g.name===Xe,totalEvents:P,summary:c,lanes:W,analytics:f,tags:A,preset:w,diffs:k,overlay:_}},[I,en,g]),ye=l.useMemo(()=>N.reduce((s,i)=>{const c=S[i],f=c?.metrics,k={backlog:c?.backlog??0,lastOffset:c?.lastOffset??-1,produced:f?.produced??0,consumed:f?.consumed??0,lagMsP50:f?.lagMsP50??0,lagMsP95:f?.lagMsP95??0,missedDeletes:f?.missedDeletes??0,writeAmplification:f?.writeAmplification??0,snapshotRows:f?.snapshotRows??0,errors:f?.errors??0};return s.set(i,k),s},new Map),[N,S]);l.useEffect(()=>{typeof window>"u"||Et&&(Vt||window.dispatchEvent(new CustomEvent("cdc:comparator-summary",{detail:Et})))},[Vt,Et]);const Cs=l.useMemo(()=>N.reduce((s,i)=>s+(ye.get(i)?.backlog??0),0),[N,ye]),Br=l.useMemo(()=>ot?N.reduce((s,i)=>{const c=ye.get(i);return c&&(s.produced+=c.produced,s.consumed+=c.consumed,s.backlog+=c.backlog,s.snapshotRows+=c.snapshotRows),s},{produced:0,consumed:0,backlog:0,snapshotRows:0}):{produced:0,consumed:0,backlog:0,snapshotRows:0},[N,ye,ot]),R=Ji(re),pn=l.useMemo(()=>re.reduce((s,i)=>s+i.events.length,0),[re]),ht=l.useMemo(()=>re.map(({method:s,events:i,metrics:c})=>({method:s,label:I[s].label,total:i.length,inserts:c.insertCount,updates:c.updateCount,deletes:c.deleteCount,schemaChanges:c.schemaChangeCount})),[re,I]),mn=l.useMemo(()=>ht.reduce((s,i)=>s.set(i.method,i),new Map),[ht]),Pe=l.useMemo(()=>{const s=new Map;return re.forEach(({method:i,events:c})=>{s.set(i,ai(i,g.ops,c))}),s},[re,g.ops]),gn=l.useMemo(()=>E?N.map(s=>{const i=ye.get(s),c=mn.get(s);return{id:s,label:I[s].label,tooltip:I[s].tooltip,produced:i?.produced??0,consumed:i?.consumed??0,backlog:i?.backlog??0,lagP50:i?.lagMsP50??0,lagP95:i?.lagMsP95??0,missedDeletes:i?.missedDeletes,writeAmplification:i?.writeAmplification,snapshotRows:i?.snapshotRows,inserts:c?.inserts??0,updates:c?.updates??0,deletes:c?.deletes??0,schemaChanges:c?.schemaChanges??0}}):[],[N,mn,ye,E,I]),Ct=l.useMemo(()=>N.map(s=>{const i=ye.get(s),c=I[s].label,f=i?.snapshotRows??0;return`${c} ${f}`}).join(", "),[N,ye,I]),Gt=l.useMemo(()=>N.map(s=>{const i=Pe.get(s),c=I[s].label,f=i?.totals??{missing:0,extra:0,ordering:0},k=i?.lag?.max??0,_=[];if(f.missing>0&&_.push({key:"missing",text:`${f.missing} missing`,tone:"missing"}),f.extra>0&&_.push({key:"extra",text:`${f.extra} extra`,tone:"extra"}),f.ordering>0&&_.push({key:"ordering",text:`${f.ordering} ordering`,tone:"ordering"}),k>0&&_.push({key:"lag",text:`${Math.round(k)}ms lag`,tone:"lag"}),s==="trigger"){const A=ye.get(s)?.writeAmplification??0,D=Ti(A);D&&_.push(D)}if(dt){const A=Le.get(s),D=A?.schemaVersion??1;A&&!A.hasSchemaColumn?_.push({key:"schema-missing",text:`${Ze.name} missing`,tone:"schema"}):D<Ke&&_.push({key:"schema-behind",text:`Schema v${D}/${Ke}`,tone:"schema"})}_.length===0&&_.push({key:"ok",text:"Aligned",tone:"ok"});const w=!!i?.issues.length||(i?.lag?.samples?.length??0)>0||(i?.lag?.max??0)>0;return{method:s,label:c,chips:_,hasDetails:w}}),[N,Le,Pe,ye,I,Ke,dt]),fn=ze.current,Ht=l.useMemo(()=>{const s={scenarioId:T,presetId:Q,activeMethods:[...N],methodConfig:X,userPinnedScenario:fn,showEventList:Ae,eventOps:$e,eventSearch:ve,eventLogTable:pe,eventLogTxn:ue,eventLogMethod:me,eventLogOp:ge,applyOnCommit:le,consumerRateEnabled:ne,consumerRateLimit:ie,generatorEnabled:ce,generatorRate:oe};return Ri(s,R??null,ht,Pe,Array.isArray(g.tags)?g.tags:[],q,Gt,re)},[N,ht,le,ne,ie,me,ge,pe,ue,$e,ve,ce,oe,Pe,re,Gt,X,q,Q,g,T,Ae,R,fn]),qr=l.useCallback(s=>{const i=new Date().toISOString(),c=Vn(Ht)?Ht:s.comparator??Ht,f={id:s.id,name:s.name,label:s.label,description:s.description,highlight:s.highlight,tags:s.tags,table:s.table,schemaVersion:s.schemaVersion,seed:s.seed,schema:s.schema??[],rows:s.rows??[],events:s.events??[],ops:s.ops,version:2,exportedAt:i,comparator:c},k=new Blob([JSON.stringify(f,null,2)],{type:"application/json"}),_=document.createElement("a");_.href=URL.createObjectURL(k),_.download=`${s.name}.json`,_.click(),URL.revokeObjectURL(_.href);const w=Array.isArray(s.rows)?s.rows.length:0,A=Array.isArray(s.events)?s.events.length:0;z("workspace.scenario.exported",{scenario:s.name,rows:w,events:A,hasComparator:Vn(c),methods:N})},[N,Ht,z]);l.useEffect(()=>{typeof window>"u"||window.dispatchEvent(new CustomEvent("cdc:consumer-paused",{detail:{paused:he,backlog:Cs}}))},[he,Cs]);const Wr=l.useCallback(()=>{if(!R)return;const s=[];if(s.push(`${g.label}: ${g.description}`),s.push(`Methods: ${N.map(i=>I[i].label).join(", ")}`),R.bestLag&&s.push(`Fastest ${I[R.bestLag.method].label} at ${Math.round(R.bestLag.metrics.lagMs)}ms`),R.lagSpread>0&&s.push(`${I[R.worstLag.method].label} trails by ${Math.round(R.lagSpread)}ms`),s.push(`Lowest delete capture: ${I[R.lowestDeletes.method].label} (${Math.round(R.lowestDeletes.metrics.deletesPct)}%)`),R.triggerWriteAmplification&&Te(R.triggerWriteAmplification.metrics.writeAmplification)){const i=tt(R.triggerWriteAmplification.metrics.writeAmplification);s.push(`Trigger write amplification: ${I[R.triggerWriteAmplification.method].label} ${i}`)}Ct&&s.push(`Snapshot rows: ${Ct}`),s.push(`Ordering: ${R.orderingIssues.length?R.orderingIssues.map(i=>I[i].label).join(", "):"All lanes aligned"}`),g.tags?.length&&s.push(`Tags: ${g.tags.join(", ")}`),navigator.clipboard.writeText(s.join(`
`)).then(()=>Nt(!0)).catch(()=>Nt(!1)),z("comparator.summary.copied",{scenario:g.name,tags:g.tags??[],methods:N})},[R,g,N,I,Ct]),Vr=l.useCallback(s=>{z("comparator.overlay.inspect",{method:s,scenario:g.name});const i=document.getElementById(`lane-diff-${s}`);i instanceof HTMLDetailsElement?(i.open=!0,i.scrollIntoView({behavior:"smooth",block:"center"})):i&&i.scrollIntoView({behavior:"smooth",block:"center"})},[g.name]),ks=l.useCallback(s=>{if(!h||!g.tags?.includes("schema"))return;const i=Math.max(Y,Bt.current+Ue);Bt.current=i,N.forEach(c=>{Re.current[c]?.applySchemaChange?.(Es,s,Ze,i),we(c)}),z("comparator.schema.change",{action:s,table:Es,scenario:g.name,commitTs:i,methods:N})},[N,Y,Re,h,Es,g.name,g.tags,we]),Gr=l.useMemo(()=>{if(!h||!g.tags?.includes("schema"))return;const s=N[0];if(s)return i=>i!==s?null:n.jsx(Ma,{columnName:Ze.name,onAdd:()=>ks("add"),onDrop:()=>ks("drop"),disableAdd:jt,disableDrop:!jt,status:un})},[N,ks,jt,h,un,g.tags]),pt=l.useCallback((s,i,c)=>{cs(f=>({...f,[s]:{...f[s],[i]:c}}))},[]),mt=l.useCallback(s=>{const i=Qe.current;if(i){it(g),i.reset(g.seed),Ce(gt(N)),U(gt(N)),xe.current={},He.current.forEach(c=>c.splice(0));for(const c of N){rt.current[c]=new Rs;const f=Re.current[c];f&&(f.bus.reset(f.topic),f.metrics.reset(),we(c,{lastOffset:-1}))}bt(0),Ve.current=0,Bt.current=0,s?.keepLoop||(i.pause(),Ne(!1),_e())}},[N,it,g,g.seed,_e,we]),Ls=l.useCallback(()=>{const s=Qe.current;s&&(mt({keepLoop:!0}),s.start(),Ne(!0),hn(),Lt("play",{scenario:g.name}))},[mt,hn,g.name]),Ms=l.useCallback(()=>{Qe.current?.pause(),Ne(!1),_e(),Lt("pause",{scenario:g.name})},[_e,g.name]),Hr=l.useCallback(()=>{wt&&ls(s=>{const i=!s;return z("comparator.consumer.toggle",{scenario:g.name,paused:i}),i||ut(),i})},[ut,wt,g.name]),Ts=l.useCallback((s=Ue)=>{const i=Qe.current;if(!i)return;const c=cn.current;c||i.start(),i.tick(s),Dt(s),c||i.pause(),Lt("step",{deltaMs:s,scenario:g.name})},[Dt,g.name]),bn=l.useCallback((s,i)=>{const c=Qe.current;if(!c)return;const f=Math.max(10,i??Ue);mt({keepLoop:!1});const k=Math.max(s,0);c.start();let _=0,w=0;for(;_<k&&w<1e4;){const A=Math.min(f,k-_);c.tick(A),_+=A,w+=1}c.pause(),Ne(!1),Lt("seek",{targetMs:s,stepMs:i,scenario:g.name})},[mt,g.name]),Ns=l.useCallback(()=>{_t(""),Ie(null),qe(null),Oe(null),We(""),mt(),Lt("reset",{scenario:g.name})},[mt,g.name,Ie,Oe,qe,We,_t]);return l.useEffect(()=>{if(typeof window>"u")return;const s={play:()=>Ls(),pause:()=>Ms(),step:c=>Ts(c),seek:(c,f)=>bn(c,f),reset:()=>Ns()};window.cdcComparatorClock=s;const i=c=>{if(!(c instanceof CustomEvent))return;const f=c.detail;if(f)switch(f.type){case"play":s.play();break;case"pause":s.pause();break;case"step":s.step(f.deltaMs);break;case"seek":s.seek(f.timeMs,f.stepMs);break;case"reset":s.reset();break}};return window.addEventListener("cdc:comparator-clock",i),()=>{window.removeEventListener("cdc:comparator-clock",i),window.cdcComparatorClock===s&&delete window.cdcComparatorClock}},[Ms,Ns,bn,Ls,Ts]),l.useEffect(()=>{if(typeof window>"u")return;const s={getLaneSnapshot:i=>Ii(Le.get(i)),getLaneHistory:i=>[...He.current.get(i)??[]],resetHistory:()=>{He.current.forEach(i=>i.splice(0))}};return window.cdcComparatorDebug=s,()=>{window.cdcComparatorDebug===s&&delete window.cdcComparatorDebug}},[Le,N]),l.useEffect(()=>{typeof window>"u"||window.dispatchEvent(new CustomEvent("cdc:comparator-clock-tick",{detail:{clock:Y}}))},[Y]),l.useEffect(()=>()=>_e(),[_e]),l.useEffect(()=>{if(typeof window>"u"||!Vt&&Et)return;const s=R?{lagSpread:R.lagSpread,bestLag:{method:R.bestLag.method,label:I[R.bestLag.method].label,metrics:R.bestLag.metrics},worstLag:{method:R.worstLag.method,label:I[R.worstLag.method].label,metrics:R.worstLag.metrics},lowestDeletes:{method:R.lowestDeletes.method,label:I[R.lowestDeletes.method].label,metrics:R.lowestDeletes.metrics},highestDeletes:{method:R.highestDeletes.method,label:I[R.highestDeletes.method].label,metrics:R.highestDeletes.metrics},orderingIssues:R.orderingIssues.map(_=>({method:_,label:I[_].label})),triggerWriteAmplification:R.triggerWriteAmplification&&Te(R.triggerWriteAmplification.metrics.writeAmplification)?{method:R.triggerWriteAmplification.method,label:I[R.triggerWriteAmplification.method].label,value:R.triggerWriteAmplification.metrics.writeAmplification??0}:null}:null,i=re.map(({method:_,metrics:w})=>({method:_,label:I[_].label,tooltip:I[_].tooltip,metrics:w})),c={id:q.id,label:q.label,description:q.description,docsHint:q.docsHint,source:{label:q.sourceLabel,tooltip:q.sourceTooltip},log:{label:q.logLabel,tooltip:q.logTooltip},bus:{label:q.busLabel,tooltip:q.busTooltip,exampleTopic:js},destination:{label:q.destinationLabel,tooltip:q.destinationTooltip},methods:j.map(_=>({id:_,label:I[_].label,tooltip:I[_].tooltip??null}))},f=re.map(({method:_})=>{const w=Pe.get(_);return w?{method:_,totals:w.totals,issues:w.issues.slice(0,25),lag:w.lag}:{method:_,totals:{missing:0,extra:0,ordering:0},issues:[],lag:{max:0,samples:[]}}}),k=N.map(_=>{const w=Pe.get(_);return w?{method:_,label:I[_].label,totals:w.totals,issues:w.issues.slice(0,10),lag:{max:w.lag.max,samples:w.lag.samples.slice(0,10)}}:{method:_,label:I[_].label,totals:{missing:0,extra:0,ordering:0},issues:[],lag:{max:0,samples:[]}}});window.dispatchEvent(new CustomEvent("cdc:comparator-summary",{detail:{scenarioName:g.name,scenarioLabel:g.label,scenarioDescription:g.description,isLive:g.name===Xe,totalEvents:pn,summary:s,lanes:i,analytics:ht,tags:V,preset:c,diffs:f,overlay:k}}))},[N,ht,Vt,Pe,re,I,q,g,js,Et,V,R,pn]),n.jsxs("section",{className:"sim-shell","aria-label":"Simulator preview",children:[n.jsxs("header",{className:"sim-shell__header",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"sim-shell__title",children:"CDC Method Comparator"}),n.jsx("p",{className:"sim-shell__description",children:q.description}),n.jsxs("div",{className:"sim-shell__preset-row",role:"list","aria-label":"Selected vendor pipeline",children:[n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":q.sourceTooltip,role:"listitem",children:["Source · ",q.sourceLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":q.logTooltip,role:"listitem",children:["Capture · ",q.logLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":q.busTooltip,role:"listitem",children:["Transport · ",q.busLabel]}),n.jsx("span",{className:"sim-shell__preset-arrow","aria-hidden":"true",children:"→"}),n.jsxs("span",{className:"sim-shell__preset-pill","data-tooltip":q.destinationTooltip,role:"listitem",children:["Sink · ",q.destinationLabel]})]}),n.jsxs("p",{className:"sim-shell__description sim-shell__description--meta",children:[q.label,q.docsHint?n.jsxs(n.Fragment,{children:[" · ",n.jsx("a",{href:q.docsHint,target:"_blank",rel:"noopener noreferrer",children:"Reference"})]}):null]})]}),n.jsxs("div",{className:"sim-shell__scenario-filter-row",role:"group","aria-label":"Filter scenarios",children:[n.jsxs("label",{className:"sim-shell__scenario-search",children:[n.jsx("span",{children:"Search scenarios"}),n.jsx("input",{type:"search",value:F,onChange:s=>Dr(s.target.value),placeholder:"Find by label, description, or tag"})]}),sn.length>0?n.jsxs("div",{className:"sim-shell__scenario-tags",role:"group","aria-label":"Scenario tags",children:[sn.map(s=>n.jsxs("button",{type:"button",className:"sim-shell__scenario-tag","data-active":tn.has(s)?"true":"false","aria-pressed":tn.has(s),onClick:()=>$r(s),children:["#",s]},s)),V.length?n.jsx("button",{type:"button",className:"sim-shell__scenario-tag sim-shell__scenario-tag--clear",onClick:Pr,children:"Clear"}):null]}):null]}),n.jsxs("div",{className:"sim-shell__actions sim-shell__actions--scenario",role:"group","aria-label":"Scenario controls",children:[n.jsx("select",{"aria-label":"Vendor preset",value:Q,onChange:s=>Rr(s.target.value),children:gr.map(s=>n.jsx("option",{value:s.id,children:s.label},s.id))}),n.jsx("select",{"aria-label":"Scenario",value:T,onChange:s=>Fr(s.target.value),children:Me.map(s=>n.jsx("option",{value:s.name,children:s.label},s.name))}),n.jsxs("div",{className:"sim-shell__scenario-actions",children:[n.jsx("button",{type:"button",className:"sim-shell__scenario-sync",onClick:()=>{g.name!==Xe&&window.dispatchEvent(new CustomEvent("cdc:apply-scenario-template",{detail:{id:g.name}}))},disabled:g.name===Xe,children:"Load in workspace"}),n.jsx("button",{type:"button",className:"sim-shell__scenario-download",onClick:()=>qr(g),children:"Download JSON"}),n.jsx("button",{type:"button",className:"sim-shell__scenario-preview",onClick:()=>Ur(g),children:"Preview"})]}),n.jsx("div",{className:"sim-shell__method-toggle",role:"group","aria-label":"Methods to display",children:j.map(s=>n.jsx("button",{type:"button",className:"sim-shell__method-chip","aria-pressed":N.includes(s),onClick:()=>yr(s),"data-tooltip":I[s].tooltip||void 0,children:I[s].label},s))})]})]}),n.jsxs("p",{className:"sim-shell__description","aria-live":"polite",children:[n.jsxs("strong",{children:[g.label,":"]})," ",g.description]}),g.highlight&&n.jsx("p",{className:"sim-shell__description sim-shell__description--highlight","aria-live":"polite",children:g.highlight}),g.tags?.length?n.jsx("div",{className:"sim-shell__tag-row","aria-label":"Scenario tags",children:g.tags.map(s=>n.jsxs("span",{className:"sim-shell__tag-chip",children:["#",s]},s))}):null,g.stats&&n.jsxs("p",{className:"sim-shell__description sim-shell__description--meta","aria-live":"polite",children:[g.stats.rows," rows · ",g.stats.ops," ops"]}),dn?n.jsx(fi,{guidance:dn}):null,n.jsx(gi,{preset:q,topicExample:js,methods:j.map(s=>({id:s,label:I[s].label,laneDescription:I[s].laneDescription,whenToUse:I[s].whenToUse,callout:I[s].callout,active:N.includes(s)}))}),n.jsx(ji,{scenarios:Mt}),n.jsxs("div",{className:"sim-shell__event-filters",role:"group","aria-label":"Event filters",children:[he&&n.jsx("div",{className:"sim-shell__pause-banner",role:"status","aria-live":"polite",children:"Apply paused. Resume to drain the event bus."}),n.jsxs("label",{className:"sim-shell__event-search",children:[n.jsx("span",{children:"Search events"}),n.jsx("input",{type:"search",value:ve,onChange:s=>wr(s.target.value),placeholder:"Filter by pk, seq, or payload"})]}),n.jsx("div",{className:"sim-shell__event-ops",role:"group","aria-label":"Change operations",children:nt.map(s=>n.jsx("button",{type:"button",className:"sim-shell__event-op","data-active":rn.has(s)?"true":"false",onClick:()=>vr(s),children:s.toUpperCase()},s))}),n.jsx("button",{type:"button",className:"sim-shell__event-toggle",onClick:Sr,children:Ae?"Hide timeline":"Show timeline"})]}),_s&&n.jsx(va,{className:"sim-shell__event-log",events:br,stats:Br,totalCount:ys.length,filters:xr,filterOptions:_r,onFiltersChange:Mr,onDownload:Tr,onClear:Ar,onCopyEvent:Ir,onReplayEvent:Or,maxVisibleEvents:$i}),Ge&&(Ge.rows.length>0||Ge.placeholder)&&n.jsx("section",{className:"sim-shell__harness-history","aria-label":"Harness nightly history",children:n.jsxs("details",{children:[n.jsx("summary",{children:"Harness nightly history"}),Ge.rows.length>0?n.jsx("div",{className:"sim-shell__harness-history-table-wrapper",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsx("tr",{children:Ge.headers.map(s=>n.jsx("th",{children:s},s))})}),n.jsx("tbody",{children:Ge.rows.map((s,i)=>n.jsx("tr",{children:s.map((c,f)=>{const k=c.text||"—",_=c.href?n.jsx("a",{href:c.href,target:"_blank",rel:"noreferrer noopener",children:k}):k,w=c.emphasis?n.jsx("em",{children:_}):_;return n.jsx("td",{children:w},`harness-cell-${i}-${f}`)})},`harness-row-${i}`))})]})}):n.jsx("p",{className:"sim-shell__harness-history-empty",children:Ge.placeholder??"No harness runs captured yet."})]})}),n.jsxs("div",{className:"sim-shell__actions",role:"group","aria-label":"Playback controls","data-tour-target":L?"comparator-actions":void 0,children:[n.jsx("button",{type:"button",onClick:Ls,disabled:Be,children:"Start"}),n.jsx("button",{type:"button",onClick:Ms,disabled:!Be,children:"Pause"}),n.jsxs("button",{type:"button",onClick:()=>Ts(),children:["Step +",Ue,"ms"]}),n.jsx("button",{type:"button",onClick:Ns,children:"Reset"}),wt&&n.jsxs("button",{type:"button",onClick:Hr,className:"sim-shell__consumer-toggle","data-tooltip":ee.backlog,children:[he?"Resume apply":"Pause apply",ot?` (${Cs} queued)`:""]}),p&&n.jsxs("label",{className:"sim-shell__apply-toggle","data-tooltip":ee.txnAtomic||void 0,children:[n.jsx("input",{type:"checkbox",checked:le,onChange:s=>At(s.target.checked)}),n.jsx("span",{children:"Apply on commit"})]}),n.jsxs("div",{className:"sim-shell__consumer-rate",role:"group","aria-label":"Apply rate limit","data-enabled":ne?"true":"false",children:[n.jsx("button",{type:"button",onClick:jr,children:ne?"Disable throttle":"Throttle apply"}),n.jsxs("label",{children:[n.jsx("span",{children:ne?`${ie} events/s`:"Unlimited"}),n.jsx("input",{type:"range",min:dr,max:ur,step:Ni,value:ie,onChange:s=>Er(Number(s.target.value)),disabled:!ne})]})]}),n.jsxs("div",{className:"sim-shell__generator",role:"group","aria-label":"Event generator","data-enabled":ce?"true":"false",children:[n.jsx("button",{type:"button",onClick:Cr,children:ce?"Stop generator":"Start generator"}),n.jsxs("label",{children:[n.jsx("span",{children:ce?`${oe} events/s`:`Set ${oe} events/s`}),n.jsx("input",{type:"range",min:hr,max:pr,step:Gs,value:oe,onChange:s=>kr(Number(s.target.value)),disabled:!ce})]}),n.jsxs("button",{type:"button",onClick:Lr,children:["Burst +",$s]})]})]}),n.jsx("div",{className:"sim-shell__controls","aria-label":"Method tuning controls",children:j.map(s=>{const i=N.includes(s);if(s==="polling"){const f=X.polling;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":i?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:I[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Adjust poll cadence and whether soft deletes are surfaced."}),xs?n.jsxs(n.Fragment,{children:[n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsxs("span",{children:["Poll interval (",(f.pollIntervalMs/1e3).toFixed(1),"s)"]}),n.jsx("input",{type:"range",min:500,max:1e4,step:100,value:f.pollIntervalMs,onChange:k=>pt("polling","pollIntervalMs",Math.min(1e4,Math.max(500,Number(k.target.value)||500)))})]}),n.jsxs("p",{className:"sim-shell__control-hint",children:["⏱️ Polling every ",(f.pollIntervalMs/1e3).toFixed(1),"s"]})]}):n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Poll interval (ms)"}),n.jsx("input",{type:"number",min:100,step:100,value:f.pollIntervalMs,onChange:k=>pt("polling","pollIntervalMs",Math.min(1e4,Math.max(100,Number(k.target.value)||500)))})]}),n.jsxs("label",{className:"sim-shell__control-checkbox",children:[n.jsx("input",{type:"checkbox",checked:f.includeSoftDeletes,onChange:k=>pt("polling","includeSoftDeletes",k.target.checked)}),n.jsx("span",{children:"Include soft delete marker column"})]})]},s)}if(s==="trigger"){const f=X.trigger;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":i?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:I[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Tune audit extractor cadence and per-write trigger overhead."}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Extractor interval (ms)"}),n.jsx("input",{type:"number",min:100,step:50,value:f.extractIntervalMs,onChange:k=>pt("trigger","extractIntervalMs",Math.max(50,Number(k.target.value)||0))})]}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Trigger overhead (ms)"}),n.jsx("input",{type:"number",min:0,step:1,value:f.triggerOverheadMs,onChange:k=>pt("trigger","triggerOverheadMs",Math.max(0,Number(k.target.value)||0))})]})]},s)}const c=X.log;return n.jsxs("fieldset",{className:"sim-shell__control-card","aria-labelledby":`control-${s}`,"data-active":i?"true":"false",children:[n.jsx("legend",{id:`control-${s}`,children:I[s].label}),n.jsx("p",{className:"sim-shell__control-copy",children:"Control how frequently the WAL/Binlog fetcher polls for new records."}),n.jsxs("label",{className:"sim-shell__control-field",children:[n.jsx("span",{children:"Fetch interval (ms)"}),n.jsx("input",{type:"number",min:10,step:10,value:c.fetchIntervalMs,onChange:f=>pt("log","fetchIntervalMs",Math.max(10,Number(f.target.value)||0))})]})]},s)})}),E&&R&&n.jsxs("div",{className:"sim-shell__summary","aria-live":"polite",children:[n.jsxs("ul",{children:[n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":ee.lagSpread,children:"Lag spread:"})," ",I[R.bestLag.method].label," is leading at",` ${R.bestLag.metrics.lagMs.toFixed(0)}ms`,R.lagSpread>0?` — ${I[R.worstLag.method].label} trails by ${R.lagSpread.toFixed(0)}ms`:" (no spread)"]}),n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":ee.deleteCapture,children:"Delete capture:"})," ",I[R.lowestDeletes.method].label," is lowest at",` ${R.lowestDeletes.metrics.deletesPct.toFixed(0)}%`," · best is ",I[R.highestDeletes.method].label,` (${R.highestDeletes.metrics.deletesPct.toFixed(0)}%)`]}),Ct&&n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":ee.snapshot,children:"Snapshot rows:"})," ",Ct]}),R.triggerWriteAmplification&&Te(R.triggerWriteAmplification.metrics.writeAmplification)&&n.jsxs("li",{children:[n.jsx("strong",{"data-tooltip":ee.triggerOverhead,children:"Trigger overhead:"})," ",I[R.triggerWriteAmplification.method].label," is at"," ",tt(R.triggerWriteAmplification.metrics.writeAmplification)," ","write amplification"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Ordering:"}),R.orderingIssues.length===0?" All methods preserved ordering":` Issues: ${R.orderingIssues.map(s=>I[s].label).join(", ")}`]})]}),n.jsx("button",{type:"button",className:"sim-shell__summary-copy",onClick:Wr,children:xt?"Copied":"Copy summary"})]}),Gt.length>0&&n.jsxs("section",{className:"sim-shell__overlay-summary","aria-label":"Lane checks",children:[n.jsxs("header",{children:[n.jsx("h3",{children:"Lane checks"}),n.jsx("p",{children:"Quick glance at diff findings and lag hotspots across active capture methods."})]}),n.jsx("ul",{children:Gt.map(s=>n.jsxs("li",{className:"sim-shell__overlay-row",children:[n.jsx("div",{className:"sim-shell__overlay-label",children:s.label}),n.jsx("div",{className:"sim-shell__overlay-chips",children:s.chips.map(i=>n.jsx("span",{className:`sim-shell__overlay-chip sim-shell__overlay-chip--${i.tone}`,children:i.text},`${s.method}-${i.key}`))}),s.hasDetails&&n.jsx("button",{type:"button",className:"sim-shell__overlay-action",onClick:()=>Vr(s.method),children:"Inspect"})]},s.method))})]}),gn.length>0&&n.jsx(ka,{lanes:gn,renderSchemaWalkthrough:Gr}),n.jsx("div",{className:"sim-shell__lane-grid","data-tour-target":L?"comparator-lanes":void 0,children:re.map(({method:s,metrics:i,events:c},f)=>{const k=I[s],_=k.laneDescription,w=Pe.get(s)??null,A=f===0,D=ye.get(s),$=Re.current[s],B=Le.get(s),P=B?.rows.slice(0,Pi)??[],W=(B?.rows.length??0)>P.length,G=h&&dt&&B?{version:B.schemaVersion,expectedVersion:Ke,hasColumn:B.hasSchemaColumn,columnName:Ze.name}:h&&dt?{version:0,expectedVersion:Ke,hasColumn:!1,columnName:Ze.name}:void 0,se=s==="trigger"?D?.writeAmplification??i.writeAmplification:void 0,ae=Te(se)?se:void 0,J=[],Se=s==="polling"?"warning":"info";k.callout&&(s==="polling"&&i.deletesPct<100?J.push({text:`${k.callout} (${i.deletesPct.toFixed(0)}% of deletes captured in this scenario)`,tone:Se}):J.push({text:k.callout,tone:Se})),h&&g.tags?.includes("schema")&&(s==="trigger"&&typeof ae=="number"&&J.push({text:`Write amplification ${tt(ae)}`,tone:"info"}),s==="log"&&J.push({text:"Log capture streams schema changes in-order, keeping downstream versions aligned.",tone:"info"}),s==="polling"&&J.push({text:"Polling picks up new columns once refreshed rows include them; expect interim nulls.",tone:"warning"})),g.tags?.includes("transactions")&&J.push({text:le?"Apply-on-commit groups transaction events before updating destinations so tables stay in sync.":"Apply-on-commit is off: events apply individually, so pausing mid-transaction shows partial state.",tone:le?"info":"warning"});const Fe=fr.get(s)??c,zt=Fe.length!==c.length||lt.length>0||rn.size<nt.length,kt=Ae&&Fe.length>Ps,xn=Ae?Fe.slice(Math.max(Fe.length-Ps,0)):[];return n.jsxs("article",{className:"sim-shell__lane-card",children:[n.jsxs("header",{className:"sim-shell__lane-header","data-tour-target":L&&A&&f===0?"comparator-callouts":void 0,children:[n.jsxs("div",{children:[n.jsx("h3",{className:"sim-shell__lane-title","data-tooltip":k.tooltip||void 0,children:k.label}),n.jsx("p",{className:"sim-shell__lane-copy",children:_})]}),n.jsxs("span",{className:"sim-shell__lane-count",children:[Fe.length,zt?` / ${c.length}`:""," events"]})]}),E&&n.jsx("div",{className:"sim-shell__metrics","data-tour-target":L&&A?"comparator-metrics":void 0,children:n.jsx(La,{...i})}),n.jsx(mi,{diff:w,scenarioName:g.name,laneId:s,schemaStatus:G}),ot&&n.jsxs("section",{className:"sim-shell__lane-bus","aria-label":`${k.label} event bus`,"data-paused":he?"true":"false",children:[n.jsxs("header",{children:[n.jsx("h4",{children:"Event Bus"}),n.jsx("span",{children:$?.topic??`cdc.${s}`})]}),n.jsxs("p",{children:[n.jsxs("span",{"data-tooltip":ee.backlog,children:["Backlog ",n.jsx("strong",{children:D?.backlog??0}),he?" (apply paused)":""]})," · ",n.jsxs("span",{"data-tooltip":ee.offset,children:["Last offset ",D?.lastOffset??-1]})]}),n.jsxs("p",{children:["Produced ",D?.produced??0," · Consumed ",D?.consumed??0]}),n.jsxs("p",{"data-tooltip":ee.snapshot,children:["Snapshot rows ",D?.snapshotRows??0]}),n.jsxs("p",{"data-tooltip":ee.lagPercentile,children:["Lag p50 ",Math.round(D?.lagMsP50??0),"ms · p95 ",Math.round(D?.lagMsP95??0),"ms"]}),s==="trigger"&&typeof ae=="number"&&n.jsxs("p",{"data-tooltip":ee.triggerWriteAmplification,children:["Write amplification: ",tt(ae)]}),s==="polling"&&n.jsxs("p",{className:"sim-shell__lane-bus-warning","data-tooltip":ee.deleteCapture,children:["Missed deletes: ",D?.missedDeletes??0]}),D&&D.errors>0&&n.jsxs("p",{className:"sim-shell__lane-bus-warning",children:["Errors: ",D.errors]})]}),B&&n.jsxs("section",{className:"sim-shell__destination","aria-label":`${k.label} destination snapshot`,children:[n.jsxs("header",{children:[n.jsxs("div",{className:"sim-shell__destination-title",children:[n.jsx("h4",{children:"Destination snapshot"}),n.jsxs("span",{children:["schema v",B.schemaVersion]})]}),n.jsx("div",{className:"sim-shell__destination-actions",children:n.jsx("button",{type:"button",className:"sim-shell__destination-download",onClick:()=>Nr(s),disabled:B.rows.length===0,children:"Download JSON"})})]}),P.length>0?n.jsx("div",{className:"sim-shell__destination-table",role:"table",children:n.jsxs("table",{children:[n.jsx("thead",{children:n.jsx("tr",{children:B.columns.map(K=>n.jsx("th",{"data-highlight":K===Ze.name?"true":void 0,children:K},K))})}),n.jsx("tbody",{children:P.map(K=>n.jsx("tr",{children:B.columns.map(Je=>n.jsx("td",{children:Wi(Je==="id"?K.displayId:Je==="table"?K.table:K.values[Je])},`${K.id}-${Je}`))},K.id))})]})}):n.jsx("p",{className:"sim-shell__destination-empty",children:"No rows applied yet."}),W&&n.jsxs("p",{className:"sim-shell__destination-note",children:["Showing ",P.length," of ",B.rows.length," rows."]})]}),n.jsxs("dl",{className:"sim-shell__lane-config",children:[s==="polling"&&(()=>{const K=X.polling;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Poll interval"}),n.jsxs("dd",{"data-tooltip":ee.pollingInterval,children:[K.pollIntervalMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Soft deletes"}),n.jsx("dd",{"data-tooltip":ee.pollingSoftDeletes,children:K.includeSoftDeletes?"included":"ignored"})]})]})})(),s==="trigger"&&(()=>{const K=X.trigger;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("dt",{children:"Extractor interval"}),n.jsxs("dd",{"data-tooltip":ee.triggerExtractorInterval,children:[K.extractIntervalMs," ms"]})]}),n.jsxs("div",{children:[n.jsx("dt",{children:"Trigger overhead"}),n.jsxs("dd",{"data-tooltip":ee.triggerOverhead,children:[K.triggerOverheadMs," ms"]})]}),typeof ae=="number"&&n.jsxs("div",{children:[n.jsx("dt",{children:"Write amplification"}),n.jsx("dd",{"data-tooltip":ee.triggerWriteAmplification,children:tt(ae)})]})]})})(),s==="log"&&(()=>{const K=X.log;return n.jsxs("div",{children:[n.jsx("dt",{children:"Fetch interval"}),n.jsxs("dd",{"data-tooltip":ee.logFetchInterval,children:[K.fetchIntervalMs," ms"]})]})})()]}),J.length>0&&n.jsx("div",{className:"sim-shell__callouts",children:J.map((K,Je)=>n.jsx("p",{className:`sim-shell__callout${K.tone==="warning"?" sim-shell__callout--warning":""}`,"data-tour-target":L&&A&&Je===0?"comparator-callouts":void 0,children:K.text},`${s}-callout-${Je}`))}),n.jsxs("section",{className:"sim-shell__lane-why","aria-label":`When to use ${k.label}`,children:[n.jsx("h4",{children:"When to use"}),n.jsx("p",{children:k.whenToUse})]}),Ae?n.jsxs("ul",{className:"sim-shell__event-list","aria-live":"polite",children:[kt&&n.jsx("li",{className:"sim-shell__event sim-shell__event--notice",children:n.jsxs("span",{children:["Showing latest ",Ps," of ",Fe.length," matching events."]})}),xn.length===0?n.jsx("li",{className:"sim-shell__empty",children:zt?"No events match the current filters.":"No events yet."}):xn.map(K=>n.jsxs("li",{className:`sim-shell__event${K.op==="d"?" sim-shell__event--delete":""}`,children:[n.jsx("span",{className:"sim-shell__event-op","data-op":K.op,children:K.op}),n.jsxs("span",{children:["#",K.seq," · pk=",K.pk.id]}),n.jsxs("span",{className:"sim-shell__event-target",children:["ts=",K.ts_ms,"ms"]})]},`${s}-${K.seq}`))]}):n.jsx("p",{className:"sim-shell__lane-hidden",children:"Timeline hidden. Use “Show timeline” to view recent events."})]},s)})}),n.jsxs("footer",{className:"sim-shell__footer",children:["Scenario clock: ",Y,"ms · ",re.reduce((s,i)=>s+i.events.length,0)," total events emitted"]})]})}function Qn(){if(typeof window>"u")return;const t=window.telemetry;if(t&&typeof t.track=="function"&&typeof t.flush=="function")return t;let e;try{e=window.localStorage}catch{e=void 0}const r=Ua({storage:e,console:typeof console<"u"?{warn:console.warn.bind(console),debug:console.debug.bind(console)}:void 0});return window.telemetry=r,r}function Jn(){const t=document.getElementById("simShellRoot");if(!t){console.warn("Simulator UI shell mount point not found (simShellRoot).");return}Kr.createRoot(t).render(n.jsx(Yi,{}))}document.readyState==="loading"?(Qn(),document.addEventListener("DOMContentLoaded",Jn,{once:!0})):(Qn(),Jn());
