import{r as x,j as e,R as E}from"./event-log-widget.js";let P=0;function N(s="tx"){return P+=1,`${s}-${P.toString(36)}`}const w={partitions:3,commitDrift:!1,schemaDrift:!1,dropProbability:0,applyPolicy:"apply-on-commit",projectSchemaDrift:!0,maxApplyPerTick:4},$=["id","email","name","tier"],k="priority_flag",A=s=>{let c=0;for(let t=0;t<s.length;t+=1)c=(c*31+s.charCodeAt(t))%9973;return c},L=(s,c)=>{if(c<=0)return!1;const t=Math.floor(c*100);return A(String(s))%100<t},R=(s,c)=>c<=1?0:A(s)%c,B=(s,c,t)=>{if(c.type==="delete")return;const n={...s??{},...c.after??{}};return!t&&k in n&&delete n[k],n},M=(s,c,t)=>{const n=s[c.table]??{},l=n[c.pk],o=B(l,c,t),r={...n};return o?r[c.pk]=o:delete r[c.pk],{...s,[c.table]:r}},b=(s,c)=>{let t=s,n=s.broker.partitions.map(l=>[...l]);for(const l of c){const o=R(l.pk,s.options.partitions),r=s.options.commitDrift?A(`${l.txId}:${l.index}`)%2:0,i=[...n[o]],m=s.options.commitDrift?0:i.length;i.splice(m,0,{...l,partition:o,offset:m,availableAt:s.clockMs+r*50}),n[o]=i,t={...t,metrics:{...t.metrics,latestCommitTs:Math.max(t.metrics.latestCommitTs,l.commitTs)}}}return{...t,broker:{...t.broker,partitions:n}}},F=(s,c)=>{let t={...s.consumer,buffered:{...s.consumer.buffered}};const n=[];for(const l of c){const o=t.buffered[l.txId],r=o?{...o,events:[...o.events,l]}:{events:[l],total:l.total,commitTs:l.commitTs,lsn:l.lsn};if(s.options.applyPolicy==="apply-as-polled"){t.tables=M(t.tables,l,s.options.projectSchemaDrift),t.appliedLog=[...t.appliedLog,l],t.lastAppliedCommitTs=Math.max(t.lastAppliedCommitTs,l.commitTs);const m=r.events.length>=r.total;t.buffered=m?Object.fromEntries(Object.entries(t.buffered).filter(([p])=>p!==l.txId)):{...t.buffered,[l.txId]:r};continue}const i={...t.buffered,[l.txId]:r};if(r.events.length>=r.total){n.push({events:[...r.events].sort((h,d)=>h.index-d.index),commitTs:r.commitTs,lsn:r.lsn});const{[l.txId]:m,...p}=i;t.buffered=p}else t.buffered=i}if(s.options.applyPolicy==="apply-on-commit"){const l=[...t.ready,...n],o=[...l.map(d=>d.commitTs),...Object.values(t.buffered).map(d=>d.commitTs),...s.broker.partitions.flat().map(d=>d.commitTs)],r=o.length>0?Math.min(...o):1/0,m=l.filter(d=>d.commitTs<=r).sort((d,a)=>d.commitTs===a.commitTs?d.lsn-a.lsn:d.commitTs-a.commitTs).slice(0,s.options.maxApplyPerTick);let p={...t.tables};for(const d of m){for(const a of d.events)p=M(p,a,s.options.projectSchemaDrift);t.appliedLog=[...t.appliedLog,...d.events],t.lastAppliedCommitTs=Math.max(t.lastAppliedCommitTs,d.commitTs)}const h=l.filter(d=>!m.includes(d));t={...t,tables:p,ready:h}}return{...s,consumer:t,metrics:{...s.metrics}}},U=s=>{const c=s.broker.partitions.map(l=>[...l]),t=[],n=s.options.maxApplyPerTick*s.options.partitions+s.options.maxApplyPerTick;for(let l=0;l<c.length;l+=1){const o=c[l];let r=0;for(;o.length>0&&o[0].availableAt<=s.clockMs&&t.length<n&&r<s.options.maxApplyPerTick;){const i=o.shift();r+=1,!L(i.lsn,s.options.dropProbability)&&t.push(i)}c[l]=o}return{nextState:{...s,broker:{...s.broker,partitions:c}},delivered:t}},_=(s,c,t,n,l,o,r)=>{const i=r?.txId??N(),m=r?.commitTs??s.clockMs+100,p=s.lsn+1,h=r?.total??1,d=r?.index??0;return{event:{txId:i,lsn:p,commitTs:m,type:t,table:c,pk:n,before:o??null,after:l,schemaVersion:s.schemaVersion,index:d,total:h,availableAt:s.clockMs},nextState:{...s,lsn:p,metrics:{...s.metrics,latestCommitTs:Math.max(s.metrics.latestCommitTs,m)}}}},v=(s,c,t)=>{const n=[...s.source.rows.filter(l=>!(l.table===c&&l.id===t.id)),{table:c,id:t.id,data:t}];return{...s,source:{...s.source,rows:n}}},V=(s,c,t)=>{const n=s.source.rows.filter(l=>!(l.table===c&&l.id===t));return{...s,source:{...s.source,rows:n}}},q=()=>[{table:"customers",id:"C-100",data:{id:"C-100",email:"ada@example.com",name:"Ada Lovelace",tier:"gold"}},{table:"customers",id:"C-200",data:{id:"C-200",email:"lin@example.com",name:"Lin Cheng",tier:"silver"}},{table:"orders",id:"O-500",data:{id:"O-500",customer_id:"C-100",status:"processing"}}],S=s=>({clockMs:0,lsn:0,schemaVersion:1,options:{...w,...s},source:{rows:q(),log:[]},broker:{partitions:Array.from({length:s?.partitions??w.partitions},()=>[]),dropped:0},consumer:{tables:{},buffered:{},ready:[],lastAppliedCommitTs:0,appliedLog:[]},metrics:{latestCommitTs:0}}),j=(s,c)=>({...s,source:{...s.source,log:[...s.source.log,...c]}}),T=(s,c)=>s.options.schemaDrift?{...c,[k]:!0}:c,D=(s,c)=>{const t=`C-${500+c}`,n={id:t,email:`user${c}@example.com`,name:`Customer ${c}`,tier:c%2===0?"gold":"silver"},l=T(s,n);return _(s,"customers","insert",t,l)},J=(s,c,t)=>{const n=N(),l=s.clockMs+120,o=1+t,r=`O-${800+s.lsn}`;let i=s;const{event:m,nextState:p}=_(i,"orders","insert",r,T(i,{id:r,customer_id:c,status:"created"}),null,{txId:n,commitTs:l,total:o,index:0});i=p;const h=[m];for(let d=0;d<t;d+=1){const{event:a,nextState:f}=_(i,"order_items","insert",`${r}-ITEM-${d+1}`,T(i,{id:`${r}-ITEM-${d+1}`,order_id:r,sku:`SKU-${d+1}`,qty:1}),null,{txId:n,commitTs:l,total:o,index:d+1});i=f,h.push(a)}return{events:h,nextState:i}},K=s=>{const c=s.consumer.lastAppliedCommitTs>0?Math.max(0,s.metrics.latestCommitTs-s.consumer.lastAppliedCommitTs):0,t=s.broker.partitions.reduce((n,l)=>n+l.length,0)+Object.values(s.consumer.buffered).reduce((n,l)=>n+l.events.length,0)+s.consumer.ready.reduce((n,l)=>n+l.events.length,0);return{lagMs:c,backlog:t}};function H(s){let c={...s.consumer.tables},t=[...s.consumer.appliedLog],n=s.consumer.lastAppliedCommitTs;for(const l of s.consumer.ready){for(const o of l.events)c=M(c,o,s.options.projectSchemaDrift);t=[...t,...l.events],n=Math.max(n,l.commitTs)}return{...s,consumer:{...s.consumer,tables:c,ready:[],buffered:{},appliedLog:t,lastAppliedCommitTs:n}}}const W=(s,c)=>{switch(c.type){case"reset":return S({...s.options});case"seed":return S({...s.options});case"setApplyPolicy":{let t=H(s);return{...t,options:{...t.options,applyPolicy:c.policy},consumer:{...t.consumer,buffered:{},ready:[]}}}case"setDropProbability":return{...s,options:{...s.options,dropProbability:c.probability}};case"toggleCommitDrift":return{...s,options:{...s.options,commitDrift:c.enabled}};case"toggleSchemaDrift":return{...s,options:{...s.options,schemaDrift:c.enabled},schemaVersion:c.enabled?s.schemaVersion+1:s.schemaVersion};case"setProjectSchemaDrift":return{...s,options:{...s.options,projectSchemaDrift:c.project}};case"setMaxApply":return{...s,options:{...s.options,maxApplyPerTick:c.maxApplyPerTick}};case"insertCustomers":{let t=s;const n=[],l=c.count??1;for(let o=0;o<l;o+=1){const{event:r,nextState:i}=D(t,o+1+s.source.rows.length);t=v(i,"customers",r.after??{}),n.push(r)}return t=j(t,n),b(t,n)}case"placeOrder":{const t=s.source.rows.find(i=>i.table==="customers")?.id??"C-100",n=c.items??2,{events:l,nextState:o}=J(s,t,n);let r=o;for(const i of l)r=v(r,i.table,i.after??{});return r=j(r,l),b(r,l)}case"updateCustomer":{const t=s.source.rows.find(p=>p.table==="customers"&&(!c.id||p.id===c.id));if(!t)return s;const n=T(s,{...t.data,tier:c.tier??(t.data.tier==="gold"?"platinum":"gold")}),l=c.commitTs??s.clockMs+100,{event:o,nextState:r}=_(s,"customers","update",t.id,n,t.data,{txId:N(),commitTs:l}),i=v(r,"customers",n),m=j(i,[o]);return b(m,[o])}case"deleteCustomer":{const t=s.source.rows.find(i=>i.table==="customers");if(!t)return s;const{event:n,nextState:l}=_(s,"customers","delete",t.id,null,t.data,{txId:N()}),o=V(l,"customers",t.id),r=j(o,[n]);return b(r,[n])}case"injectBacklog":{let t=s;const n=[];for(let l=0;l<c.count;l+=1){const{event:o,nextState:r}=D(t,l+1e3+s.source.rows.length);t=v(r,"customers",o.after??{}),n.push(o)}return t=j(t,n),b(t,n)}case"tick":{const t=c.deltaMs??50;let n={...s,clockMs:s.clockMs+t};const{nextState:l,delivered:o}=U(n);return n=l,n=F(n,o),n}default:return s}},z=s=>{const{lagMs:c,backlog:t}=K(s);return{source:s.source,broker:s.broker,consumer:s.consumer,options:s.options,metrics:{...s.metrics,lagMs:c,backlog:t}}},G=[...$,k],C=[.5,1,2],I=50,g=s=>`${s} ms`,Q=({type:s})=>e.jsx("span",{className:`cf-badge cf-badge--${s}`,children:s}),y=({event:s,showPartition:c=!1,showAvailability:t=!1,tone:n})=>e.jsxs("div",{className:`cf-event-card${n?` cf-event-card--${n}`:""}`,children:[e.jsxs("div",{className:"cf-event-card__header",children:[e.jsx(Q,{type:s.type}),e.jsxs("span",{className:"cf-event-card__tx",children:["tx ",s.txId]})]}),e.jsxs("dl",{className:"cf-event-card__meta",children:[e.jsxs("div",{children:[e.jsx("dt",{children:"lsn"}),e.jsx("dd",{children:s.lsn})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"commit"}),e.jsx("dd",{children:g(s.commitTs)})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"index"}),e.jsxs("dd",{children:[s.index+1,"/",s.total]})]}),c?e.jsxs("div",{children:[e.jsx("dt",{children:"partition"}),e.jsx("dd",{children:s.partition??0})]}):null,t?e.jsxs("div",{children:[e.jsx("dt",{children:"available"}),e.jsx("dd",{children:g(s.availableAt)})]}):null]}),e.jsxs("div",{className:"cf-event-card__body",children:[e.jsx("div",{className:"cf-event-card__table",children:s.table}),e.jsxs("div",{className:"cf-event-card__pk",children:["pk ",s.pk]})]})]}),X=s=>{if(s.source.log.length===0&&s.broker.partitions.every(n=>n.length===0)&&Object.keys(s.consumer.buffered).length===0&&s.consumer.ready.length===0&&s.consumer.appliedLog.length===0)return[];const c=new Map,t=(n,l)=>{const r=c.get(n.txId)??{txId:n.txId,total:n.total,commitTs:n.commitTs,lsn:n.lsn,stages:{source:0,broker:0,buffered:0,ready:0,applied:0}};r.stages[l]+=1,r.total=Math.max(r.total,n.total),r.commitTs=Math.max(r.commitTs,n.commitTs),r.lsn=Math.max(r.lsn,n.lsn),c.set(n.txId,r)};s.source.log.forEach(n=>t(n,"source"));for(const n of s.broker.partitions)for(const l of n)t(l,"broker");for(const n of Object.values(s.consumer.buffered))for(const l of n.events)t(l,"buffered");for(const n of s.consumer.ready)for(const l of n.events)t(l,"ready");return s.consumer.appliedLog.forEach(n=>t(n,"applied")),Array.from(c.values()).sort((n,l)=>n.commitTs===l.commitTs?n.lsn-l.lsn:n.commitTs-l.commitTs)};function Y(){const[s,c]=x.useReducer(W,void 0,()=>S()),[t,n]=x.useState(1),[l,o]=x.useState(!0),r=x.useMemo(()=>({...z(s),clockMs:s.clockMs}),[s]);x.useEffect(()=>{if(!l)return;const a=window.setInterval(()=>{c({type:"tick",deltaMs:Math.round(I*t)})},Math.round(I*2));return()=>window.clearInterval(a)},[t,l]);const i=x.useMemo(()=>X(r),[r]),m=a=>c({type:"setApplyPolicy",policy:a}),p=a=>c({type:"toggleSchemaDrift",enabled:a}),h=a=>c({type:"setProjectSchemaDrift",project:a}),d=x.useMemo(()=>r.source.log.slice(-12).reverse(),[r.source.log]);return e.jsxs("section",{className:"cf-shell","aria-label":"Change feed playground",children:[e.jsxs("header",{className:"cf-shell__header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cf-shell__eyebrow",children:"Change Feed Playground"}),e.jsx("h3",{className:"cf-shell__title",children:"Source → Change Feed → Consumer"}),e.jsx("p",{className:"cf-shell__lede",children:"Drive inserts, updates, deletes, and multi-table transactions to watch ordering, drift, and apply policies across the pipeline."})]}),e.jsxs("div",{className:"cf-shell__metrics",role:"status","aria-live":"polite",children:[e.jsxs("div",{className:"cf-metric",children:[e.jsx("span",{className:"cf-metric__label",children:"Lag"}),e.jsx("span",{className:"cf-metric__value",children:g(r.metrics.lagMs)})]}),e.jsxs("div",{className:"cf-metric",children:[e.jsx("span",{className:"cf-metric__label",children:"Backlog"}),e.jsx("span",{className:"cf-metric__value",children:r.metrics.backlog})]}),e.jsxs("div",{className:"cf-metric",children:[e.jsx("span",{className:"cf-metric__label",children:"Commit drift"}),e.jsx("span",{className:"cf-metric__value",children:r.options.commitDrift?"on":"off"})]})]})]}),e.jsxs("div",{className:"cf-toolbar",role:"group","aria-label":"Playground controls",children:[e.jsxs("div",{className:"cf-toolbar__row",children:[e.jsxs("label",{className:"cf-field",children:[e.jsx("span",{className:"cf-field__label",children:"Speed"}),e.jsx("input",{type:"range",min:0,max:C.length-1,step:1,value:C.indexOf(t),onChange:a=>n(C[Number(a.target.value)]??1)}),e.jsxs("span",{className:"cf-field__value",children:[t,"x"]})]}),e.jsxs("label",{className:"cf-field",children:[e.jsx("span",{className:"cf-field__label",children:"Apply policy"}),e.jsxs("select",{value:r.options.applyPolicy,onChange:a=>m(a.target.value),children:[e.jsx("option",{value:"apply-on-commit",children:"Apply on commit"}),e.jsx("option",{value:"apply-as-polled",children:"Apply as polled"})]})]}),e.jsxs("label",{className:"cf-field cf-field--toggle",children:[e.jsx("input",{type:"checkbox",checked:r.options.commitDrift,onChange:a=>c({type:"toggleCommitDrift",enabled:a.target.checked})}),e.jsx("span",{children:"Commit drift"})]}),e.jsxs("label",{className:"cf-field cf-field--toggle",children:[e.jsx("input",{type:"checkbox",checked:r.options.schemaDrift,onChange:a=>p(a.target.checked)}),e.jsx("span",{children:"Schema drift"})]}),e.jsxs("label",{className:"cf-field cf-field--toggle",children:[e.jsx("input",{type:"checkbox",checked:r.options.projectSchemaDrift,onChange:a=>h(a.target.checked)}),e.jsx("span",{children:"Project drifted column"})]}),e.jsxs("label",{className:"cf-field",children:[e.jsx("span",{className:"cf-field__label",children:"Faults (drop %)"}),e.jsx("input",{type:"range",min:0,max:.4,step:.05,value:r.options.dropProbability,onChange:a=>c({type:"setDropProbability",probability:Number(a.target.value)}),"aria-valuetext":`${Math.round(r.options.dropProbability*100)}%`}),e.jsxs("span",{className:"cf-field__value",children:[Math.round(r.options.dropProbability*100),"%"]})]}),e.jsxs("div",{className:"cf-toolbar__actions",children:[e.jsx("button",{type:"button",onClick:()=>o(a=>!a),children:l?"Pause":"Resume"}),e.jsx("button",{type:"button",onClick:()=>c({type:"reset"}),children:"Reset & Seed"})]})]}),e.jsx("div",{className:"cf-toolbar__row",children:e.jsxs("div",{className:"cf-toolbar__actions",children:[e.jsx("button",{type:"button",onClick:()=>c({type:"insertCustomers",count:1}),children:"Insert customers"}),e.jsx("button",{type:"button",onClick:()=>c({type:"placeOrder",items:2}),children:"Place order"}),e.jsx("button",{type:"button",onClick:()=>c({type:"updateCustomer"}),children:"Update customer"}),e.jsx("button",{type:"button",onClick:()=>c({type:"deleteCustomer"}),children:"Delete customer"}),e.jsx("button",{type:"button",onClick:()=>c({type:"injectBacklog",count:8}),children:"Inject backlog"}),e.jsx("button",{type:"button",onClick:()=>c({type:"setMaxApply",maxApplyPerTick:1}),children:"Throttle"}),e.jsx("button",{type:"button",onClick:()=>c({type:"setMaxApply",maxApplyPerTick:12}),children:"Catch up"})]})})]}),e.jsxs("div",{className:"cf-lanes",role:"group","aria-label":"Change feed lanes",children:[e.jsxs("div",{className:"cf-lane",children:[e.jsxs("header",{className:"cf-lane__header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cf-lane__eyebrow",children:"Source"}),e.jsx("h4",{className:"cf-lane__title",children:"Rows & captured events"})]}),e.jsxs("div",{className:"cf-lane__meta",children:[e.jsxs("span",{children:[r.source.rows.length," rows"]}),e.jsxs("span",{children:[r.source.log.length," events"]})]})]}),e.jsxs("div",{className:"cf-lane__body",children:[e.jsx("div",{className:"cf-grid cf-grid--rows",children:G.map(a=>e.jsx("span",{className:"cf-chip",children:a},a))}),e.jsxs("div",{className:"cf-table",children:[e.jsx("div",{className:"cf-table__header",children:"Latest rows"}),e.jsx("div",{className:"cf-table__body",children:r.source.rows.slice(-5).map(a=>e.jsxs("div",{className:"cf-table__row",children:[e.jsx("span",{className:"cf-table__cell",children:a.table}),e.jsx("span",{className:"cf-table__cell",children:a.id}),e.jsx("span",{className:"cf-table__cell",children:JSON.stringify(a.data)})]},`${a.table}-${a.id}`))})]}),e.jsx("div",{className:"cf-event-stack","aria-label":"Source log",children:d.map(a=>e.jsx(y,{event:a},`source-${a.lsn}`))})]})]}),e.jsxs("div",{className:"cf-lane",children:[e.jsxs("header",{className:"cf-lane__header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cf-lane__eyebrow",children:"Change feed"}),e.jsx("h4",{className:"cf-lane__title",children:"Broker partitions"})]}),e.jsxs("div",{className:"cf-lane__meta",children:[e.jsxs("span",{children:[r.broker.partitions.length," partitions"]}),e.jsxs("span",{children:[r.broker.partitions.reduce((a,f)=>a+f.length,0)," buffered"]})]})]}),e.jsx("div",{className:"cf-lane__body",children:e.jsx("div",{className:"cf-partitions",children:r.broker.partitions.map((a,f)=>e.jsxs("div",{className:"cf-partition",children:[e.jsxs("div",{className:"cf-partition__header",children:["Partition ",f]}),e.jsxs("div",{className:"cf-partition__queue",children:[a.length===0?e.jsx("p",{className:"cf-empty",children:"idle"}):null,a.map(u=>e.jsx(y,{event:u,showPartition:!0,showAvailability:!0,tone:"muted"},`broker-${u.lsn}`))]})]},`partition-${f}`))})})]}),e.jsxs("div",{className:"cf-lane",children:[e.jsxs("header",{className:"cf-lane__header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cf-lane__eyebrow",children:"Consumer"}),e.jsx("h4",{className:"cf-lane__title",children:"Buffered vs applied"})]}),e.jsxs("div",{className:"cf-lane__meta",children:[e.jsxs("span",{children:[r.consumer.appliedLog.length," applied"]}),e.jsxs("span",{children:[Object.keys(r.consumer.tables).length," tables"]})]})]}),e.jsxs("div",{className:"cf-lane__body",children:[e.jsxs("div",{className:"cf-buffered",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cf-subtitle",children:"Buffered"}),e.jsxs("div",{className:"cf-event-stack",children:[Object.values(r.consumer.buffered).map(a=>a.events.map(f=>e.jsx(y,{event:f,tone:"muted"},`buffered-${f.lsn}`))),r.consumer.ready.flatMap(a=>a.events).length===0&&Object.values(r.consumer.buffered).flatMap(a=>a.events).length===0?e.jsx("p",{className:"cf-empty",children:"No buffered events"}):null]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"cf-subtitle",children:"Applied"}),e.jsx("div",{className:"cf-event-stack",children:r.consumer.appliedLog.slice(-12).map(a=>e.jsx(y,{event:a,tone:"active"},`applied-${a.lsn}`))})]})]}),e.jsxs("div",{className:"cf-table",children:[e.jsx("div",{className:"cf-table__header",children:"Consumer tables"}),e.jsx("div",{className:"cf-table__body",children:Object.entries(r.consumer.tables).map(([a,f])=>e.jsxs("div",{className:"cf-table__row cf-table__row--nested",children:[e.jsx("span",{className:"cf-table__cell",children:a}),e.jsxs("span",{className:"cf-table__cell cf-table__cell--muted",children:[Object.keys(f).length," rows"]}),e.jsx("div",{className:"cf-table__nested",children:Object.values(f).slice(-4).map(u=>e.jsxs("div",{className:"cf-table__nested-row",children:[e.jsx("span",{children:u.id??"row"}),e.jsx("span",{className:"cf-table__cell--muted",children:JSON.stringify(u)})]},u.id??JSON.stringify(u)))})]},a))})]})]})]})]}),e.jsxs("section",{className:"cf-transactions","aria-label":"Transaction atomicity",children:[e.jsxs("header",{className:"cf-transactions__header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cf-lane__eyebrow",children:"Transactions"}),e.jsx("h4",{className:"cf-lane__title",children:"Atomicity across lanes"}),e.jsx("p",{className:"cf-transactions__hint",children:"Each bracket shows how many events from a transaction are visible in the source log, broker partitions, buffered pool, and applied tables."})]}),e.jsxs("span",{className:"cf-clock",children:["Clock ",g(r.clockMs)]})]}),e.jsxs("div",{className:"cf-transaction-list",children:[i.length===0?e.jsx("p",{className:"cf-empty",children:"Run an operation to see transactions"}):null,i.map(a=>{const f=Math.min(1,a.stages.applied/a.total),u=a.stages.buffered+a.stages.ready;return e.jsxs("div",{className:"cf-transaction",children:[e.jsxs("div",{className:"cf-transaction__meta",children:[e.jsxs("span",{className:"cf-transaction__tx",children:["tx ",a.txId]}),e.jsxs("span",{className:"cf-transaction__commit",children:["commit ",g(a.commitTs)]}),e.jsxs("span",{className:"cf-transaction__total",children:[a.total," events"]})]}),e.jsxs("div",{className:"cf-transaction__stages",role:"list",children:[e.jsxs("div",{className:"cf-transaction__stage",role:"listitem",children:[e.jsx("span",{className:"cf-stage__label",children:"source"}),e.jsx("span",{className:"cf-stage__value",children:a.stages.source})]}),e.jsxs("div",{className:"cf-transaction__stage",role:"listitem",children:[e.jsx("span",{className:"cf-stage__label",children:"broker"}),e.jsx("span",{className:"cf-stage__value",children:a.stages.broker})]}),e.jsxs("div",{className:"cf-transaction__stage",role:"listitem",children:[e.jsx("span",{className:"cf-stage__label",children:"buffered"}),e.jsx("span",{className:"cf-stage__value",children:u})]}),e.jsxs("div",{className:"cf-transaction__stage",role:"listitem",children:[e.jsx("span",{className:"cf-stage__label",children:"applied"}),e.jsx("span",{className:"cf-stage__value",children:a.stages.applied})]})]}),e.jsxs("div",{className:"cf-transaction__progress",children:[e.jsx("span",{className:"cf-progress",role:"progressbar","aria-label":"Applied progress","aria-valuenow":a.stages.applied,"aria-valuemin":0,"aria-valuemax":a.total,style:{width:`${f*100}%`}}),e.jsx("span",{className:"cf-progress cf-progress--buffered",role:"progressbar","aria-label":"Buffered progress","aria-valuenow":u,"aria-valuemin":0,"aria-valuemax":a.total,style:{width:`${Math.min(1,u/a.total)*100}%`}})]})]},a.txId)})]})]})]})}function O(){const s=document.getElementById("changefeedPlaygroundRoot");if(!s){console.warn("Change feed playground mount point not found (changefeedPlaygroundRoot).");return}E.createRoot(s).render(e.jsx(Y,{}))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",O,{once:!0}):O();
