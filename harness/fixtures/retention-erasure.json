{
  "id": "retention-erasure",
  "name": "Retention & Erasure",
  "description": "Walk through right-to-be-forgotten and legal hold flows.",
  "tags": [
    "gdpr",
    "retention",
    "privacy"
  ],
  "schema": [
    {
      "name": "id",
      "type": "string",
      "pk": true
    },
    {
      "name": "email",
      "type": "string",
      "pk": false
    },
    {
      "name": "status",
      "type": "string",
      "pk": false
    },
    {
      "name": "marketing_opt_in",
      "type": "bool",
      "pk": false
    },
    {
      "name": "deletion_requested",
      "type": "bool",
      "pk": false
    },
    {
      "name": "deleted_ts",
      "type": "number",
      "pk": false
    }
  ],
  "rows": [
    {
      "id": "C-300",
      "email": "samira@example.com",
      "status": "active",
      "marketing_opt_in": true,
      "deletion_requested": false
    },
    {
      "id": "C-301",
      "email": "leena@example.com",
      "status": "active",
      "marketing_opt_in": false,
      "deletion_requested": false
    }
  ],
  "ops": [
    {
      "t": 20,
      "op": "insert",
      "table": "marketing_preferences",
      "pk": {
        "id": "MP-300"
      },
      "after": {
        "customer_id": "C-300",
        "channel": "email",
        "status": "opt_in"
      }
    },
    {
      "t": 30,
      "op": "insert",
      "table": "marketing_preferences",
      "pk": {
        "id": "MP-301"
      },
      "after": {
        "customer_id": "C-301",
        "channel": "sms",
        "status": "opt_out"
      }
    },
    {
      "t": 40,
      "op": "insert",
      "table": "deletion_requests",
      "pk": {
        "id": "DR-300"
      },
      "after": {
        "customer_id": "C-300",
        "reason": "right_to_be_forgotten"
      }
    },
    {
      "t": 60,
      "op": "update",
      "table": "customers",
      "pk": {
        "id": "C-300"
      },
      "after": {
        "deletion_requested": true,
        "status": "pending_erasure"
      }
    },
    {
      "t": 80,
      "op": "insert",
      "table": "retention_audits",
      "pk": {
        "id": "AUD-300-1"
      },
      "after": {
        "customer_id": "C-300",
        "action": "mask_email",
        "actor": "privacy-bot"
      }
    },
    {
      "t": 90,
      "op": "update",
      "table": "customers",
      "pk": {
        "id": "C-300"
      },
      "after": {
        "email": null,
        "marketing_opt_in": false
      }
    },
    {
      "t": 110,
      "op": "delete",
      "table": "marketing_preferences",
      "pk": {
        "id": "MP-300"
      }
    },
    {
      "t": 150,
      "op": "delete",
      "table": "customers",
      "pk": {
        "id": "C-300"
      }
    },
    {
      "t": 190,
      "op": "insert",
      "table": "deletion_requests",
      "pk": {
        "id": "DR-301"
      },
      "after": {
        "customer_id": "C-301",
        "reason": "retention_window"
      }
    },
    {
      "t": 230,
      "op": "update",
      "table": "customers",
      "pk": {
        "id": "C-301"
      },
      "after": {
        "deletion_requested": true,
        "deleted_ts": 230,
        "status": "retained_for_legal"
      }
    },
    {
      "t": 260,
      "op": "insert",
      "table": "retention_audits",
      "pk": {
        "id": "AUD-301-1"
      },
      "after": {
        "customer_id": "C-301",
        "action": "legal_hold",
        "actor": "risk-team"
      }
    },
    {
      "t": 320,
      "op": "update",
      "table": "customers",
      "pk": {
        "id": "C-301"
      },
      "after": {
        "status": "erased",
        "email": null,
        "marketing_opt_in": false
      }
    },
    {
      "t": 360,
      "op": "delete",
      "table": "marketing_preferences",
      "pk": {
        "id": "MP-301"
      }
    }
  ]
}